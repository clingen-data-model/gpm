"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[684],{8709:function(e,t,n){n.r(t),n.d(t,{default:function(){return y}});var a=n(6252),o=n(3577),i=n(9963);const s=(0,a._)("option",{value:null},"Select...",-1),r=["value"],l=(0,a.Uk)("    "),d=(0,a._)("div",{class:"ml-4"},null,-1);function c(e,t,n,c,u,p){const m=(0,a.up)("input-row"),_=(0,a.up)("step-input"),h=(0,a.up)("rich-text-editor"),w=(0,a.up)("checkbox"),A=(0,a.up)("button-row"),g=(0,a.up)("form-container");return(0,a.wg)(),(0,a.j4)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(m,{label:"Creation Date",errors:u.errors.date_created,type:"date",modelValue:u.newAction.date_created,"onUpdate:modelValue":t[0]||(t[0]=e=>u.newAction.date_created=e)},null,8,["errors","modelValue"]),2==p.application.expert_panel_type_id?((0,a.wg)(),(0,a.j4)(_,{key:0,modelValue:u.newAction.step,"onUpdate:modelValue":t[1]||(t[1]=e=>u.newAction.step=e),errors:u.errors.step},null,8,["modelValue","errors"])):(0,a.kq)("",!0),(0,a.Wm)(m,{label:"Target",Date:"",errors:u.errors.target_date,type:"date",modelValue:u.newAction.target_date,"onUpdate:modelValue":t[2]||(t[2]=e=>u.newAction.target_date=e)},null,8,["errors","modelValue"]),(0,a.Wm)(m,{label:"Entry",errors:u.errors.entry},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{modelValue:u.newAction.entry,"onUpdate:modelValue":t[3]||(t[3]=e=>u.newAction.entry=e)},null,8,["modelValue"])])),_:1},8,["errors"]),(0,a.Wm)(m,{label:"Assigned To",errors:p.assignmentErrors},{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("select",{id:"","onUpdate:modelValue":t[4]||(t[4]=e=>u.newAction.assigned_to=e)},[s,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(p.assignees,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.id,value:e.id},(0,o.zw)(e.name),9,r)))),128))],512),[[i.bM,u.newAction.assigned_to]]),l,(0,a.wy)((0,a._)("input",{type:"text",label:"Name","onUpdate:modelValue":t[5]||(t[5]=e=>u.newAction.assigned_to_name=e),placeholder:"Name (optional)"},null,512),[[i.nr,u.newAction.assigned_to_name]])])),_:1},8,["errors"]),d,(0,a.Wm)(w,{modelValue:u.completed,"onUpdate:modelValue":t[6]||(t[6]=e=>u.completed=e),label:"This is already completed",class:"ml-36"},null,8,["modelValue"]),u.completed?((0,a.wg)(),(0,a.j4)(m,{key:1,label:"Date Completed",errors:u.errors.date_completed,class:"ml-36"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=e=>u.newAction.date_completed=e)},null,512),[[i.nr,u.newAction.date_completed]])])),_:1},8,["errors"])):(0,a.kq)("",!0),(0,a.Wm)(A,null,{default:(0,a.w5)((()=>[(0,a._)("button",{class:"btn",onClick:t[8]||(t[8]=(...e)=>p.cancel&&p.cancel(...e))},"Cancel"),(0,a._)("button",{class:"btn blue",onClick:t[9]||(t[9]=(...e)=>p.save&&p.save(...e))},"Save")])),_:1})])),_:1})}var u=n(703),p=n(3907),m=n(2584),_=n(5699),h=n(3823),w={name:"NextActionForm",components:{StepInput:u["default"],RichTextEditor:m["default"]},props:{id:{required:!1,default:null}},emits:["saved","closed","formCleared","canceled"],data(){return{errors:{},newAction:{date_created:new Date,step:null,date_completed:null,entry:"",assigned_to:null,assigned_to_name:null},completed:!1}},computed:{...(0,p.Se)({group:"groups/currentItemOrNew"}),application(){return this.group.expert_panel},title(){return this.newAction.id?"Update Action":"Add Next Action"},steps(){return[1,2,3,4]},assignmentErrors(){let e=[];return this.errors.assigned_to&&(e=[...e,...this.errors.assigned_to]),this.errors.assigned_to_name&&(e=[...e,...this.errors.assigned_to_name]),e},assignees(){return Object.values(h.nextActions.assignees)}},watch:{id:{immediate:!0,handler:function(){const e=this.findAction();e&&this.syncAction(e)}},application:{immediate:!0,handler:function(){const e=this.findAction();e&&this.syncAction(e)}}},methods:{cancel(){this.clearForm(),this.$emit("canceled")},clearForm(){this.initNewAction(),this.$emit("formCleared")},initNewAction(){this.newAction={date_created:new Date,step:null,target_date:null,date_completed:null,entry:"",assigned_to:null,assigned_to_name:null}},findAction(){return null===this.id?null:this.application.next_actions?this.application.next_actions.find((e=>e.id==this.id)):void 0},syncAction(e){e&&(this.newAction={id:e.id,uuid:e.uuid,date_created:(0,_.p6)(e.created_at),step:e.step,target_date:(0,_.p6)(e.target_date),date_completed:(0,_.p6)(e.date_completed),entry:e.entry??"",assigned_to:e.assigned_to,assigned_to_name:e.assigned_to_name})},async save(){try{this.newAction.id?(await this.$store.dispatch("applications/updateNextAction",{application:this.application,updatedAction:this.newAction}),this.$emit("saved"),this.clearForm()):(await this.$store.dispatch("applications/addNextAction",{application:this.application,nextActionData:this.newAction}),this.$emit("saved"),this.clearForm())}catch(e){if(e.response&&422==e.response.status&&e.response.data.errors)return void(this.errors=e.response.data.errors)}}},unmounted(){this.initNewAction()},mounted(){}},A=n(3744);const g=(0,A.Z)(w,[["render",c]]);var y=g}}]);
//# sourceMappingURL=next-action-form.ced57be8.js.map