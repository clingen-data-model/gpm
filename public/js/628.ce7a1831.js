"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[628],{2790:function(e,t,a){a.d(t,{Z:function(){return i}});a(6699);var l=a(2119),r=a(6252);function i(e=null){const t=(0,l.tv)(),a=(0,l.yj)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const i=(0,r.Fl)({immediate:!0,get(){return Object.keys(a.query).includes("sort-field")?{field:a.query["sort-field"],desc:Boolean(parseInt(a.query["sort-desc"]))}:e},set(e){const l={"sort-field":e.field,"sort-desc":e.desc?1:0},r={...a.query,...l};t.replace({path:a.path,query:r})}}),n=(0,r.Fl)({set(e){let l=a.query,r=a.path,i={...l};e?i={...l,filter:e}:delete i.filter,t.replace({path:r,query:i})},get(){return a.query.filter},immediate:!0});return{sort:i,filter:n}}},7143:function(e,t,a){a.r(t),a.d(t,{default:function(){return b}});var l=a(6252),r=a(9963),i=a(3577);const n=(0,l._)("h1",null,"Mail Log",-1),s={class:"mb-2"},o=(0,l.Uk)("Filter: "),d={key:0},c=["onClick"];function u(e,t,a,u,m,h){const g=(0,l.up)("data-table"),p=(0,l.up)("mail-detail"),f=(0,l.up)("modal-dialog"),w=(0,l.up)("custom-email-form");return(0,l.wg)(),(0,l.iD)("div",null,[n,(0,l.Wm)(g,{fields:m.fields,data:h.getPage,"row-class":"cursor-pointer","row-click-handler":h.showMailDetail,sort:u.sort,"onUpdate:sort":t[1]||(t[1]=e=>u.sort=e),"page-size":20,paginated:"",ref:"dataTable"},{header:(0,l.w5)((()=>[(0,l._)("div",s,[o,(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>u.filter=e)},null,512),[[r.nr,u.filter]])])])),"cell-to":(0,l.w5)((({item:e})=>[(0,l._)("ul",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.to,(e=>((0,l.wg)(),(0,l.iD)("li",{key:e.address},[e.name?((0,l.wg)(),(0,l.iD)("span",d,(0,i.zw)(e.name)+" - ",1)):(0,l.kq)("",!0),(0,l.Uk)(" "+(0,i.zw)(e.address),1)])))),128))])])),"cell-actions":(0,l.w5)((({item:t})=>[(0,l._)("div",null,[e.hasPermission("people-manage")?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn-xs",onClick:(0,r.iM)((e=>h.initResend(t)),["stop"])},"Resend",8,c)):(0,l.kq)("",!0)])])),_:1},8,["fields","data","row-click-handler","sort"]),((0,l.wg)(),(0,l.j4)(l.lR,{to:"body"},[(0,l.Wm)(f,{modelValue:m.showDetail,"onUpdate:modelValue":t[3]||(t[3]=e=>m.showDetail=e)},{default:(0,l.w5)((()=>[e.hasPermission("people-manage")?((0,l.wg)(),(0,l.j4)(p,{key:0,mail:m.currentEmail,onResend:t[2]||(t[2]=e=>h.initResend(m.currentEmail))},null,8,["mail"])):(0,l.kq)("",!0)])),_:1},8,["modelValue"]),(0,l.Wm)(f,{title:"Resend Email",modelValue:m.showResendDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>m.showResendDialog=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{"mail-data":m.currentEmail,onSent:h.cleanupResend,onCanceled:h.cleanupResend},null,8,["mail-data","onSent","onCanceled"])])),_:1},8,["modelValue"])]))])}var m=a(812),h=a(9183),g=a(5699),p=a(2790),f={props:{},setup(){const{sort:e,filter:t}=(0,p.Z)({field:"created_at",desc:!0});return{sort:e,filter:t}},data(){return{showDetail:!1,fields:[{name:"to",sortable:!0,type:Array,resolveValue(e){const t=Object.keys(e.to);return 0==t.length?"":1==t.length?t[0]:t.join("; ")}},{name:"subject",sortable:!0,type:String},{name:"created_at",label:"Sent at",sortable:!0,resolveValue(e){return(0,g.o0)(e.created_at)},resolveSort(e){return e.created_at},type:String},{name:"actions",label:"",sortable:!1}],data:[],currentEmail:{},showResendDialog:!1}},watch:{filter:{immediate:!0,handler:function(){this.triggerSearch&&this.triggerSearch()}},sort:{deep:!0,immediate:!0,handler:function(){this.triggerSearch&&this.triggerSearch()}}},methods:{async getPage(e,t,a,l){try{const r={page:e,page_size:t,"sort[field]":a.field.name,"sort[dir]":a.desc?"DESC":"ASC","where[filterString]":this.filter},i=await m.Z.get("/api/mail-log",{params:r}).then((e=>e.data));return l(i.total),i.data}catch(r){alert(r)}},showMailDetail(e){this.currentEmail=e,this.showDetail=!0},initResend(e){this.currentEmail=e,this.showResendDialog=!0},cleanupResend(){this.currentEmail={},this.showResendDialog=!1,this.$refs.dataTable.getItems()}},created(){this.triggerSearch=(0,h.Z)((()=>this.$refs.dataTable.getItems()),500)}},w=a(3744);const y=(0,w.Z)(f,[["render",u]]);var b=y}}]);
//# sourceMappingURL=628.ce7a1831.js.map