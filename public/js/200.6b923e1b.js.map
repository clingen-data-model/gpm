{"version":3,"file":"js/200.6b923e1b.js","mappings":"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","sources":["webpack://epam/./src/views/Coi.vue","webpack://epam/./src/survey.js","webpack://epam/./src/components/coi/CoiPolicy.vue","webpack://epam/./src/views/Coi.vue?6bb8"],"sourcesContent":["<template>\n    <div>\n        <card :title=\"verifying ? `Loading COI Form` : `COI Form not found`\" v-if=\"!codeIsValid\">\n            <div v-if=\"!verifying\">We couldn't find this COI.</div>\n        </card>\n        <card title=\"There's a problem\" v-if=\"!groupMemberId\">\n            We can't seem to find your membership for this group id.  Please try refreshing.\n        </card>\n\n        <card :title=\"coiTitle\"  class=\"mx-auto relative\" style=\"max-width:800px\" v-else-if=\"codeIsValid\">\n            <CoiPolicy />\n            <hr>\n            <h2>COI</h2>\n            <div class=\"relative\">\n                <div\n                    v-for=\"question in survey.questions\"\n                    :key=\"question.name\"\n                    :class=\"question.class\"\n                >\n                    <transition name=\"slide-fade-down\">\n                        <div v-if=\"question.type == 'content'\">\n                            <MarkdownBlock\n                                :markdown=\"question.content\"\n                            />\n                        </div>\n                        <input-row\n                            v-else\n                            :label=\"question.question_text\"\n                            :errors=\"errors[question.name]\"\n                            :vertical=\"true\"\n                            v-show=\"showQuestion(question)\"\n                        >\n\n                            <textarea  v-if=\"question.type == 'text'\"\n                                class=\"w-full h-24\"\n                                v-model=\"response[question.name]\"\n                                :name=\"question.name\"\n                            ></textarea>\n\n                            <div v-if=\"question.type == 'multiple-choice'\">\n                                <label v-for=\"option in question.options\" :key=\"option.value\" class=\"mb-1\">\n                                    <input type=\"radio\"\n                                        :value=\"option.value\"\n                                        :name=\"question.name\"\n                                        v-model=\"response[question.name]\"\n                                    >\n                                    <div>{{option.label}}</div>\n                                </label>\n                            </div>\n\n                            <input\n                                type=\"text\"\n                                v-if=\"question.type == 'string'\"\n                                v-model=\"response[question.name]\"\n                                :name=\"question.name\"\n                            >\n                        </input-row>\n                    </transition>\n                </div>\n                <button-row :show-cancel=\"false\" @submitClicked=\"storeResponse()\">\n                    <slot v-if=\"saving\">\n                        Saving...\n                    </slot>\n                </button-row>\n            </div>\n        </card>\n\n        <note class=\"container\">GroupMemberId: {{groupMemberId}}</note>\n    </div>\n</template>\n<script>\nimport coiDef from '../../../surveys/coi_v2.json'\nimport Survey from '@/survey'\nimport api from '@/http/api'\nimport is_validation_error from '@/http/is_validation_error';\nimport CoiPolicy from '@/components/coi/CoiPolicy'\nimport MarkdownBlock from '@/components/MarkdownBlock'\n\nconst survey = new Survey(coiDef);\n\nexport default {\n    name: 'Coi',\n    components: {\n        CoiPolicy,\n        MarkdownBlock\n    },\n    props: {\n        code: {\n            required: true,\n            type: String\n        }\n    },\n    data() {\n        return {\n            coiDef: coiDef,\n            survey: survey,\n            response: survey.getResponseTemplate(),\n            errors: {},\n            groupName: null,\n            verifying: false,\n            saved: false,\n            saving: false,\n            redirectCountdown: 5\n        }\n    },\n    computed: {\n        codeIsValid() {\n            return this.groupName !== null;\n        },\n        coiTitle() {\n            return survey.name+' for '+this.groupName;\n        },\n        membership () {\n            return this.$store.getters\n                    .currentUser\n                    .person.memberships.find(m => {\n                        return m.group\n                            && m.group.coi_code === this.code\n                    });\n        },\n        groupMemberId() {\n            if (this.membership) {\n                return this.membership.id;\n            }\n\n            return null;\n        },\n    },\n    watch: {\n        code: {\n            immediate: true,\n            handler () {\n                this.initResponseValues()\n            }\n        }\n    },\n    methods: {\n        initResponseValues() {\n            if (this.membership && this.membership.cois.length > 0) {\n                const lastResponse = {...this.membership.cois[this.membership.cois.length -1]};\n\n                const v2ResponseData = (lastResponse.version == '1.0.0')\n                    ? this.transformV1Response(lastResponse.data)\n                    : {...lastResponse.data};\n\n                v2ResponseData.coi_attestation = null\n                v2ResponseData.data_policy_attestation = null\n                this.response = v2ResponseData;\n            }\n\n            return {}\n        },\n\n        transformV1Response (lastResponse) {\n            const v2Response = {\n                work_fee_lab: lastResponse.work_fee_lab,\n                contributions_to_gd_in_group: lastResponse.contributions_to_gd_in_ep,\n                contributions_to_genes: lastResponse.contributions_to_genes,\n                coi: (lastResponse.independent_efforts == 0 && lastResponse.coi == 0) ? 0 : 1,\n                coi_details: [\n                                lastResponse.independent_efforts_details,\n                                lastResponse.coi_details\n                            ].join(\";\\n\")\n            }\n\n            if ((lastResponse.independent_efforts == 2 || lastResponse.coi == 2)) {\n                v2Response.coi = 2;\n            }\n\n            return v2Response;\n        },\n\n        showQuestion(question) {\n            if (!question.show) {\n                return true;\n            }\n            if (Array.isArray(question.show.value)) {\n                return question.show.value.indexOf(this.response[question.show.name]) > -1;\n            }\n            return (this.response[question.show.name] == question.show.value);\n        },\n        verifyCode() {\n            this.verifying = true;\n            api.get(`/api/coi/${this.code}/group`)\n                .then(response => {\n                    this.groupName = response.data.display_name\n                })\n                .then(() => {\n                    this.verifying = false;\n                })\n        },\n        async storeResponse() {\n            this.saving = true;\n            try {\n                await this.$store.dispatch(\n                    'storeCoi',\n                    {\n                        code: this.code,\n                        groupMemberId: this.groupMemberId,\n                        coiData: this.response,\n                    }\n                );\n                this.saved = true;\n                await this.$store.dispatch('forceGetCurrentUser');\n                this.$router.push({name: 'Dashboard'});\n            } catch (error) {\n                if (is_validation_error(error)) {\n                    this.errors = error.response.data.errors\n                } else {\n                    this.$store.commit('pushError', `You can not complete a COI for ${this.groupName} because you are not a member.`)\n                }\n            }\n            this.saving = false;\n        },\n    },\n    async mounted() {\n        this.verifyCode();\n        await this.$store.dispatch('getCurrentUser')\n    }\n}\n</script>\n","class Question {\n    constructor(question) {\n        this.question_text = question.question;\n        this.name = question.name;\n        this.options = question.options;\n        this.validationRules = question.validation;\n        this.type = question.type;\n        this.show = question.show;\n        this.class = question.class;\n        this.content = question.content;\n    }\n}\n\nclass YesNoQuestion extends Question {\n    constructor(question) {\n        super(question)\n        this.type = 'multiple-choice';\n        this.options = [{\n                label: 'Yes',\n                value: 1\n            },\n            {\n                label: 'No',\n                value: 0\n            }\n        ];\n    }\n}\n\nfunction makeQuestion(questionDef) {\n    if (questionDef.type == 'yes-no') {\n        return new YesNoQuestion(questionDef);\n    }\n\n    return new Question(questionDef);\n}\n\nclass Survey {\n    constructor(surveyDefinition) {\n        this._name = surveyDefinition.name;\n        this._questions = surveyDefinition.questions.map(q => makeQuestion(q));\n\n    }\n\n    get name() {\n        return this._name;\n    }\n\n    get questions() {\n        return this._questions\n    }\n\n    getResponseTemplate() {\n        const rsp = {};\n        this.questions\n            .filter(q => q.type == 'content')\n            .forEach(q => {\n                rsp[q.name] = null\n            });\n        return rsp;\n\n    }\n}\n\nexport default Survey\n","import script from \"./CoiPolicy.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./CoiPolicy.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./CoiPolicy.vue?vue&type=style&index=0&id=d87f1f48&scoped=true&lang=css\"\n\nimport exportComponent from \"/Users/bpow/src/clingen/gpm/resources/app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-d87f1f48\"]])\n\nexport default __exports__","import { render } from \"./Coi.vue?vue&type=template&id=bcf40ab6\"\nimport script from \"./Coi.vue?vue&type=script&lang=js\"\nexport * from \"./Coi.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/bpow/src/clingen/gpm/resources/app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","class","_createElementBlock","$options","_createBlock","_component_card","title","$data","_hoisted_1","style","_createVNode","_component_CoiPolicy","_hoisted_3","_hoisted_4","_Fragment","_renderList","questions","question","key","name","_Transition","type","_hoisted_6","_component_MarkdownBlock","markdown","content","_component_input_row","label","question_text","errors","vertical","$event","_hoisted_8","options","option","value","_toDisplayString","_component_button_row","onSubmitClicked","_renderSlot","_ctx","_component_note","Question","constructor","this","validationRules","validation","show","YesNoQuestion","super","makeQuestion","questionDef","Survey","surveyDefinition","_name","_questions","map","q","getResponseTemplate","rsp","filter","forEach","__exports__","survey","coiDef","components","CoiPolicy","MarkdownBlock","props","code","required","String","data","response","groupName","verifying","saved","saving","redirectCountdown","computed","codeIsValid","coiTitle","membership","$store","getters","currentUser","person","memberships","find","m","group","coi_code","groupMemberId","id","watch","immediate","handler","initResponseValues","methods","cois","length","lastResponse","v2ResponseData","version","transformV1Response","coi_attestation","data_policy_attestation","v2Response","work_fee_lab","contributions_to_gd_in_group","contributions_to_gd_in_ep","contributions_to_genes","coi","independent_efforts","coi_details","independent_efforts_details","join","showQuestion","Array","isArray","indexOf","verifyCode","api","then","display_name","async","dispatch","coiData","$router","push","error","is_validation_error","commit","render"],"sourceRoot":""}