"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[23],{3774:function(e,t,a){a.d(t,{R0:function(){return i}});var r=a(2262),s=a(9700),o=a(812);const i=(0,r.iH)({}),l=(0,r.iH)(!1),u=()=>{l.value=!1,i.value={}},n=async({method:e,url:t,data:a})=>{try{return await(0,o.Z)({method:e,url:t,data:a}).then((e=>e.data.data))}catch(r){(0,s.Z)(r)&&(i.value={...i,...r.response.data.errors})}},p=()=>{i.value={}};t["ZP"]=()=>({errors:i,editing:l,hideForm:u,submitFormData:n,resetErrors:p})},7889:function(e,t,a){a.d(t,{Z:function(){return G}});var r=a(6252),s=a(3577),o=a(9963);const i={key:0},l={key:0},u=(0,r.Uk)(" Affiliation ID "),n=(0,r.Uk)("admin-only"),p={key:0},d={key:1,class:"text-gray-400"},m={key:1},g={key:2},h=(0,r.Uk)(" Status: "),_=(0,r.Uk)("admin-only"),c=(0,r.Uk)(" Parent group: "),f=(0,r.Uk)("admin-only");function w(e,t,a,w,b,y){const v=(0,r.up)("input-row"),D=(0,r.up)("dictionary-row"),k=(0,r.up)("note");return(0,r.wg)(),(0,r.iD)("div",null,[y.canSetType?((0,r.wg)(),(0,r.j4)(v,{key:0,modelValue:y.group.group_type_id,"onUpdate:modelValue":t[0]||(t[0]=e=>y.group.group_type_id=e),errors:w.errors.group_type_id,type:"select",options:y.typeOptions,label:"Type"},null,8,["modelValue","errors","options"])):((0,r.wg)(),(0,r.j4)(D,{key:1,label:"Type"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(this.group?.type?.display_name),1)])),_:1})),(0,r.Wm)(o.uT,{name:"slide-fade-down",mode:"out-in"},{default:(0,r.w5)((()=>[y.group.group_type_id>2&&y.group.expert_panel?((0,r.wg)(),(0,r.iD)("div",i,[(0,r.Wm)(v,{label:"Long Base Name",modelValue:y.group.expert_panel.long_base_name,"onUpdate:modelValue":[t[1]||(t[1]=e=>y.group.expert_panel.long_base_name=e),y.emitUpdate],placeholder:"Long base name",errors:w.errors.long_base_name,"input-class":"w-full"},null,8,["modelValue","onUpdate:modelValue","errors"]),(0,r.Wm)(v,{label:"Short Base Name",modelValue:y.group.expert_panel.short_base_name,"onUpdate:modelValue":[t[2]||(t[2]=e=>y.group.expert_panel.short_base_name=e),y.emitUpdate],placeholder:"Short base name",errors:w.errors.short_base_name,"input-class":"w-full"},null,8,["modelValue","onUpdate:modelValue","errors"]),e.hasAnyPermission(["groups-manage"])?((0,r.wg)(),(0,r.iD)("div",l,[(0,r.Wm)(v,{label:"Affiliation ID",modelValue:y.group.expert_panel.affiliation_id,"onUpdate:modelValue":[t[3]||(t[3]=e=>y.group.expert_panel.affiliation_id=e),y.emitUpdate],placeholder:y.affiliationIdPlaceholder,errors:w.errors.affiliation_id,"input-class":"w-full"},{label:(0,r.w5)((()=>[u,(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[n])),_:1})])),_:1},8,["modelValue","placeholder","errors","onUpdate:modelValue"])])):((0,r.wg)(),(0,r.j4)(D,{key:1,label:"Affiliation ID"},{default:(0,r.w5)((()=>[y.group.expert_panel.affiliation_id?((0,r.wg)(),(0,r.iD)("span",p,(0,s.zw)(y.group.expert_panel.affiliation_id),1)):((0,r.wg)(),(0,r.iD)("span",d,(0,s.zw)("Not yet assigend")))])),_:1}))])):((0,r.wg)(),(0,r.iD)("div",m,[(0,r.Wm)(v,{modelValue:y.group.name,"onUpdate:modelValue":[t[4]||(t[4]=e=>y.group.name=e),y.emitUpdate],placeholder:"Name",label:"Name","input-class":"w-full",errors:w.errors.name},null,8,["modelValue","errors","onUpdate:modelValue"])]))])),_:1}),e.hasPermission("groups-manage")?((0,r.wg)(),(0,r.iD)("div",g,[(0,r.Wm)(v,{modelValue:y.group.group_status_id,"onUpdate:modelValue":[t[5]||(t[5]=e=>y.group.group_status_id=e),y.emitUpdate],type:"select",options:y.statusOptions,errors:w.errors.group_status_id},{label:(0,r.w5)((()=>[h,(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[_])),_:1})])),_:1},8,["modelValue","options","errors","onUpdate:modelValue"]),(0,r.Wm)(v,{modelValue:y.group.parent_id,"onUpdate:modelValue":[t[6]||(t[6]=e=>y.group.parent_id=e),y.emitUpdate],type:"select",options:y.parentOptions,errors:w.errors.parent_id},{label:(0,r.w5)((()=>[c,(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[f])),_:1})])),_:1},8,["modelValue","options","errors","onUpdate:modelValue"])])):(0,r.kq)("",!0)])}var b=a(6486),y=a(9028),v=a(7506),D=a(3823),k=a(3774),x={name:"GroupForm",emits:["canceled","saved","update"],data(){return{groupTypes:D.groups.types,groupStatuses:D.groups.statuses,newGroup:new v.Z,parents:[]}},computed:{group:{get(){const e=this.$store.getters["groups/currentItem"];return e||this.newGroup},set(e){try{this.$store.commit("groups/addItem",e)}catch(t){this.newGroup=e}}},statusOptions(){return Object.values(this.groupStatuses).map((e=>({value:e.id,label:this.titleCase(e.name)})))},typeOptions(){return Object.values(this.groupTypes).map((e=>({value:e.id,label:e.display_name})))},canSetType(){return this.hasPermission("groups-manage")&&!this.group.id},affiliationIdPlaceholder(){return 5e4},cdwgs(){return this.$store.getters["cdwgs/all"]},namesDirty(){return this.group.expert_panel.isDirty("long_base_name")||this.group.expert_panel.isDirty("short_base_name")},affiliationIdDirty(){return this.group.expert_panel.isDirty("affiliation_id")},parentOptions(){const e=[{value:0,label:"None"}];return this.parents.filter((e=>e.type.can_be_parent)).forEach((t=>{e.push({value:t.id,label:t.displayName})})),(0,b.sortBy)(e,"label")}},methods:{async save(){this.resetErrors();try{if(this.group.id)return await this.updateGroup(),void this.$emit("saved");const e=await this.createGroup().then((e=>e.data.data));this.$emit("saved"),this.$store.commit("pushSuccess","Group created."),this.$router.push({name:"AddMember",params:{uuid:e.uuid}})}catch(e){throw(0,y.z1)(e)&&(this.errors=e.response.data.errors),e}},createGroup(){let{name:e,parent_id:t,group_type_id:a,group_status_id:r}=this.group.attributes;const{short_base_name:s}=this.group.expert_panel;return null===e&&this.group.expert_panel&&(e=this.group.expert_panel.long_base_name),this.$store.dispatch("groups/create",{name:e,parent_id:t,group_type_id:a,group_status_id:r,short_base_name:s})},updateGroup(){const e=[];return e.push(this.saveGroupData()),this.group.expert_panel&&e.push(this.saveEpData()),Promise.all(e)},saveGroupData(){const e=[];return this.group.isDirty("parent_id")&&e.push(this.saveParent()),this.group.isDirty("name")&&e.push(this.saveName()),this.group.isDirty("group_status_id")&&e.push(this.saveStatus()),Promise.all(e)},async saveEpData(){const e=[];if(this.namesDirty){const{long_base_name:t,short_base_name:a}=this.group.expert_panel;e.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/name`,data:{long_base_name:t,short_base_name:a}}))}return this.affiliationIdDirty&&e.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/affiliation-id`,data:{affiliation_id:this.group.expert_panel.affiliation_id}})),await Promise.all(e)},isDirty(e){return this.group[e]!=this.group[e]},saveParent(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/parent`,data:{parent_id:this.group.parent_id}})},saveName(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/name`,data:{name:this.group.name}})},saveStatus(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/status`,data:{status_id:this.group.group_status_id}})},resetData(){this.group.uuid&&this.$store.dispatch("groups/find",this.group.uuid)},cancel(){this.group.uuid&&this.resetData(),this.$emit("canceled")},async getParentOptions(){const e={"where[group_type_id]":[1,2],without:["coordinators","expertPanel"]};this.parents=await y.hi.get("/api/groups",{params:e}).then((e=>e.data.filter((e=>e.id!=this.group.id)).map((e=>new v.Z(e)))))},emitUpdate(){this.$emit("update")}},beforeMount(){this.getParentOptions(),this.$store.dispatch("cdwgs/getAll")},setup(e,t){const{errors:a,submitFormData:r,resetErrors:s}=(0,k.ZP)(e,t);return{errors:a,submitFormData:r,resetErrors:s}}},U=a(3744);const V=(0,U.Z)(x,[["render",w]]);var G=V},3010:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var r=a(6252),s=a(9963),o=a(3577);const i={class:"flex justify-between items-center"},l=(0,r.Uk)(" Groups "),u={key:0,class:"text-center w-full"},n={key:1},p={class:"mb-2"},d=(0,r.Uk)(" Filter: "),m={key:0},g={key:0},h={key:0};function _(e,t,a,_,c,f){const w=(0,r.up)("badge"),b=(0,r.up)("router-link"),y=(0,r.up)("data-table"),v=(0,r.up)("tab-item"),D=(0,r.up)("tabs-container"),k=(0,r.up)("group-form"),x=(0,r.up)("submission-wrapper"),U=(0,r.up)("modal-dialog"),V=(0,r.Q2)("remaining-height");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("h1",i,[l,e.hasPermission("groups-manage")?((0,r.wg)(),(0,r.iD)("button",{key:0,class:"btn btn-xs",onClick:t[0]||(t[0]=(...e)=>f.startCreateGroup&&f.startCreateGroup(...e))},"Create a group")):(0,r.kq)("",!0)]),(0,r.Wm)(D,{onTabChanged:f.getGroupsForType},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(_.tabDefinitions,(e=>((0,r.wg)(),(0,r.j4)(v,{label:e.label,key:e.label},{default:(0,r.w5)((()=>[c.loading?((0,r.wg)(),(0,r.iD)("div",u,"Loading...")):((0,r.wg)(),(0,r.iD)("div",n,[(0,r._)("div",p,[d,(0,r.wy)((0,r._)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>_.filterString=e),placeholder:"name,id,status,coordinator name"},null,512),[[s.nr,_.filterString]])]),(0,r.wy)(((0,r.wg)(),(0,r.j4)(y,{data:_.filteredGroups.filter(e.filter),fields:c.fields,sort:c.sort,"onUpdate:sort":t[3]||(t[3]=e=>c.sort=e),"row-click-handler":_.goToGroup,"row-class":"cursor-pointer active:bg-blue-100"},{"cell-displayStatus":(0,r.w5)((({item:e})=>[(0,r.Wm)(w,{class:"text-xs",color:e.statusColor},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.displayStatus),1),1==e.status.id&&e.is_ep?((0,r.wg)(),(0,r.iD)("span",m," - "+(0,o.zw)(e.expert_panel.currentStepAbbr),1)):(0,r.kq)("",!0)])),_:2},1032,["color"])])),"cell-coordinators":(0,r.w5)((({value:e})=>[0==e.length?((0,r.wg)(),(0,r.iD)("div",g)):(0,r.kq)("",!0),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e,((e,a)=>((0,r.wg)(),(0,r.iD)("span",{key:e.id},[a>0?((0,r.wg)(),(0,r.iD)("span",h,", ")):(0,r.kq)("",!0),(0,r.Wm)(b,{to:{name:"PersonDetail",params:{uuid:e.person.uuid}},class:"link",onClick:t[2]||(t[2]=(0,s.iM)((()=>{}),["stop"]))},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.person.name),1)])),_:2},1032,["to"])])))),128))])),_:2},1032,["data","fields","sort","row-click-handler"])),[[V]])]))])),_:2},1032,["label"])))),128))])),_:1},8,["onTabChanged"]),(0,r.Wm)(U,{modelValue:c.showCreateForm,"onUpdate:modelValue":t[8]||(t[8]=e=>c.showCreateForm=e),title:"Create a New Group",size:"sm"},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{onSubmitted:t[6]||(t[6]=t=>e.$refs.groupForm.save()),onCanceled:t[7]||(t[7]=t=>e.$refs.groupForm.cancel())},{default:(0,r.w5)((()=>[(0,r.Wm)(k,{ref:"groupForm",onCanceled:t[4]||(t[4]=e=>c.showCreateForm=!1),onSaved:t[5]||(t[5]=e=>c.showCreateForm=!1)},null,512)])),_:1})])),_:1},8,["modelValue"])])}var c=a(3907),f=a(2119),w=a(2262),b=a(7889),y=a(3117),v={name:"ComponentName",components:{GroupForm:b.Z,SubmissionWrapper:y.Z},props:{},data(){return{loading:!1,showCreateForm:!1,loadedFor:{VCEPs:!1,GCEPs:!1,CDWGs:!1,WGs:!1},sort:{field:"id",desc:!1},fields:[{name:"id",label:"ID",sortable:!0},{name:"name",label:"Name",sortable:!0,resolveValue:e=>e.displayName},{name:"coordinators",sortable:!1},{name:"displayStatus",sortable:!0,label:"status"}]}},methods:{startCreateGroup(){this.showCreateForm=!0},async getGroupsForType(e){const t=this.tabDefinitions.find((t=>t.label===e));this.loadedFor[e]||(this.loading=!0,await this.$store.dispatch("groups/getItems",{where:{group_type_id:t.typeId}}),this.loadedFor[e]=!0,this.loading=!1)}},setup(){const e=(0,c.oR)(),t=(0,f.tv)(),a=(0,r.Fl)((()=>{const e=[{label:"VCEPs",typeId:4,filter:e=>e.is_vcep_or_scvcep},{label:"GCEPs",typeId:3,filter:e=>e.is_gcep},{label:"CDWGs",typeId:2,filter:e=>e.isCdwg()},{label:"WGs",typeId:1,filter:e=>e.isWg()}];return e})),s=(0,w.iH)(null),o=(0,r.Fl)((()=>e.getters["groups/all"])),i=(0,r.Fl)((()=>o.value.filter((e=>{if(!s.value)return!0;const t=new RegExp(`.*${s.value}.*`,"i");return e.name&&e.name.match(t)||e.displayName&&e.displayName.match(t)||e.expert_panel&&e.expert_panel.full_short_base_name&&e.expert_panel.full_short_base_name.match(t)||e.id==s.value||e.status.name.match(t)||e.expert_panel&&e.expert_panel.currentStepName&&e.expert_panel.currentStepName.match(t)||e.coordinators.filter((e=>e.person.name.match(t))).length>0})))),l=e=>{t.push({name:"GroupDetail",params:{uuid:e.uuid}})};return{filterString:s,groups:o,filteredGroups:i,tabDefinitions:a,goToItem:l,goToGroup:l}}},D=a(3744);const k=(0,D.Z)(v,[["render",_]]);var x=k}}]);
//# sourceMappingURL=group-list.e66bc4e7.js.map