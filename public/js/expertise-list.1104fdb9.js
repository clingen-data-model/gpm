"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[647],{2790:function(e,t,r){r.d(t,{Z:function(){return i}});r(6699);var a=r(2119),n=r(6252);function i(e=null){const t=(0,a.tv)(),r=(0,a.yj)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const i=(0,n.Fl)({immediate:!0,get(){return Object.keys(r.query).includes("sort-field")?{field:r.query["sort-field"],desc:Boolean(parseInt(r.query["sort-desc"]))}:e},set(e){const a={"sort-field":e.field,"sort-desc":e.desc?1:0},n={...r.query,...a};t.replace({path:r.path,query:n})}}),o=(0,n.Fl)({set(e){let a=r.query,n=r.path,i={...a};e?i={...a,filter:e}:delete i.filter,t.replace({path:n,query:i})},get(){return r.query.filter},immediate:!0});return{sort:i,filter:o}}},5024:function(e,t,r){r.r(t),r.d(t,{default:function(){return q}});var a=r(6252),n=r(9963),i=r(3577);const o={class:"flex justify-between items-center"},l=(0,a._)("h1",null,"Expertises",-1),s=(0,a.Uk)(" Filter: "),d=(0,a._)("button",{class:"btn btn-xs"},"â€¦",-1),u=(0,a.Uk)("Edit"),m=(0,a.Uk)("Delete"),c={key:0},p=(0,a._)("p",null,"You cannot delete an expertise people are using.",-1),h=(0,a._)("p",null,"Either edit this this expertise or remove all people that have claimed it as an expertise.",-1),w=[p,h],f={key:1};function b(e,t,r,p,h,b){const v=(0,a.up)("dropdown-item"),C=(0,a.up)("dropdown-menu"),g=(0,a.up)("data-table"),y=(0,a.up)("ExpertiseUpdateForm"),I=(0,a.up)("modal-dialog"),x=(0,a.up)("button-row"),D=(0,a.up)("ExpertiseCreateForm");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",o,[l,(0,a._)("button",{class:"btn btn-sm",onClick:t[0]||(t[0]=e=>h.showCreateDialog=!0)},"Add Expertise")]),(0,a.Wm)(g,{paginated:"",data:b.filteredItems,fields:h.fields,sort:p.sort,"onUpdate:sort":t[2]||(t[2]=e=>p.sort=e),"reset-page-on-data-change":!1},{header:(0,a.w5)((()=>[(0,a._)("label",null,[s,(0,a.wy)((0,a._)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>p.filter=e)},null,512),[[n.nr,p.filter]])])])),"cell-actions":(0,a.w5)((({item:e})=>[(0,a.Wm)(C,{"hide-cheveron":""},{label:(0,a.w5)((()=>[d])),default:(0,a.w5)((()=>[(0,a.Wm)(v,{onClick:t=>b.edit(e)},{default:(0,a.w5)((()=>[u])),_:2},1032,["onClick"]),(0,a.Wm)(v,{onClick:t=>b.initDelete(e)},{default:(0,a.w5)((()=>[m])),_:2},1032,["onClick"])])),_:2},1024)])),_:1},8,["data","fields","sort"]),((0,a.wg)(),(0,a.j4)(a.lR,{to:"body"},[(0,a.Wm)(I,{modelValue:h.showEditDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>h.showEditDialog=e),title:`Edit ${h.currentItem.name}`},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{modelValue:h.currentItem,"onUpdate:modelValue":t[3]||(t[3]=e=>h.currentItem=e),onSaved:b.handleSaved,onCanceled:b.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,a.Wm)(I,{modelValue:h.showDeleteConfirmation,"onUpdate:modelValue":t[6]||(t[6]=e=>h.showDeleteConfirmation=e),title:"Delete Expertise",size:"sm"},{default:(0,a.w5)((()=>[h.currentItem.people_count>0?((0,a.wg)(),(0,a.iD)("div",c,w)):((0,a.wg)(),(0,a.iD)("div",f,[(0,a.Uk)(" You are about to delete the "+(0,i.zw)(h.currentItem.name)+" ",1),(0,a.Wm)(x,{"submit-text":"Delete",onSubmitted:b.deleteItem,onCanceled:t[5]||(t[5]=e=>h.showDeleteConfirmation=!1)},null,8,["onSubmitted"])]))])),_:1},8,["modelValue"]),(0,a.Wm)(I,{modelValue:h.showCreateDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>h.showCreateDialog=e),title:"Add a New Expertise."},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{onSaved:b.handleSaved,onCanceled:b.handleCancel},null,8,["onSaved","onCanceled"])])),_:1},8,["modelValue"])]))])}var v=r(2790);function C(e,t,r,n,i,o){const l=(0,a.up)("input-row"),s=(0,a.up)("button-row");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(l,{label:"Name",modelValue:n.workingCopy.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.workingCopy.name=e),errors:i.errors.name},null,8,["modelValue","errors"]),(0,a.Wm)(s,{"submit-text":"Save",onSubmitted:o.save,onCancel:o.cancel},null,8,["onSubmitted","onCancel"])])}var g=r(1076),y=r(9028),I={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],data(){return{errors:{}}},methods:{async save(){try{this.initErrors();const e=await this.$store.dispatch("expertises/update",this.workingCopy).then((e=>e.data));this.$emit("update:modelValue",e),this.$emit("saved",e)}catch(e){(0,y.z1)(e)&&(this.errors=e.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}},setup(e,t){const{workingCopy:r}=(0,g.kM)(e,t);return{workingCopy:r}}},x=r(3744);const D=(0,x.Z)(I,[["render",C]]);var k=D,E=r(2262),V=r(3907),S={__name:"ExpertiseCreateForm",props:{starterString:{type:String,required:!1}},emits:["saved","canceled"],setup(e,{emit:t}){const r=e,n=(0,V.oR)(),i=(0,E.iH)({}),o=(0,E.iH)(null);(0,a.YP)((()=>r.starterString),(e=>{o.value=e}));const l=async()=>{try{const e=await n.dispatch("expertises/create",{name:o.value}).then((e=>e.data));o.value=null,t("saved",e)}catch(e){(0,y.z1)(e)&&(i.value=e.response.data.errors)}},s=()=>{o.value=null,t("canceled")};return(e,t)=>{const r=(0,a.up)("input-row"),n=(0,a.up)("button-row");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(r,{label:"Name",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),errors:i.value.name},null,8,["modelValue","errors"]),(0,a.Wm)(n,{onSubmitted:l,onCancel:s,"submit-text":"Create Credential"})])}}};const _=S;var W=_,U={name:"CredentialList",components:{ExpertiseUpdateForm:k,ExpertiseCreateForm:W},data(){return{fields:[{name:"id",label:"ID",type:Number,sortable:!0,class:"w-12"},{name:"name",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"actions",label:"",sortable:!1}],currentItem:{},showCreateDialog:!1,showEditDialog:!1,showDeleteConfirmation:!1}},computed:{items(){return this.$store.getters["expertises/items"]},filteredItems(){if(!this.filter)return this.items;const e=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter((t=>t.name.match(e)||t.abbreviation&&t.abbreviation.match(e)||t.country&&t.country.name.match(e)))},currentIndex(){return this.items.findIndex((e=>e.id==this.currentItem.id))}},methods:{edit(e){this.showEditDialog=!0,this.currentItem=e},handleSaved(){this.showCreateDialog=!1,this.showEditDialog=!1,this.updateItem(),this.$store.commit("pushSuccess","Expertise saved.")},handleCancel(){this.showCreateDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},updateItem(){this.currentItem.id&&this.currentIndex>-1&&(this.items[this.currentIndex]={...this.currentItem})},initDelete(e){this.showDeleteConfirmation=!0,this.currentItem=e},async deleteItem(){if(this.currentItem.id){this.currentItem.people_count>0&&alert("You cannot delete this expertise because it is in use.  Please edit the expertise or remove it from all people using it.");try{await this.$store.dispatch("expertises/delete",this.currentItem),this.showDeleteConfirmation=!1,this.$store.commit("pushSuccess",`${this.currentItem.name} deleted.`)}catch(e){throw console.error(e),e}}}},setup(){const{sort:e,filter:t}=(0,v.Z)({field:"name",desc:!1});return{sort:e,filter:t}},mounted(){this.$store.dispatch("expertises/getItems")}};const $=(0,x.Z)(U,[["render",b]]);var q=$}}]);
//# sourceMappingURL=expertise-list.1104fdb9.js.map