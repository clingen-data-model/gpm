{"version":3,"file":"ApplicationsSummaryTable-CiCSeJ31.js","sources":["../../../resources/js/components/applications/ApplicationsSummaryTable.vue"],"sourcesContent":["<script>\nimport { mapGetters } from 'vuex'\nimport sortAndFilter from '@/composables/router_aware_sort_and_filter'\n\nexport default {\n    name: 'SummaryVceps',\n    components: {\n    },\n    props: {\n        expertPanelTypeId: {\n            type: Number,\n            default: null\n        }\n    },\n    setup() {\n        const {sort, filter} = sortAndFilter();\n\n        return {\n            sort,\n            filter,\n        }\n    },\n    data() {\n        return {\n            fields: [\n                {\n                    name: 'name',\n                    label: 'Name',\n                    type: String,\n                    sortable: true\n                },\n                {\n                    name: 'group.parent.name',\n                    label: 'CDWG',\n                    type: String,\n                    sortable: true,\n                    resolveValue (item) {\n                        if (item.group && item.group.parent) {\n                            return item.group.parent.name\n                        }\n                        return '';\n                    }\n                },\n                {\n                    name: 'current_step',\n                    label: 'Step',\n                    type: Number,\n                    sortable: true,\n                    resolveValue (item) {\n                        return item.isCompleted ? 'Completed' : item.current_step\n                    },\n                    resolveSort (item) {\n                        return item.isCompleted ? 5 : item.current_step\n                    }\n                },\n                {\n                    name: 'contacts',\n                    label: 'Contacts',\n                    type: Array,\n                    sortable: false,\n                    class: ['min-w-40'],\n                    step: 1\n                },\n                {\n                    name: 'step_1_received_date',\n                    label: this.expert_panel_type_id === 2 ? 'Step 1 Received' : 'Application Received',\n                    type: Date,\n                    sortable: true,\n                    class: ['min-w-28'],\n                    step: 1\n\n                },\n                {\n                    name: 'step_1_approval_date',\n                    label: this.expert_panel_type_id === 2 ? 'Step 1 Approved' : 'Application Approved',\n                    type: Date,\n                    sortable: true,\n                    class: ['min-w-28'],\n                    step: 1\n                },\n                {\n                    name: 'step_2_approval_date',\n                    label: 'Step 2 Approved',\n                    type: Date,\n                    sortable: true,\n                    class: ['min-w-28'],\n                    step: 2\n                },\n                {\n                    name: 'step_3_approval_date',\n                    label: 'Step 3 Approved',\n                    type: Date,\n                    sortable: true,\n                    class: ['min-w-28'],\n                    step: 3\n                },\n                {\n                    name: 'step_4_received_date',\n                    label: 'Step 4 Received',\n                    type: Date,\n                    sortable: true,\n                    class: ['min-w-28'],\n                    step: 4\n                },\n                {\n                    name: 'step_4_approval_date',\n                    label: 'Step 4 Approved',\n                    type: Date,\n                    sortable: true,\n                    class: ['min-w-28'],\n                    step: 4\n                }\n            ]\n        }\n    },\n    computed: {\n        ...mapGetters({\n            applications: 'applications/all'\n        }),\n        filteredData() {\n            return this.applications\n                .filter(item => !this.expert_panel_type_id || item.expert_panel_type_id === this.expert_panel_type_id)\n                .filter(item => {\n                    if (!this.showCompleted) {\n                        return item.date_completed == null;\n                    }\n                    return true;\n                })\n        },\n        showCompleted: {\n            set(value) {\n                const currentQuery = this.$route.query;\n                const currentPath = this.$route.path;\n                \n                let updatedQuery = {...currentQuery};\n\n                if (!value) {\n                    delete updatedQuery['show-completed'];\n                } else {\n                    updatedQuery = {...currentQuery, ...{'show-completed': 1} };\n                }\n\n                this.$router.replace({path: currentPath, query: updatedQuery})\n            },\n            get() {\n                return Boolean(Number.parseInt(this.$route.query['show-completed']))\n            },\n            immediate: true\n        },\n        selectedFields() {\n            const stepsToShow = this.expert_panel_type_id === 2 ? [1,2,3,4] : [1]\n            return this.fields.filter(field => !field.step || stepsToShow.includes(field.step))\n        },\n        showAllInfo: {\n            immediate: true,\n                get() {\n                    if (Object.keys(this.$route.query).includes('showAllInfo')) {\n                        return this.$route.query.showAllInfo\n                    }\n                    return 0\n                },\n                set(newValue) {\n                    const newQuery = {...this.$route.query};\n                    newQuery.showAllInfo = newValue\n\n                    this.$router.replace({path: this.$route.path, query: newQuery})\n                }            \n        },\n        remainingHeight () {\n            return {height: 'calc(100vh - 220px)'}\n        }\n    },\n    mounted () {\n        this.getApplications()\n    },\n    methods: {\n\n        getApplications () {\n            const params = {\n                with: [\n                    'group',\n                    'group.parent',\n                    'group.latestLogEntry',\n                    'latestPendingNextAction',\n                    'type',\n                    'group.contacts',\n                    'group.contacts.person',\n                ],\n            }\n\n            const where = {};\n\n            if (Object.keys(where).length > 0) {\n                params.where = where;\n            }\n\n            this.$store.dispatch('applications/getApplications', params);\n        },\n        goToApplication (item) {\n            this.$router.push({name: 'ApplicationDetail', params: {uuid: item.uuid}})\n        },\n    },\n}\n</script>\n<template>\n  <div>\n    <div class=\"flex justify-between\">\n      <div class=\"mb-1 flex space-x-2\">\n        <label>Filter: <input v-model=\"filter\" type=\"text\" class=\"sm\" placeholder=\"filter\"></label>\n        <checkbox \n          v-model=\"showCompleted\"\n          label=\"Show completed\"\n        />\n      </div>\n    </div>\n    <data-table \n      v-model:sort=\"sort\" \n      :data=\"filteredData\" \n      :fields=\"selectedFields\" \n      :filter-term=\"filter\"\n      :row-click-handler=\"goToApplication\"\n      row-class=\"cursor-pointer\"\n      :style=\"remainingHeight\"\n      class=\"overflow-auto text-xs\"\n    >\n      <template #cell-contacts=\"{item}\">\n        <ul>\n          <li v-for=\"member in item.group.contacts\" :key=\"member.id\">\n            <small><a :href=\"`mailto:${member.person.email}`\" class=\"text-blue-500\">{{ member.person.name }}</a></small>\n          </li>\n        </ul>\n      </template>\n      <template #cell-latest_log_entry_description=\"{value}\">\n        <div v-html=\"value\" />\n      </template>\n      <template #cell-latest_pending_next_action_entry=\"{value}\">\n        <div v-html=\"value\" />\n      </template>\n    </data-table>\n  </div>\n</template>"],"names":["_sfc_main","sort","filter","sortAndFilter","item","mapGetters","value","currentQuery","currentPath","updatedQuery","stepsToShow","field","newValue","newQuery","params","where","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_createElementBlock","_createElementVNode","_cache","_createTextVNode","$event","$setup","_createVNode","_component_checkbox","$options","_component_data_table","_normalizeStyle","_withCtx","_Fragment","_renderList","member","_toDisplayString"],"mappings":"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"}