import{s as E}from"./router_aware_sort_and_filter-Cf36Wg2d.js";import{_ as g,a2 as I,aZ as V,c as C,f as s,a as l,b as c,r as _,x as y,v as S,d as p,e as k,w as u,i as b,C as N,D as U,j as F,a1 as B}from"./app-CdNyBcCS.js";const j={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],setup(t,e){const{workingCopy:h}=V(t,e);return{workingCopy:h}},data(){return{errors:{}}},methods:{async save(){try{this.initErrors();const t=await this.$store.dispatch("expertises/update",this.workingCopy).then(e=>e.data);this.$emit("update:modelValue",t),this.$emit("saved",t)}catch(t){I(t)&&(this.errors=t.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}}};function A(t,e,h,a,r,o){const i=l("input-row"),f=l("button-row");return c(),C("div",null,[s(i,{modelValue:a.workingCopy.name,"onUpdate:modelValue":e[0]||(e[0]=w=>a.workingCopy.name=w),label:"Name",errors:r.errors.name},null,8,["modelValue","errors"]),s(f,{"submit-text":"Save",onSubmitted:o.save,onCancel:o.cancel},null,8,["onSubmitted","onCancel"])])}const T=g(j,[["render",A]]),Y={__name:"ExpertiseCreateForm",props:{starterString:{type:String,required:!1}},emits:["saved","canceled"],setup(t,{emit:e}){const h=t,a=e,r=S(),o=_({}),i=_(null);y(()=>h.starterString,d=>{i.value=d});const f=async()=>{try{const d=await r.dispatch("expertises/create",{name:i.value}).then(m=>m.data);i.value=null,a("saved",d)}catch(d){I(d)&&(o.value=d.response.data.errors)}},w=()=>{i.value=null,a("canceled")};return(d,m)=>{const v=l("input-row"),x=l("button-row");return c(),C("div",null,[s(v,{modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=n=>i.value=n),label:"Name",errors:o.value.name},null,8,["modelValue","errors"]),s(x,{"submit-text":"Create Credential",onSubmitted:f,onCancel:w})])}}},q={name:"CredentialList",components:{ExpertiseUpdateForm:T,ExpertiseCreateForm:Y},setup(){const{sort:t,filter:e}=E({field:"name",desc:!1});return{sort:t,filter:e}},data(){return{fields:[{name:"id",label:"ID",type:Number,sortable:!0,class:"w-12"},{name:"name",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"actions",label:"",sortable:!1}],currentItem:{},showCreateDialog:!1,showEditDialog:!1,showDeleteConfirmation:!1}},computed:{items(){return this.$store.getters["expertises/items"]},filteredItems(){if(!this.filter)return this.items;const t=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter(e=>e.name.match(t)||e.abbreviation&&e.abbreviation.match(t)||e.country&&e.country.name.match(t))},currentIndex(){return this.items.findIndex(t=>t.id===this.currentItem.id)}},mounted(){this.$store.dispatch("expertises/getItems")},methods:{edit(t){this.showEditDialog=!0,this.currentItem=t},handleSaved(){this.showCreateDialog=!1,this.showEditDialog=!1,this.updateItem(),this.$store.commit("pushSuccess","Expertise saved.")},handleCancel(){this.showCreateDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},updateItem(){this.currentItem.id&&this.currentIndex>-1&&(this.items[this.currentIndex]={...this.currentItem})},initDelete(t){this.showDeleteConfirmation=!0,this.currentItem=t},async deleteItem(){if(this.currentItem.id){this.currentItem.people_count>0&&alert("You cannot delete this expertise because it is in use.  Please edit the expertise or remove it from all people using it.");try{await this.$store.dispatch("expertises/delete",this.currentItem),this.showDeleteConfirmation=!1,this.$store.commit("pushSuccess",`${this.currentItem.name} deleted.`)}catch(t){throw console.error(t),t}}}}},L={class:"flex justify-between items-center"},M={key:0},P={key:1};function z(t,e,h,a,r,o){const i=l("dropdown-item"),f=l("dropdown-menu"),w=l("data-table"),d=l("ExpertiseUpdateForm"),m=l("modal-dialog"),v=l("button-row"),x=l("ExpertiseCreateForm");return c(),C("div",null,[p("div",L,[e[8]||(e[8]=p("h1",null,"Expertises",-1)),p("button",{class:"btn btn-sm",onClick:e[0]||(e[0]=n=>r.showCreateDialog=!0)}," Add Expertise ")]),s(w,{sort:a.sort,"onUpdate:sort":e[2]||(e[2]=n=>a.sort=n),paginated:"",data:o.filteredItems,fields:r.fields,"reset-page-on-data-change":!1},{header:u(()=>[p("label",null,[e[9]||(e[9]=b(" Filter: ")),N(p("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.filter=n),type:"text"},null,512),[[U,a.filter]])])]),"cell-actions":u(({item:n})=>[s(f,{"hide-cheveron":""},{label:u(()=>e[10]||(e[10]=[p("button",{class:"btn btn-xs"}," â€¦ ",-1)])),default:u(()=>[s(i,{onClick:D=>o.edit(n)},{default:u(()=>e[11]||(e[11]=[b(" Edit ")])),_:2},1032,["onClick"]),s(i,{onClick:D=>o.initDelete(n)},{default:u(()=>e[12]||(e[12]=[b(" Delete ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["sort","data","fields"]),(c(),k(B,{to:"body"},[s(m,{modelValue:r.showEditDialog,"onUpdate:modelValue":e[4]||(e[4]=n=>r.showEditDialog=n),title:`Edit ${r.currentItem.name}`},{default:u(()=>[s(d,{modelValue:r.currentItem,"onUpdate:modelValue":e[3]||(e[3]=n=>r.currentItem=n),onSaved:o.handleSaved,onCanceled:o.handleCancel},null,8,["modelValue","onSaved","onCanceled"])]),_:1},8,["modelValue","title"]),s(m,{modelValue:r.showDeleteConfirmation,"onUpdate:modelValue":e[6]||(e[6]=n=>r.showDeleteConfirmation=n),title:"Delete Expertise",size:"sm"},{default:u(()=>[r.currentItem.people_count>0?(c(),C("div",M,e[13]||(e[13]=[p("p",null,"You cannot delete an expertise people are using.",-1),p("p",null,"Either edit this this expertise or remove all people that have claimed it as an expertise.",-1)]))):(c(),C("div",P,[b(" You are about to delete the "+F(r.currentItem.name)+" ",1),s(v,{"submit-text":"Delete",onSubmitted:o.deleteItem,onCanceled:e[5]||(e[5]=n=>r.showDeleteConfirmation=!1)},null,8,["onSubmitted"])]))]),_:1},8,["modelValue"]),s(m,{modelValue:r.showCreateDialog,"onUpdate:modelValue":e[7]||(e[7]=n=>r.showCreateDialog=n),title:"Add a New Expertise."},{default:u(()=>[s(x,{onSaved:o.handleSaved,onCanceled:o.handleCancel},null,8,["onSaved","onCanceled"])]),_:1},8,["modelValue"])]))])}const Z=g(q,[["render",z]]);export{Z as default};
//# sourceMappingURL=ExpertiseList-BhD4c-FT.js.map
