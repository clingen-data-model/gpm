import{S,H as E,I as T,J as O,K as G,L as x,M as N,N as V,O as _,Q as q,R as C,T as J,U,V as D,W,X as g,Y as K,_ as L,p as b,a as p,c,b as f,d as o,f as m,C as y,D as Q,Z as P,w as h,i as F,h as Y,j as w,F as H,m as X,e as v}from"./app-xUpSbDwL.js";import{s as Z}from"./router_aware_sort_and_filter-DC3rfj3s.js";function k(e){return e}var z=1,$=2;function I(e,t,n,i){var s=n.length,r=s;if(e==null)return!r;for(e=Object(e);s--;){var a=n[s];if(a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++s<r;){a=n[s];var u=a[0],l=e[u],d=a[1];if(a[2]){if(l===void 0&&!(u in e))return!1}else{var B=new S,A;if(!(A===void 0?E(d,l,z|$,i,B):A))return!1}}return!0}function M(e){return e===e&&!T(e)}function j(e){for(var t=O(e),n=t.length;n--;){var i=t[n],s=e[i];t[n]=[i,s,M(s)]}return t}function R(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function ee(e){var t=j(e);return t.length==1&&t[0][2]?R(t[0][0],t[0][1]):function(n){return n===e||I(n,e,t)}}function te(e,t){return e!=null&&t in Object(e)}function ne(e,t,n){t=G(t,e);for(var i=-1,s=t.length,r=!1;++i<s;){var a=x(t[i]);if(!(r=e!=null&&n(e,a)))break;e=e[a]}return r||++i!=s?r:(s=e==null?0:e.length,!!s&&N(s)&&V(a,s)&&(_(e)||q(e)))}function re(e,t){return e!=null&&ne(e,t,te)}var ie=1,se=2;function ae(e,t){return C(e)&&M(t)?R(x(e),t):function(n){var i=J(n,e);return i===void 0&&i===t?re(n,e):E(t,i,ie|se)}}function le(e){return function(t){return t==null?void 0:t[e]}}function ue(e){return function(t){return U(t,e)}}function de(e){return C(e)?le(x(e)):ue(e)}function oe(e){return typeof e=="function"?e:e==null?k:typeof e=="object"?_(e)?ae(e[0],e[1]):ee(e):de(e)}function fe(e){return function(t,n,i){for(var s=-1,r=Object(t),a=i(t),u=a.length;u--;){var l=a[++s];if(n(r[l],l,r)===!1)break}return t}}var ce=fe();function pe(e,t){return e&&ce(e,t,O)}function me(e,t){return function(n,i){if(n==null)return n;if(!D(n))return e(n,i);for(var s=n.length,r=-1,a=Object(n);++r<s&&i(a[r],r,a)!==!1;);return n}}var he=me(pe);function _e(e,t){var n=-1,i=D(e)?Array(e.length):[];return he(e,function(s,r,a){i[++n]=t(s,r,a)}),i}function we(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function ge(e,t){if(e!==t){var n=e!==void 0,i=e===null,s=e===e,r=W(e),a=t!==void 0,u=t===null,l=t===t,d=W(t);if(!u&&!d&&!r&&e>t||r&&a&&l&&!u&&!d||i&&a&&l||!n&&l||!s)return 1;if(!i&&!r&&!d&&e<t||d&&n&&s&&!i&&!r||u&&n&&s||!a&&s||!l)return-1}return 0}function be(e,t,n){for(var i=-1,s=e.criteria,r=t.criteria,a=s.length,u=n.length;++i<a;){var l=ge(s[i],r[i]);if(l){if(i>=u)return l;var d=n[i];return l*(d=="desc"?-1:1)}}return e.index-t.index}function ye(e,t,n){t.length?t=g(t,function(r){return _(r)?function(a){return U(a,r.length===1?r[0]:r)}:r}):t=[k];var i=-1;t=g(t,K(oe));var s=_e(e,function(r,a,u){var l=g(t,function(d){return d(r)});return{criteria:l,index:++i,value:r}});return we(s,function(r,a){return be(r,a,n)})}function xe(e,t,n,i){return e==null?[]:(_(t)||(t=t==null?[]:[t]),n=n,_(n)||(n=n==null?[]:[n]),ye(e,t,n))}const Ae={name:"AnnualUpdateTeable",props:{items:{type:Array,required:!0}},setup(){const{sort:e,filter:t}=Z({field:"expert_panel.display_name",desc:!1});return{sort:e,filter:t}},data(){return{fields:[{name:"id",sortable:!0,label:"ID"},{name:"expert_panel.display_name",label:"Expert Panel",sortable:!0},{name:"submitter.person.name",label:"Submitter",sortable:!0},{name:"completed_at",label:"Completed",sortable:!0,resolveValue:e=>e.completed_at?this.formatDate(e.completed_at):null},{name:"action",label:"",sortable:!1}]}},computed:{completedFilter:{get(){return this.$route.query.completed||null},set(e){const t=this.$route.query,n=this.$route.path;let i={...t};e?i={...t,completed:e}:delete i.completed,this.$router.replace({path:n,query:i})}},filteredItems(){let e=JSON.parse(JSON.stringify(this.items));if(this.filter!=null){const t=new RegExp(`.*${this.filter}.*`,"i");e=this.items.filter(n=>n.expert_panel.display_name.match(t)||n.submitter&&n.submitter.person&&n.submitter.person.name.match(t))}return this.completedFilter!=null&&(e=e.filter(t=>Number.parseInt(this.completedFilter)===1?t.completed_at!==null:t.completed_at==null)),e}},methods:{exportData(){const e=this.filteredItems.map(t=>t.id);b.post("/api/annual-updates/export",{annual_update_ids:e}).then(t=>{const n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.href=window.URL.createObjectURL(new Blob([t.data,{type:"text/csv"}])),n.setAttribute("download","annual_updates.csv"),n.click(),document.body.removeChild(n)})}}},We={class:"flex mb-2 items-end justify-between"},ve={class:"flex space-x-4 items-end"};function Ee(e,t,n,i,s,r){const a=p("router-link"),u=p("data-table");return f(),c("div",null,[o("div",We,[o("div",ve,[y(o("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>i.filter=l),placeholder:"EP name, submitter name",class:"w-60"},null,512),[[Q,i.filter]]),y(o("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>r.completedFilter=l),class:"flex radio-group"},t[4]||(t[4]=[o("option",{value:null}," Any ",-1),o("option",{value:2}," Only Pending ",-1),o("option",{value:1}," Only Completed ",-1)]),512),[[P,r.completedFilter]])]),o("button",{class:"btn btn-xs",onClick:t[2]||(t[2]=(...l)=>r.exportData&&r.exportData(...l))}," Export Data ")]),m(u,{sort:i.sort,"onUpdate:sort":t[3]||(t[3]=l=>i.sort=l),data:r.filteredItems,fields:s.fields},{"cell-action":h(({item:l})=>[m(a,{to:{name:"AnnualUpdateDetail",params:{id:l.id}}},{default:h(()=>t[5]||(t[5]=[F(" view ")])),_:2},1032,["to"])]),_:1},8,["sort","data","fields"])])}const Oe=L(Ae,[["render",Ee]]),Ce={name:"AnnualUpdatesList",components:{AnnualUpdateTable:Oe},data(){return{selectedWindow:null,windows:[],items:[],loading:!1}},computed:{sortedWindows(){return xe(this.windows,"for_year","desc")},latestWindow(){return this.sortedWindows[0]||{}},gcepReviews(){return this.items.filter(e=>e.expert_panel.expert_panel_type_id===1)},vcepReviews(){return this.items.filter(e=>e.expert_panel.expert_panel_type_id===2)},selectedYear(){return this.selectedWindow?this.selectedWindow.for_year:this.latestWindow.for_year},selectedStartDate(){return this.selectedWindow?this.selectedWindow.start:this.latestWindow.start},selectedEndDate(){return this.selectedWindow?this.selectedWindow.end:this.latestWindow.end}},watch:{selectedWindow(e){e&&this.getItems()}},mounted(){this.getWindows(),this.getItems()},methods:{async getWindows(){this.windows=await b.get("/api/annual-updates/windows").then(e=>e.data),this.selectedWindow=this.latestWindow},async getItems(){let e="/api/annual-updates";this.selectedWindow&&(e+=`?window_id=${this.selectedWindow.id}`),this.loading=!0,this.items=await b.get(e).then(t=>t.data),this.loading=!1}}},Ue={class:"flex justify-between items-center border-b mb-4"},De={class:"border-0 mb-0"},Le=["value"],Pe={key:0},Fe={key:0};function ke(e,t,n,i,s,r){const a=p("AnnualUpdateTable"),u=p("tab-item"),l=p("tabs-container");return f(),c("div",null,[o("header",Ue,[o("h1",De," Annual Updates for "+w(r.selectedYear),1),F(" "+w(e.formatDate(r.selectedStartDate))+" - "+w(e.formatDate(r.selectedEndDate))+" ",1),s.windows.length>1?y((f(),c("select",{key:0,"onUpdate:modelValue":t[0]||(t[0]=d=>s.selectedWindow=d),class:"font-normal text-md"},[(f(!0),c(H,null,X(r.sortedWindows,d=>(f(),c("option",{key:d.id,value:d},w(d.for_year),9,Le))),128))],512)),[[P,s.selectedWindow]]):Y("",!0)]),m(l,null,{default:h(()=>[m(u,{label:"VCEPS"},{default:h(()=>[s.loading?(f(),c("div",Pe," Loading… ")):(f(),v(a,{key:1,items:r.vcepReviews},null,8,["items"]))]),_:1}),m(u,{label:"GCEPS"},{default:h(()=>[s.loading?(f(),c("div",Fe," Loading… ")):(f(),v(a,{key:1,items:r.gcepReviews},null,8,["items"]))]),_:1})]),_:1})])}const Be=L(Ce,[["render",ke],["__scopeId","data-v-4c99267f"]]);export{Be as default};
//# sourceMappingURL=AnnualUpdatesList-wvkrgRgO.js.map
