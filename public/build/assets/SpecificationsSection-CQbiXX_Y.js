import{_ as w,c as r,d as t,f as m,F as D,m as v,i as g,a as c,w as p,b as o,j as y,am as I,a2 as T,A,h as d,e as _,a1 as N}from"./app-xtqLUWuO.js";const F={name:"CspecSummary",props:{readonly:{type:Boolean,default:!1}},data(){return{sort:{field:"id",desc:!1},specFields:[{name:"name",type:String,sortable:!0},{name:"status",label:"Status",type:String,sortable:!0},{name:"updated_at",label:"Last Updated",type:Date,sortable:!0}]}},computed:{group(){return this.$store.getters["groups/currentItemOrNew"]},hasSpecifications(){return this.group.expert_panel.specifications&&this.group.expert_panel.specifications.length>0},specifications(){return this.group.expert_panel.specifications}},watch:{group(n){this.$store.dispatch("groups/getSpecifications",n)}},mounted(){this.$store.dispatch("groups/getSpecifications",this.group)},methods:{goToCspec(){window.location="https://cspec.genome.network/"}}},U={key:0,class:"well mb-2"},V={key:1},x={class:"mb-2"},E=["href"],B=["disabled"];function $(n,e,l,b,a,s){const f=c("icon-arrow-right"),h=c("note");return o(),r("div",null,[s.hasSpecifications?(o(),r("div",V,[t("table",x,[e[0]||(e[0]=t("thead",null,[t("tr",null,[t("th",null,"Specification Name"),t("th",null,"Status"),t("th",null,"Last Updated"),t("th",null," ")])],-1)),t("tbody",null,[(o(!0),r(D,null,v(s.specifications,u=>(o(),r("tr",{key:u.id},[t("td",null,y(u.name),1),t("td",null,y(u.status),1),t("td",null,y(n.formatDate(u.updated_at)),1),t("td",null,[t("ul",null,[t("li",null,[t("a",{target:"cspec_edit",href:`https://cspec.genome.network/cspec/ed/svi/doc/${u.cspec_id}`},"Edit",8,E)])])])]))),128))])])])):(o(),r("div",U," No specifications on record in the CSPEC Registry. ")),t("a",{class:"btn btn-lg blue",target:"cspec-editor",disabled:l.readonly,href:"https://cspec.genome.network/"},[e[1]||(e[1]=g(" Go to the CSpec Registry ")),m(f,{class:"inline"})],8,B),m(h,{class:"mt-2"},{default:p(()=>e[2]||(e[2]=[g(" It may take up to an hour for the latest updates in the CSPEC Registry to display here. ")])),_:1})])}const O=w(F,[["render",$]]),L=A.documentsTypes,j={props:{documentTypeId:{type:[Number,Array],required:!0},step:{type:Number,required:!1,default:null},showNotes:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["saved","canceled"],data(){return{newDocument:{file:null,date_received:new Date().toISOString(),step:this.step},errors:{},activeDocument:{},showDeleteConfirmation:!1}},computed:{group(){return this.$store.getters["groups/currentItemOrNew"]},documents(){return this.group.documents.filter(n=>this.docTypeIsArray?this.documentTypeId.includes(n.document_type_id):n.document_type_id===this.documentTypeId)},docTypeIsArray(){return Array.isArray(this.documentTypeId)},filteredTypes(){return this.docTypeIsArray?Object.values(L).filter(n=>this.documentTypeId.includes(n.id)).map(n=>({label:n.long_name,value:n.id})):[]},document_type_id(){return this.docTypeIsArray?null:this.documentTypeId}},mounted(){this.$store.dispatch("groups/getDocuments",this.group)},methods:{async save(){try{const n=new FormData;Object.entries(this.newDocument).forEach(([e,l])=>{l!=null&&n.append(e,l)}),n.set("file",this.$refs.fileInput.files[0]),n.set("document_type_id",this.documentTypeId),await this.$store.dispatch("groups/addApplicationDocument",{group:this.group,data:n}),this.clearForm(),this.$emit("saved")}catch(n){T(n)&&(this.errors=n.response.data.errors)}},cancel(){this.clearForm(),this.$emit("canceled")},clearForm(){this.initNewDocument(),this.clearErrors()},initNewDocument(){this.$refs.fileInput.value=null,this.newDocument={file:null,date_received:I(new Date),date_reviewed:null,step:this.step,document_type_id:this.documentTypeId,notes:null}},clearErrors(){this.errors={}},initDownload(n){window.location=n.download_url},initDelete(n){this.activeDocument=n,this.showDeleteConfirmation=!0},cancelDelete(){this.showDeleteConfirmation=!1,this.resetActiveDocument()},async commitDelete(){await this.$store.dispatch("groups/deleteDocument",{group:this.group,document:this.activeDocument}),this.showDeleteConfirmation=!1,this.resetActiveDocument()},resetActiveDocument(){this.activeDocument={type:{}}}}},q={key:0,class:"table"},P={key:0},R=["href"],G={class:"note"},Y={key:0},z={key:1},H={ref:"fileInput",type:"file"},J={key:0},K={key:0,class:"mb-3"};function M(n,e,l,b,a,s){const f=c("dropdown-item"),h=c("dropdown-menu"),u=c("input-row"),S=c("button-row"),k=c("modal-dialog");return o(),r("div",null,[s.documents.length>0?(o(),r("table",q,[t("thead",null,[t("tr",null,[e[3]||(e[3]=t("th",null,"File",-1)),s.docTypeIsArray?(o(),r("th",P," Type ")):d("",!0),e[4]||(e[4]=t("th",null,"uploaded",-1)),e[5]||(e[5]=t("th",null,null,-1))])]),t("tbody",null,[(o(!0),r(D,null,v(s.documents,i=>(o(),r("tr",{key:i.id,class:"p-1 border"},[t("td",null,[t("a",{href:i.download_url},y(i.filename),9,R),t("span",G," (v. "+y(i.version)+")",1)]),s.docTypeIsArray?(o(),r("td",Y,y(i.type.long_name),1)):d("",!0),t("td",null,y(n.formatDate(i.created_at)),1),t("td",null,[m(h,{"hide-cheveron":""},{label:p(()=>e[6]||(e[6]=[t("button",{class:"btn btn-xs"}," … ",-1)])),default:p(()=>[m(f,{onClick:C=>s.initDownload(i)},{default:p(()=>e[7]||(e[7]=[g(" Download ")])),_:2},1032,["onClick"]),n.hasAnyPermission(["ep-applications-manage",["application-edit",s.group]])?(o(),_(f,{key:0,onClick:C=>s.initDelete(i)},{default:p(()=>e[8]||(e[8]=[g(" Delete ")])),_:2},1032,["onClick"])):d("",!0)]),_:2},1024)])]))),128))])])):d("",!0),l.readonly?d("",!0):(o(),r("div",z,[s.docTypeIsArray?(o(),_(u,{key:0,modelValue:a.newDocument.document_type_id,"onUpdate:modelValue":e[0]||(e[0]=i=>a.newDocument.document_type_id=i),label:"Document type",type:"select",options:s.filteredTypes},null,8,["modelValue","options"])):d("",!0),m(u,{label:"Document",errors:a.errors.file},{default:p(()=>[t("input",H,null,512)]),_:1},8,["errors"]),t("button",{class:"btn blue",onClick:e[1]||(e[1]=(...i)=>s.save&&s.save(...i))}," Upload ")])),(o(),_(N,{to:"body"},[m(k,{modelValue:a.showDeleteConfirmation,"onUpdate:modelValue":e[2]||(e[2]=i=>a.showDeleteConfirmation=i),title:`You are about to delete ${a.activeDocument.filename}`},{default:p(()=>[a.activeDocument?(o(),r("div",J,[a.activeDocument.is_final?(o(),r("p",K," This version has been tagged as the final version of the document. ")):d("",!0),e[9]||(e[9]=t("p",null,"Are you sure you want to continue?",-1)),m(S,{"submit-text":"Delete Document",onCanceled:s.cancelDelete,onSubmitted:s.commitDelete},null,8,["onCanceled","onSubmitted"])])):d("",!0)]),_:1},8,["modelValue","title"])]))])}const Q=w(j,[["render",M]]),W={name:"SpecificationsSection",components:{CspecSummary:O,ApplicationUploadForm:Q},props:{docTypeId:{required:!0,type:[Number,Array]},readonly:{type:Boolean,default:!1}},data(){return{}},computed:{cspecSummaryEnabled(){return this.$store.state.systemInfo.app.features.cspec_summary},specificationUpload(){return this.$store.state.systemInfo.app.features.specification_upload}},methods:{}};function X(n,e,l,b,a,s){const f=c("CspecSummary"),h=c("ApplicationUploadForm"),u=c("collapsible");return o(),r("div",null,[s.cspecSummaryEnabled?(o(),_(f,{key:0,readonly:l.readonly},null,8,["readonly"])):d("",!0),m(u,{class:"mt-4"},{title:p(()=>e[0]||(e[0]=[t("h3",null,"Legacy document-based specifications",-1)])),default:p(()=>[s.specificationUpload?(o(),_(h,{key:0,"document-type-id":l.docTypeId,"show-notes":!1,readonly:l.readonly},null,8,["document-type-id","readonly"])):d("",!0)]),_:1})])}const ee=w(W,[["render",X]]);export{ee as S};
//# sourceMappingURL=SpecificationsSection-CQbiXX_Y.js.map
