import{s as ue,p as q,r as R,q as C,L as Y,$ as W,o as K,a as w,c as h,b as u,f as a,v as O,k as de,d as c,e as S,C as B,h as x,j as _,w as m,i as b,aG as U,S as N,F as z,m as H,n as J,g as j,J as pe,a6 as F,x as ve}from"./app-CIOUoV39.js";import{_ as _e,a as ye}from"./ExpertisesView-CO59Nvnb.js";import{E as fe}from"./EvidenceSummaryList-DBzGAVIj.js";class Q{constructor(t,e={}){this.baseUrl=t,this.options=e}query(t){const e=ue(t);return q.get(this.baseUrl+e).then(o=>this.transformToEntity(o.data))}find(t){return q.get(`${this.baseUrl}/${t}`).then(e=>this.transformToEntity(e.data))}save(t){return q.post(this.baseUrl,t).then(e=>this.transformToEntity(e.data))}update(t){return q.put(`${this.baseUrl}/${t.id}`,t).then(e=>this.transformToEntity(e.data))}destroy(t){return q.delete(`${this.baseUrl}/${t.id}`)}transformToEntity(t){return this.options.entityClass&&Array.isArray(t)?t.map(e=>new this.options.entityClass(e)):t}}const A=new Q("/api/comments");A.resolve=l=>q.post(`/api/comments/${l}/resolved`).then(t=>t.data);A.unresolve=l=>q.post(`/api/comments/${l}/unresolved`).then(t=>t.data);const P={internal:1,suggestion:2,requirement:3},be=(l,t)=>{const e=R([]),o=C(()=>e.value.filter(n=>!n.is_resolved)),y=C(()=>o.value.filter(n=>n.comment_type_id===P.requirement)),p=C(()=>o.value.filter(n=>n.comment_type_id===P.suggestion)),g=C(()=>[...y.value,...p.value]),i=C(()=>o.value.filter(n=>n.comment_type_id===P.internal)),s=n=>e.value.findIndex($=>$.id===n.id);return{subject:{type:l,id:t},comments:e,openComments:o,openRequirements:y,openSuggestions:p,openInternal:i,getComments:async()=>{e.value=await A.query({where:{subject_type:l,subject_id:t}})},addComment:n=>e.value.push(n),removeComment:n=>e.value.splice(s(n),1),updateComment:n=>e.value[s(n)]=n,commentsForEp:g}};class ge{constructor(t,e){this.fields=t,this.repo=e,this.currentItem=R({}),this.originalItem=R({}),this.errors=R({})}async find(t){return await this.repo.find(t).then(e=>(this.currentItem.value=e,this.originalItem.value=e,e))}async save(t){this.clearErrors();try{const e=await this.repo.save(t);return this.clearCurrentItem(),e}catch(e){throw Y(e)&&(this.errors.value=e.response.data.errors),e}}async update(t){this.clearErrors();try{return this.currentItem.value=this.repo.update(t),this.currentItem.value}catch(e){throw Y(e)&&(this.errors.value=e.response.data.errors),e}}async destroy(t){this.repo.destroy(t)}cancel(){this.clearErrors(),this.currentItem.value.id||this.clearCurrentItem()}clearCurrentItem(){this.currentItem.value={}}clearErrors(){this.errors.value={}}}class we extends Q{constructor(t,e={}){super(t,e),this.cachedList=null}query(t){if(!this.cachedList){const e=super.query(t);this.cachedList=e}return this.cachedList}find(t){throw new Error("CommentTypeRepository.find not implemented")}save(t){throw new Error("CommentTypeRepository.save not implemented")}update(t){throw new Error("CommentTypeRepository.update not implemented")}destroy(t){throw new Error("CommentTypeRepository.destroy not implemented")}}const he=new we("/api/comment-types"),V=R([]),Ce=async()=>await he.query().then(l=>(V.value=l.map(t=>({label:t.name,value:t.id})),V.value)),ke=R([{name:"comment_type_id",label:"Type",type:"select",options:V,required:!0},{name:"content",label:"Comment",type:"large-text",required:!0}]),X=()=>(Ce(),new ge(ke,A)),L={__name:"ReviewCommentForm",props:{commentManager:{type:Object,required:!0},section:{type:[String,null],default:null},subjectType:{type:String,default:"App\\Modules\\Group\\Models\\Group"},subjectId:{type:Number,required:!1},comment:{type:Object},onlyInternal:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(l,{emit:t}){const e=l,o=t,y=W("group"),p=X();K(()=>{e.comment&&(p.currentItem.value=e.comment)});const g=C(()=>{const n=[...p.fields.value];if(e.onlyInternal){const $=n.findIndex(D=>D.name==="comment_type_id");n.splice($,1)}return n}),i=C(()=>p.errors.value),s=C({get(){return p.currentItem.value},set(n){p.currentItem.value=n}}),k=()=>{p.clearCurrentItem(),p.clearErrors(),o("canceled")},r=()=>{s.value.subject_type=e.subjectType,s.value.subject_id=e.subjectId||y.value.id,s.value.metadata={section:e.section,root_subject_type:"App\\Modules\\Group\\Models\\Group",root_subject_id:y.value.id},e.onlyInternal&&(s.value.comment_type_id=1),p.save(s.value).then(n=>{e.commentManager.addComment(n),o("saved",n)})},v=()=>{e.onlyInternal&&(s.value.comment_type_id=1),p.update(s.value).then(n=>{e.commentManager.updateComment(n),o("saved",n)})},d=()=>{if(s.value.id){v();return}r()};return(n,$)=>{const D=w("data-form"),T=w("button-row");return u(),h("div",null,[a(D,{modelValue:s.value,"onUpdate:modelValue":$[0]||($[0]=G=>s.value=G),fields:g.value,errors:i.value},null,8,["modelValue","fields","errors"]),a(T,{size:"xs","submit-text":"Save",onSubmitted:d,onCanceled:k})])}}},xe={class:"my-2"},$e={class:"comment-container"},Re={key:0,class:"relative"},Ie={class:"flex justify-between items-start mb-1 rounded"},Se={class:"flex space-x-2 items-end"},Ee={class:"block"},je={class:"flex space-x-2"},Me={class:"replies ml-1"},qe={key:0},Te={class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},Ae={__name:"ReviewComment",props:{comment:{type:Object,required:!0},commentManager:{type:Object,required:!0}},emits:["created","updated","resolved","unresolved","deleted"],setup(l,{emit:t}){const e=l,o=t,y=O(),p=X(),g=R(be("App\\Models\\Comment",e.comment.id)),i=R(!1),s=R(!1),k=I=>{if(!I.type)return"gray";switch(I.type.name){case"required revision":return"yellow";case"suggestion":return"blue";case"internal comment":return"gray"}},r=()=>{s.value=!0},v=()=>{p.destroy(e.comment).then(()=>{s.value=!1,e.commentManager.removeComment(e.comment),o("deleted",e.comment)})},d=async()=>{if(e.comment.is_resolved){const f=await A.unresolve(e.comment.id);e.commentManager.updateComment(f),o("updated"),o("resolved");return}const I=await A.resolve(e.comment.id);e.commentManager.updateComment(I),o("updated"),o("unresolved")},n=R(!1),$=()=>{g.value.getComments().then(I=>(n.value=!0,I))},D=async()=>{n.value||$(),n.value=!n.value},T=R(!1),G=()=>T.value=!0,Z=()=>{const I={...e.comment};I.comments_count+=1,e.commentManager.updateComment(I),n.value=!0,T.value=!1},ee=()=>{const I={...e.comment};I.comments_count-=1,e.commentManager.updateComment(I)};K(()=>{g.value.getComments()});const te=C(()=>de("comments-manage")||y.getters.currentUser.person.id===e.comment.creator_id);return(I,f)=>{const ne=w("badge"),oe=w("icon-checkmark"),se=w("popper"),ae=w("dropdown-menu"),re=w("markdown-block"),le=w("icon-reply"),ie=w("button-row"),me=w("static-alert"),ce=w("ReviewComment",!0);return u(),h("div",xe,[c("div",$e,[i.value?(u(),S(L,{key:1,comment:l.comment,"comment-manager":l.commentManager,onCanceled:f[2]||(f[2]=M=>i.value=!1),onSaved:f[3]||(f[3]=M=>i.value=!1)},null,8,["comment","comment-manager"])):(u(),h("div",Re,[c("div",Ie,[c("div",Se,[c("strong",Ee,_(l.comment.creator&&l.comment.creator.name),1),a(ne,{class:"block",color:k(l.comment),size:"xxs"},{default:m(()=>[b(_(l.comment.type&&I.titleCase(l.comment.type.name)),1)]),_:1},8,["color"]),l.comment.is_resolved?(u(),S(se,{key:0,hover:"",arrow:"",content:"Resolved"},{default:m(()=>[a(oe,{class:"text-green-500",title:"Resolved"})]),_:1})):x("",!0)]),c("div",je,[te.value?(u(),S(ae,{key:0,"hide-cheveron":""},{default:m(()=>[a(U,{onClick:f[0]||(f[0]=M=>i.value=!0)},{default:m(()=>f[5]||(f[5]=[b(" Edit ")])),_:1}),a(U,{onClick:d},{default:m(()=>[b(_(l.comment.is_resolved?"Mark unresolved":"Resolve"),1)]),_:1}),a(U,{onClick:r},{default:m(()=>f[6]||(f[6]=[b(" Delete ")])),_:1})]),_:1})):x("",!0)])]),a(re,{markdown:l.comment.content,class:"text-sm"},null,8,["markdown"]),c("button",{class:"link",onClick:G},[a(le,{class:"inline-block"}),f[7]||(f[7]=b("Reply "))]),B(a(me,{variant:"danger",class:""},{default:m(()=>[f[8]||(f[8]=b(" Continue with delete? ")),a(ie,{size:"xs","submit-text":"Yes, delete","submit-variant":"red",onSubmitted:v,onCanceled:f[1]||(f[1]=M=>s.value=!1)})]),_:1},512),[[N,s.value]])]))]),c("div",Me,[n.value?(u(),h("ul",qe,[(u(!0),h(z,null,H(g.value.comments,M=>(u(),h("li",{key:M.id,class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},[a(ce,{comment:M,"comment-manager":g.value,onDeleted:ee},null,8,["comment","comment-manager"])]))),128))])):x("",!0),l.comment.comments_count>0?(u(),h("button",{key:1,class:"link text-sm",onClick:D},_(n.value?"Hide":"Show")+" "+_(l.comment.comments_count)+" "+_(l.comment.comments_count>1?"replies":"reply"),1)):x("",!0),B(c("div",Te,[f[9]||(f[9]=c("strong",null,"Your Reply",-1)),a(L,{"subject-type":"App\\Models\\Comment","subject-id":l.comment.id,"only-internal":!0,"comment-manager":g.value,onSaved:Z,onCanceled:f[4]||(f[4]=M=>T.value=!1)},null,8,["subject-id","comment-manager"])],512),[[N,T.value]])])])}}},De={class:"lg:flex lg:space-x-4 screen-block"},Fe={class:"flex justify-between items-start space-x-4"},Be={key:0,class:"flex justify-between items-center lg:w-2/5 px-2 py-1 pb-0 bg-gray-100 rounded-lg"},Ne={class:"lg:w-2/5 p-2 bg-gray-100 rounded-lg mb-2"},Ge={class:"flex justify-between items-center"},Ue={class:"bg-white mt-2 p-2"},E={__name:"ReviewSection",props:{title:{type:String||null,default:null},name:{type:String||null,default:null}},setup(l){const t=l,e=W("commentManager"),o=R(!1),y=R(!0),p=C(()=>e?e.value.comments.filter(i=>i.metadata?i.metadata.section===t.name:!1):[]),g=C(()=>e?p.value.find(i=>i.type.name==="required revision")?"yellow":p.value.find(i=>i.type.name==="suggestion")?"blue":"gray":null);return(i,s)=>{const k=w("icon-cheveron-right"),r=w("badge"),v=w("icon-cheveron-down");return u(),h("section",De,[c("div",{class:J(["overflow-x-auto flex-grow",{"lg:w-3/5":y.value}])},[c("header",Fe,[c("h2",{class:J(["flex-grow",{"lg:w-3/5":!y.value}])},_(l.title),3),j(e)?B((u(),h("div",Be,[c("h3",null,[a(k,{class:"inline cursor-pointer",onClick:s[0]||(s[0]=d=>y.value=!0)}),s[5]||(s[5]=b(" Comments ")),a(r,{color:g.value},{default:m(()=>[b(_(p.value.length),1)]),_:1},8,["color"])])],512)),[[N,!y.value]]):x("",!0)]),c("div",null,[c("div",null,[pe(i.$slots,"default")])])],2),B(c("div",Ne,[c("div",Ge,[c("h3",null,[a(v,{class:"inline cursor-pointer",onClick:s[1]||(s[1]=d=>y.value=!1)}),s[6]||(s[6]=b(" Comments "))])]),c("ul",null,[(u(!0),h(z,null,H(p.value,d=>(u(),h("li",{key:d.id,class:"bg-white p-2"},[a(Ae,{comment:d,"comment-manager":j(e)},null,8,["comment","comment-manager"])]))),128))]),c("div",Ue,[o.value?(u(),S(L,{key:0,section:l.name,"comment-manager":j(e),onSaved:s[2]||(s[2]=d=>o.value=!1),onCanceled:s[3]||(s[3]=d=>o.value=!1)},null,8,["section","comment-manager"])):(u(),h("button",{key:1,class:"btn btn-xs block",onClick:s[4]||(s[4]=d=>o.value=!0)}," Add comment "))])],512),[[N,y.value&&j(e)]])])}}},Pe={__name:"ReviewMembership",props:{members:{required:!0,type:Array}},setup(l){const t=l,e={Chair:1,Coordinator:2,"Grant Liaison":3,Biocurator:4,Expert:5},o=r=>e[r.display_name]??1/0,y=R({field:"roles",desc:!1}),g=R([{name:"name",sortable:!0,label:"Name",sortFunction:(r,v)=>{let d=r.last_name.localeCompare(v.last_name);return d===0&&(d=r.first_name.localeCompare(v.first_name)),d}},{name:"legacy_credentials",sortable:!1,label:"Credentials"},{name:"roles",sortable:!0,label:"Roles",sortFunction:(r,v)=>r.role_priority-v.role_priority},{name:"legacy_expertise",sortable:!1,label:"Expertise"},{name:"institution",sortable:!1,label:"Institution"}]),i=C(()=>t.members.map(r=>{var d;const v=r.roles.toSorted((n,$)=>n.id-$.id);return{id:r.id,first_name:r.person.first_name,last_name:r.person.last_name,name:r.person.name,institution:(d=r.person.institution)==null?void 0:d.name,legacy_credentials:r.person.legacy_credentials,legacy_expertise:r.legacy_expertise,roles:v,role_priority:Math.min(...v.map(o)),active:r.isActive,person:r.person}}).filter(r=>r.active)),s=(r,v)=>{r[v]||(r[v]=0),r[v]++},k=C(()=>{const r={};return r.Total=i.value.length,console.log(i.value),Object.keys(e).forEach(v=>r[v]=0),i.value.forEach(v=>{v.roles.forEach(d=>s(r,d.display_name)),v.roles.length===0&&s(r,"None")}),r});return(r,v)=>{const d=w("data-table");return u(),h("div",null,[(u(!0),h(z,null,H(k.value,(n,$)=>(u(),h("div",{key:$},[c("span",null,_($)+": "+_(n),1)]))),128)),a(d,{sort:y.value,"onUpdate:sort":v[0]||(v[0]=n=>y.value=n),fields:g.value,data:i.value,class:"text-xs"},{"cell-roles":m(({item:n})=>[c("span",null,_(n.roles.map($=>$.display_name).join(", ")),1)]),"cell-legacy_credentials":m(({item:n})=>[a(ye,{person:n.person},null,8,["person"])]),"cell-legacy_expertise":m(({item:n})=>[a(_e,{person:n.person,"legacy-expertise":n.legacy_expertise},null,8,["person","legacy-expertise"])]),_:1},8,["sort","fields","data"])])}}},Ve={class:"space-y-4"},Le={key:0,class:"mt-6"},Oe={class:"mb-6"},ze={key:0},He={class:"flex-none"},Ye={key:0,class:"mt-1"},et={__name:"DefinitionReview",setup(l){const t=O(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel),y=C(()=>e.value?e.value.members:[]),p=C(()=>({type:e.value.type.name?e.value.type.name.toUpperCase():"",long_base_name:o.value.long_base_name,short_base_name:o.value.short_base_name}));return(g,i)=>{const s=w("object-dictionary"),k=w("dictionary-row"),r=w("markdown-block"),v=w("simple-table");return u(),h("div",Ve,[a(E,{title:"Basic Information",name:"basic-info"},{default:m(()=>[a(s,{obj:p.value,"label-class":"w-40 font-bold"},null,8,["obj"]),a(k,{label:"CDWG","label-class":"w-40 font-bold"},{default:m(()=>[b(_(e.value.parent?e.value.parent.name:"--"),1)]),_:1})]),_:1}),a(E,{title:"Membership",name:"membership"},{default:m(()=>[a(Pe,{members:y.value},null,8,["members"]),e.value.is_vcep_or_scvcep?(u(),h("div",Le,[i[0]||(i[0]=c("h4",null,"Expertise of VCEP members",-1)),c("blockquote",null,[a(r,{markdown:o.value.membership_description},null,8,["markdown"])])])):x("",!0)]),_:1}),a(E,{title:"Scope",name:"scope"},{default:m(()=>[i[1]||(i[1]=c("h3",null,"Genes",-1)),c("div",Oe,[e.value.is_gcep?(u(),h("p",ze,_(o.value.genes.map(d=>d.gene_symbol).join(", ")),1)):x("",!0),e.value.is_vcep_or_scvcep?(u(),S(v,{key:1,data:o.value.genes.map(d=>({id:d.id,gene:d.gene_symbol,disease:d.disease_name})),"key-by":"id","hide-columns":["id"]},null,8,["data"])):x("",!0)]),i[2]||(i[2]=c("h3",null,"Description of scope",-1)),c("blockquote",null,[a(r,{markdown:o.value.scope_description},null,8,["markdown"])])]),_:1}),e.value.is_gcep?(u(),S(E,{key:0,title:"Plans",name:"plans"},{default:m(()=>[a(k,{label:"Selected protocol","label-class":"w-48 font-bold"},{default:m(()=>[c("div",He,[b(_(o.value.curation_review_protocol?g.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id===100?(u(),h("p",Ye,[i[3]||(i[3]=c("em",null,"Details:",-1)),b(" "+_(o.value.curation_review_protocol_other),1)])):x("",!0)])]),_:1})]),_:1})):x("",!0),e.value.is_gcep?(u(),S(E,{key:1,title:"Attestations",name:"attestations"},{default:m(()=>[a(k,{label:"GCEP Attestation Signed","label-class":"w-52 font-bold"},{default:m(()=>[b(_(j(F)(o.value.gcep_attestation_date)),1)]),_:1}),a(k,{label:"GCI Training Date","label-class":"w-52 font-bold"},{default:m(()=>[b(_(j(F)(o.value.gci_training_date)),1)]),_:1}),a(k,{label:"NHGRI Attestation Signed","label-class":"w-52 font-bold"},{default:m(()=>[b(_(j(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):x("",!0),e.value.is_vcep_or_scvcep?(u(),S(E,{key:2,title:"Attestations",name:"attestations"},{default:m(()=>[a(k,{label:"Reanalysis and Discrepancy Resolution Attestation Signed","label-class":"w-52 font-bold"},{default:m(()=>[b(_(j(F)(o.value.reanalysis_attestation_date)),1)]),_:1}),a(k,{label:"NHGRI Attestation Signed","label-class":"w-60 font-bold"},{default:m(()=>[b(_(j(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):x("",!0)])}}},Je={class:"application-review p-2 bg-gray-100"},We={class:"w-full"},Ke={key:0,class:"mt-1"},tt={__name:"SustainedCurationReview",setup(l){const t=O(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel);return ve(()=>e.value,(y,p)=>{y.id&&(!p||y.id!==p.id)&&t.dispatch("groups/getEvidenceSummaries",e.value)}),(y,p)=>{const g=w("dictionary-row"),i=w("markdown-block");return u(),h("div",Je,[o.value.has_approved_pilot?(u(),S(E,{key:0,title:"Plans for Ongoing Review and Discrepancy Resolution",name:"discrepency-review"},{default:m(()=>[a(g,{label:"Selected protocol","label-width-class":"w-48 font-bold"},{default:m(()=>[c("div",We,[b(_(o.value.curation_review_protocol?y.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id===100?(u(),h("p",Ke,[p[0]||(p[0]=c("em",null,"Details:",-1)),b(" "+_(o.value.curation_review_protocol_other),1)])):x("",!0)])]),_:1}),a(g,{label:"Notes","label-width-class":"w-48 font-bold"},{default:m(()=>[a(i,{markdown:o.value.curation_review_process_notes},null,8,["markdown"])]),_:1})]),_:1})):x("",!0),o.value.has_approved_pilot?(u(),S(E,{key:1,title:"Evidence Summaries",name:"evidence-summaries"},{default:m(()=>[a(fe,{readonly:!0})]),_:1})):x("",!0),o.value.has_approved_pilot?(u(),S(E,{key:2,title:"Core Approval Member, Trained Biocurator, and Biocurator Trainer Designation",name:"member-designation"},{default:m(()=>[a(g,{label:"Core Approval Members","label-width-class":"w-48 font-bold"},{default:m(()=>[b(_(e.value.coreApprovalMembers.map(s=>s.person.name).join(", ")),1)]),_:1}),a(g,{label:"Biocurator Trainers","label-width-class":"w-48 font-bold"},{default:m(()=>[b(_(e.value.biocuratorTrainers.map(s=>s.person.name).join(", ")),1)]),_:1}),a(g,{label:"Trained Biocurators","label-width-class":"w-48 font-bold"},{default:m(()=>[b(_(e.value.trainedBiocurators.map(s=>s.person.name).join(", ")),1)]),_:1})]),_:1})):x("",!0)])}}};export{tt as _,et as a,be as c};
//# sourceMappingURL=SustainedCurationReview-CxvAtxQj.js.map
