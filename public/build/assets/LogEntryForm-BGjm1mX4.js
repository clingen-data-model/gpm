import{_,B as w,an as h,ao as g,am as u,e as p,w as a,f as i,h as b,a as o,d,b as c}from"./app-DNJR23u9.js";import{u as V,s as v,l as N}from"./log_entry_repository-BcZgjvxE.js";const x={name:"LogEntryForm",components:{StepInput:g,RichTextEditor:h},props:{id:{required:!1,default:null}},emits:["canceled","saved"],setup(){return{logEntries:N}},data(){return{newEntry:{log_date:new Date,step:null,entry:""},errors:{}}},computed:{...w({group:"groups/currentItemOrNew"}),application(){return this.group.expert_panel}},watch:{id:{immediate:!0,handler(){const e=this.findEntry();e&&this.syncEntry(e)}},application:{immediate:!0,handler(){const e=this.findEntry();e&&this.syncEntry(e)}}},mounted(){this.$el.querySelectorAll("input")[0].focus()},methods:{findEntry(){if(this.id===null)return null;const e=Number.parseInt(this.id);if(this.logEntries)return this.logEntries.find(t=>t.id===e)},initNewEntry(){this.newEntry={log_date:u(new Date),step:null,entry:""}},syncEntry(e){e&&(this.newEntry={id:e.id,log_date:u(new Date(Date.parse(e.created_at))),step:Number.parseInt(e.step),entry:e.description})},cancel(){this.initNewEntry(),this.$emit("canceled")},async save(){try{this.newEntry.id?V(`/api/groups/${this.group.uuid}/activity-logs/${this.newEntry.id}`,this.newEntry):v(`/api/groups/${this.group.uuid}/activity-logs`,this.newEntry),this.initNewEntry(),this.$emit("saved")}catch(e){e.response&&Number.parseInt(e.response.status)===422&&e.response.data.errors&&(this.errors=e.response.data.errors)}}}};function I(e,t,C,D,r,s){const l=o("input-row"),m=o("StepInput"),y=o("RichTextEditor"),E=o("button-row"),f=o("form-container");return c(),p(f,{class:"log-entry-form"},{default:a(()=>[i(l,{modelValue:r.newEntry.log_date,"onUpdate:modelValue":t[0]||(t[0]=n=>r.newEntry.log_date=n),label:"Log Date",errors:r.errors.log_date,type:"date"},null,8,["modelValue","errors"]),s.application.expert_panel_type_id==2?(c(),p(m,{key:0,modelValue:r.newEntry.step,"onUpdate:modelValue":t[1]||(t[1]=n=>r.newEntry.step=n),errors:r.errors.step},null,8,["modelValue","errors"])):b("",!0),i(l,{label:"Entry",errors:r.errors.entry},{default:a(()=>[i(y,{modelValue:r.newEntry.entry,"onUpdate:modelValue":t[2]||(t[2]=n=>r.newEntry.entry=n)},null,8,["modelValue"])]),_:1},8,["errors"]),i(E,null,{default:a(()=>[d("button",{class:"btn",onClick:t[3]||(t[3]=(...n)=>s.cancel&&s.cancel(...n))}," Cancel "),d("button",{class:"btn blue",onClick:t[4]||(t[4]=(...n)=>s.save&&s.save(...n))}," Save ")]),_:1})]),_:1})}const B=_(x,[["render",I]]);export{B as default};
//# sourceMappingURL=LogEntryForm-BGjm1mX4.js.map
