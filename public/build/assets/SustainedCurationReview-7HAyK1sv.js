import{s as me,p as T,r as $,q as C,a2 as Y,af as J,o as K,a as h,c as w,b as u,f as r,v as O,k as de,d as m,e as S,C as B,h as k,j as v,w as c,i as b,aG as L,a8 as G,F as H,m as z,n as W,g as M,$ as pe,am as F,x as ve}from"./app-uoJXbb9N.js";import{_ as _e,a as fe}from"./ExpertisesView-BYYle8Li.js";import{_ as ye,V as be}from"./SpecificationsSection-DbcKYiXX.js";import{E as ge}from"./EvidenceSummaryList-85vBMNcx.js";class Q{constructor(t,e={}){this.baseUrl=t,this.options=e}query(t){const e=me(t);return T.get(this.baseUrl+e).then(o=>this.transformToEntity(o.data))}find(t){return T.get(`${this.baseUrl}/${t}`).then(e=>this.transformToEntity(e.data))}save(t){return T.post(this.baseUrl,t).then(e=>this.transformToEntity(e.data))}update(t){return T.put(`${this.baseUrl}/${t.id}`,t).then(e=>this.transformToEntity(e.data))}destroy(t){return T.delete(`${this.baseUrl}/${t.id}`)}transformToEntity(t){return this.options.entityClass&&Array.isArray(t)?t.map(e=>new this.options.entityClass(e)):t}}const A=new Q("/api/comments");A.resolve=l=>T.post(`/api/comments/${l}/resolved`).then(t=>t.data);A.unresolve=l=>T.post(`/api/comments/${l}/unresolved`).then(t=>t.data);const V={internal:1,suggestion:2,requirement:3},we=(l,t)=>{const e=$([]),o=C(()=>e.value.filter(n=>!n.is_resolved)),_=C(()=>o.value.filter(n=>n.comment_type_id===V.requirement)),d=C(()=>o.value.filter(n=>n.comment_type_id===V.suggestion)),g=C(()=>[..._.value,...d.value]),i=C(()=>o.value.filter(n=>n.comment_type_id===V.internal)),s=n=>e.value.findIndex(R=>R.id===n.id);return{subject:{type:l,id:t},comments:e,openComments:o,openRequirements:_,openSuggestions:d,openInternal:i,getComments:async()=>{e.value=await A.query({where:{subject_type:l,subject_id:t}})},addComment:n=>e.value.push(n),removeComment:n=>e.value.splice(s(n),1),updateComment:n=>e.value[s(n)]=n,commentsForEp:g}};class he{constructor(t,e){this.fields=t,this.repo=e,this.currentItem=$({}),this.originalItem=$({}),this.errors=$({})}async find(t){return await this.repo.find(t).then(e=>(this.currentItem.value=e,this.originalItem.value=e,e))}async save(t){this.clearErrors();try{const e=await this.repo.save(t);return this.clearCurrentItem(),e}catch(e){throw Y(e)&&(this.errors.value=e.response.data.errors),e}}async update(t){this.clearErrors();try{return this.currentItem.value=this.repo.update(t),this.currentItem.value}catch(e){throw Y(e)&&(this.errors.value=e.response.data.errors),e}}async destroy(t){this.repo.destroy(t)}cancel(){this.clearErrors(),this.currentItem.value.id||this.clearCurrentItem()}clearCurrentItem(){this.currentItem.value={}}clearErrors(){this.errors.value={}}}class Ce extends Q{constructor(t,e={}){super(t,e),this.cachedList=null}query(t){if(!this.cachedList){const e=super.query(t);this.cachedList=e}return this.cachedList}find(t){throw new Error("CommentTypeRepository.find not implemented")}save(t){throw new Error("CommentTypeRepository.save not implemented")}update(t){throw new Error("CommentTypeRepository.update not implemented")}destroy(t){throw new Error("CommentTypeRepository.destroy not implemented")}}const ke=new Ce("/api/comment-types"),U=$([]),xe=async()=>await ke.query().then(l=>(U.value=l.map(t=>({label:t.name,value:t.id})),U.value)),$e=$([{name:"comment_type_id",label:"Type",type:"select",options:U,required:!0},{name:"content",label:"Comment",type:"large-text",required:!0}]),X=()=>(xe(),new he($e,A)),P={__name:"ReviewCommentForm",props:{commentManager:{type:Object,required:!0},section:{type:[String,null],default:null},subjectType:{type:String,default:"App\\Modules\\Group\\Models\\Group"},subjectId:{type:Number,required:!1},comment:{type:Object},onlyInternal:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(l,{emit:t}){const e=l,o=t,_=J("group"),d=X();K(()=>{e.comment&&(d.currentItem.value=e.comment)});const g=C(()=>{const n=[...d.fields.value];if(e.onlyInternal){const R=n.findIndex(D=>D.name==="comment_type_id");n.splice(R,1)}return n}),i=C(()=>d.errors.value),s=C({get(){return d.currentItem.value},set(n){d.currentItem.value=n}}),x=()=>{d.clearCurrentItem(),d.clearErrors(),o("canceled")},a=()=>{s.value.subject_type=e.subjectType,s.value.subject_id=e.subjectId||_.value.id,s.value.metadata={section:e.section,root_subject_type:"App\\Modules\\Group\\Models\\Group",root_subject_id:_.value.id},e.onlyInternal&&(s.value.comment_type_id=1),d.save(s.value).then(n=>{e.commentManager.addComment(n),o("saved",n)})},p=()=>{e.onlyInternal&&(s.value.comment_type_id=1),d.update(s.value).then(n=>{e.commentManager.updateComment(n),o("saved",n)})},f=()=>{if(s.value.id){p();return}a()};return(n,R)=>{const D=h("data-form"),q=h("button-row");return u(),w("div",null,[r(D,{modelValue:s.value,"onUpdate:modelValue":R[0]||(R[0]=N=>s.value=N),fields:g.value,errors:i.value},null,8,["modelValue","fields","errors"]),r(q,{size:"xs","submit-text":"Save",onSubmitted:f,onCanceled:x})])}}},Re={class:"my-2"},Ie={class:"comment-container"},Se={key:0,class:"relative"},Ee={class:"flex justify-between items-start mb-1 rounded"},Me={class:"flex space-x-2 items-end"},je={class:"block"},Te={class:"flex space-x-2"},qe={class:"replies ml-1"},Ae={key:0},De={class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},Fe={__name:"ReviewComment",props:{comment:{type:Object,required:!0},commentManager:{type:Object,required:!0}},emits:["created","updated","resolved","unresolved","deleted"],setup(l,{emit:t}){const e=l,o=t,_=O(),d=X(),g=$(we("App\\Models\\Comment",e.comment.id)),i=$(!1),s=$(!1),x=I=>{if(!I.type)return"gray";switch(I.type.name){case"required revision":return"yellow";case"suggestion":return"blue";case"internal comment":return"gray"}},a=()=>{s.value=!0},p=()=>{d.destroy(e.comment).then(()=>{s.value=!1,e.commentManager.removeComment(e.comment),o("deleted",e.comment)})},f=async()=>{if(e.comment.is_resolved){const y=await A.unresolve(e.comment.id);e.commentManager.updateComment(y),o("updated"),o("resolved");return}const I=await A.resolve(e.comment.id);e.commentManager.updateComment(I),o("updated"),o("unresolved")},n=$(!1),R=()=>{g.value.getComments().then(I=>(n.value=!0,I))},D=async()=>{n.value||R(),n.value=!n.value},q=$(!1),N=()=>q.value=!0,Z=()=>{const I={...e.comment};I.comments_count+=1,e.commentManager.updateComment(I),n.value=!0,q.value=!1},ee=()=>{const I={...e.comment};I.comments_count-=1,e.commentManager.updateComment(I)};K(()=>{g.value.getComments()});const te=C(()=>de("comments-manage")||_.getters.currentUser.person.id===e.comment.creator_id);return(I,y)=>{const ne=h("badge"),oe=h("icon-checkmark"),se=h("popper"),ae=h("dropdown-menu"),re=h("markdown-block"),le=h("icon-reply"),ie=h("button-row"),ue=h("static-alert"),ce=h("ReviewComment",!0);return u(),w("div",Re,[m("div",Ie,[i.value?(u(),S(P,{key:1,comment:l.comment,"comment-manager":l.commentManager,onCanceled:y[2]||(y[2]=j=>i.value=!1),onSaved:y[3]||(y[3]=j=>i.value=!1)},null,8,["comment","comment-manager"])):(u(),w("div",Se,[m("div",Ee,[m("div",Me,[m("strong",je,v(l.comment.creator&&l.comment.creator.name),1),r(ne,{class:"block",color:x(l.comment),size:"xxs"},{default:c(()=>[b(v(l.comment.type&&I.titleCase(l.comment.type.name)),1)]),_:1},8,["color"]),l.comment.is_resolved?(u(),S(se,{key:0,hover:"",arrow:"",content:"Resolved"},{default:c(()=>[r(oe,{class:"text-green-500",title:"Resolved"})]),_:1})):k("",!0)]),m("div",Te,[te.value?(u(),S(ae,{key:0,"hide-cheveron":""},{default:c(()=>[r(L,{onClick:y[0]||(y[0]=j=>i.value=!0)},{default:c(()=>y[5]||(y[5]=[b(" Edit ")])),_:1}),r(L,{onClick:f},{default:c(()=>[b(v(l.comment.is_resolved?"Mark unresolved":"Resolve"),1)]),_:1}),r(L,{onClick:a},{default:c(()=>y[6]||(y[6]=[b(" Delete ")])),_:1})]),_:1})):k("",!0)])]),r(re,{markdown:l.comment.content,class:"text-sm"},null,8,["markdown"]),m("button",{class:"link",onClick:N},[r(le,{class:"inline-block"}),y[7]||(y[7]=b("Reply "))]),B(r(ue,{variant:"danger",class:""},{default:c(()=>[y[8]||(y[8]=b(" Continue with delete? ")),r(ie,{size:"xs","submit-text":"Yes, delete","submit-variant":"red",onSubmitted:p,onCanceled:y[1]||(y[1]=j=>s.value=!1)})]),_:1},512),[[G,s.value]])]))]),m("div",qe,[n.value?(u(),w("ul",Ae,[(u(!0),w(H,null,z(g.value.comments,j=>(u(),w("li",{key:j.id,class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},[r(ce,{comment:j,"comment-manager":g.value,onDeleted:ee},null,8,["comment","comment-manager"])]))),128))])):k("",!0),l.comment.comments_count>0?(u(),w("button",{key:1,class:"link text-sm",onClick:D},v(n.value?"Hide":"Show")+" "+v(l.comment.comments_count)+" "+v(l.comment.comments_count>1?"replies":"reply"),1)):k("",!0),B(m("div",De,[y[9]||(y[9]=m("strong",null,"Your Reply",-1)),r(P,{"subject-type":"App\\Models\\Comment","subject-id":l.comment.id,"only-internal":!0,"comment-manager":g.value,onSaved:Z,onCanceled:y[4]||(y[4]=j=>q.value=!1)},null,8,["subject-id","comment-manager"])],512),[[G,q.value]])])])}}},Be={class:"lg:flex lg:space-x-4 screen-block"},Ge={class:"flex justify-between items-start space-x-4"},Ne={key:0,class:"flex justify-between items-center lg:w-2/5 px-2 py-1 pb-0 bg-gray-100 rounded-lg"},Le={class:"lg:w-2/5 p-2 bg-gray-100 rounded-lg mb-2"},Ve={class:"flex justify-between items-center"},Ue={class:"bg-white mt-2 p-2"},E={__name:"ReviewSection",props:{title:{type:String||null,default:null},name:{type:String||null,default:null}},setup(l){const t=l,e=J("commentManager"),o=$(!1),_=$(!0),d=C(()=>e?e.value.comments.filter(i=>i.metadata?i.metadata.section===t.name:!1):[]),g=C(()=>e?d.value.find(i=>i.type.name==="required revision")?"yellow":d.value.find(i=>i.type.name==="suggestion")?"blue":"gray":null);return(i,s)=>{const x=h("icon-cheveron-right"),a=h("badge"),p=h("icon-cheveron-down");return u(),w("section",Be,[m("div",{class:W(["overflow-x-auto flex-grow",{"lg:w-3/5":_.value}])},[m("header",Ge,[m("h2",{class:W(["flex-grow",{"lg:w-3/5":!_.value}])},v(l.title),3),M(e)?B((u(),w("div",Ne,[m("h3",null,[r(x,{class:"inline cursor-pointer",onClick:s[0]||(s[0]=f=>_.value=!0)}),s[5]||(s[5]=b(" Comments ")),r(a,{color:g.value},{default:c(()=>[b(v(d.value.length),1)]),_:1},8,["color"])])],512)),[[G,!_.value]]):k("",!0)]),m("div",null,[m("div",null,[pe(i.$slots,"default")])])],2),B(m("div",Le,[m("div",Ve,[m("h3",null,[r(p,{class:"inline cursor-pointer",onClick:s[1]||(s[1]=f=>_.value=!1)}),s[6]||(s[6]=b(" Comments "))])]),m("ul",null,[(u(!0),w(H,null,z(d.value,f=>(u(),w("li",{key:f.id,class:"bg-white p-2"},[r(Fe,{comment:f,"comment-manager":M(e)},null,8,["comment","comment-manager"])]))),128))]),m("div",Ue,[o.value?(u(),S(P,{key:0,section:l.name,"comment-manager":M(e),onSaved:s[2]||(s[2]=f=>o.value=!1),onCanceled:s[3]||(s[3]=f=>o.value=!1)},null,8,["section","comment-manager"])):(u(),w("button",{key:1,class:"btn btn-xs block",onClick:s[4]||(s[4]=f=>o.value=!0)}," Add comment "))])],512),[[G,_.value&&M(e)]])])}}},Pe={__name:"ReviewMembership",props:{members:{required:!0,type:Array}},setup(l){const t=l,e={Chair:1,Coordinator:2,"Grant Liaison":3,Biocurator:4,Expert:5},o=a=>e[a.display_name]??1/0,_=$({field:"roles",desc:!1}),g=$([{name:"name",sortable:!0,label:"Name",sortFunction:(a,p)=>{let f=a.last_name.localeCompare(p.last_name);return f===0&&(f=a.first_name.localeCompare(p.first_name)),f}},{name:"legacy_credentials",sortable:!1,label:"Credentials"},{name:"roles",sortable:!0,label:"Roles",sortFunction:(a,p)=>a.role_priority-p.role_priority},{name:"legacy_expertise",sortable:!1,label:"Expertise"},{name:"institution",sortable:!1,label:"Institution"}]),i=C(()=>t.members.map(a=>{var f;const p=a.roles.toSorted((n,R)=>n.id-R.id);return{id:a.id,first_name:a.person.first_name,last_name:a.person.last_name,name:a.person.name,institution:(f=a.person.institution)==null?void 0:f.name,legacy_credentials:a.person.legacy_credentials,legacy_expertise:a.legacy_expertise,roles:p,role_priority:Math.min(...p.map(o)),active:a.isActive,person:a.person}}).filter(a=>a.active)),s=(a,p)=>{a[p]||(a[p]=0),a[p]++},x=C(()=>{const a={};return a.Total=i.value.length,console.log(i.value),Object.keys(e).forEach(p=>a[p]=0),i.value.forEach(p=>{p.roles.forEach(f=>s(a,f.display_name)),p.roles.length===0&&s(a,"None")}),a});return(a,p)=>{const f=h("data-table");return u(),w("div",null,[(u(!0),w(H,null,z(x.value,(n,R)=>(u(),w("div",{key:R},[m("span",null,v(R)+": "+v(n),1)]))),128)),r(f,{sort:_.value,"onUpdate:sort":p[0]||(p[0]=n=>_.value=n),fields:g.value,data:i.value,class:"text-xs"},{"cell-roles":c(({item:n})=>[m("span",null,v(n.roles.map(R=>R.display_name).join(", ")),1)]),"cell-legacy_credentials":c(({item:n})=>[r(fe,{person:n.person},null,8,["person"])]),"cell-legacy_expertise":c(({item:n})=>[r(_e,{person:n.person,"legacy-expertise":n.legacy_expertise},null,8,["person","legacy-expertise"])]),_:1},8,["sort","fields","data"])])}}},Oe={class:"space-y-4"},He={key:0,class:"mt-6"},ze=["innerHTML"],Ye={class:"mb-6"},We={key:0},Je=["innerHTML"],Ke={class:"flex-none"},Qe={key:0,class:"mt-1"},at={__name:"DefinitionReview",setup(l){const t=O(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel);$("published");const _=C(()=>e.value?e.value.members:[]),d=C(()=>({type:e.value.type.name?e.value.type.name.toUpperCase():"",long_base_name:o.value.long_base_name,short_base_name:o.value.short_base_name}));return(g,i)=>{const s=h("object-dictionary"),x=h("dictionary-row");return u(),w("div",Oe,[r(E,{title:"Basic Information",name:"basic-info"},{default:c(()=>[r(s,{obj:d.value,"label-class":"w-40 font-bold"},null,8,["obj"]),r(x,{label:"CDWG","label-class":"w-40 font-bold"},{default:c(()=>[b(v(e.value.parent?e.value.parent.name:"--"),1)]),_:1})]),_:1}),r(E,{title:"Membership",name:"membership"},{default:c(()=>[r(Pe,{members:_.value},null,8,["members"]),e.value.is_vcep_or_scvcep?(u(),w("div",He,[i[0]||(i[0]=m("h4",null,"Expertise of VCEP members",-1)),m("blockquote",{innerHTML:o.value.membership_description},null,8,ze)])):k("",!0)]),_:1}),r(E,{title:"Scope",name:"scope"},{default:c(()=>[i[1]||(i[1]=m("h3",null,"Genes",-1)),m("div",Ye,[e.value.is_gcep?(u(),w("p",We,v(o.value.genes.map(a=>a.gene_symbol).join(", ")),1)):k("",!0),e.value.is_gcep?(u(),S(ye,{key:1,genes:o.value.genes,readonly:!0,editing:!1},null,8,["genes"])):k("",!0),e.value.is_vcep_or_scvcep?(u(),S(be,{key:2,group:e.value,editing:!1},null,8,["group"])):k("",!0)]),i[2]||(i[2]=m("h3",null,"Description of scope",-1)),m("blockquote",{innerHTML:o.value.scope_description},null,8,Je)]),_:1}),e.value.is_gcep?(u(),S(E,{key:0,title:"Plans",name:"plans"},{default:c(()=>[r(x,{label:"Selected protocol","label-class":"w-48 font-bold"},{default:c(()=>[m("div",Ke,[b(v(o.value.curation_review_protocol?g.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(u(),w("p",Qe,[i[3]||(i[3]=m("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):k("",!0)])]),_:1})]),_:1})):k("",!0),e.value.is_gcep?(u(),S(E,{key:1,title:"Attestations",name:"attestations"},{default:c(()=>[r(x,{label:"GCEP Attestation Signed","label-class":"w-52 font-bold"},{default:c(()=>[b(v(M(F)(o.value.gcep_attestation_date)),1)]),_:1}),r(x,{label:"GCI Training Date","label-class":"w-52 font-bold"},{default:c(()=>[b(v(M(F)(o.value.gci_training_date)),1)]),_:1}),r(x,{label:"NHGRI Attestation Signed","label-class":"w-52 font-bold"},{default:c(()=>[b(v(M(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):k("",!0),e.value.is_vcep_or_scvcep?(u(),S(E,{key:2,title:"Attestations",name:"attestations"},{default:c(()=>[r(x,{label:"Reanalysis and Discrepancy Resolution Attestation Signed","label-class":"w-52 font-bold"},{default:c(()=>[b(v(M(F)(o.value.reanalysis_attestation_date)),1)]),_:1}),r(x,{label:"NHGRI Attestation Signed","label-class":"w-60 font-bold"},{default:c(()=>[b(v(M(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):k("",!0)])}}},Xe={class:"application-review p-2 bg-gray-100"},Ze={class:"w-full"},et={key:0,class:"mt-1"},rt={__name:"SustainedCurationReview",setup(l){const t=O(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel);return ve(()=>e.value,(_,d)=>{_.id&&(!d||_.id!==d.id)&&t.dispatch("groups/getEvidenceSummaries",e.value)}),(_,d)=>{const g=h("dictionary-row"),i=h("markdown-block");return u(),w("div",Xe,[o.value.has_approved_pilot?(u(),S(E,{key:0,title:"Plans for Ongoing Review and Discrepancy Resolution",name:"discrepency-review"},{default:c(()=>[r(g,{label:"Selected protocol","label-width-class":"w-48 font-bold"},{default:c(()=>[m("div",Ze,[b(v(o.value.curation_review_protocol?_.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(u(),w("p",et,[d[0]||(d[0]=m("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):k("",!0)])]),_:1}),r(g,{label:"Notes","label-width-class":"w-48 font-bold"},{default:c(()=>[r(i,{markdown:o.value.curation_review_process_notes},null,8,["markdown"])]),_:1})]),_:1})):k("",!0),o.value.has_approved_pilot?(u(),S(E,{key:1,title:"Evidence Summaries",name:"evidence-summaries"},{default:c(()=>[r(ge,{readonly:!0})]),_:1})):k("",!0),o.value.has_approved_pilot?(u(),S(E,{key:2,title:"Core Approval Member, Trained Biocurator, and Biocurator Trainer Designation",name:"member-designation"},{default:c(()=>[r(g,{label:"Core Approval Members","label-width-class":"w-48 font-bold"},{default:c(()=>[b(v(e.value.coreApprovalMembers.map(s=>s.person.name).join(", ")),1)]),_:1}),r(g,{label:"Biocurator Trainers","label-width-class":"w-48 font-bold"},{default:c(()=>[b(v(e.value.biocuratorTrainers.map(s=>s.person.name).join(", ")),1)]),_:1}),r(g,{label:"Trained Biocurators","label-width-class":"w-48 font-bold"},{default:c(()=>[b(v(e.value.trainedBiocurators.map(s=>s.person.name).join(", ")),1)]),_:1})]),_:1})):k("",!0)])}}};export{rt as _,at as a,we as c};
//# sourceMappingURL=SustainedCurationReview-7HAyK1sv.js.map
