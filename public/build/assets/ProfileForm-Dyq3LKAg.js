import{_ as E,aw as N,p as k,a2 as S,a as y,c as w,b as d,d as s,e as c,f as n,w as p,a1 as j,n as A,v as W,r as I,q as U,k as B,aq as F,x as D,o as L,h as v,i as V,g as T,ax as O,ay as $,az as R,aA as M,aB as Y,P as G}from"./app-RwQUrOg2.js";const H={name:"ProfilePhotoForm",components:{ImageCropper:N},props:{person:{type:Object,required:!0}},data(){return{showForm:!1,file:null,croppedImageBlob:null,errors:{},saving:!1}},computed:{srcPath(){return this.file?URL.createObjectURL(this.file):this.person.profile_photo?`/profile-photos/${this.person.profile_photo}`:"/images/default_profile.jpg"},profilePhoto(){return this.person.profile_photo?`/profile-photos/${this.person.profile_photo}`:"/images/default_profile.jpg"},altText(){return this.person.profile_photo_path?`${this.person.name} profile photo.`:"Default profile image"}},watch:{person:{immediate:!0,deep:!0,handler(i){i.profile_photo&&this.fetchProfileImage()}}},methods:{initUpload(){this.showForm=!0,this.$nextTick(()=>{window.dispatchEvent(new Event("resize"))})},setFile(){this.file=this.$refs.fileInput.files[0]},setCroppedImageBlob(i){this.croppedImageBlob=i},async fetchProfileImage(){const i=`/api/people/${this.person.uuid}/profile-photo`,a={Accept:"application/octet-stream",timeout:3e4,responseType:"blob"};this.file=await k.get(i,a).then(o=>{if(o.data instanceof Blob)return new Blob([o.data])})},saveCropped(){this.croppedImageBlob.size>1e6?createImageBitmap(this.croppedImageBlob).then(a=>{const o=document.createElement("canvas"),g=o.getContext("2d");o.width=400,o.height=400*a.height/a.width,g.drawImage(a,0,0,o.width,o.height),o.toBlob(u=>{u.size>1e6?this.errors.profile_photo=["The image is too large, even after resizing."]:(delete this.errors.profile_photo,this.storeImage(u))},"image/jpeg",.5)}):(delete this.errors.profile_photo,this.storeImage(this.croppedImageBlob))},storeImage(i){this.saving=!0;const a=new FormData;a.append("profile_photo",i),k.postForm(`/api/people/${this.person.uuid}/profile-photo`,a).then(async o=>{let g=o==null?void 0:o.data;this.$emit("uploaded",g),this.showForm=!1,this.file=null,this.saving=!1}).catch(o=>{if(this.saving=!1,S(o)){this.errors=o.response.data.errors;return}else if(Number.parseInt(o.response.status)===413){this.errors.profile_photo=["The image is too large."];return}throw o})},cancelCropped(){this.showForm=!1,this.file=null}}},J={class:"border border-gray-200 rounded-lg"},K=["src","alt"],Q={key:1};function X(i,a,o,g,u,l){const t=y("ImageCropper"),b=y("input-row"),_=y("button-row"),C=y("modal-dialog");return d(),w("div",{class:A({"cursor-wait":u.saving})},[s("div",J,[s("img",{src:l.srcPath,alt:l.altText,class:"rounded-t-lg w-full",onClick:a[0]||(a[0]=(...h)=>l.initUpload&&l.initUpload(...h))},null,8,K),s("button",{class:"border border-t-0 bg-gray-200 block w-full",onClick:a[1]||(a[1]=(...h)=>l.initUpload&&l.initUpload(...h))}," Edit ")]),(d(),c(j,{to:"body"},[n(C,{modelValue:u.showForm,"onUpdate:modelValue":a[3]||(a[3]=h=>u.showForm=h),title:"Upload a new profile photo"},{default:p(()=>[n(t,{"image-src":l.srcPath,onCropped:l.setCroppedImageBlob},null,8,["image-src","onCropped"]),n(b,{"hide-label":"",errors:u.errors.profile_photo},{default:p(()=>[s("input",{ref:"fileInput",type:"file",onChange:a[2]||(a[2]=(...h)=>l.setFile&&l.setFile(...h))},null,544)]),_:1},8,["errors"]),u.saving?(d(),w("div",Q," Saving... ")):(d(),c(_,{key:0,"submit-text":"Save",onSubmitted:l.saveCropped,onCanceled:l.cancelCropped},null,8,["onSubmitted","onCanceled"]))]),_:1},8,["modelValue"])]))],2)}const Z=E(H,[["render",X]]),ee={key:0},te={key:1,class:"float-right"},oe={key:7,class:"mb-2"},re={__name:"ProfileForm",props:{person:{type:Object,required:!0},showTitle:{type:Boolean,default:!0},allowCancel:{type:Boolean,default:!0},saveButtonText:{type:String,default:"Save"}},emits:["saved","canceled"],setup(i,{emit:a}){const o=i,g=a,u=W(),l=I({}),t=I({}),b=I(!1),_=()=>{o.person.clone?t.value={...o.person.attributes}:t.value={...o.person},t.value.credential_ids=o.person.credentials?o.person.credentials.map(f=>f.id):null},C=async()=>{try{t.value.credentials&&(t.value.credential_ids=t.value.credentials.map(e=>e.id)),t.value.expertises&&(t.value.expertise_ids=t.value.expertises.map(e=>e.id)),b.value=!0;const f=await u.dispatch("people/updateProfile",{uuid:o.person.uuid,attributes:t.value}).then(e=>(u.dispatch("getCurrentUser",{force:!0}),u.commit("pushSuccess","Your profile has been updated."),e.data));b.value=!1,l.value={},g("saved",new G(f))}catch(f){S(f)&&(l.value=f.response.data.errors),b.value=!1}},h=()=>{_(),l.value={},g("canceled")},x=U(()=>B("people-manage")||F(o.person));D(()=>o.person,()=>{_()},{immediate:!0});const q=U(()=>u.getters["countries/items"].map(f=>({value:f.id,label:f.name})));return L(()=>{u.dispatch("countries/getItems")}),(f,e)=>{const m=y("input-row"),P=y("popover"),z=y("button-row");return d(),w("div",null,[i.showTitle?(d(),w("h3",ee," Profile ")):v("",!0),e[21]||(e[21]=s("p",{class:"text-xs text-gray-500 mb-4"},[s("span",{class:"text-red-500"},"*"),V(" indicates required field. ")],-1)),T(B)("people-manage")||T(F)(i.person)?(d(),w("div",te,[n(Z,{person:i.person,onUploaded:e[0]||(e[0]=r=>i.person={...r}),style:{width:"100px",height:"100px"}},null,8,["person"])])):v("",!0),n(m,{modelValue:t.value.first_name,"onUpdate:modelValue":e[1]||(e[1]=r=>t.value.first_name=r),label:"First Name",required:"",errors:l.value.first_name},null,8,["modelValue","errors"]),n(m,{modelValue:t.value.last_name,"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.last_name=r),label:"Last Name",required:"",errors:l.value.last_name},null,8,["modelValue","errors"]),n(m,{modelValue:t.value.email,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.email=r),label:"Email",required:"",errors:l.value.email},null,8,["modelValue","errors"]),n(m,{label:"Institution",required:"",errors:l.value.institution_id},{default:p(()=>[n(O,{modelValue:t.value.institution_id,"onUpdate:modelValue":e[4]||(e[4]=r=>t.value.institution_id=r)},null,8,["modelValue"])]),_:1},8,["errors"]),n(m,{errors:l.value.credential_ids},{label:p(()=>[e[15]||(e[15]=V(" Credentials ")),e[16]||(e[16]=s("span",{class:"text-red-500"},"*",-1)),s("div",null,[n(P,{hover:"",arrow:""},{content:p(()=>e[13]||(e[13]=[s("div",{style:{"max-width":"500px"}},[s("h4",null,"What do you mean by credentials?"),s("p",null," Credentials are any degrees or professional certifications you have earned. Typically, these will be the acronyms you list after your name on your CV. "),s("p",null," We recommend choosing one or more options already in the list of credentials, but if you do not see yours feel free to add it. "),s("p",null," Please do not include current job titles or specific. If you would like to add that information to your profile please do so in the biography field below. ")],-1)])),default:p(()=>[e[14]||(e[14]=s("div",{class:"text-xs cursor-pointer text-blue-600"}," What is this? ",-1))]),_:1})])]),default:p(()=>[n($,{modelValue:t.value.credentials,"onUpdate:modelValue":e[5]||(e[5]=r=>t.value.credentials=r)},null,8,["modelValue"])]),_:1},8,["errors"]),n(m,{errors:l.value.expertise_ids},{label:p(()=>[e[19]||(e[19]=V(" Area of Expertise ")),e[20]||(e[20]=s("span",{class:"text-red-500"},"*",-1)),s("div",null,[n(P,{hover:"",arrow:""},{content:p(()=>e[17]||(e[17]=[s("div",{style:{"max-width":"500px"}},[s("h4",null,[V("What do you mean by "),s("em",null,"Area of Expertise"),V("?")]),s("p",null," We use this information to determine if the make up of gene and variant expert panels includes the breadth of expertise needed to do it's work. "),s("p",null," Please choose the option from list that best describes your area of expertise. If you don't feel any of these options fit, select 'None'. ")],-1)])),default:p(()=>[e[18]||(e[18]=s("div",{class:"text-xs cursor-pointer text-blue-600"}," What is this? ",-1))]),_:1})])]),default:p(()=>[n(R,{modelValue:t.value.expertises,"onUpdate:modelValue":e[6]||(e[6]=r=>t.value.expertises=r)},null,8,["modelValue"])]),_:1},8,["errors"]),x.value?(d(),c(m,{key:2,modelValue:t.value.biography,"onUpdate:modelValue":e[7]||(e[7]=r=>t.value.biography=r),label:"Biography",errors:l.value.biography,type:"large-text"},null,8,["modelValue","errors"])):v("",!0),x.value?(d(),c(m,{key:3,label:"Address"},{default:p(()=>[n(M,{modelValue:t.value,"onUpdate:modelValue":e[8]||(e[8]=r=>t.value=r),errors:l.value},null,8,["modelValue","errors"])]),_:1})):v("",!0),x.value?(d(),c(m,{key:4,modelValue:t.value.country_id,"onUpdate:modelValue":e[9]||(e[9]=r=>t.value.country_id=r),label:"Country",required:"",type:"select",options:q.value,errors:l.value.country_id},null,8,["modelValue","options","errors"])):v("",!0),x.value?(d(),c(m,{key:5,modelValue:t.value.phone,"onUpdate:modelValue":e[10]||(e[10]=r=>t.value.phone=r),label:"Phone",errors:l.value.phone},null,8,["modelValue","errors"])):v("",!0),x.value?(d(),c(m,{key:6,label:"Timezone",required:"",errors:l.value.timezone},{default:p(()=>[n(Y,{modelValue:t.value.timezone,"onUpdate:modelValue":e[11]||(e[11]=r=>t.value.timezone=r)},null,8,["modelValue"])]),_:1},8,["errors"])):v("",!0),e[22]||(e[22]=s("hr",{class:"my-4"},null,-1)),b.value?(d(),w("div",oe," Saving... ")):v("",!0),b.value?v("",!0):(d(),c(z,{key:8,"submit-text":i.saveButtonText,"show-cancel":i.allowCancel,onSubmitted:C,onCanceled:e[12]||(e[12]=r=>h())},null,8,["submit-text","show-cancel"]))])}}};export{Z as P,re as _};
//# sourceMappingURL=ProfileForm-Dyq3LKAg.js.map
