import{aL as v,aM as w,H as F,aw as k,aN as I,aO as D,r as N,p as P,L as G,_ as A,G as x,A as V,c as m,e as f,f as l,h as C,a as y,w as d,i as g,j as c,T as E,b as p}from"./app-Dodz6L5-.js";import{i as O,b as B}from"./_baseOrderBy-Cp_BrSnl.js";function M(t,e,a){switch(a.length){case 0:return t.call(e);case 1:return t.call(e,a[0]);case 2:return t.call(e,a[0],a[1]);case 3:return t.call(e,a[0],a[1],a[2])}return t.apply(e,a)}var L=800,j=16,H=Date.now;function R(t){var e=0,a=0;return function(){var s=H(),o=j-(s-a);if(a=s,o>0){if(++e>=L)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function q(t){return function(){return t}}var z=v?function(t,e){return v(t,"toString",{configurable:!0,enumerable:!1,value:q(e),writable:!0})}:O,J=R(z),U=Math.max;function K(t,e,a){return e=U(e===void 0?t.length-1:e,0),function(){for(var s=arguments,o=-1,r=U(s.length-e,0),n=Array(r);++o<r;)n[o]=s[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=s[o];return u[e]=a(n),M(t,this,u)}}function Q(t,e){return J(K(t,e,O),t+"")}var S=w?w.isConcatSpreadable:void 0;function W(t){return F(t)||k(t)||!!(S&&t&&t[S])}function X(t,e,a,s,o){var r=-1,n=t.length;for(a||(a=W),o||(o=[]);++r<n;){var u=t[r];a(u)?I(o,u):o[o.length]=u}return o}var Y=Q(function(t,e){if(t==null)return[];var a=e.length;return a>1&&D(t,e[0],e[1])?e=[]:a>2&&D(e[0],e[1],e[2])&&(e=[e[0]]),B(t,X(e),[])});const h=N({}),T=N(!1),Z=()=>{T.value=!1,h.value={}},$=async({method:t,url:e,data:a})=>{try{return await P({method:t,url:e,data:a}).then(s=>s.data.data)}catch(s){G(s)&&(h.value={...h,...s.response.data.errors})}},ee=()=>{h.value={}},te=()=>({errors:h,editing:T,hideForm:Z,submitFormData:$,resetErrors:ee}),re={name:"GroupForm",emits:["canceled","saved","update"],setup(t,e){const{errors:a,submitFormData:s,resetErrors:o}=te();return{errors:a,submitFormData:s,resetErrors:o}},data(){return{groupTypes:V.groups.types,groupStatuses:V.groups.statuses,newGroup:new x,parents:[]}},computed:{group:{get(){const t=this.$store.getters["groups/currentItem"];return t||this.newGroup},set(t){try{this.$store.commit("groups/addItem",t)}catch(e){console.log(`Error setting group: ${e}`),this.newGroup=t}}},statusOptions(){return Object.values(this.groupStatuses).map(t=>({value:t.id,label:this.titleCase(t.name)}))},typeOptions(){return Object.values(this.groupTypes).map(t=>({value:t.id,label:t.display_name}))},canSetType(){return this.hasPermission("groups-manage")&&!this.group.id},affiliationIdPlaceholder(){return 5e4},cdwgs(){return this.$store.getters["cdwgs/all"]},namesDirty(){return this.group.expert_panel.isDirty("long_base_name")||this.group.expert_panel.isDirty("short_base_name")},affiliationIdDirty(){return this.group.expert_panel.isDirty("affiliation_id")},parentOptions(){const t=[{value:0,label:"None"}];return this.parents.filter(e=>e.type.can_be_parent).forEach(e=>{t.push({value:e.id,label:e.displayName})}),Y(t,"label")}},beforeMount(){this.getParentOptions(),this.$store.dispatch("cdwgs/getAll")},methods:{async save(){this.resetErrors();try{if(this.group.id){await this.updateGroup(),this.$emit("saved");return}const t=await this.createGroup().then(e=>e.data.data);this.$emit("saved"),this.$store.commit("pushSuccess","Group created."),this.$router.push({name:"AddMember",params:{uuid:t.uuid}})}catch(t){throw G(t)&&(this.errors=t.response.data.errors),t}},createGroup(){let{name:t,parent_id:e,group_type_id:a,group_status_id:s}=this.group.attributes;const{short_base_name:o}=this.group.expert_panel;return t===null&&this.group.expert_panel&&(t=this.group.expert_panel.long_base_name),this.$store.dispatch("groups/create",{name:t,parent_id:e,group_type_id:a,group_status_id:s,short_base_name:o})},updateGroup(){const t=[];return t.push(this.saveGroupData()),this.group.expert_panel&&t.push(this.saveEpData()),Promise.all(t)},saveGroupData(){const t=[];return this.group.isDirty("parent_id")&&t.push(this.saveParent()),this.group.isDirty("name")&&t.push(this.saveName()),this.group.isDirty("group_status_id")&&t.push(this.saveStatus()),Promise.all(t)},async saveEpData(){const t=[];if(this.namesDirty){const{long_base_name:e,short_base_name:a}=this.group.expert_panel;t.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/name`,data:{long_base_name:e,short_base_name:a}}))}return this.affiliationIdDirty&&t.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/affiliation-id`,data:{affiliation_id:this.group.expert_panel.affiliation_id}})),await Promise.all(t)},isDirty(t){return console.log("Not sure isDirty is supposed to be called here..."),this.group.isDirty(t)},saveParent(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/parent`,data:{parent_id:this.group.parent_id}})},saveName(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/name`,data:{name:this.group.name}})},saveStatus(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/status`,data:{status_id:this.group.group_status_id}})},resetData(){this.group.uuid&&this.$store.dispatch("groups/find",this.group.uuid)},cancel(){this.group.uuid&&this.resetData(),this.$emit("canceled")},async getParentOptions(){const t={"where[group_type_id]":[1,2],without:["coordinators","expertPanel"]};this.parents=await P.get("/api/groups",{params:t}).then(e=>e.data.filter(a=>a.id!==this.group.id).map(a=>new x(a)))},emitUpdate(){this.$emit("update")}}},ae={key:0},se={key:0},oe={key:0},ie={key:1,class:"text-gray-400"},ne={key:1},ue={key:2};function le(t,e,a,s,o,r){const n=y("input-row"),u=y("dictionary-row"),_=y("note");return p(),m("div",null,[r.canSetType?(p(),f(n,{key:0,modelValue:r.group.group_type_id,"onUpdate:modelValue":e[0]||(e[0]=i=>r.group.group_type_id=i),errors:s.errors.group_type_id,type:"select",options:r.typeOptions,label:"Type"},null,8,["modelValue","errors","options"])):(p(),f(u,{key:1,label:"Type"},{default:d(()=>{var i,b;return[g(c((b=(i=r.group)==null?void 0:i.type)==null?void 0:b.display_name),1)]}),_:1})),l(E,{name:"slide-fade-down",mode:"out-in"},{default:d(()=>[r.group.group_type_id>2&&r.group.expert_panel?(p(),m("div",ae,[l(n,{modelValue:r.group.expert_panel.long_base_name,"onUpdate:modelValue":[e[1]||(e[1]=i=>r.group.expert_panel.long_base_name=i),r.emitUpdate],label:"Long Base Name",placeholder:"Long base name",errors:s.errors.long_base_name,"input-class":"w-full"},null,8,["modelValue","errors","onUpdate:modelValue"]),l(n,{modelValue:r.group.expert_panel.short_base_name,"onUpdate:modelValue":[e[2]||(e[2]=i=>r.group.expert_panel.short_base_name=i),r.emitUpdate],label:"Short Base Name",placeholder:"Short base name",errors:s.errors.short_base_name,"input-class":"w-full"},null,8,["modelValue","errors","onUpdate:modelValue"]),t.hasAnyPermission(["groups-manage"])?(p(),m("div",se,[l(n,{modelValue:r.group.expert_panel.affiliation_id,"onUpdate:modelValue":[e[3]||(e[3]=i=>r.group.expert_panel.affiliation_id=i),r.emitUpdate],label:"Affiliation ID",placeholder:r.affiliationIdPlaceholder,errors:s.errors.affiliation_id,"input-class":"w-full"},{label:d(()=>[e[8]||(e[8]=g(" Affiliation ID ")),l(_,null,{default:d(()=>e[7]||(e[7]=[g("admin-only")])),_:1})]),_:1},8,["modelValue","placeholder","errors","onUpdate:modelValue"])])):(p(),f(u,{key:1,label:"Affiliation ID"},{default:d(()=>[r.group.expert_panel.affiliation_id?(p(),m("span",oe,c(r.group.expert_panel.affiliation_id),1)):(p(),m("span",ie,c("Not yet assigend")))]),_:1}))])):(p(),m("div",ne,[l(n,{modelValue:r.group.name,"onUpdate:modelValue":[e[4]||(e[4]=i=>r.group.name=i),r.emitUpdate],placeholder:"Name",label:"Name","input-class":"w-full",errors:s.errors.name},null,8,["modelValue","errors","onUpdate:modelValue"])]))]),_:1}),t.hasPermission("groups-manage")?(p(),m("div",ue,[l(n,{modelValue:r.group.group_status_id,"onUpdate:modelValue":[e[5]||(e[5]=i=>r.group.group_status_id=i),r.emitUpdate],type:"select",options:r.statusOptions,errors:s.errors.group_status_id},{label:d(()=>[e[10]||(e[10]=g(" Status: ")),l(_,null,{default:d(()=>e[9]||(e[9]=[g("admin-only")])),_:1})]),_:1},8,["modelValue","options","errors","onUpdate:modelValue"]),l(n,{modelValue:r.group.parent_id,"onUpdate:modelValue":[e[6]||(e[6]=i=>r.group.parent_id=i),r.emitUpdate],type:"select",options:r.parentOptions,errors:s.errors.parent_id},{label:d(()=>[e[12]||(e[12]=g(" Parent group: ")),l(_,null,{default:d(()=>e[11]||(e[11]=[g("admin-only")])),_:1})]),_:1},8,["modelValue","options","errors","onUpdate:modelValue"])])):C("",!0)])}const me=A(re,[["render",le]]);export{me as G,h as e,te as f};
//# sourceMappingURL=GroupForm-FlF0d3B3.js.map
