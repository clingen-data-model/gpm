import{s as me,p as T,r as $,q as C,a2 as W,ag as J,o as K,a as h,c as w,b as m,f as a,v as P,k as de,d as c,e as S,C as G,h as k,j as v,w as u,i as b,aG as N,a8 as B,F as O,m as z,n as Y,g as E,$ as pe,an as F,x as ve}from"./app-_e7sJ9nw.js";import{_ as _e,a as fe}from"./ExpertisesView-Dw7fvyLr.js";import{G as ye,V as be}from"./SpecificationsSection-BzUZwJ9M.js";import{E as ge}from"./EvidenceSummaryList-Dd5Vfx9T.js";class Q{constructor(t,e={}){this.baseUrl=t,this.options=e}query(t){const e=me(t);return T.get(this.baseUrl+e).then(o=>this.transformToEntity(o.data))}find(t){return T.get(`${this.baseUrl}/${t}`).then(e=>this.transformToEntity(e.data))}save(t){return T.post(this.baseUrl,t).then(e=>this.transformToEntity(e.data))}update(t){return T.put(`${this.baseUrl}/${t.id}`,t).then(e=>this.transformToEntity(e.data))}destroy(t){return T.delete(`${this.baseUrl}/${t.id}`)}transformToEntity(t){return this.options.entityClass&&Array.isArray(t)?t.map(e=>new this.options.entityClass(e)):t}}const D=new Q("/api/comments");D.resolve=l=>T.post(`/api/comments/${l}/resolved`).then(t=>t.data);D.unresolve=l=>T.post(`/api/comments/${l}/unresolved`).then(t=>t.data);const V={internal:1,suggestion:2,requirement:3},we=(l,t)=>{const e=$([]),o=C(()=>e.value.filter(n=>!n.is_resolved)),_=C(()=>o.value.filter(n=>n.comment_type_id===V.requirement)),d=C(()=>o.value.filter(n=>n.comment_type_id===V.suggestion)),g=C(()=>[..._.value,...d.value]),i=C(()=>o.value.filter(n=>n.comment_type_id===V.internal)),s=n=>e.value.findIndex(R=>R.id===n.id);return{subject:{type:l,id:t},comments:e,openComments:o,openRequirements:_,openSuggestions:d,openInternal:i,getComments:async()=>{e.value=await D.query({where:{subject_type:l,subject_id:t}})},addComment:n=>e.value.push(n),removeComment:n=>e.value.splice(s(n),1),updateComment:n=>e.value[s(n)]=n,commentsForEp:g}};class he{constructor(t,e){this.fields=t,this.repo=e,this.currentItem=$({}),this.originalItem=$({}),this.errors=$({})}async find(t){return await this.repo.find(t).then(e=>(this.currentItem.value=e,this.originalItem.value=e,e))}async save(t){this.clearErrors();try{const e=await this.repo.save(t);return this.clearCurrentItem(),e}catch(e){throw W(e)&&(this.errors.value=e.response.data.errors),e}}async update(t){this.clearErrors();try{return this.currentItem.value=this.repo.update(t),this.currentItem.value}catch(e){throw W(e)&&(this.errors.value=e.response.data.errors),e}}async destroy(t){this.repo.destroy(t)}cancel(){this.clearErrors(),this.currentItem.value.id||this.clearCurrentItem()}clearCurrentItem(){this.currentItem.value={}}clearErrors(){this.errors.value={}}}class Ce extends Q{constructor(t,e={}){super(t,e),this.cachedList=null}query(t){if(!this.cachedList){const e=super.query(t);this.cachedList=e}return this.cachedList}find(t){throw new Error("CommentTypeRepository.find not implemented")}save(t){throw new Error("CommentTypeRepository.save not implemented")}update(t){throw new Error("CommentTypeRepository.update not implemented")}destroy(t){throw new Error("CommentTypeRepository.destroy not implemented")}}const ke=new Ce("/api/comment-types"),U=$([]),xe=async()=>await ke.query().then(l=>(U.value=l.map(t=>({label:t.name,value:t.id})),U.value)),$e=$([{name:"comment_type_id",label:"Type",type:"select",options:U,required:!0},{name:"content",label:"Comment",type:"large-text",required:!0}]),X=()=>(xe(),new he($e,D)),H={__name:"ReviewCommentForm",props:{commentManager:{type:Object,required:!0},section:{type:[String,null],default:null},subjectType:{type:String,default:"App\\Modules\\Group\\Models\\Group"},subjectId:{type:Number,required:!1},comment:{type:Object},onlyInternal:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(l,{emit:t}){const e=l,o=t,_=J("group"),d=X();K(()=>{e.comment&&(d.currentItem.value=e.comment)});const g=C(()=>{const n=[...d.fields.value];if(e.onlyInternal){const R=n.findIndex(A=>A.name==="comment_type_id");n.splice(R,1)}return n}),i=C(()=>d.errors.value),s=C({get(){return d.currentItem.value},set(n){d.currentItem.value=n}}),x=()=>{d.clearCurrentItem(),d.clearErrors(),o("canceled")},r=()=>{s.value.subject_type=e.subjectType,s.value.subject_id=e.subjectId||_.value.id,s.value.metadata={section:e.section,root_subject_type:"App\\Modules\\Group\\Models\\Group",root_subject_id:_.value.id},e.onlyInternal&&(s.value.comment_type_id=1),d.save(s.value).then(n=>{e.commentManager.addComment(n),o("saved",n)})},p=()=>{e.onlyInternal&&(s.value.comment_type_id=1),d.update(s.value).then(n=>{e.commentManager.updateComment(n),o("saved",n)})},f=()=>{if(s.value.id){p();return}r()};return(n,R)=>{const A=h("data-form"),q=h("button-row");return m(),w("div",null,[a(A,{modelValue:s.value,"onUpdate:modelValue":R[0]||(R[0]=L=>s.value=L),fields:g.value,errors:i.value},null,8,["modelValue","fields","errors"]),a(q,{size:"xs","submit-text":"Save",onSubmitted:f,onCanceled:x})])}}},Re={class:"my-2"},Ie={class:"comment-container"},Se={key:0,class:"relative"},Me={class:"flex justify-between items-start mb-1 rounded"},Ee={class:"flex space-x-2 items-end"},je={class:"block"},Te={class:"flex space-x-2"},qe={class:"replies ml-1"},De={key:0},Ae={class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},Fe={__name:"ReviewComment",props:{comment:{type:Object,required:!0},commentManager:{type:Object,required:!0}},emits:["created","updated","resolved","unresolved","deleted"],setup(l,{emit:t}){const e=l,o=t,_=P(),d=X(),g=$(we("App\\Models\\Comment",e.comment.id)),i=$(!1),s=$(!1),x=I=>{if(!I.type)return"gray";switch(I.type.name){case"required revision":return"yellow";case"suggestion":return"blue";case"internal comment":return"gray"}},r=()=>{s.value=!0},p=()=>{d.destroy(e.comment).then(()=>{s.value=!1,e.commentManager.removeComment(e.comment),o("deleted",e.comment)})},f=async()=>{if(e.comment.is_resolved){const y=await D.unresolve(e.comment.id);e.commentManager.updateComment(y),o("updated"),o("resolved");return}const I=await D.resolve(e.comment.id);e.commentManager.updateComment(I),o("updated"),o("unresolved")},n=$(!1),R=()=>{g.value.getComments().then(I=>(n.value=!0,I))},A=async()=>{n.value||R(),n.value=!n.value},q=$(!1),L=()=>q.value=!0,Z=()=>{const I={...e.comment};I.comments_count+=1,e.commentManager.updateComment(I),n.value=!0,q.value=!1},ee=()=>{const I={...e.comment};I.comments_count-=1,e.commentManager.updateComment(I)};K(()=>{g.value.getComments()});const te=C(()=>de("comments-manage")||_.getters.currentUser.person.id===e.comment.creator_id);return(I,y)=>{const ne=h("badge"),oe=h("icon-checkmark"),se=h("popper"),ae=h("dropdown-menu"),re=h("markdown-block"),le=h("icon-reply"),ie=h("button-row"),ue=h("static-alert"),ce=h("ReviewComment",!0);return m(),w("div",Re,[c("div",Ie,[i.value?(m(),S(H,{key:1,comment:l.comment,"comment-manager":l.commentManager,onCanceled:y[2]||(y[2]=j=>i.value=!1),onSaved:y[3]||(y[3]=j=>i.value=!1)},null,8,["comment","comment-manager"])):(m(),w("div",Se,[c("div",Me,[c("div",Ee,[c("strong",je,v(l.comment.creator&&l.comment.creator.name),1),a(ne,{class:"block",color:x(l.comment),size:"xxs"},{default:u(()=>[b(v(l.comment.type&&I.titleCase(l.comment.type.name)),1)]),_:1},8,["color"]),l.comment.is_resolved?(m(),S(se,{key:0,hover:"",arrow:"",content:"Resolved"},{default:u(()=>[a(oe,{class:"text-green-500",title:"Resolved"})]),_:1})):k("",!0)]),c("div",Te,[te.value?(m(),S(ae,{key:0,"hide-cheveron":""},{default:u(()=>[a(N,{onClick:y[0]||(y[0]=j=>i.value=!0)},{default:u(()=>y[5]||(y[5]=[b(" Edit ")])),_:1}),a(N,{onClick:f},{default:u(()=>[b(v(l.comment.is_resolved?"Mark unresolved":"Resolve"),1)]),_:1}),a(N,{onClick:r},{default:u(()=>y[6]||(y[6]=[b(" Delete ")])),_:1})]),_:1})):k("",!0)])]),a(re,{markdown:l.comment.content,class:"text-sm"},null,8,["markdown"]),c("button",{class:"link",onClick:L},[a(le,{class:"inline-block"}),y[7]||(y[7]=b("Reply "))]),G(a(ue,{variant:"danger",class:""},{default:u(()=>[y[8]||(y[8]=b(" Continue with delete? ")),a(ie,{size:"xs","submit-text":"Yes, delete","submit-variant":"red",onSubmitted:p,onCanceled:y[1]||(y[1]=j=>s.value=!1)})]),_:1},512),[[B,s.value]])]))]),c("div",qe,[n.value?(m(),w("ul",De,[(m(!0),w(O,null,z(g.value.comments,j=>(m(),w("li",{key:j.id,class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},[a(ce,{comment:j,"comment-manager":g.value,onDeleted:ee},null,8,["comment","comment-manager"])]))),128))])):k("",!0),l.comment.comments_count>0?(m(),w("button",{key:1,class:"link text-sm",onClick:A},v(n.value?"Hide":"Show")+" "+v(l.comment.comments_count)+" "+v(l.comment.comments_count>1?"replies":"reply"),1)):k("",!0),G(c("div",Ae,[y[9]||(y[9]=c("strong",null,"Your Reply",-1)),a(H,{"subject-type":"App\\Models\\Comment","subject-id":l.comment.id,"only-internal":!0,"comment-manager":g.value,onSaved:Z,onCanceled:y[4]||(y[4]=j=>q.value=!1)},null,8,["subject-id","comment-manager"])],512),[[B,q.value]])])])}}},Ge={class:"lg:flex lg:space-x-4 screen-block"},Be={class:"flex justify-between items-start space-x-4"},Le={key:0,class:"flex justify-between items-center lg:w-2/5 px-2 py-1 pb-0 bg-gray-100 rounded-lg"},Ne={class:"lg:w-2/5 p-2 bg-gray-100 rounded-lg mb-2"},Ve={class:"flex justify-between items-center"},Ue={class:"bg-white mt-2 p-2"},M={__name:"ReviewSection",props:{title:{type:String||null,default:null},name:{type:String||null,default:null}},setup(l){const t=l,e=J("commentManager"),o=$(!1),_=$(!0),d=C(()=>e?e.value.comments.filter(i=>i.metadata?i.metadata.section===t.name:!1):[]),g=C(()=>e?d.value.find(i=>i.type.name==="required revision")?"yellow":d.value.find(i=>i.type.name==="suggestion")?"blue":"gray":null);return(i,s)=>{const x=h("icon-cheveron-right"),r=h("badge"),p=h("icon-cheveron-down");return m(),w("section",Ge,[c("div",{class:Y(["overflow-x-auto flex-grow",{"lg:w-3/5":_.value}])},[c("header",Be,[c("h2",{class:Y(["flex-grow",{"lg:w-3/5":!_.value}])},v(l.title),3),E(e)?G((m(),w("div",Le,[c("h3",null,[a(x,{class:"inline cursor-pointer",onClick:s[0]||(s[0]=f=>_.value=!0)}),s[5]||(s[5]=b(" Comments ")),a(r,{color:g.value},{default:u(()=>[b(v(d.value.length),1)]),_:1},8,["color"])])],512)),[[B,!_.value]]):k("",!0)]),c("div",null,[c("div",null,[pe(i.$slots,"default")])])],2),G(c("div",Ne,[c("div",Ve,[c("h3",null,[a(p,{class:"inline cursor-pointer",onClick:s[1]||(s[1]=f=>_.value=!1)}),s[6]||(s[6]=b(" Comments "))])]),c("ul",null,[(m(!0),w(O,null,z(d.value,f=>(m(),w("li",{key:f.id,class:"bg-white p-2"},[a(Fe,{comment:f,"comment-manager":E(e)},null,8,["comment","comment-manager"])]))),128))]),c("div",Ue,[o.value?(m(),S(H,{key:0,section:l.name,"comment-manager":E(e),onSaved:s[2]||(s[2]=f=>o.value=!1),onCanceled:s[3]||(s[3]=f=>o.value=!1)},null,8,["section","comment-manager"])):(m(),w("button",{key:1,class:"btn btn-xs block",onClick:s[4]||(s[4]=f=>o.value=!0)}," Add comment "))])],512),[[B,_.value&&E(e)]])])}}},He={__name:"ReviewMembership",props:{members:{required:!0,type:Array}},setup(l){const t=l,e={Chair:1,Coordinator:2,"Grant Liaison":3,Biocurator:4,Expert:5},o=r=>e[r.display_name]??1/0,_=$({field:"roles",desc:!1}),g=$([{name:"name",sortable:!0,label:"Name",sortFunction:(r,p)=>{let f=r.last_name.localeCompare(p.last_name);return f===0&&(f=r.first_name.localeCompare(p.first_name)),f}},{name:"legacy_credentials",sortable:!1,label:"Credentials"},{name:"roles",sortable:!0,label:"Roles",sortFunction:(r,p)=>r.role_priority-p.role_priority},{name:"legacy_expertise",sortable:!1,label:"Expertise"},{name:"institution",sortable:!1,label:"Institution"}]),i=C(()=>t.members.map(r=>{var f;const p=r.roles.toSorted((n,R)=>n.id-R.id);return{id:r.id,first_name:r.person.first_name,last_name:r.person.last_name,name:r.person.name,institution:(f=r.person.institution)==null?void 0:f.name,legacy_credentials:r.person.legacy_credentials,legacy_expertise:r.legacy_expertise,roles:p,role_priority:Math.min(...p.map(o)),active:r.isActive,person:r.person}}).filter(r=>r.active)),s=(r,p)=>{r[p]||(r[p]=0),r[p]++},x=C(()=>{const r={};return r.Total=i.value.length,console.log(i.value),Object.keys(e).forEach(p=>r[p]=0),i.value.forEach(p=>{p.roles.forEach(f=>s(r,f.display_name)),p.roles.length===0&&s(r,"None")}),r});return(r,p)=>{const f=h("data-table");return m(),w("div",null,[(m(!0),w(O,null,z(x.value,(n,R)=>(m(),w("div",{key:R},[c("span",null,v(R)+": "+v(n),1)]))),128)),a(f,{sort:_.value,"onUpdate:sort":p[0]||(p[0]=n=>_.value=n),fields:g.value,data:i.value,class:"text-xs"},{"cell-roles":u(({item:n})=>[c("span",null,v(n.roles.map(R=>R.display_name).join(", ")),1)]),"cell-legacy_credentials":u(({item:n})=>[a(fe,{person:n.person},null,8,["person"])]),"cell-legacy_expertise":u(({item:n})=>[a(_e,{person:n.person,"legacy-expertise":n.legacy_expertise},null,8,["person","legacy-expertise"])]),_:1},8,["sort","fields","data"])])}}},Pe={class:"space-y-4"},Oe={key:0,class:"mt-6"},ze=["innerHTML"],We=["innerHTML"],Ye={class:"mb-6"},Je={key:0},Ke=["innerHTML"],Qe={class:"flex-none"},Xe={key:0,class:"mt-1"},rt={__name:"DefinitionReview",setup(l){const t=P(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel);$("published");const _=C(()=>e.value?e.value.members:[]),d=C(()=>({type:e.value.type.name?e.value.type.name.toUpperCase():"",long_base_name:o.value.long_base_name,short_base_name:o.value.short_base_name}));return(g,i)=>{const s=h("object-dictionary"),x=h("dictionary-row");return m(),w("div",Pe,[a(M,{title:"Basic Information",name:"basic-info"},{default:u(()=>[a(s,{obj:d.value,"label-class":"w-40 font-bold"},null,8,["obj"]),a(x,{label:"CDWG","label-class":"w-40 font-bold"},{default:u(()=>[b(v(e.value.parent?e.value.parent.name:"--"),1)]),_:1})]),_:1}),a(M,{title:"Membership",name:"membership"},{default:u(()=>[a(He,{members:_.value},null,8,["members"]),e.value.is_vcep_or_scvcep?(m(),w("div",Oe,[i[0]||(i[0]=c("h4",null,"Expertise of VCEP members",-1)),c("blockquote",{innerHTML:o.value.membership_description},null,8,ze)])):k("",!0)]),_:1}),a(M,{title:"Website Description",name:"website-description"},{default:u(()=>[c("blockquote",{innerHTML:e.value.description},null,8,We)]),_:1}),a(M,{title:"Scope",name:"scope"},{default:u(()=>[i[1]||(i[1]=c("h3",null,"Genes",-1)),c("div",Ye,[e.value.is_gcep?(m(),w("p",Je,v(o.value.genes.map(r=>r.gene_symbol).join(", ")),1)):k("",!0),e.value.is_gcep?(m(),S(ye,{key:1,genes:o.value.genes,readonly:!0,editing:!1},null,8,["genes"])):k("",!0),e.value.is_vcep_or_scvcep?(m(),S(be,{key:2,group:e.value,editing:!1},null,8,["group"])):k("",!0)]),i[2]||(i[2]=c("h3",null,"Description of scope",-1)),c("blockquote",{innerHTML:o.value.scope_description},null,8,Ke)]),_:1}),e.value.is_gcep?(m(),S(M,{key:0,title:"Plans",name:"plans"},{default:u(()=>[a(x,{label:"Selected protocol","label-class":"w-48 font-bold"},{default:u(()=>[c("div",Qe,[b(v(o.value.curation_review_protocol?g.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(m(),w("p",Xe,[i[3]||(i[3]=c("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):k("",!0)])]),_:1})]),_:1})):k("",!0),e.value.is_gcep?(m(),S(M,{key:1,title:"Attestations",name:"attestations"},{default:u(()=>[a(x,{label:"GCEP Attestation Signed","label-class":"w-52 font-bold"},{default:u(()=>[b(v(E(F)(o.value.gcep_attestation_date)),1)]),_:1}),a(x,{label:"GCI Training Date","label-class":"w-52 font-bold"},{default:u(()=>[b(v(E(F)(o.value.gci_training_date)),1)]),_:1}),a(x,{label:"NHGRI Attestation Signed","label-class":"w-52 font-bold"},{default:u(()=>[b(v(E(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):k("",!0),e.value.is_vcep_or_scvcep?(m(),S(M,{key:2,title:"Attestations",name:"attestations"},{default:u(()=>[a(x,{label:"Reanalysis and Discrepancy Resolution Attestation Signed","label-class":"w-52 font-bold"},{default:u(()=>[b(v(E(F)(o.value.reanalysis_attestation_date)),1)]),_:1}),a(x,{label:"NHGRI Attestation Signed","label-class":"w-60 font-bold"},{default:u(()=>[b(v(E(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):k("",!0)])}}},Ze={class:"application-review p-2 bg-gray-100"},et={class:"w-full"},tt={key:0,class:"mt-1"},lt={__name:"SustainedCurationReview",setup(l){const t=P(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel);return ve(()=>e.value,(_,d)=>{_.id&&(!d||_.id!==d.id)&&t.dispatch("groups/getEvidenceSummaries",e.value)}),(_,d)=>{const g=h("dictionary-row"),i=h("markdown-block");return m(),w("div",Ze,[o.value.has_approved_pilot?(m(),S(M,{key:0,title:"Plans for Ongoing Review and Discrepancy Resolution",name:"discrepency-review"},{default:u(()=>[a(g,{label:"Selected protocol","label-width-class":"w-48 font-bold"},{default:u(()=>[c("div",et,[b(v(o.value.curation_review_protocol?_.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(m(),w("p",tt,[d[0]||(d[0]=c("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):k("",!0)])]),_:1}),a(g,{label:"Notes","label-width-class":"w-48 font-bold"},{default:u(()=>[a(i,{markdown:o.value.curation_review_process_notes},null,8,["markdown"])]),_:1})]),_:1})):k("",!0),o.value.has_approved_pilot?(m(),S(M,{key:1,title:"Evidence Summaries",name:"evidence-summaries"},{default:u(()=>[a(ge,{readonly:!0})]),_:1})):k("",!0),o.value.has_approved_pilot?(m(),S(M,{key:2,title:"Core Approval Member, Trained Biocurator, and Biocurator Trainer Designation",name:"member-designation"},{default:u(()=>[a(g,{label:"Core Approval Members","label-width-class":"w-48 font-bold"},{default:u(()=>[b(v(e.value.coreApprovalMembers.map(s=>s.person.name).join(", ")),1)]),_:1}),a(g,{label:"Biocurator Trainers","label-width-class":"w-48 font-bold"},{default:u(()=>[b(v(e.value.biocuratorTrainers.map(s=>s.person.name).join(", ")),1)]),_:1}),a(g,{label:"Trained Biocurators","label-width-class":"w-48 font-bold"},{default:u(()=>[b(v(e.value.trainedBiocurators.map(s=>s.person.name).join(", ")),1)]),_:1})]),_:1})):k("",!0)])}}};export{lt as _,rt as a,we as c};
//# sourceMappingURL=SustainedCurationReview-DmblgIvW.js.map
