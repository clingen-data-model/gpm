{"version":3,"file":"ExpertiseList-DG2Svgyg.js","sources":["../../../resources/js/components/expertises/ExpertiseUpdateForm.vue","../../../resources/js/components/expertises/ExpertiseCreateForm.vue","../../../resources/js/views/ExpertiseList.vue"],"sourcesContent":["<script>\nimport {setupMirror} from '@/composables/setup_working_mirror'\nimport {isValidationError} from '@/http'\n\nexport default {\n    name: 'InstitutionCreateForm',\n    props: {\n        modelValue: {\n            type: Object,\n            required: true\n        }\n    },\n    emits: [\n        'update:modelValue',\n        'saved',\n        'canceled'\n    ],\n    setup(props, context) {\n        const {workingCopy} = setupMirror(props, context)\n\n        return {\n            workingCopy\n        }\n    },\n    data() {\n        return {\n            errors: {}\n        }\n    },\n    methods: {\n        async save () {\n            try {\n                this.initErrors();\n                const newCred = await this.$store.dispatch('expertises/update', this.workingCopy)\n                                    .then(rsp => rsp.data);\n\n                this.$emit('update:modelValue', newCred);\n                this.$emit('saved', newCred)\n            } catch (error) {\n                if (isValidationError(error)) {\n                    this.errors = error.response.data.errors\n                }\n            }\n        },\n        cancel () {\n            this.$emit('canceled')\n            this.initInstitution()\n        },\n        initErrors () {\n            this.errors = {};\n        }\n    },\n}\n</script>\n<template>\n  <div>\n    <input-row v-model=\"workingCopy.name\" label=\"Name\" :errors=\"errors.name\" />\n    <button-row submit-text=\"Save\" @submitted=\"save\" @cancel=\"cancel\" />\n  </div>\n</template>\n","<script setup>\n    import {ref, watch} from 'vue';\n    import {useStore} from 'vuex';\n    import {isValidationError} from '@/http';\n\n    const props = defineProps({\n        starterString: {\n            type: String,\n            required: false,\n        }\n    });\n    const emits = defineEmits([\n        'saved',\n        'canceled'\n    ]);\n    const store = useStore();\n    const errors = ref({});\n    const newExpertiseName = ref(null);\n\n    watch(() => props.starterString, to => {\n        newExpertiseName.value = to\n    });\n\n    const saveNewCredential = async () => {\n        try {\n            const newCredential = await store.dispatch(\n                                        'expertises/create',\n                                        {name: newExpertiseName.value}\n                                    )\n                                    .then(rsp => rsp.data);\n\n            newExpertiseName.value = null;\n            emits('saved', newCredential);\n        } catch (e) {\n            if (isValidationError(e)) {\n                errors.value = e.response.data.errors;\n            }\n        }\n    };\n\n    const cancelNewCredential = () => {\n        newExpertiseName.value = null;\n        emits('canceled');\n    };\n</script>\n\n<template>\n  <div>\n    <input-row v-model=\"newExpertiseName\" label=\"Name\" :errors=\"errors.name\" />\n    <button-row submit-text=\"Create Credential\" @submitted=\"saveNewCredential\" @cancel=\"cancelNewCredential\" />\n  </div>\n</template>\n","<script>\nimport sortAndFilter from '@/composables/router_aware_sort_and_filter';\nimport ExpertiseUpdateForm from '@/components/expertises/ExpertiseUpdateForm.vue'\nimport ExpertiseCreateForm from '@/components/expertises/ExpertiseCreateForm.vue'\n\nexport default {\n    name: 'CredentialList',\n    components: {\n    ExpertiseUpdateForm,\n    ExpertiseCreateForm\n},\n    setup() {\n        const {sort, filter} = sortAndFilter({field: 'name', desc: false});\n\n        return {\n            sort,\n            filter\n        }\n    },\n    data() {\n        return {\n            fields: [\n                {\n                    name: 'id',\n                    label: 'ID',\n                    type: Number,\n                    sortable: true,\n                    class: 'w-12'\n                },\n                {\n                    name: 'name',\n                    type: String,\n                    sortable: true\n                },\n                {\n                    name: 'people_count',\n                    label: '# People',\n                    type: Number,\n                    sortable: true\n                },\n                {\n                    name: 'actions',\n                    label: '',\n                    sortable: false\n                }\n\n            ],\n            currentItem: {},\n            showCreateDialog: false,\n            showEditDialog: false,\n            showDeleteConfirmation: false,\n        }\n    },\n    computed: {\n        items () {\n            return this.$store.getters['expertises/items']\n        },\n        filteredItems () {\n            if (!this.filter) {\n                return this.items;\n            }\n            const pattern = new RegExp(`.*${this.filter}.*`, 'i');\n            return this.items.filter(item =>  item.name.match(pattern)\n                                        || (item.abbreviation && item.abbreviation.match(pattern))\n                                        || (item.country && item.country.name.match(pattern)))\n        },\n        currentIndex () {\n            return this.items.findIndex(i => i.id === this.currentItem.id);\n        }\n    },\n    mounted () {\n        this.$store.dispatch('expertises/getItems');\n    },\n    methods: {\n        edit (item) {\n            this.showEditDialog = true;\n            this.currentItem = item;\n        },\n        handleSaved() {\n            this.showCreateDialog = false;\n            this.showEditDialog = false;\n\n            this.updateItem();\n            this.$store.commit(\"pushSuccess\", 'Expertise saved.')\n        },\n        handleCancel() {\n            this.showCreateDialog = false;\n            this.showEditDialog = false;\n            this.updateItem();\n            this.currentItem = {country: {}}\n        },\n        updateItem() {\n            if (!this.currentItem.id) {\n                return;\n            }\n\n            if (this.currentIndex > -1) {\n                this.items[this.currentIndex] = {...this.currentItem}\n            }\n        },\n        initDelete (item) {\n            this.showDeleteConfirmation = true;\n            this.currentItem = item;\n        },\n        async deleteItem() {\n            if (!this.currentItem.id) {\n                return;\n            }\n\n            if (this.currentItem.people_count > 0) {\n                // eslint-disable-next-line no-alert\n                alert('You cannot delete this expertise because it is in use.  Please edit the expertise or remove it from all people using it.')\n            }\n            try {\n                await this.$store.dispatch('expertises/delete', this.currentItem)\n                this.showDeleteConfirmation = false;\n                this.$store.commit(\"pushSuccess\", `${this.currentItem.name} deleted.`);\n            } catch (e) {\n                console.error(e);\n                throw e;\n            }\n        },\n    },\n}\n</script>\n<template>\n  <div>\n    <div class=\"flex justify-between items-center\">\n      <h1>Expertises</h1>\n      <button class=\"btn btn-sm\" @click=\"showCreateDialog = true\">\n        Add Expertise\n      </button>\n    </div>\n    <data-table\n      v-model:sort=\"sort\"\n      paginated\n      :data=\"filteredItems\"\n      :fields=\"fields\"\n      :reset-page-on-data-change=\"false\"\n    >\n      <template #header>\n        <label>\n          Filter:\n          <input v-model=\"filter\" type=\"text\">\n        </label>\n      </template>\n      <template #cell-actions=\"{item}\">\n        <dropdown-menu hide-cheveron>\n          <template #label>\n            <button class=\"btn btn-xs\">\n              &hellip;\n            </button>\n          </template>\n          <dropdown-item @click=\"edit(item)\">\n            Edit\n          </dropdown-item>\n          <dropdown-item @click=\"initDelete(item)\">\n            Delete\n          </dropdown-item>\n        </dropdown-menu>\n      </template>\n    </data-table>\n    <teleport to=\"body\">\n      <modal-dialog v-model=\"showEditDialog\" :title=\"`Edit ${currentItem.name}`\">\n        <ExpertiseUpdateForm v-model=\"currentItem\" @saved=\"handleSaved\" @canceled=\"handleCancel\" />\n      </modal-dialog>\n      <modal-dialog v-model=\"showDeleteConfirmation\" title=\"Delete Expertise\" size=\"sm\">\n        <div v-if=\"currentItem.people_count > 0\">\n          <p>You cannot delete an expertise people are using.</p>\n          <p>Either edit this this expertise or remove all people that have claimed it as an expertise.</p>\n        </div>\n        <div v-else>\n          You are about to delete the {{ currentItem.name }}\n          <button-row\n            submit-text=\"Delete\"\n            @submitted=\"deleteItem\"\n            @canceled=\"showDeleteConfirmation = false\"\n          />\n        </div>\n      </modal-dialog>\n      <modal-dialog v-model=\"showCreateDialog\" title=\"Add a New Expertise.\">\n        <ExpertiseCreateForm @saved=\"handleSaved\" @canceled=\"handleCancel\" />\n      </modal-dialog>\n    </teleport>\n  </div>\n</template>\n"],"names":["_sfc_main","props","context","workingCopy","setupMirror","newCred","rsp","error","isValidationError","_createElementBlock","_createVNode","_component_input_row","$setup","_cache","$event","$data","_component_button_row","$options","__props","emits","__emit","store","useStore","errors","ref","newExpertiseName","watch","to","saveNewCredential","newCredential","e","cancelNewCredential","ExpertiseUpdateForm","ExpertiseCreateForm","sort","filter","sortAndFilter","pattern","item","i","_hoisted_1","_createElementVNode","_component_data_table","_createTextVNode","_withCtx","_component_dropdown_menu","_component_dropdown_item","_createBlock","_Teleport","_component_modal_dialog","_component_ExpertiseUpdateForm","_openBlock","_hoisted_2","_hoisted_3","_toDisplayString","_component_ExpertiseCreateForm"],"mappings":"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"}