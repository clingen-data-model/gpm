import{s as me,p as T,r as R,q as C,a2 as Y,af as J,o as K,a as h,c as w,b as d,f as r,v as O,k as de,d as m,e as S,C as B,h as x,j as v,w as u,i as b,aG as L,a8 as N,F as H,m as z,n as W,g as M,$ as pe,am as F,x as ve}from"./app-M9a5cX1z.js";import{_ as _e,a as ye}from"./ExpertisesView-CkByTOGS.js";import{E as fe}from"./EvidenceSummaryList-xEPGya8d.js";class Q{constructor(t,e={}){this.baseUrl=t,this.options=e}query(t){const e=me(t);return T.get(this.baseUrl+e).then(o=>this.transformToEntity(o.data))}find(t){return T.get(`${this.baseUrl}/${t}`).then(e=>this.transformToEntity(e.data))}save(t){return T.post(this.baseUrl,t).then(e=>this.transformToEntity(e.data))}update(t){return T.put(`${this.baseUrl}/${t.id}`,t).then(e=>this.transformToEntity(e.data))}destroy(t){return T.delete(`${this.baseUrl}/${t.id}`)}transformToEntity(t){return this.options.entityClass&&Array.isArray(t)?t.map(e=>new this.options.entityClass(e)):t}}const A=new Q("/api/comments");A.resolve=l=>T.post(`/api/comments/${l}/resolved`).then(t=>t.data);A.unresolve=l=>T.post(`/api/comments/${l}/unresolved`).then(t=>t.data);const U={internal:1,suggestion:2,requirement:3},be=(l,t)=>{const e=R([]),o=C(()=>e.value.filter(n=>!n.is_resolved)),_=C(()=>o.value.filter(n=>n.comment_type_id===U.requirement)),p=C(()=>o.value.filter(n=>n.comment_type_id===U.suggestion)),g=C(()=>[..._.value,...p.value]),i=C(()=>o.value.filter(n=>n.comment_type_id===U.internal)),s=n=>e.value.findIndex($=>$.id===n.id);return{subject:{type:l,id:t},comments:e,openComments:o,openRequirements:_,openSuggestions:p,openInternal:i,getComments:async()=>{e.value=await A.query({where:{subject_type:l,subject_id:t}})},addComment:n=>e.value.push(n),removeComment:n=>e.value.splice(s(n),1),updateComment:n=>e.value[s(n)]=n,commentsForEp:g}};class ge{constructor(t,e){this.fields=t,this.repo=e,this.currentItem=R({}),this.originalItem=R({}),this.errors=R({})}async find(t){return await this.repo.find(t).then(e=>(this.currentItem.value=e,this.originalItem.value=e,e))}async save(t){this.clearErrors();try{const e=await this.repo.save(t);return this.clearCurrentItem(),e}catch(e){throw Y(e)&&(this.errors.value=e.response.data.errors),e}}async update(t){this.clearErrors();try{return this.currentItem.value=this.repo.update(t),this.currentItem.value}catch(e){throw Y(e)&&(this.errors.value=e.response.data.errors),e}}async destroy(t){this.repo.destroy(t)}cancel(){this.clearErrors(),this.currentItem.value.id||this.clearCurrentItem()}clearCurrentItem(){this.currentItem.value={}}clearErrors(){this.errors.value={}}}class we extends Q{constructor(t,e={}){super(t,e),this.cachedList=null}query(t){if(!this.cachedList){const e=super.query(t);this.cachedList=e}return this.cachedList}find(t){throw new Error("CommentTypeRepository.find not implemented")}save(t){throw new Error("CommentTypeRepository.save not implemented")}update(t){throw new Error("CommentTypeRepository.update not implemented")}destroy(t){throw new Error("CommentTypeRepository.destroy not implemented")}}const he=new we("/api/comment-types"),P=R([]),Ce=async()=>await he.query().then(l=>(P.value=l.map(t=>({label:t.name,value:t.id})),P.value)),ke=R([{name:"comment_type_id",label:"Type",type:"select",options:P,required:!0},{name:"content",label:"Comment",type:"large-text",required:!0}]),X=()=>(Ce(),new ge(ke,A)),V={__name:"ReviewCommentForm",props:{commentManager:{type:Object,required:!0},section:{type:[String,null],default:null},subjectType:{type:String,default:"App\\Modules\\Group\\Models\\Group"},subjectId:{type:Number,required:!1},comment:{type:Object},onlyInternal:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(l,{emit:t}){const e=l,o=t,_=J("group"),p=X();K(()=>{e.comment&&(p.currentItem.value=e.comment)});const g=C(()=>{const n=[...p.fields.value];if(e.onlyInternal){const $=n.findIndex(D=>D.name==="comment_type_id");n.splice($,1)}return n}),i=C(()=>p.errors.value),s=C({get(){return p.currentItem.value},set(n){p.currentItem.value=n}}),k=()=>{p.clearCurrentItem(),p.clearErrors(),o("canceled")},a=()=>{s.value.subject_type=e.subjectType,s.value.subject_id=e.subjectId||_.value.id,s.value.metadata={section:e.section,root_subject_type:"App\\Modules\\Group\\Models\\Group",root_subject_id:_.value.id},e.onlyInternal&&(s.value.comment_type_id=1),p.save(s.value).then(n=>{e.commentManager.addComment(n),o("saved",n)})},c=()=>{e.onlyInternal&&(s.value.comment_type_id=1),p.update(s.value).then(n=>{e.commentManager.updateComment(n),o("saved",n)})},y=()=>{if(s.value.id){c();return}a()};return(n,$)=>{const D=h("data-form"),q=h("button-row");return d(),w("div",null,[r(D,{modelValue:s.value,"onUpdate:modelValue":$[0]||($[0]=G=>s.value=G),fields:g.value,errors:i.value},null,8,["modelValue","fields","errors"]),r(q,{size:"xs","submit-text":"Save",onSubmitted:y,onCanceled:k})])}}},xe={class:"my-2"},$e={class:"comment-container"},Re={key:0,class:"relative"},Ie={class:"flex justify-between items-start mb-1 rounded"},Se={class:"flex space-x-2 items-end"},Ee={class:"block"},Me={class:"flex space-x-2"},je={class:"replies ml-1"},Te={key:0},qe={class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},Ae={__name:"ReviewComment",props:{comment:{type:Object,required:!0},commentManager:{type:Object,required:!0}},emits:["created","updated","resolved","unresolved","deleted"],setup(l,{emit:t}){const e=l,o=t,_=O(),p=X(),g=R(be("App\\Models\\Comment",e.comment.id)),i=R(!1),s=R(!1),k=I=>{if(!I.type)return"gray";switch(I.type.name){case"required revision":return"yellow";case"suggestion":return"blue";case"internal comment":return"gray"}},a=()=>{s.value=!0},c=()=>{p.destroy(e.comment).then(()=>{s.value=!1,e.commentManager.removeComment(e.comment),o("deleted",e.comment)})},y=async()=>{if(e.comment.is_resolved){const f=await A.unresolve(e.comment.id);e.commentManager.updateComment(f),o("updated"),o("resolved");return}const I=await A.resolve(e.comment.id);e.commentManager.updateComment(I),o("updated"),o("unresolved")},n=R(!1),$=()=>{g.value.getComments().then(I=>(n.value=!0,I))},D=async()=>{n.value||$(),n.value=!n.value},q=R(!1),G=()=>q.value=!0,Z=()=>{const I={...e.comment};I.comments_count+=1,e.commentManager.updateComment(I),n.value=!0,q.value=!1},ee=()=>{const I={...e.comment};I.comments_count-=1,e.commentManager.updateComment(I)};K(()=>{g.value.getComments()});const te=C(()=>de("comments-manage")||_.getters.currentUser.person.id===e.comment.creator_id);return(I,f)=>{const ne=h("badge"),oe=h("icon-checkmark"),se=h("popper"),ae=h("dropdown-menu"),re=h("markdown-block"),le=h("icon-reply"),ie=h("button-row"),ce=h("static-alert"),ue=h("ReviewComment",!0);return d(),w("div",xe,[m("div",$e,[i.value?(d(),S(V,{key:1,comment:l.comment,"comment-manager":l.commentManager,onCanceled:f[2]||(f[2]=j=>i.value=!1),onSaved:f[3]||(f[3]=j=>i.value=!1)},null,8,["comment","comment-manager"])):(d(),w("div",Re,[m("div",Ie,[m("div",Se,[m("strong",Ee,v(l.comment.creator&&l.comment.creator.name),1),r(ne,{class:"block",color:k(l.comment),size:"xxs"},{default:u(()=>[b(v(l.comment.type&&I.titleCase(l.comment.type.name)),1)]),_:1},8,["color"]),l.comment.is_resolved?(d(),S(se,{key:0,hover:"",arrow:"",content:"Resolved"},{default:u(()=>[r(oe,{class:"text-green-500",title:"Resolved"})]),_:1})):x("",!0)]),m("div",Me,[te.value?(d(),S(ae,{key:0,"hide-cheveron":""},{default:u(()=>[r(L,{onClick:f[0]||(f[0]=j=>i.value=!0)},{default:u(()=>f[5]||(f[5]=[b(" Edit ")])),_:1}),r(L,{onClick:y},{default:u(()=>[b(v(l.comment.is_resolved?"Mark unresolved":"Resolve"),1)]),_:1}),r(L,{onClick:a},{default:u(()=>f[6]||(f[6]=[b(" Delete ")])),_:1})]),_:1})):x("",!0)])]),r(re,{markdown:l.comment.content,class:"text-sm"},null,8,["markdown"]),m("button",{class:"link",onClick:G},[r(le,{class:"inline-block"}),f[7]||(f[7]=b("Reply "))]),B(r(ce,{variant:"danger",class:""},{default:u(()=>[f[8]||(f[8]=b(" Continue with delete? ")),r(ie,{size:"xs","submit-text":"Yes, delete","submit-variant":"red",onSubmitted:c,onCanceled:f[1]||(f[1]=j=>s.value=!1)})]),_:1},512),[[N,s.value]])]))]),m("div",je,[n.value?(d(),w("ul",Te,[(d(!0),w(H,null,z(g.value.comments,j=>(d(),w("li",{key:j.id,class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},[r(ue,{comment:j,"comment-manager":g.value,onDeleted:ee},null,8,["comment","comment-manager"])]))),128))])):x("",!0),l.comment.comments_count>0?(d(),w("button",{key:1,class:"link text-sm",onClick:D},v(n.value?"Hide":"Show")+" "+v(l.comment.comments_count)+" "+v(l.comment.comments_count>1?"replies":"reply"),1)):x("",!0),B(m("div",qe,[f[9]||(f[9]=m("strong",null,"Your Reply",-1)),r(V,{"subject-type":"App\\Models\\Comment","subject-id":l.comment.id,"only-internal":!0,"comment-manager":g.value,onSaved:Z,onCanceled:f[4]||(f[4]=j=>q.value=!1)},null,8,["subject-id","comment-manager"])],512),[[N,q.value]])])])}}},De={class:"lg:flex lg:space-x-4 screen-block"},Fe={class:"flex justify-between items-start space-x-4"},Be={key:0,class:"flex justify-between items-center lg:w-2/5 px-2 py-1 pb-0 bg-gray-100 rounded-lg"},Ne={class:"lg:w-2/5 p-2 bg-gray-100 rounded-lg mb-2"},Ge={class:"flex justify-between items-center"},Le={class:"bg-white mt-2 p-2"},E={__name:"ReviewSection",props:{title:{type:String||null,default:null},name:{type:String||null,default:null}},setup(l){const t=l,e=J("commentManager"),o=R(!1),_=R(!0),p=C(()=>e?e.value.comments.filter(i=>i.metadata?i.metadata.section===t.name:!1):[]),g=C(()=>e?p.value.find(i=>i.type.name==="required revision")?"yellow":p.value.find(i=>i.type.name==="suggestion")?"blue":"gray":null);return(i,s)=>{const k=h("icon-cheveron-right"),a=h("badge"),c=h("icon-cheveron-down");return d(),w("section",De,[m("div",{class:W(["overflow-x-auto flex-grow",{"lg:w-3/5":_.value}])},[m("header",Fe,[m("h2",{class:W(["flex-grow",{"lg:w-3/5":!_.value}])},v(l.title),3),M(e)?B((d(),w("div",Be,[m("h3",null,[r(k,{class:"inline cursor-pointer",onClick:s[0]||(s[0]=y=>_.value=!0)}),s[5]||(s[5]=b(" Comments ")),r(a,{color:g.value},{default:u(()=>[b(v(p.value.length),1)]),_:1},8,["color"])])],512)),[[N,!_.value]]):x("",!0)]),m("div",null,[m("div",null,[pe(i.$slots,"default")])])],2),B(m("div",Ne,[m("div",Ge,[m("h3",null,[r(c,{class:"inline cursor-pointer",onClick:s[1]||(s[1]=y=>_.value=!1)}),s[6]||(s[6]=b(" Comments "))])]),m("ul",null,[(d(!0),w(H,null,z(p.value,y=>(d(),w("li",{key:y.id,class:"bg-white p-2"},[r(Ae,{comment:y,"comment-manager":M(e)},null,8,["comment","comment-manager"])]))),128))]),m("div",Le,[o.value?(d(),S(V,{key:0,section:l.name,"comment-manager":M(e),onSaved:s[2]||(s[2]=y=>o.value=!1),onCanceled:s[3]||(s[3]=y=>o.value=!1)},null,8,["section","comment-manager"])):(d(),w("button",{key:1,class:"btn btn-xs block",onClick:s[4]||(s[4]=y=>o.value=!0)}," Add comment "))])],512),[[N,_.value&&M(e)]])])}}},Ue={__name:"ReviewMembership",props:{members:{required:!0,type:Array}},setup(l){const t=l,e={Chair:1,Coordinator:2,"Grant Liaison":3,Biocurator:4,Expert:5},o=a=>e[a.display_name]??1/0,_=R({field:"roles",desc:!1}),g=R([{name:"name",sortable:!0,label:"Name",sortFunction:(a,c)=>{let y=a.last_name.localeCompare(c.last_name);return y===0&&(y=a.first_name.localeCompare(c.first_name)),y}},{name:"legacy_credentials",sortable:!1,label:"Credentials"},{name:"roles",sortable:!0,label:"Roles",sortFunction:(a,c)=>a.role_priority-c.role_priority},{name:"legacy_expertise",sortable:!1,label:"Expertise"},{name:"institution",sortable:!1,label:"Institution"}]),i=C(()=>t.members.map(a=>{var y;const c=a.roles.toSorted((n,$)=>n.id-$.id);return{id:a.id,first_name:a.person.first_name,last_name:a.person.last_name,name:a.person.name,institution:(y=a.person.institution)==null?void 0:y.name,legacy_credentials:a.person.legacy_credentials,legacy_expertise:a.legacy_expertise,roles:c,role_priority:Math.min(...c.map(o)),active:a.isActive,person:a.person}}).filter(a=>a.active)),s=(a,c)=>{a[c]||(a[c]=0),a[c]++},k=C(()=>{const a={};return a.Total=i.value.length,console.log(i.value),Object.keys(e).forEach(c=>a[c]=0),i.value.forEach(c=>{c.roles.forEach(y=>s(a,y.display_name)),c.roles.length===0&&s(a,"None")}),a});return(a,c)=>{const y=h("data-table");return d(),w("div",null,[(d(!0),w(H,null,z(k.value,(n,$)=>(d(),w("div",{key:$},[m("span",null,v($)+": "+v(n),1)]))),128)),r(y,{sort:_.value,"onUpdate:sort":c[0]||(c[0]=n=>_.value=n),fields:g.value,data:i.value,class:"text-xs"},{"cell-roles":u(({item:n})=>[m("span",null,v(n.roles.map($=>$.display_name).join(", ")),1)]),"cell-legacy_credentials":u(({item:n})=>[r(ye,{person:n.person},null,8,["person"])]),"cell-legacy_expertise":u(({item:n})=>[r(_e,{person:n.person,"legacy-expertise":n.legacy_expertise},null,8,["person","legacy-expertise"])]),_:1},8,["sort","fields","data"])])}}},Pe={class:"space-y-4"},Ve={key:0,class:"mt-6"},Oe=["innerHTML"],He={class:"mb-6"},ze={key:0},Ye=["innerHTML"],We={class:"flex-none"},Je={key:0,class:"mt-1"},nt={__name:"DefinitionReview",setup(l){const t=O(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel),_=C(()=>e.value?e.value.members:[]),p=C(()=>({type:e.value.type.name?e.value.type.name.toUpperCase():"",long_base_name:o.value.long_base_name,short_base_name:o.value.short_base_name}));return(g,i)=>{const s=h("object-dictionary"),k=h("dictionary-row"),a=h("simple-table");return d(),w("div",Pe,[r(E,{title:"Basic Information",name:"basic-info"},{default:u(()=>[r(s,{obj:p.value,"label-class":"w-40 font-bold"},null,8,["obj"]),r(k,{label:"CDWG","label-class":"w-40 font-bold"},{default:u(()=>[b(v(e.value.parent?e.value.parent.name:"--"),1)]),_:1})]),_:1}),r(E,{title:"Membership",name:"membership"},{default:u(()=>[r(Ue,{members:_.value},null,8,["members"]),e.value.is_vcep_or_scvcep?(d(),w("div",Ve,[i[0]||(i[0]=m("h4",null,"Expertise of VCEP members",-1)),m("blockquote",{innerHTML:o.value.membership_description},null,8,Oe)])):x("",!0)]),_:1}),r(E,{title:"Scope",name:"scope"},{default:u(()=>[i[1]||(i[1]=m("h3",null,"Genes",-1)),m("div",He,[e.value.is_gcep?(d(),w("p",ze,v(o.value.genes.map(c=>c.gene_symbol).join(", ")),1)):x("",!0),e.value.is_vcep_or_scvcep?(d(),S(a,{key:1,data:o.value.genes.map(c=>({id:c.id,gene:c.gene_symbol,disease:c.disease_name})),"key-by":"id","hide-columns":["id"]},null,8,["data"])):x("",!0)]),i[2]||(i[2]=m("h3",null,"Description of scope",-1)),m("blockquote",{innerHTML:o.value.scope_description},null,8,Ye)]),_:1}),e.value.is_gcep?(d(),S(E,{key:0,title:"Plans",name:"plans"},{default:u(()=>[r(k,{label:"Selected protocol","label-class":"w-48 font-bold"},{default:u(()=>[m("div",We,[b(v(o.value.curation_review_protocol?g.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(d(),w("p",Je,[i[3]||(i[3]=m("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):x("",!0)])]),_:1})]),_:1})):x("",!0),e.value.is_gcep?(d(),S(E,{key:1,title:"Attestations",name:"attestations"},{default:u(()=>[r(k,{label:"GCEP Attestation Signed","label-class":"w-52 font-bold"},{default:u(()=>[b(v(M(F)(o.value.gcep_attestation_date)),1)]),_:1}),r(k,{label:"GCI Training Date","label-class":"w-52 font-bold"},{default:u(()=>[b(v(M(F)(o.value.gci_training_date)),1)]),_:1}),r(k,{label:"NHGRI Attestation Signed","label-class":"w-52 font-bold"},{default:u(()=>[b(v(M(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):x("",!0),e.value.is_vcep_or_scvcep?(d(),S(E,{key:2,title:"Attestations",name:"attestations"},{default:u(()=>[r(k,{label:"Reanalysis and Discrepancy Resolution Attestation Signed","label-class":"w-52 font-bold"},{default:u(()=>[b(v(M(F)(o.value.reanalysis_attestation_date)),1)]),_:1}),r(k,{label:"NHGRI Attestation Signed","label-class":"w-60 font-bold"},{default:u(()=>[b(v(M(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):x("",!0)])}}},Ke={class:"application-review p-2 bg-gray-100"},Qe={class:"w-full"},Xe={key:0,class:"mt-1"},ot={__name:"SustainedCurationReview",setup(l){const t=O(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel);return ve(()=>e.value,(_,p)=>{_.id&&(!p||_.id!==p.id)&&t.dispatch("groups/getEvidenceSummaries",e.value)}),(_,p)=>{const g=h("dictionary-row"),i=h("markdown-block");return d(),w("div",Ke,[o.value.has_approved_pilot?(d(),S(E,{key:0,title:"Plans for Ongoing Review and Discrepancy Resolution",name:"discrepency-review"},{default:u(()=>[r(g,{label:"Selected protocol","label-width-class":"w-48 font-bold"},{default:u(()=>[m("div",Qe,[b(v(o.value.curation_review_protocol?_.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(d(),w("p",Xe,[p[0]||(p[0]=m("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):x("",!0)])]),_:1}),r(g,{label:"Notes","label-width-class":"w-48 font-bold"},{default:u(()=>[r(i,{markdown:o.value.curation_review_process_notes},null,8,["markdown"])]),_:1})]),_:1})):x("",!0),o.value.has_approved_pilot?(d(),S(E,{key:1,title:"Evidence Summaries",name:"evidence-summaries"},{default:u(()=>[r(fe,{readonly:!0})]),_:1})):x("",!0),o.value.has_approved_pilot?(d(),S(E,{key:2,title:"Core Approval Member, Trained Biocurator, and Biocurator Trainer Designation",name:"member-designation"},{default:u(()=>[r(g,{label:"Core Approval Members","label-width-class":"w-48 font-bold"},{default:u(()=>[b(v(e.value.coreApprovalMembers.map(s=>s.person.name).join(", ")),1)]),_:1}),r(g,{label:"Biocurator Trainers","label-width-class":"w-48 font-bold"},{default:u(()=>[b(v(e.value.biocuratorTrainers.map(s=>s.person.name).join(", ")),1)]),_:1}),r(g,{label:"Trained Biocurators","label-width-class":"w-48 font-bold"},{default:u(()=>[b(v(e.value.trainedBiocurators.map(s=>s.person.name).join(", ")),1)]),_:1})]),_:1})):x("",!0)])}}};export{ot as _,nt as a,be as c};
//# sourceMappingURL=SustainedCurationReview-DcgOx7oF.js.map
