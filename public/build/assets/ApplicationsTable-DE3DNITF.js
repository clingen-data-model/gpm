import{_ as D,B as S,A as T,am as w,c as n,d as s,f as h,i as _,C as v,D as k,Z as C,F as d,m as c,a as b,n as A,w as p,j as u,E as N,b as o}from"./app-xtqLUWuO.js";import{s as V}from"./router_aware_sort_and_filter-9Sdst5yH.js";const B={components:{},props:{epTypeId:{type:Number,default:null}},data(){return{fields:[{name:"id",label:"ID",type:Number,sortable:!0},{name:"full_name",label:"Name",type:String,sortable:!0},{name:"group.parent.name",label:"CDWG",type:String,sortable:!0,resolveValue(e){return e.group&&e.group.parent?e.group.parent.name:""}},{name:"current_step",label:"Current Step",type:Number,sortable:!0,resolveValue(e){return e.isCompleted?"Completed":e.current_step},resolveSort(e){return e.isCompleted?5:e.current_step}},{name:"latest_submission_date",label:"Last Submitted",type:Date,sortable:!0,resolveValue(e){return e.group.latest_submission?w(e.group.latest_submission.created_at):null}},{name:"latest_submision.status",label:"Submission Status",type:String,sortable:!0,resolveValue(e){return e.group.latest_submission?e.group.latest_submission.status.name:null}},{name:"latest_log_entry",label:"Last Activity",type:Date,sortable:!0,resolveSort(e){return e&&e.group&&e.group.latest_log_entry?w(e.group.latest_log_entry.created_at):null}},{name:"next_actions",label:"Next Actions",type:String,sortable:!1,class:["min-w-28","max-w-xs","truncate"]}],allInfoFields:[{name:"contacts",label:"Contacts",type:Array,sortable:!1,class:["min-w-40"],step:1},{name:"step_1_received_date",label:Number.parseInt(this.epTypeId)===2?"Step 1 Received":"Application Received",type:Date,sortable:!0,class:["min-w-28"],step:1},{name:"step_1_approval_date",label:Number.parseInt(this.epTypeId)===2?"Step 1 Approved":"Application Approved",type:Date,sortable:!0,class:["min-w-28"],step:1},{name:"step_2_approval_date",label:"Step 2 Approved",type:Date,sortable:!0,class:["min-w-28"],step:2},{name:"step_3_approval_date",label:"Step 3 Approved",type:Date,sortable:!0,class:["min-w-28"],step:3},{name:"step_4_received_date",label:"Step 4 Received",type:Date,sortable:!0,class:["min-w-28"],step:4},{name:"step_4_approval_date",label:"Step 4 Approved",type:Date,sortable:!0,class:["min-w-28"],step:4}],waitingOn:null,showDeleted:!1}},computed:{...S({applications:"applications/all"}),filteredData(){let e=this.applications.filter(t=>!this.epTypeId||Number.parseInt(t.expert_panel_type_id)===Number.parseInt(this.epTypeId)).filter(t=>this.showCompleted?!0:t.date_completed==null);return this.waitingOn&&(e=e.filter(t=>t.pendingActionsByAssignee[this.waitingOn].length>0)),this.showDeleted||(e=e.filter(t=>t.deleted_at===null)),e},showCompleted:{set(e){const t=this.$route.query,m=this.$route.path;let i={...t};e?i={...t,"show-completed":1}:delete i["show-completed"],this.$router.replace({path:m,query:i})},get(){return!!Number.parseInt(this.$route.query["show-completed"])},immediate:!0},selectedFields(){if(+this.showAllInfo==1){const e=Number.parseInt(this.epTypeId)===2?[1,2,3,4]:[1],t=this.allInfoFields.filter(m=>e.includes(m.step));return[...this.fields,...t]}return this.fields},showAllInfo:{immediate:!0,get(){return Object.keys(this.$route.query).includes("showAllInfo")?this.$route.query.showAllInfo:0},set(e){const t={...this.$route.query};t.showAllInfo=e,this.$router.replace({path:this.$route.path,query:t})}},remainingHeight(){return{height:"calc(100vh - 220px)"}},assignees(){return Object.values(T.nextActions.assignees)}},mounted(){this.getApplications()},methods:{getApplications(){const e={},t={expert_panel_type_id:this.epTypeId};Object.keys(t).length>0&&(e.where=t),this.showDeleted&&(e.showDeleted=1),this.$store.dispatch("applications/getApplications",e)},goToApplication(e){if(e.deleted_at){alert(`The application for ${e.name} has been deleted.  Details cannot be viewed.`);return}this.$router.push({name:"ApplicationDetail",params:{uuid:e.group.uuid}})}},setup(){const{sort:e,filter:t}=V({field:"full_name",desc:!1});return{sort:e,filter:t}}},F={class:"sm:flex justify-between"},O={class:"mb-1 sm:flex space-x-2"},q={class:"block"},L={class:"block"},H=["value"],M=["href"],j=["innerHTML"],U={class:"list-disc pl-6 text-sm"},Q=["innerHTML"];function R(e,t,m,i,f,a){const I=b("checkbox"),g=b("popper"),x=b("data-table");return o(),n("div",null,[s("div",F,[s("div",O,[s("label",q,[t[6]||(t[6]=_(" Filter: ")),v(s("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>i.filter=l),type:"text",class:"sm",placeholder:"filter"},null,512),[[k,i.filter]])]),s("label",L,[t[8]||(t[8]=_(" Waiting on: ")),v(s("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>f.waitingOn=l),class:"sm"},[t[7]||(t[7]=s("option",{value:null},"Any",-1)),(o(!0),n(d,null,c(a.assignees,l=>(o(),n("option",{key:l.id,value:l.id},u(l.name),9,H))),128))],512),[[C,f.waitingOn]])]),h(I,{modelValue:a.showCompleted,"onUpdate:modelValue":t[2]||(t[2]=l=>a.showCompleted=l),label:"Show completed"},null,8,["modelValue"])]),s("div",null,[s("button",{class:A(["btn btn-xs",{blue:a.showAllInfo==0}]),onClick:t[3]||(t[3]=l=>a.showAllInfo=0)}," Summary ",2),s("button",{class:A(["btn btn-xs",{blue:a.showAllInfo==1}]),onClick:t[4]||(t[4]=l=>a.showAllInfo=1)}," All Info ",2)])]),h(x,{sort:i.sort,"onUpdate:sort":t[5]||(t[5]=l=>i.sort=l),data:a.filteredData,fields:a.selectedFields,"filter-term":i.filter,"row-click-handler":a.goToApplication,"row-class":"cursor-pointer",style:N(a.remainingHeight),class:"overflow-auto"},{"cell-contacts":p(({item:l})=>[s("ul",null,[(o(!0),n(d,null,c(l.group.members,r=>(o(),n("li",{key:r.id},[s("small",null,[s("a",{href:`mailto:${r.person.email}`,class:"text-blue-500"},u(r.person.name),9,M)])]))),128))])]),"cell-latest_log_entry":p(({item:l})=>[h(g,{hover:"",arrow:"",placement:"right"},{content:p(()=>[s("div",{innerHTML:l.group.latest_log_entry.description},null,8,j)]),default:p(()=>[_(" "+u(e.formatDate(l.group.latest_log_entry.created_at)),1)]),_:2},1024)]),"cell-next_actions":p(({item:l})=>[h(g,{hover:"",arrow:"",placement:"left"},{content:p(()=>[(o(!0),n(d,null,c(a.assignees.filter(r=>l.pendingActionsByAssignee[r.id].length>0),r=>(o(),n("div",{key:r.id,class:"whitespace-normal max-w-80"},[s("h4",null,u(r.short_name)+":",1),s("ul",U,[(o(!0),n(d,null,c(l.pendingActionsByAssignee[r.id],y=>(o(),n("li",{key:y.id,class:"w-76 whitespace-normal",innerHTML:y.entry},null,8,Q))),128))])]))),128))]),default:p(()=>[(o(!0),n(d,null,c(a.assignees.filter(r=>l.pendingActionsByAssignee[r.id].length>0),r=>(o(),n("div",{key:r.id},[s("span",null,[_(u(r.short_name)+": ",1),s("strong",null,u(l.pendingActionsByAssignee[r.id].length),1)])]))),128))]),_:2},1024)]),_:1},8,["sort","data","fields","filter-term","row-click-handler","style"])])}const G=D(B,[["render",R]]);export{G as A};
//# sourceMappingURL=ApplicationsTable-DE3DNITF.js.map
