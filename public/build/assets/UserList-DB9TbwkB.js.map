{"version":3,"file":"UserList-DB9TbwkB.js","sources":["../../../resources/js/views/users/UserList.vue"],"sourcesContent":["<script>\nimport {api} from '@/http'\nimport {debounce} from 'lodash-es'\nimport sortAndFilterSetup from '@/composables/router_aware_sort_and_filter'\n\nexport default {\n    name: 'ComponentName',\n    props: {\n\n    },\n    setup() {\n        const {sort, filter} = sortAndFilterSetup({\n            field: 'person.name',\n            desc: false\n        });\n\n        return {\n            sort,\n            filter,\n        }\n    },\n    data() {\n        return {\n            users: [],\n            fields: [\n                {\n                    name: 'id',\n                    type: Number,\n                    sortable: true\n                },\n                {\n                    name: 'person.name',\n                    label: 'Name',\n                    type: String,\n                    sortable: true\n                },\n                {\n                    name: 'person.email',\n                    label: 'Email',\n                    type: String,\n                    sortable: true\n                },\n                {\n                    name: 'roles',\n                    label: 'System Roles',\n                    type: String,\n                    sortable: false,\n                    resolveValue (item) {\n                        return item.roles.map(r => r.display_name).join(', ')\n                    }\n                },\n                {\n                    name: 'permissions',\n                    label: '+ Permissions',\n                    type: String,\n                    sortable: false,\n                    resolveValue (item) {\n                        return item.permissions.map(r => r.display_name).join(', ')\n                    },\n                    class: 'text-xs'\n                },\n                // {\n                //     name: 'actions',\n                //     sortable: false,\n                //     label: ''\n                // }\n\n            ]\n        }\n    },\n    computed: {\n        filteredUsers () {\n            if (!this.filter) {\n                return this.users;\n            }\n            const pattern = new RegExp(`.*${this.filter}.*`, 'i')\n            return this.users.filter(u => {\n                return u.person.name.match(pattern)\n                    || u.person.email.match(pattern);\n            });\n        }\n    },\n    watch: {\n        filter: {\n            immediate: true,\n            handler () {\n                if (this.triggerSearch) {\n                    this.triggerSearch()\n                }\n            }\n        },\n        sort: {\n            immediate: true,\n            handler () {\n                 if (this.triggerSearch) {\n                    this.triggerSearch()\n                }\n            }\n        }\n    },\n    created () {\n        this.triggerSearch = debounce(() => this.$refs.dataTable.getItems(), 500)\n    },\n    methods: {\n        async getUsers (currentPage, pageSize, sort, setTotalItems) {\n            const params = {\n                page: currentPage,\n                page_size: pageSize,\n                'sort[field]': sort.field.name,\n                'sort[dir]': sort.desc ? 'DESC' : 'ASC',\n                'where[filterString]': this.filter,\n                'with': ['roles', 'permissions'],\n                paginated: true\n            }\n            const pageResponse = await api.get('/api/users', {params})\n                                .then(response => response.data);\n            setTotalItems(pageResponse.meta.total);\n            return pageResponse.data;\n        },\n        goToUser (user) {\n            this.$router.push({name: 'UserDetail', params: {id: user.id}})\n        }\n    }\n}\n</script>\n<template>\n  <div>\n    <h1>Users</h1>\n    <data-table\n      ref=\"dataTable\"\n      v-model:sort=\"sort\"\n      :fields=\"fields\"\n      :data=\"getUsers\"\n      row-class=\"cursor-pointer\"\n      paginated\n      @row-click=\"goToUser\"\n    >\n      <template #header>\n        <div>Filter: &nbsp;<input v-model=\"filter\" type=\"text\" placeholder=\"name, email\"></div>\n      </template>\n    </data-table>\n  </div>\n</template>\n"],"names":["_sfc_main","sort","filter","sortAndFilterSetup","item","r","pattern","u","debounce","currentPage","pageSize","setTotalItems","params","pageResponse","api","response","user","_createElementBlock","_cache","_createElementVNode","_createVNode","_component_data_table","$setup","$event","$data","$options","_createTextVNode"],"mappings":"mLAKA,MAAKA,EAAU,CACX,KAAM,gBACN,MAAO,CAEN,EACD,OAAQ,CACJ,KAAM,CAAC,KAAAC,EAAM,OAAAC,CAAM,EAAIC,EAAmB,CACtC,MAAO,cACP,KAAM,EACV,CAAC,EAED,MAAO,CACH,KAAAF,EACA,OAAAC,CACJ,CACH,EACD,MAAO,CACH,MAAO,CACH,MAAO,CAAE,EACT,OAAQ,CACJ,CACI,KAAM,KACN,KAAM,OACN,SAAU,EACb,EACD,CACI,KAAM,cACN,MAAO,OACP,KAAM,OACN,SAAU,EACb,EACD,CACI,KAAM,eACN,MAAO,QACP,KAAM,OACN,SAAU,EACb,EACD,CACI,KAAM,QACN,MAAO,eACP,KAAM,OACN,SAAU,GACV,aAAcE,EAAM,CAChB,OAAOA,EAAK,MAAM,IAAIC,GAAKA,EAAE,YAAY,EAAE,KAAK,IAAI,CACxD,CACH,EACD,CACI,KAAM,cACN,MAAO,gBACP,KAAM,OACN,SAAU,GACV,aAAcD,EAAM,CAChB,OAAOA,EAAK,YAAY,IAAIC,GAAKA,EAAE,YAAY,EAAE,KAAK,IAAI,CAC7D,EACD,MAAO,SACV,CAOL,CACJ,CACH,EACD,SAAU,CACN,eAAiB,CACb,GAAI,CAAC,KAAK,OACN,OAAO,KAAK,MAEhB,MAAMC,EAAU,IAAI,OAAO,KAAK,KAAK,MAAM,KAAM,GAAG,EACpD,OAAO,KAAK,MAAM,OAAOC,GACdA,EAAE,OAAO,KAAK,MAAMD,CAAO,GAC3BC,EAAE,OAAO,MAAM,MAAMD,CAAO,CACtC,CACL,CACH,EACD,MAAO,CACH,OAAQ,CACJ,UAAW,GACX,SAAW,CACH,KAAK,eACL,KAAK,cAAa,CAE1B,CACH,EACD,KAAM,CACF,UAAW,GACX,SAAW,CACF,KAAK,eACN,KAAK,cAAa,CAE1B,CACJ,CACH,EACD,SAAW,CACP,KAAK,cAAgBE,EAAS,IAAM,KAAK,MAAM,UAAU,SAAQ,EAAI,GAAG,CAC3E,EACD,QAAS,CACL,MAAM,SAAUC,EAAaC,EAAUT,EAAMU,EAAe,CACxD,MAAMC,EAAS,CACX,KAAMH,EACN,UAAWC,EACX,cAAeT,EAAK,MAAM,KAC1B,YAAaA,EAAK,KAAO,OAAS,MAClC,sBAAuB,KAAK,OAC5B,KAAQ,CAAC,QAAS,aAAa,EAC/B,UAAW,EACf,EACMY,EAAe,MAAMC,EAAI,IAAI,aAAc,CAAC,OAAAF,CAAM,CAAC,EACpC,KAAKG,GAAYA,EAAS,IAAI,EACnD,OAAAJ,EAAcE,EAAa,KAAK,KAAK,EAC9BA,EAAa,IACvB,EACD,SAAUG,EAAM,CACZ,KAAK,QAAQ,KAAK,CAAC,KAAM,aAAc,OAAQ,CAAC,GAAIA,EAAK,EAAE,CAAC,CAAC,CACjE,CACJ,CACJ,6DAGEC,EAeM,MAAA,KAAA,CAdJC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAc,UAAV,QAAK,EAAA,GACTC,EAYaC,EAAA,CAXX,IAAI,YACI,KAAMC,EAAI,KAlIxB,gBAAAJ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAK,GAkIoBD,EAAI,KAAAC,GACjB,OAAQC,EAAM,OACd,KAAMC,EAAQ,SACf,YAAU,iBACV,UAAA,GACC,WAAWA,EAAQ,WAET,SACT,IAAuF,CAAvFN,EAAuF,MAAA,KAAA,CA1I/FD,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAQ,EA0Ia,WAAc,KAAAP,EAA8D,QAAA,CA1IzF,sBAAAD,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAK,GA0I2CD,EAAM,OAAAC,GAAE,KAAK,OAAO,YAAY,6BAAhCD,EAAM,MAAA,QA1IjD,EAAA"}