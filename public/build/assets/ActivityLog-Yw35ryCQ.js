import{r as p,q as D,v as N,x as q,e as k,w as v,f as i,h as w,a as d,ao as A,an as T,d as u,b as s,_ as V,am as U,c as m,j as L,F as I,m as O,a2 as H,aS as B}from"./app-kcWpDedC.js";import{u as M,s as j,f as h,d as P}from"./log_entry_repository-Dwyj2mzO.js";const Y={__name:"ActivityLogEntryForm",props:{logEntry:{required:!1,default:()=>({log_date:new Date().toISOString(),step:null,entry:""})},apiUrl:{required:!0,type:String}},emits:["saved","canceled"],setup(r,{emit:o}){const n=r,e=o,c=N(),l=p({log_date:new Date().toISOString(),step:null,entry:""}),a=p({}),y=D(()=>c.getters["groups/currentItemOrNew"]),f=t=>{!t||!t.created_at||(l.value={id:t.id,log_date:new Date(Date.parse(t.created_at)).toISOString(),step:t.step,entry:t.description})},b=()=>{l.value={log_date:new Date().toISOString(),step:null,entry:""}},g=async()=>{try{l.value.id?await M(`${n.apiUrl}/${l.value.id}`,l.value):await j(n.apiUrl,l.value),await h(n.apiUrl),b(),e("saved",l.value)}catch(t){t.response&&Number.parseInt(t.response.status)===422&&t.response.data.errors&&(a.value=t.response.data.errors)}},C=()=>{b(),e("canceled")};return q(()=>n.logEntry,t=>{f(t)},{immediate:!0}),(t,_)=>{const S=d("input-row"),x=d("button-row"),F=d("form-container");return s(),k(F,{class:"log-entry-form"},{default:v(()=>[i(S,{modelValue:l.value.log_date,"onUpdate:modelValue":_[0]||(_[0]=E=>l.value.log_date=E),label:"Log Date",errors:a.value.log_date,type:"date"},null,8,["modelValue","errors"]),y.value.is_vcep?(s(),k(A,{key:0,modelValue:l.value.step,"onUpdate:modelValue":_[1]||(_[1]=E=>l.value.step=E),errors:a.value.step},null,8,["modelValue","errors"])):w("",!0),i(S,{label:"Entry",errors:a.value.entry},{default:v(()=>[i(T,{modelValue:l.value.entry,"onUpdate:modelValue":_[2]||(_[2]=E=>l.value.entry=E),"markdown-format":!1},null,8,["modelValue"])]),_:1},8,["errors"]),i(x,null,{default:v(()=>[u("button",{class:"btn",onClick:C}," Cancel "),u("button",{class:"btn blue",onClick:g}," Save ")]),_:1})]),_:1})}}},z={name:"ConfirmDeleteLogEntry",props:{logEntry:{required:!0,type:Object},apiUrl:{required:!0,type:String}},emits:["deleted","canceled"],setup(r,o){const n=p({}),e=D(()=>U(r.logEntry.log_date)),c=D(()=>Object.values(n.value).flat());return{errors:n,logDate:e,flattenedErrors:c,deleteLogEntry:async()=>{try{await P(r.apiUrl,r.logEntry.id),o.emit("deleted"),await h(r.apiUrl)}catch(a){if(H(a)){n.value=a.response.data.errors;return}n.value={a:a.message}}}}}},G={class:"border-y py-2"},J=["innerHTML"],K={key:0,class:"ml-4 mt-2 mb-4 text-gray-700 text-sm"},Q={key:0,class:"bg-red-200 text-red-900 rounded p-2 my-2"};function R(r,o,n,e,c,l){const a=d("button-row");return s(),m("div",null,[o[1]||(o[1]=u("p",null,"You are about to delete the following log entry:",-1)),u("div",G,[u("blockquote",null,[u("div",{innerHTML:n.logEntry.description},null,8,J)]),n.logEntry.causer?(s(),m("div",K," Logged by "+L(n.logEntry.causer.name)+", "+L(e.logDate),1)):w("",!0)]),o[2]||(o[2]=u("div",null,"This can not be undone. Are you sure you want to continue?",-1)),e.flattenedErrors.length>0?(s(),m("div",Q,[u("ul",null,[(s(!0),m(I,null,O(e.flattenedErrors,(y,f)=>(s(),m("li",{key:f},L(y),1))),128))])])):w("",!0),i(a,{"submit-text":"Delete Log Entry",onCanceled:o[0]||(o[0]=y=>r.$emit("canceled")),onSubmitted:e.deleteLogEntry},null,8,["onSubmitted"])])}const W=V(z,[["render",R]]),X=[{name:"created_at",label:"Date & Time",sortName:"created_at",sortable:!0,resolveValue({created_at:r}){return r?U(r):null},type:Date,colspan:2,class:"w-16"},{name:"created_at",label:"Time",sortName:"created_at",hideHeader:!0,sortable:!1,resolveValue({created_at:r}){return r?B(r):null},class:"w-28",type:Date},{name:"description",label:"Entry",sortable:!0,type:String},{name:"causer.name",label:"User",sortable:!0},{name:"id",label:"",sortable:!1}],Z={components:{LogEntryForm:Y,ActivityLogDeleteConfirmation:W},props:{logEntries:{required:!0,type:Array},apiUrl:{required:!0,type:String}},setup(r){const o=p({field:"created_at",desc:!0}),n=p({}),e=p(!1),c=p(!1),l=D(()=>r.logEntries.length>0),a=g=>{e.value=!0,n.value=g},y=()=>{e.value=!1,n.value={}},f=g=>{n.value=g,c.value=!0},b=()=>{c.value=!1,n.value={}};return{fields:p(X),sort:o,selectedEntry:n,editingEntry:e,hasLogEntries:l,editLogEntry:a,closeEntryForm:y,showDeleteConfirmation:c,confirmDelete:f,closeDeleteConfirmation:b}}},$={key:0,class:"px-3 py-2 rounded border border-gray-300 text-gray-500 bg-gray-200"},ee={key:0,class:"flex space-x-1"},te=["onClick"],ne=["onClick"],oe=["innerHTML"];function re(r,o,n,e,c,l){const a=d("icon-edit"),y=d("icon-trash"),f=d("data-table"),b=d("LogEntryForm"),g=d("modal-dialog"),C=d("ActivityLogDeleteConfirmation");return s(),m("div",null,[e.hasLogEntries?(s(),k(f,{key:1,sort:e.sort,"onUpdate:sort":o[0]||(o[0]=t=>e.sort=t),fields:e.fields,data:n.logEntries},{"cell-id":v(({item:t})=>[r.hasPermission("groups-manage")?(s(),m("div",ee,[u("button",{class:"btn btn-xs inline-block",onClick:_=>e.editLogEntry(t)},[i(a,{width:"12"})],8,te),t.activity_type===null?(s(),m("button",{key:0,class:"btn btn-xs inline-block",onClick:_=>e.confirmDelete(t)},[i(y,{width:"12"})],8,ne)):w("",!0)])):w("",!0)]),"cell-description":v(({item:t})=>[u("div",{class:"links-blue",innerHTML:t.description},null,8,oe)]),_:1},8,["sort","fields","data"])):(s(),m("div",$," No log entries to display ")),i(g,{modelValue:e.editingEntry,"onUpdate:modelValue":o[1]||(o[1]=t=>e.editingEntry=t),title:"Edit log entry"},{default:v(()=>[i(b,{"log-entry":e.selectedEntry,"api-url":n.apiUrl,onSaved:e.closeEntryForm,onCanceled:e.closeEntryForm},null,8,["log-entry","api-url","onSaved","onCanceled"])]),_:1},8,["modelValue"]),i(g,{modelValue:e.showDeleteConfirmation,"onUpdate:modelValue":o[2]||(o[2]=t=>e.showDeleteConfirmation=t),title:"Delete this log entry?"},{default:v(()=>[i(C,{"log-entry":e.selectedEntry,"api-url":n.apiUrl,onCanceled:e.closeDeleteConfirmation,onDeleted:e.closeDeleteConfirmation},null,8,["log-entry","api-url","onCanceled","onDeleted"])]),_:1},8,["modelValue"])])}const se=V(Z,[["render",re]]);export{se as A};
//# sourceMappingURL=ActivityLog-Yw35ryCQ.js.map
