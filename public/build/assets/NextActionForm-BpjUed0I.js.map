{"version":3,"file":"NextActionForm-BpjUed0I.js","sources":["../../../resources/js/components/next_actions/NextActionForm.vue"],"sourcesContent":["<script>\nimport StepInput from '@/components/forms/StepInput.vue'\nimport {mapGetters} from 'vuex'\nimport RichTextEditor from '@/components/prosekit/RichTextEditor.vue'\nimport {formatDate} from '@/date_utils'\nimport configs from '@/configs'\n\nexport default {\n    name: 'NextActionForm',\n    components: {\n        StepInput,\n        RichTextEditor\n    },\n    props: {\n        id: {\n            required: false,\n            default: null\n        }\n    },\n    emits: [\n        'saved',\n        'closed',\n        'formCleared',\n        'canceled'\n    ],\n    data() {\n        return {\n            errors: {},\n            newAction: {\n                date_created: new Date(),\n                step: null,\n                date_completed: null,\n                entry: '',\n                assigned_to: null,\n                assigned_to_name: null\n            },\n            completed: false\n        }\n    },\n    computed: {\n        ...mapGetters({\n            group: 'groups/currentItemOrNew'\n        }),\n        application () {\n            return this.group.expert_panel;\n        },\n        title () {\n            return this.newAction.id ? 'Update Action' : 'Add Next Action';\n        },\n        steps () {\n            return [1,2,3,4];\n        },\n        assignmentErrors () {\n            let errors = [];\n            if (this.errors.assigned_to) {\n                errors = [...errors, ...this.errors.assigned_to]\n            }\n            if (this.errors.assigned_to_name) {\n                errors = [...errors, ...this.errors.assigned_to_name]\n            }\n            return errors;\n        },\n        assignees () {\n            return Object.values(configs.nextActions.assignees);\n        }\n    },\n    watch: {\n        id: {\n            immediate: true,\n            handler() {\n                const action = this.findAction();\n                if (action) {\n                    this.syncAction(action)\n                }\n            }\n        },\n        application: {\n            immediate: true,\n            handler () {\n                const action = this.findAction();\n                if (action) {\n                    this.syncAction(action);\n                }\n            }\n        }\n    },\n    unmounted() {\n        this.initNewAction()\n    },\n    mounted() {\n    },\n    methods: {\n        cancel () {\n            this.clearForm();\n            this.$emit('canceled');\n        },\n        clearForm() {\n            this.initNewAction();\n            this.$emit('formCleared')\n        },\n        initNewAction () {\n            this.newAction = {\n                date_created: new Date(),\n                step: null,\n                target_date: null,\n                date_completed: null,\n                entry: '',\n                assigned_to: null,\n                assigned_to_name: null,\n            };\n        },\n        findAction () {\n            if (this.id === null) {\n                return null;\n            }\n            if (this.application.next_actions) {\n                return this.application.next_actions.find(i => i.id === +this.id);\n            }\n        },\n        syncAction (action) {\n            if (!action) {\n                return;\n            }\n            this.newAction = {\n                id: action.id,\n                uuid: action.uuid,\n                date_created: formatDate(action.created_at),\n                step: action.step,\n                target_date: formatDate(action.target_date),\n                date_completed: formatDate(action.date_completed),\n                entry: action.entry ?? '',\n                assigned_to: action.assigned_to,\n                assigned_to_name: action.assigned_to_name\n            }\n        },\n        async save() {\n            try {\n                if (this.newAction.id) {\n                    await this.$store.dispatch(\n                        'applications/updateNextAction',\n                        {\n                            application: this.application,\n                            updatedAction: this.newAction,\n                        }\n                    );\n                    this.$emit('saved')\n                    this.clearForm();\n                } else {\n                    await this.$store.dispatch(\n                        'applications/addNextAction',\n                        {\n                            application: this.application,\n                            nextActionData: this.newAction\n                        }\n                    );\n                    this.$emit('saved')\n                    this.clearForm();\n                }\n            } catch (error) {\n                if (error.response && Number.parseInt(error.response.status) === 422 && error.response.data.errors) {\n                    this.errors = error.response.data.errors\n                }\n            }\n        },\n    }\n}\n</script>\n<template>\n  <form-container>\n    <input-row v-model=\"newAction.date_created\" label=\"Creation Date\" :errors=\"errors.date_created\" type=\"date\" />\n\n    <StepInput v-if=\"application.expert_panel_type_id == 2\" v-model=\"newAction.step\" :errors=\"errors.step\" />\n\n    <input-row v-model=\"newAction.target_date\" label=\"Target Date\" :errors=\"errors.target_date\" type=\"date\" />\n\n    <input-row label=\"Entry\" :errors=\"errors.entry\">\n      <RichTextEditor v-model=\"newAction.entry\" />\n    </input-row>\n\n    <input-row label=\"Assigned To\" :errors=\"assignmentErrors\">\n      <select id=\"\" v-model=\"newAction.assigned_to\">\n        <option :value=\"null\">\n          Select...\n        </option>\n        <option\n          v-for=\"i in assignees\" :key=\"i.id\"\n          :value=\"i.id\"\n        >\n          {{ i.name }}\n        </option>\n      </select>\n            &nbsp;&nbsp;\n      <input v-model=\"newAction.assigned_to_name\" type=\"text\" label=\"Name\" placeholder=\"Name (optional)\">\n    </input-row>\n\n    <div class=\"ml-4\" />\n\n    <checkbox\n      v-model=\"completed\"\n      label=\"This is already completed\"\n      class=\"ml-36\"\n    />\n\n    <input-row v-if=\"completed\" label=\"Date Completed\" :errors=\"errors.date_completed\" class=\"ml-36\">\n      <input v-model=\"newAction.date_completed\" type=\"date\">\n    </input-row>\n\n    <button-row>\n      <button class=\"btn\" @click=\"cancel\">\n        Cancel\n      </button>\n      <button class=\"btn blue\" @click=\"save\">\n        Save\n      </button>\n    </button-row>\n  </form-container>\n</template>\n"],"names":["_sfc_main","StepInput","RichTextEditor","mapGetters","errors","configs","action","i","formatDate","error","_hoisted_1","_createBlock","_component_form_container","_withCtx","_createVNode","_component_input_row","$data","_cache","$event","$options","_component_StepInput","_createCommentVNode","_component_RichTextEditor","_createElementVNode","_openBlock","_createElementBlock","_Fragment","_renderList","_vModelSelect","_createTextVNode","_vModelText","_component_checkbox","_component_button_row","args"],"mappings":"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"}