import{_ as v,a as g,c as l,b as t,f as u,d as c,w as o,F as _,m as w,j as f,e as k,i as p,h as D,a9 as R,C as S,D as E,a1 as V,p as M,a4 as T,aa as x}from"./app-Cv_muMPT.js";import{s as F}from"./router_aware_sort_and_filter-DfeIEInP.js";import{C as j}from"./CustomEmailForm-DXYuF9xk.js";const B={name:"MailDetail",props:{mail:{type:Object,required:!0}},emits:["resend"],data(){return{}},computed:{},methods:{}},L={class:"flex-none"},N={key:1},P={key:1},U=["innerHTML"],A={class:"mt-2 border-t pt-2 text-right"};function z(a,e,n,b,r,d){const m=g("dictionary-row"),y=g("note");return t(),l("div",null,[u(m,{label:"To","label-class":"font-bold w-36",class:"mb-1 border-b"},{default:o(()=>[c("div",L,[(t(!0),l(_,null,w(n.mail.to,s=>(t(),l("div",{key:s.address},f(s.address),1))),128))])]),_:1}),u(m,{label:"From","label-class":"font-bold w-36",class:"mb-1 border-b"},{default:o(()=>[(t(!0),l(_,null,w(n.mail.from,s=>(t(),l("div",{key:s.address},f(s.address),1))),128))]),_:1}),u(m,{label:"Cc","label-class":"font-bold w-36",class:"mb-1 border-b"},{default:o(()=>[n.mail.cc?(t(),l("ul",N,[(t(!0),l(_,null,w(n.mail.cc,s=>(t(),l("li",{key:s.address},f(s.address),1))),128))])):(t(),k(y,{key:0},{default:o(()=>e[1]||(e[1]=[p(" -- ")])),_:1}))]),_:1}),u(m,{label:"Bcc","label-class":"font-bold w-36",class:"mb-1 border-b"},{default:o(()=>[n.mail.bcc?(t(),l("ul",P,[(t(!0),l(_,null,w(n.mail.bcc,s=>(t(),l("li",{key:s.address},f(s.address),1))),128))])):(t(),k(y,{key:0},{default:o(()=>e[2]||(e[2]=[p(" -- ")])),_:1}))]),_:1}),u(m,{label:"Subject","label-class":"font-bold w-36",class:"mb-1 border-b"},{default:o(()=>[p(f(n.mail.subject),1)]),_:1}),u(m,{label:"Body","label-class":"font-bold w-36",class:"mb-1"},{default:o(()=>[c("div",{class:"email-body w-3/4",innerHTML:n.mail.body},null,8,U)]),_:1}),c("div",A,[c("button",{class:"btn",onClick:e[0]||(e[0]=s=>a.$emit("resend"))}," Resend ")])])}const H=v(B,[["render",z]]),I={components:{CustomEmailForm:j,MailDetail:H},props:{},setup(){const{sort:a,filter:e}=F({field:"created_at",desc:!0});return{sort:a,filter:e}},data(){return{showDetail:!1,fields:[{name:"to",sortable:!0,type:Array,resolveValue(a){const e=Object.keys(a.to);return e.length===0?"":e.length===1?e[0]:e.join("; ")}},{name:"subject",sortable:!0,type:String},{name:"created_at",label:"Sent at",sortable:!0,resolveValue(a){return x(a.created_at)},resolveSort(a){return a.created_at},type:String},{name:"actions",label:"",sortable:!1}],data:[],currentEmail:{},showResendDialog:!1}},watch:{filter:{immediate:!0,handler(){this.triggerSearch&&this.triggerSearch()}},sort:{deep:!0,immediate:!0,handler(){this.triggerSearch&&this.triggerSearch()}}},created(){this.triggerSearch=T(()=>this.$refs.dataTable.getItems(),500)},methods:{async getPage(a,e,n,b){try{const r={page:a,page_size:e,"sort[field]":n.field.name,"sort[dir]":n.desc?"DESC":"ASC","where[filterString]":this.filter},d=await M.get("/api/mail-log",{params:r}).then(m=>m.data);return b(d.total),d.data}catch(r){alert(r)}},showMailDetail(a){this.currentEmail=a,this.showDetail=!0},initResend(a){this.currentEmail=a,this.showResendDialog=!0},cleanupResend(){this.currentEmail={},this.showResendDialog=!1,this.$refs.dataTable.getItems()}}},O={class:"mb-2"},q={key:0},G=["onClick"];function J(a,e,n,b,r,d){const m=g("data-table"),y=g("MailDetail"),s=g("modal-dialog"),C=g("CustomEmailForm");return t(),l("div",null,[e[6]||(e[6]=c("h1",null,"Mail Log",-1)),u(m,{ref:"dataTable",sort:b.sort,"onUpdate:sort":e[1]||(e[1]=i=>b.sort=i),fields:r.fields,data:d.getPage,"row-class":"cursor-pointer","row-click-handler":d.showMailDetail,"page-size":20,paginated:""},{header:o(()=>[c("div",O,[e[5]||(e[5]=p(" Filter: ")),S(c("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>b.filter=i),type:"text"},null,512),[[E,b.filter]])])]),"cell-to":o(({item:i})=>[c("ul",null,[(t(!0),l(_,null,w(i.to,h=>(t(),l("li",{key:h.address},[h.name?(t(),l("span",q,f(h.name)+" - ",1)):D("",!0),p(" "+f(h.address),1)]))),128))])]),"cell-actions":o(({item:i})=>[c("div",null,[a.hasPermission("people-manage")?(t(),l("button",{key:0,class:"btn btn-xs",onClick:R(h=>d.initResend(i),["stop"])}," Resend ",8,G)):D("",!0)])]),_:1},8,["sort","fields","data","row-click-handler"]),(t(),k(V,{to:"body"},[u(s,{modelValue:r.showDetail,"onUpdate:modelValue":e[3]||(e[3]=i=>r.showDetail=i)},{default:o(()=>[a.hasPermission("people-manage")?(t(),k(y,{key:0,mail:r.currentEmail,onResend:e[2]||(e[2]=i=>d.initResend(r.currentEmail))},null,8,["mail"])):D("",!0)]),_:1},8,["modelValue"]),u(s,{modelValue:r.showResendDialog,"onUpdate:modelValue":e[4]||(e[4]=i=>r.showResendDialog=i),title:"Resend Email"},{default:o(()=>[u(C,{"mail-data":r.currentEmail,onSent:d.cleanupResend,onCanceled:d.cleanupResend},null,8,["mail-data","onSent","onCanceled"])]),_:1},8,["modelValue"])]))])}const X=v(I,[["render",J]]);export{X as default};
//# sourceMappingURL=MailLog-Bm-ryoTW.js.map
