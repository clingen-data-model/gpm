import{s as M}from"./router_aware_sort_and_filter-9Sdst5yH.js";import{_ as g,aY as S,c as v,i as s,f as o,w as i,j as I,a,b as h,a2 as _,aZ as A,a_ as x,a$ as k,b0 as U,b1 as E,b2 as F,d as p,e as N,C as O,D as B,a1 as Y,b3 as j,b4 as T}from"./app-xtqLUWuO.js";const q={name:"ComponentName",props:{modelValue:{type:Object,required:!0}},emits:["saved","canceled","update:modelValue"],methods:{async approve(){const t=await S(this.modelValue);this.$emit("update:modelValue",t),this.$emit("saved",t)},cancelApproval(){this.$emit("canceled")}}};function L(t,e,d,m,n,r){const u=a("dictionary-row"),c=a("button-row");return h(),v("div",null,[e[0]||(e[0]=s(" Are you sure you want to approve this institution? ")),o(u,{label:"Name"},{default:i(()=>[s(I(d.modelValue.name),1)]),_:1}),o(u,{label:"Abbreviation"},{default:i(()=>[s(I(d.modelValue.abbreviation||"--"),1)]),_:1}),o(u,{label:"URL"},{default:i(()=>[s(I(d.modelValue.url||"--"),1)]),_:1}),o(u,{label:"Country"},{default:i(()=>[s(I(d.modelValue.country?d.modelValue.country.name:"--"),1)]),_:1}),o(u,{label:"Reportable"},{default:i(()=>[s(I(d.modelValue.reportable?"Yes":"No"),1)]),_:1}),o(c,{"submit-text":"Approve",onSubmitted:r.approve,onCancel:r.cancelApproval},null,8,["onSubmitted","onCancel"])])}const R=g(q,[["render",L]]),P={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],setup(t,e){const{workingCopy:d}=A(t,e);return{fields:E,getCountries:U,countries:k,updateInstitution:x,workingCopy:d}},data(){return{errors:{}}},mounted(){this.getCountries()},methods:{async save(){try{this.initErrors();const t=await this.updateInstitution(this.workingCopy);this.$emit("update:modelValue",t),this.$emit("saved",t)}catch(t){_(t)&&(this.errors=t.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}}};function z(t,e,d,m,n,r){const u=a("data-form"),c=a("button-row");return h(),v("div",null,[o(u,{modelValue:m.workingCopy,"onUpdate:modelValue":e[0]||(e[0]=b=>m.workingCopy=b),fields:m.fields,errors:n.errors},null,8,["modelValue","fields","errors"]),o(c,{"submit-text":"Save",onSubmitted:r.save,onCancel:r.cancel},null,8,["onSubmitted","onCancel"])])}const Z=g(P,[["render",z]]),G={name:"InstitutionMergeForm",props:{authority:{type:Object,required:!1},obsoletes:{type:Array,default:()=>[]}},emits:["saved","canceled"],data(){return{authorityId:null,obsoleteIds:[],errors:{}}},watch:{authority:{immediate:!0,handler(t){t&&(this.authorityId=t.id)}},obsoletes:{immediate:!0,deep:!0,handler(t){this.obsoleteIds=t.map(e=>e.id)}}},methods:{handleObsoleteUpdate(t){if(!t){this.obsoleteIds=[];return}this.obsoleteIds=[t]},async commitMerge(){try{this.errors={},await F(this.authorityId,this.obsoleteIds),this.authorityId=null,this.obsoleteIds=[],this.$emit("saved")}catch(t){_(t)&&(this.errors=t.response.data.errors)}},cancelMerge(){this.authorityId=null,this.obsoleteIds=[],this.$emit("canceled")}}};function H(t,e,d,m,n,r){const u=a("note"),c=a("institution-search-select"),b=a("input-row"),w=a("button-row");return h(),v("div",null,[e[5]||(e[5]=p("p",{class:"mb-8"},[s(" Merging institutions will do the following: "),p("ol",{class:"list-decimal ml-6"},[p("li",null,"Transfer all people with the obsolete institution to the authoritiative institution."),p("li",null,"Delete the obsolete institution.")])],-1)),o(b,{label:"Merge",vertical:""},{label:i(()=>[e[2]||(e[2]=s(" Merge ")),o(u,{class:"inline-block"},{default:i(()=>e[1]||(e[1]=[s(" (Obsolete institution that will be deleted) ")])),_:1})]),default:i(()=>[o(c,{"model-value":n.obsoleteIds,"allow-add":!1,"onUpdate:modelValue":r.handleObsoleteUpdate},null,8,["model-value","onUpdate:modelValue"])]),_:1}),o(b,{label:"Into",errors:n.errors.authority_id,vertical:""},{label:i(()=>[e[4]||(e[4]=s(" Into ")),o(u,{class:"inline"},{default:i(()=>e[3]||(e[3]=[s(" (Authoritative institution) ")])),_:1})]),default:i(()=>[o(c,{modelValue:n.authorityId,"onUpdate:modelValue":e[0]||(e[0]=f=>n.authorityId=f),"allow-add":!1},null,8,["modelValue"])]),_:1},8,["errors"]),o(w,{"submit-text":"Merge",onSubmitted:r.commitMerge,onCanceled:r.cancelMerge},null,8,["onSubmitted","onCanceled"])])}const J=g(G,[["render",H]]),K={name:"InstitutionList",components:{InstitutionUpdateForm:Z,InstitutionApprovalForm:R,InstitutionMergeForm:J},setup(){const{sort:t,filter:e}=M({field:"name",desc:!1});return{sort:t,filter:e}},data(){return{items:[],fields:[{name:"id",label:"ID",type:Number,sortable:!0},{name:"name",type:String,sortable:!0},{name:"abbreviation",type:String,sortable:!0},{name:"country.name",label:"Country",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"approved",type:Boolean,sortable:!0,resolveValue(t){return t.approved?"Approved":null},resolveSort(t){return t.approved}},{name:"actions",label:"",sortable:!1}],currentItem:{country:{}},showApproveDialog:!1,showEditDialog:!1,showMergeDialog:!1,showDeleteConfirmation:!1}},computed:{filteredItems(){if(!this.filter)return this.items;const t=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter(e=>e.name.match(t)||e.abbreviation&&e.abbreviation.match(t)||e.country&&e.country.name.match(t))},currentIndex(){return this.items.findIndex(t=>t.id===this.currentItem.id)}},mounted(){this.getInstitutions()},methods:{edit(t){this.showEditDialog=!0,this.currentItem=t},initApprove(t){this.showApproveDialog=!0,this.currentItem=t},initMerge(t){this.currentItem=t,this.showMergeDialog=!0},async getInstitutions(){this.items=await T()},handleSaved(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}},this.$store.commit("pushSuccess","Institution saved.")},handleCancel(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},handleMerge(){this.items.splice(this.currentIndex,1),this.showMergeDialog=!1,this.$store.commit("pushSuccess","Institution merged.")},updateItem(){this.currentItem.id&&this.currentIndex>-1&&(this.items[this.currentIndex]={...this.currentItem})},initDelete(t){this.showDeleteConfirmation=!0,this.currentItem=t},async deleteItem(){this.currentItem.id&&(this.currentItem.people_count>0&&alert("You cannot delete an institution because it is in use.  Please edit the institution or merge it into another."),await j(this.currentItem),this.items.splice(this.currentIndex,1),this.showDeleteConfirmation=!1,this.$store.commit("pushSuccess",`${this.currentItem.name} deleted.`))}}},Q={key:0},W={key:1};function X(t,e,d,m,n,r){const u=a("dropdown-item"),c=a("dropdown-menu"),b=a("data-table"),w=a("InstitutionApprovalForm"),f=a("modal-dialog"),V=a("InstitutionUpdateForm"),C=a("InstitutionMergeForm"),D=a("button-row");return h(),v("div",null,[e[17]||(e[17]=p("h1",null,"Institutions",-1)),o(b,{sort:m.sort,"onUpdate:sort":e[1]||(e[1]=l=>m.sort=l),paginated:"",data:r.filteredItems,fields:n.fields,"reset-page-on-data-change":!1},{header:i(()=>[p("label",null,[e[10]||(e[10]=s(" Filter: ")),O(p("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>m.filter=l),type:"text"},null,512),[[B,m.filter]])])]),"cell-actions":i(({item:l})=>[o(c,{"hide-cheveron":""},{label:i(()=>e[11]||(e[11]=[p("button",{class:"btn btn-xs"}," â€¦ ",-1)])),default:i(()=>[o(u,{onClick:y=>r.edit(l)},{default:i(()=>e[12]||(e[12]=[s(" Edit ")])),_:2},1032,["onClick"]),o(u,{onClick:y=>r.initApprove(l)},{default:i(()=>e[13]||(e[13]=[s(" Approve ")])),_:2},1032,["onClick"]),o(u,{onClick:y=>r.initMerge(l)},{default:i(()=>e[14]||(e[14]=[s(" Merge into another ")])),_:2},1032,["onClick"]),o(u,{onClick:y=>r.initDelete(l)},{default:i(()=>e[15]||(e[15]=[s(" Delete ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["sort","data","fields"]),(h(),N(Y,{to:"body"},[o(f,{modelValue:n.showApproveDialog,"onUpdate:modelValue":e[3]||(e[3]=l=>n.showApproveDialog=l),title:`Approve ${n.currentItem.name}`},{default:i(()=>[o(w,{modelValue:n.currentItem,"onUpdate:modelValue":e[2]||(e[2]=l=>n.currentItem=l),onSaved:r.handleSaved,onCanceled:r.handleCancel},null,8,["modelValue","onSaved","onCanceled"])]),_:1},8,["modelValue","title"]),o(f,{modelValue:n.showEditDialog,"onUpdate:modelValue":e[5]||(e[5]=l=>n.showEditDialog=l),title:`Edit ${n.currentItem.name}`},{default:i(()=>[o(V,{modelValue:n.currentItem,"onUpdate:modelValue":e[4]||(e[4]=l=>n.currentItem=l),onSaved:r.handleSaved,onCanceled:r.handleCancel},null,8,["modelValue","onSaved","onCanceled"])]),_:1},8,["modelValue","title"]),o(f,{modelValue:n.showMergeDialog,"onUpdate:modelValue":e[7]||(e[7]=l=>n.showMergeDialog=l),title:"Merge Institutions"},{default:i(()=>[o(C,{obsoletes:[n.currentItem],onSaved:r.handleMerge,onCanceled:e[6]||(e[6]=l=>n.showMergeDialog=!1)},null,8,["obsoletes","onSaved"])]),_:1},8,["modelValue"]),o(f,{modelValue:n.showDeleteConfirmation,"onUpdate:modelValue":e[9]||(e[9]=l=>n.showDeleteConfirmation=l),title:"Delete Institution",size:"sm"},{default:i(()=>[n.currentItem.people_count>0?(h(),v("div",Q,e[16]||(e[16]=[p("p",null,"You cannot delete an institution people are using.",-1),p("p",null,"Either edit this this institution or merge it into another.",-1)]))):(h(),v("div",W,[s(" You are about to delete the "+I(n.currentItem.name)+" ",1),o(D,{"submit-text":"Delete",onSubmitted:r.deleteItem,onCanceled:e[8]||(e[8]=l=>n.showDeleteConfirmation=!1)},null,8,["onSubmitted"])]))]),_:1},8,["modelValue"])]))])}const te=g(K,[["render",X]]);export{te as default};
//# sourceMappingURL=InstitutionList-VVFDveO_.js.map
