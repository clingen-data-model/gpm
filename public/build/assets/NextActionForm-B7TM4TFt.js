import{_ as V,B as b,an as v,ao as N,a as l,e as u,b as d,w as p,f as r,h as _,d as i,C as c,i as C,c as A,F as k,m as D,j as U,Z as F,D as w,am as m,A as T}from"./app-CnEAf7X7.js";const E={name:"NextActionForm",components:{StepInput:N,RichTextEditor:v},props:{id:{required:!1,default:null}},emits:["saved","closed","formCleared","canceled"],data(){return{errors:{},newAction:{date_created:new Date,step:null,date_completed:null,entry:"",assigned_to:null,assigned_to_name:null},completed:!1}},computed:{...b({group:"groups/currentItemOrNew"}),application(){return this.group.expert_panel},title(){return this.newAction.id?"Update Action":"Add Next Action"},steps(){return[1,2,3,4]},assignmentErrors(){let e=[];return this.errors.assigned_to&&(e=[...e,...this.errors.assigned_to]),this.errors.assigned_to_name&&(e=[...e,...this.errors.assigned_to_name]),e},assignees(){return Object.values(T.nextActions.assignees)}},watch:{id:{immediate:!0,handler(){const e=this.findAction();e&&this.syncAction(e)}},application:{immediate:!0,handler(){const e=this.findAction();e&&this.syncAction(e)}}},unmounted(){this.initNewAction()},mounted(){},methods:{cancel(){this.clearForm(),this.$emit("canceled")},clearForm(){this.initNewAction(),this.$emit("formCleared")},initNewAction(){this.newAction={date_created:new Date,step:null,target_date:null,date_completed:null,entry:"",assigned_to:null,assigned_to_name:null}},findAction(){if(this.id===null)return null;if(this.application.next_actions)return this.application.next_actions.find(e=>e.id===+this.id)},syncAction(e){e&&(this.newAction={id:e.id,uuid:e.uuid,date_created:m(e.created_at),step:e.step,target_date:m(e.target_date),date_completed:m(e.date_completed),entry:e.entry??"",assigned_to:e.assigned_to,assigned_to_name:e.assigned_to_name})},async save(){try{this.newAction.id?(await this.$store.dispatch("applications/updateNextAction",{application:this.application,updatedAction:this.newAction}),this.$emit("saved"),this.clearForm()):(await this.$store.dispatch("applications/addNextAction",{application:this.application,nextActionData:this.newAction}),this.$emit("saved"),this.clearForm())}catch(e){e.response&&Number.parseInt(e.response.status)===422&&e.response.data.errors&&(this.errors=e.response.data.errors)}}}},S=["value"];function B(e,t,I,R,o,s){const a=l("input-row"),f=l("StepInput"),g=l("RichTextEditor"),h=l("checkbox"),x=l("button-row"),y=l("form-container");return d(),u(y,null,{default:p(()=>[r(a,{modelValue:o.newAction.date_created,"onUpdate:modelValue":t[0]||(t[0]=n=>o.newAction.date_created=n),label:"Creation Date",errors:o.errors.date_created,type:"date"},null,8,["modelValue","errors"]),s.application.expert_panel_type_id==2?(d(),u(f,{key:0,modelValue:o.newAction.step,"onUpdate:modelValue":t[1]||(t[1]=n=>o.newAction.step=n),errors:o.errors.step},null,8,["modelValue","errors"])):_("",!0),r(a,{modelValue:o.newAction.target_date,"onUpdate:modelValue":t[2]||(t[2]=n=>o.newAction.target_date=n),label:"Target Date",errors:o.errors.target_date,type:"date"},null,8,["modelValue","errors"]),r(a,{label:"Entry",errors:o.errors.entry},{default:p(()=>[r(g,{modelValue:o.newAction.entry,"onUpdate:modelValue":t[3]||(t[3]=n=>o.newAction.entry=n)},null,8,["modelValue"])]),_:1},8,["errors"]),r(a,{label:"Assigned To",errors:s.assignmentErrors},{default:p(()=>[c(i("select",{id:"","onUpdate:modelValue":t[4]||(t[4]=n=>o.newAction.assigned_to=n)},[t[10]||(t[10]=i("option",{value:null}," Select... ",-1)),(d(!0),A(k,null,D(s.assignees,n=>(d(),A("option",{key:n.id,value:n.id},U(n.name),9,S))),128))],512),[[F,o.newAction.assigned_to]]),t[11]||(t[11]=C("    ")),c(i("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>o.newAction.assigned_to_name=n),type:"text",label:"Name",placeholder:"Name (optional)"},null,512),[[w,o.newAction.assigned_to_name]])]),_:1},8,["errors"]),t[12]||(t[12]=i("div",{class:"ml-4"},null,-1)),r(h,{modelValue:o.completed,"onUpdate:modelValue":t[6]||(t[6]=n=>o.completed=n),label:"This is already completed",class:"ml-36"},null,8,["modelValue"]),o.completed?(d(),u(a,{key:1,label:"Date Completed",errors:o.errors.date_completed,class:"ml-36"},{default:p(()=>[c(i("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>o.newAction.date_completed=n),type:"date"},null,512),[[w,o.newAction.date_completed]])]),_:1},8,["errors"])):_("",!0),r(x,null,{default:p(()=>[i("button",{class:"btn",onClick:t[8]||(t[8]=(...n)=>s.cancel&&s.cancel(...n))}," Cancel "),i("button",{class:"btn blue",onClick:t[9]||(t[9]=(...n)=>s.save&&s.save(...n))}," Save ")]),_:1})]),_:1})}const M=V(E,[["render",B]]);export{M as default};
//# sourceMappingURL=NextActionForm-B7TM4TFt.js.map
