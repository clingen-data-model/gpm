import{_ as y,N as E,c as w,b as h,C as m,D as g,d,a7 as x,p as B,L as v,a as u,f as s,w as n,h as S,S as C,j as b,i as R}from"./app-Dodz6L5-.js";const F={name:"RecipientInput",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],data(){return{newRecipients:[]}},computed:{recipientsString:{get(){return this.modelValue?this.modelValue.map(o=>o.address).join(`
`):""},set(o){this.debounceInput(o)}}},created(){this.debounceInput=E(o=>{const r=/[\n,;]/,a=o.split(r).map(i=>({name:null,address:i.trim()})).filter(i=>i.address!==null);this.$emit("update:modelValue",a)},1e3)},methods:{}};function j(o,r,a,i,e,l){return h(),w("div",null,[m(d("textarea",{"onUpdate:modelValue":r[0]||(r[0]=p=>l.recipientsString=p),rows:"5",class:"w-full"},null,512),[[g,l.recipientsString]])])}const D=y(F,[["render",j]]),A={name:"CustomEmailForm",components:{RecipientInput:D,RichTextEditor:x},props:{mailData:{type:Object,required:!1}},emits:["sent","canceled"],data(){return{workingCopy:{},showBcc:!1,showCc:!1,errors:{}}},computed:{toErrors(){return this.assembleErrorsForAddressField("to")},ccErrors(){return this.assembleErrorsForAddressField("cc")},bccErrors(){return this.assembleErrorsForAddressField("bcc")}},watch:{mailData:{immediate:!0,handler(o){this.workingCopy=o||{},this.showCc=!1,this.workingCopy.cc!==null&&this.workingCopy.cc!=[]&&(this.showCc=!0),this.showBcc=!1,this.workingCopy.bcc!==null&&this.workingCopy.bcc!=[]&&(this.showBcc=!0)}}},methods:{async sendMail(){try{this.cleanData(),await B.post("/api/mail",this.workingCopy),this.$emit("sent"),this.errors={}}catch(o){if(v(o)){this.errors=o.response.data.errors;return}throw o}},cleanData(){this.workingCopy.to=this.workingCopy.to?this.workingCopy.to.filter(o=>o.address!==""):null,this.workingCopy.cc=this.workingCopy.cc?this.workingCopy.cc.filter(o=>o.address!==""):null,this.workingCopy.bcc=this.workingCopy.bcc?this.workingCopy.bcc.filter(o=>o.address!==""):null},assembleErrorsForAddressField(o){let r=[];const a=new RegExp(`${o}.\\d+.address`);return Object.keys(this.errors).filter(e=>e.match(a)).forEach(e=>{r=[...r,...this.errors[e]]}),[...new Set([...this.errors.to||[],...r])]}}},I={key:0};function T(o,r,a,i,e,l){const p=u("RecipientInput"),c=u("input-row"),f=u("truncate-expander"),k=u("RichTextEditor"),V=u("note"),_=u("button-row");return h(),w("div",null,[s(c,{label:"To",errors:l.toErrors},{default:n(()=>[s(p,{modelValue:e.workingCopy.to,"onUpdate:modelValue":r[0]||(r[0]=t=>e.workingCopy.to=t)},null,8,["modelValue"])]),_:1},8,["errors"]),s(c,{label:"Cc",errors:e.errors.ccErrors},{default:n(()=>[m(s(p,{modelValue:e.workingCopy.cc,"onUpdate:modelValue":r[1]||(r[1]=t=>e.workingCopy.cc=t)},null,8,["modelValue"]),[[C,e.showCc]]),e.workingCopy.cc&&e.workingCopy.cc.length>0&&!e.showCc?(h(),w("div",I,[s(f,{value:e.workingCopy.cc.map(t=>t.address).join(", "),"truncate-length":100},null,8,["value"])])):S("",!0),d("button",{class:"btn btn-xs",onClick:r[2]||(r[2]=t=>e.showCc=!e.showCc)},b(e.showCc?"Hide Cc":"Show Cc"),1)]),_:1},8,["errors"]),s(c,{label:"Bcc",errors:l.bccErrors},{default:n(()=>[m(s(p,{modelValue:e.workingCopy.bcc,"onUpdate:modelValue":r[3]||(r[3]=t=>e.workingCopy.bcc=t)},null,8,["modelValue"]),[[C,e.showBcc]]),d("button",{class:"btn btn-xs",onClick:r[4]||(r[4]=t=>e.showBcc=!e.showBcc)},b(e.showBcc?"Hide Bcc":"Show Bcc"),1)]),_:1},8,["errors"]),s(c,{label:"Subject",errors:e.errors.subject},{default:n(()=>[m(d("input",{"onUpdate:modelValue":r[5]||(r[5]=t=>e.workingCopy.subject=t),type:"text",class:"w-full"},null,512),[[g,e.workingCopy.subject]])]),_:1},8,["errors"]),s(c,{label:"Body",errors:e.errors.body},{default:n(()=>[s(k,{modelValue:e.workingCopy.body,"onUpdate:modelValue":r[6]||(r[6]=t=>e.workingCopy.body=t)},null,8,["modelValue"])]),_:1},8,["errors"]),s(c,{label:"Attachments",errors:e.errors.attachments},{default:n(()=>[r[9]||(r[9]=d("input",{type:"file",multiple:""},null,-1)),s(V,{class:"mt-2"},{default:n(()=>r[8]||(r[8]=[R(' Please note that if you are "Resending" an email, any attachments on the original email must be re-added. ')])),_:1})]),_:1},8,["errors"]),s(_,{"submit-text":"Send",onSubmitted:l.sendMail,onCancel:r[7]||(r[7]=t=>o.$emit("canceled"))},null,8,["onSubmitted"])])}const N=y(A,[["render",T]]);export{N as C};
//# sourceMappingURL=CustomEmailForm-xsgeg_NA.js.map
