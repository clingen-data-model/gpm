{"version":3,"file":"PeopleList-BlNkg9Ex.js","sources":["../../../resources/js/composables/pagination.js","../../../resources/js/views/PeopleList.vue"],"sourcesContent":["import {ref} from 'vue'\n\nexport const pageSize = 20;\nexport const currentPage = ref(0);\n\nexport const getPageItems = (allItems) => {\n    const startIndex = currentPage.value * pageSize;\n    const endIndex = startIndex + pageSize - 1;\n    return allItems.slice(startIndex, endIndex);\n}\n\n","<script>\nimport { debounce } from 'lodash-es'\nimport { mapGetters } from 'vuex'\nimport {api} from '@/http'\nimport SortAndFilter from './../composables/router_aware_sort_and_filter';\nimport {pageSize, currentPage, getPageItems} from '@/composables/pagination'\n\nconst fields = [\n                {\n                    name: 'name',\n                    sortable: true,\n                    type: String\n                },\n                {\n                    name: 'email',\n                    sortable: true,\n                    type: String\n                },\n                {\n                    name: 'institution.name',\n                    label: 'Institution',\n                    sortable: true,\n                    type: String,\n                    resolveSort (item) {\n                        return item.institution ? item.institution.name : '';\n                    }\n                }\n            ];\n\nexport default {\n    data() {\n        return {\n            fields\n        }\n    },\n    computed: {\n        ...mapGetters({\n            currentUser: 'currentUser'\n        }),\n    },\n    watch: {\n        filter: {\n            immediate: true,\n            handler () {\n                if (this.triggerSearch) {\n                    this.triggerSearch();\n                }\n            }\n        },\n        sort: {\n            immediate: true,\n            handler () {\n                if (this.triggerSearch) {\n                    this.triggerSearch();\n                }\n            }\n        }\n    },\n    created() {\n        if (this.triggerSearch) {\n            this.triggerSearch();\n        }\n        this.triggerSearch = debounce(() => this.$refs.dataTable.getItems(), 500)\n    },\n    methods: {\n        goToPerson (person) {\n            this.$router.push(`/people/${person.uuid}`)\n        },\n        goToEditPerson (person) {\n            this.$router.push(`/people/${person.uuid}/edit`)\n        },\n        canEdit(person) {\n            if (this.hasPermission('people-manage')) {\n                return true;\n            }\n            if (Number.parseInt(this.currentUser.id) === Number.parseInt(person.user_id)) {\n                return true;\n            }\n\n            return false;\n        },\n        async itemProvider (currentPage, pageSize, sort, setTotalItems) {\n            const params = {\n                page: currentPage,\n                page_size: pageSize,\n                'sort[field]': sort.field.name,\n                'sort[dir]': sort.desc ? 'DESC' : 'ASC',\n                'where[filterString]': this.filter\n            }\n            const pageResponse = await api.get(`/api/people`, {params})\n                .then(rsp => rsp.data);\n            setTotalItems(pageResponse.meta.total);\n            return pageResponse.data;\n        }\n    },\n    setup() {\n        const {sort, filter} = SortAndFilter();\n\n        return {\n            sort, filter,\n            pageSize, currentPage, getPageItems\n        }\n    }\n}\n</script>\n<template>\n  <div>\n    <h1>People</h1>\n    <data-table\n      ref=\"dataTable\"\n      v-model:sort=\"sort\"\n      :data=\"itemProvider\"\n      :fields=\"fields\"\n      class=\"width-full\"\n      :row-click-handler=\"goToPerson\"\n      row-class=\"cursor-pointer\"\n      :page-size=\"20\"\n      paginated\n    >\n      <template #header>\n        <label class=\"block mb-2\" for=\"filter-input\">Filter:&nbsp;<input v-model=\"filter\" type=\"text\" placeholder=\"filter\"></label>\n      </template>\n    </data-table>\n  </div>\n</template>\n"],"names":["pageSize","currentPage","ref","getPageItems","allItems","startIndex","endIndex","fields","item","_sfc_main","mapGetters","debounce","person","sort","setTotalItems","params","pageResponse","api","rsp","filter","SortAndFilter","_createElementBlock","_cache","_createElementVNode","_createVNode","_component_data_table","$setup","$event","$options","$data","_hoisted_1","_createTextVNode"],"mappings":"iMAEO,MAAMA,EAAW,GACXC,EAAcC,EAAI,CAAC,EAEnBC,EAAgBC,GAAa,CACtC,MAAMC,EAAaJ,EAAY,MAAQD,EACjCM,EAAWD,EAAaL,EAAW,EACzC,OAAOI,EAAS,MAAMC,EAAYC,CAAQ,CAC9C,ECFMC,EAAS,CACC,CACI,KAAM,OACN,SAAU,GACV,KAAM,MACT,EACD,CACI,KAAM,QACN,SAAU,GACV,KAAM,MACT,EACD,CACI,KAAM,mBACN,MAAO,cACP,SAAU,GACV,KAAM,OACN,YAAaC,EAAM,CACf,OAAOA,EAAK,YAAcA,EAAK,YAAY,KAAO,EACtD,CACJ,CACH,EAERC,EAAU,CACX,MAAO,CACH,MAAO,CACH,OAAAF,CACJ,CACH,EACD,SAAU,CACN,GAAGG,EAAW,CACV,YAAa,aACjB,CAAC,CACJ,EACD,MAAO,CACH,OAAQ,CACJ,UAAW,GACX,SAAW,CACH,KAAK,eACL,KAAK,cAAe,CAE5B,CACH,EACD,KAAM,CACF,UAAW,GACX,SAAW,CACH,KAAK,eACL,KAAK,cAAe,CAE5B,CACJ,CACH,EACD,SAAU,CACF,KAAK,eACL,KAAK,cAAe,EAExB,KAAK,cAAgBC,EAAS,IAAM,KAAK,MAAM,UAAU,SAAQ,EAAI,GAAG,CAC3E,EACD,QAAS,CACL,WAAYC,EAAQ,CAChB,KAAK,QAAQ,KAAK,WAAWA,EAAO,IAAI,EAAE,CAC7C,EACD,eAAgBA,EAAQ,CACpB,KAAK,QAAQ,KAAK,WAAWA,EAAO,IAAI,OAAO,CAClD,EACD,QAAQA,EAAQ,CAIZ,MAHI,QAAK,cAAc,eAAe,GAGlC,OAAO,SAAS,KAAK,YAAY,EAAE,IAAM,OAAO,SAASA,EAAO,OAAO,EAK9E,EACD,MAAM,aAAcX,EAAaD,EAAUa,EAAMC,EAAe,CAC5D,MAAMC,EAAS,CACX,KAAMd,EACN,UAAWD,EACX,cAAea,EAAK,MAAM,KAC1B,YAAaA,EAAK,KAAO,OAAS,MAClC,sBAAuB,KAAK,MAChC,EACMG,EAAe,MAAMC,EAAI,IAAI,cAAe,CAAC,OAAAF,CAAM,CAAC,EACrD,KAAKG,GAAOA,EAAI,IAAI,EACzB,OAAAJ,EAAcE,EAAa,KAAK,KAAK,EAC9BA,EAAa,IACxB,CACH,EACD,OAAQ,CACJ,KAAM,CAAC,KAAAH,EAAM,OAAAM,CAAM,EAAIC,EAAe,EAEtC,MAAO,CACH,KAAAP,EAAM,OAAAM,EACN,SAAAnB,EAAU,YAAAC,EAAa,aAAAE,CAC3B,CACJ,CACJ,KAiBe,MAAM,aAAa,IAAI,2EAdpCkB,EAiBM,MAAA,KAAA,CAhBJC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAe,UAAX,SAAM,EAAA,GACVC,EAcaC,EAAA,CAbX,IAAI,YACI,KAAMC,EAAI,KA9GxB,gBAAAJ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAK,GA8GoBD,EAAI,KAAAC,GACjB,KAAMC,EAAY,aAClB,OAAQC,EAAM,OACf,MAAM,aACL,oBAAmBD,EAAU,WAC9B,YAAU,iBACT,YAAW,GACZ,UAAA,KAEW,SACT,IAA2H,CAA3HL,EAA2H,QAA3HO,EAA2H,CAxHnIR,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAS,EAwHqD,UAAa,KAAAR,EAAyD,QAAA,CAxH3H,sBAAAD,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAK,GAwHkFD,EAAM,OAAAC,GAAE,KAAK,OAAO,YAAY,wBAAhCD,EAAM,MAAA,QAxHxF,EAAA"}