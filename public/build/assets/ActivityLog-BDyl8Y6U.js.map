{"version":3,"file":"ActivityLog-BDyl8Y6U.js","sources":["../../../resources/js/components/log_entries/ActivityLogEntryForm.vue","../../../resources/js/components/log_entries/ActivityLogDeleteConfirmation.vue","../../../resources/js/components/log_entries/ActivityLog.vue"],"sourcesContent":["<script setup>\n    import { ref, watch, computed } from 'vue'\n    import {useStore} from 'vuex'\n    import RichTextEditor from '@/components/prosekit/RichTextEditor.vue'\n    import StepInput from '@/components/forms/StepInput.vue'\n    import {saveEntry, updateEntry, fetchEntries} from '@/adapters/log_entry_repository'\n\n    const props = defineProps({\n        logEntry: {\n                required: false,\n                default: () => {\n                    return {\n                        log_date: new Date().toISOString(),\n                        step: null,\n                        entry: '',\n                    }\n                }\n            },\n            apiUrl: {\n                required: true,\n                type: String\n            }\n    });\n    const emits = defineEmits(['saved', 'canceled'])\n    const store = useStore();\n\n    // DATA\n    const newEntry = ref({\n        log_date: new Date().toISOString(),\n        step: null,\n        entry: '',\n    });\n    const errors = ref({});\n\n    //COMPUTED\n    const group = computed(() => store.getters['groups/currentItemOrNew']);\n\n    // METHODS\n    const syncEntry =  (entry) => {\n        if (!entry || !entry.created_at) {\n            return;\n        }\n\n        newEntry.value = {\n            id: entry.id,\n            log_date: new Date(Date.parse((entry.created_at))).toISOString(),\n            step: entry.step,\n            entry: entry.description\n        }\n    }\n\n    const initNewEntry = () => {\n        newEntry.value = {\n            log_date: new Date().toISOString(),\n            step: null,\n            entry: ''\n        }\n    }\n\n    const save = async () => {\n        try {\n            if (newEntry.value.id) {\n                await updateEntry(`${props.apiUrl}/${newEntry.value.id}`, newEntry.value);\n            } else {\n                await saveEntry(props.apiUrl, newEntry.value);\n            }\n\n            await fetchEntries(props.apiUrl);\n            initNewEntry();\n            emits('saved', newEntry.value);\n        } catch (error) {\n            if (error.response && Number.parseInt(error.response.status) === 422 && error.response.data.errors) {\n                errors.value = error.response.data.errors\n            }\n        }\n    };\n\n    const cancel = () => {\n        initNewEntry();\n        emits('canceled');\n    }\n\n    watch(\n        () => props.logEntry,\n        (to) => {\n            syncEntry(to)\n        },\n        {immediate: true}\n    );\n\n</script>\n<template>\n  <form-container class=\"log-entry-form\">\n    <input-row\n      v-model=\"newEntry.log_date\"\n      label=\"Log Date\"\n      :errors=\"errors.log_date\"\n      type=\"date\"\n    />\n    <StepInput v-if=\"group.is_vcep\" v-model=\"newEntry.step\" :errors=\"errors.step\" />\n    <input-row label=\"Entry\" :errors=\"errors.entry\">\n      <RichTextEditor v-model=\"newEntry.entry\" />\n    </input-row>\n    <button-row>\n      <button class=\"btn\" @click=\"cancel\">\n        Cancel\n      </button>\n      <button class=\"btn blue\" @click=\"save\">\n        Save\n      </button>\n    </button-row>\n  </form-container>\n</template>\n","<script>\nimport {ref, computed} from 'vue';\nimport { formatDate } from '@/date_utils';\nimport is_validation_error from '@/http/is_validation_error';\nimport { fetchEntries, deleteEntry } from '@/adapters/log_entry_repository'\n\n\nexport default {\n    name: 'ConfirmDeleteLogEntry',\n    props: {\n        logEntry: {\n            required: true,\n            type: Object,\n        },\n        apiUrl: {\n            required: true,\n            type: String\n        }\n    },\n    emits: [\n        'deleted',\n        'canceled'\n    ],\n    setup (props, context) {\n        const errors = ref({});\n        const logDate = computed(() => {\n            return formatDate(props.logEntry.log_date)\n        });\n        const flattenedErrors = computed(() => {\n            return Object.values(errors.value).flat();\n        });\n\n        const deleteLogEntry = async () => {\n            try {\n                await deleteEntry(props.apiUrl, props.logEntry.id);\n                context.emit('deleted')\n                await fetchEntries(props.apiUrl);\n            } catch (error) {\n                if (is_validation_error(error)) {\n                    errors.value = error.response.data.errors;\n                    return;\n                }\n                errors.value = {a: error.message};\n            }\n        }\n\n\n        return {\n            errors,\n            logDate,\n            flattenedErrors,\n            deleteLogEntry\n        }\n    }\n}\n</script>\n<template>\n  <div>\n    <p>You are about to delete the following log entry:</p>\n\n    <div class=\"border-y py-2\">\n      <blockquote>\n        <div v-html=\"logEntry.description\" />\n      </blockquote>\n      <div v-if=\"logEntry.causer\" class=\"ml-4 mt-2 mb-4 text-gray-700 text-sm\">\n        Logged by {{ logEntry.causer.name }}, {{ logDate }}\n      </div>\n    </div>\n\n    <div>This can not be undone. Are you sure you want to continue?</div>\n\n    <div v-if=\"flattenedErrors.length > 0\" class=\"bg-red-200 text-red-900 rounded p-2 my-2\">\n      <ul>\n        <li v-for=\"(err,idx) in flattenedErrors\" :key=\"idx\">\n          {{ err }}\n        </li>\n      </ul> \n    </div>\n        \n    <button-row submit-text=\"Delete Log Entry\" @canceled=\"$emit('canceled')\" @submitted=\"deleteLogEntry\" />\n  </div>\n</template>\n<style lang=\"postcss\" scope>\n    blockquote {\n        @apply mt-4 ml-4 border-l-4 pl-2 text-gray-700;\n        font-size: 1.1rem;\n    }\n</style>","<script>\nimport { ref, computed } from 'vue'\n\nimport LogEntryForm from '@/components/log_entries/ActivityLogEntryForm.vue'\nimport ActivityLogDeleteConfirmation from '@/components/log_entries/ActivityLogDeleteConfirmation.vue'\nimport {formatDate, formatTime} from '@/date_utils'\n\nconst fields = [\n    {\n        name: 'created_at',\n        label: 'Date & Time',\n        sortName: 'created_at',\n        sortable: true,\n        resolveValue ({created_at}) {\n            return (created_at) ? formatDate(created_at) : null;\n        },\n        type: Date,\n        colspan: 2,\n        class: 'w-16'\n    },\n    {\n        name: 'created_at',\n        label: 'Time',\n        sortName: 'created_at',\n        hideHeader: true,\n        sortable: false,\n        resolveValue ({created_at}) {\n            return (created_at) ? formatTime(created_at) : null;\n        },\n        class: \"w-28\",\n        type: Date,\n    },\n    {\n        name: 'description',\n        label: 'Entry',\n        sortable: true,\n        type: String\n    },\n    {\n        name: 'causer.name',\n        label: 'User',\n        sortable: true\n    },\n    {\n        name: 'id',\n        label: '',\n        sortable: false,\n    }\n];\n\nexport default {\n    components: {\n        LogEntryForm,\n        ActivityLogDeleteConfirmation\n    },\n    props: {\n        logEntries: {\n            required: true,\n            type: Array,\n        },\n        apiUrl: {\n            required: true,\n            type: String\n        }\n    },\n    setup (props) {\n        // DATA\n        const sort = ref({\n            field: 'created_at',\n            desc: true\n        });\n        const selectedEntry = ref({});\n        const editingEntry = ref(false);\n        const showDeleteConfirmation = ref(false);\n\n        // COMPUTED\n        const hasLogEntries = computed(() => {\n            return props.logEntries.length > 0;\n        });\n\n        // METHODS\n        const editLogEntry = entry => {\n            editingEntry.value = true;\n            selectedEntry.value = entry;\n        };\n\n        const closeEntryForm = () => {\n            editingEntry.value = false;\n            selectedEntry.value = {};\n        }\n        \n        const confirmDelete = (entry) => {\n            selectedEntry.value = entry;\n            showDeleteConfirmation.value = true;\n        }\n        const closeDeleteConfirmation = () => {\n            showDeleteConfirmation.value = false;\n            selectedEntry.value = {};\n        }\n\n        return {\n            fields: ref(fields),\n            sort,\n            selectedEntry,\n            editingEntry,\n            hasLogEntries,\n            editLogEntry,\n            closeEntryForm,\n            showDeleteConfirmation,\n            confirmDelete,\n            closeDeleteConfirmation\n        }\n    }\n}\n</script>\n<template>\n  <div>\n    <div v-if=\"!hasLogEntries\" class=\"px-3 py-2 rounded border border-gray-300 text-gray-500 bg-gray-200\">\n      No log entries to display\n    </div>\n    <data-table v-else v-model:sort=\"sort\" :fields=\"fields\" :data=\"logEntries\">\n      <template #cell-id=\"{item}\">\n        <div v-if=\"hasPermission('groups-manage')\" class=\"flex space-x-1\">\n          <button class=\"btn btn-xs inline-block\" @click=\"editLogEntry(item)\">\n            <icon-edit width=\"12\" />\n          </button>\n          <button \n            v-if=\"item.activity_type === null\"\n            class=\"btn btn-xs inline-block\"\n            @click=\"confirmDelete(item)\"\n          >\n            <icon-trash width=\"12\" />\n          </button>\n        </div>\n      </template>\n      <template #cell-description=\"{item}\">\n        <div class=\"links-blue\" v-html=\"item.description\" />\n      </template>\n    </data-table>\n    <modal-dialog v-model=\"editingEntry\" title=\"Edit log entry\">\n      <LogEntryForm \n        :log-entry=\"selectedEntry\" \n        :api-url=\"apiUrl\"\n        @saved=\"closeEntryForm\"\n        @canceled=\"closeEntryForm\"\n      />\n    </modal-dialog>\n\n    <modal-dialog v-model=\"showDeleteConfirmation\" title=\"Delete this log entry?\">\n      <ActivityLogDeleteConfirmation \n        :log-entry=\"selectedEntry\" \n        :api-url=\"apiUrl\"\n        @canceled=\"closeDeleteConfirmation\"\n        @deleted=\"closeDeleteConfirmation\"\n      />\n    </modal-dialog>\n  </div>\n</template>\n<style lang=\"postcss\">\n    .links-blue a {\n        @apply text-blue-500;\n    }\n</style>"],"names":["props","__props","emits","__emit","store","useStore","newEntry","ref","errors","group","computed","syncEntry","entry","initNewEntry","save","updateEntry","saveEntry","fetchEntries","error","cancel","watch","to","_sfc_main","context","logDate","formatDate","flattenedErrors","deleteEntry","is_validation_error","_hoisted_1","_hoisted_2","_createElementBlock","_cache","_createElementVNode","$props","_openBlock","_hoisted_3","_toDisplayString","$setup","_createCommentVNode","_hoisted_4","_Fragment","_renderList","err","idx","_createVNode","_component_button_row","_ctx","fields","created_at","formatTime","LogEntryForm","ActivityLogDeleteConfirmation","sort","selectedEntry","editingEntry","showDeleteConfirmation","hasLogEntries","editLogEntry","closeEntryForm","confirmDelete","closeDeleteConfirmation","_hoisted_5","_createBlock","_component_data_table","$event","_withCtx","item","_component_icon_edit","_component_icon_trash","_component_modal_dialog","_component_LogEntryForm","_component_ActivityLogDeleteConfirmation"],"mappings":"4dAOI,MAAMA,EAAQC,EAgBRC,EAAQC,EACRC,EAAQC,EAAU,EAGlBC,EAAWC,EAAI,CACjB,SAAU,IAAI,KAAM,EAAC,YAAa,EAClC,KAAM,KACN,MAAO,EACf,CAAK,EACKC,EAASD,EAAI,EAAE,EAGfE,EAAQC,EAAS,IAAMN,EAAM,QAAQ,yBAAyB,CAAC,EAG/DO,EAAcC,GAAU,CACtB,CAACA,GAAS,CAACA,EAAM,aAIrBN,EAAS,MAAQ,CACb,GAAIM,EAAM,GACV,SAAU,IAAI,KAAK,KAAK,MAAOA,EAAM,UAAU,CAAE,EAAE,YAAa,EAChE,KAAMA,EAAM,KACZ,MAAOA,EAAM,WACzB,EACA,EAEUC,EAAe,IAAM,CACvBP,EAAS,MAAQ,CACb,SAAU,IAAI,KAAM,EAAC,YAAa,EAClC,KAAM,KACN,MAAO,EACnB,CACA,EAEUQ,EAAO,SAAY,CACrB,GAAI,CACIR,EAAS,MAAM,GACf,MAAMS,EAAY,GAAGf,EAAM,MAAM,IAAIM,EAAS,MAAM,EAAE,GAAIA,EAAS,KAAK,EAExE,MAAMU,EAAUhB,EAAM,OAAQM,EAAS,KAAK,EAGhD,MAAMW,EAAajB,EAAM,MAAM,EAC/Ba,EAAc,EACdX,EAAM,QAASI,EAAS,KAAK,CAChC,OAAQY,EAAO,CACRA,EAAM,UAAY,OAAO,SAASA,EAAM,SAAS,MAAM,IAAM,KAAOA,EAAM,SAAS,KAAK,SACxFV,EAAO,MAAQU,EAAM,SAAS,KAAK,OAEnD,CACK,EAEKC,EAAS,IAAM,CACjBN,EAAc,EACdX,EAAM,UAAU,CACxB,EAEI,OAAAkB,EACI,IAAMpB,EAAM,SACXqB,GAAO,CACJV,EAAUU,CAAE,CACf,EACD,CAAC,UAAW,EAAI,CACnB,oyBCjFAC,EAAU,CACX,KAAM,wBACN,MAAO,CACH,SAAU,CACN,SAAU,GACV,KAAM,MACT,EACD,OAAQ,CACJ,SAAU,GACV,KAAM,MACV,CACH,EACD,MAAO,CACH,UACA,UACH,EACD,MAAOtB,EAAOuB,EAAS,CACnB,MAAMf,EAASD,EAAI,EAAE,EACfiB,EAAUd,EAAS,IACde,EAAWzB,EAAM,SAAS,QAAQ,CAC5C,EACK0B,EAAkBhB,EAAS,IACtB,OAAO,OAAOF,EAAO,KAAK,EAAE,KAAM,CAC5C,EAiBD,MAAO,CACH,OAAAA,EACA,QAAAgB,EACA,gBAAAE,EACA,eAnBmB,SAAY,CAC/B,GAAI,CACA,MAAMC,EAAY3B,EAAM,OAAQA,EAAM,SAAS,EAAE,EACjDuB,EAAQ,KAAK,SAAS,EACtB,MAAMN,EAAajB,EAAM,MAAM,CACjC,OAAOkB,EAAO,CACZ,GAAIU,EAAoBV,CAAK,EAAG,CAC5BV,EAAO,MAAQU,EAAM,SAAS,KAAK,OACnC,MACJ,CACAV,EAAO,MAAQ,CAAC,EAAGU,EAAM,OAAO,CACpC,CACJ,CAQA,CACJ,CACJ,EAMSW,EAAA,CAAA,MAAM,eAAe,EA5D9BC,EAAA,CAAA,WAAA,KAAA,IAAA,EAgEkC,MAAM,2CAhExC,IAAA,EAuE2C,MAAM,uGAd/CC,EAuBM,MAAA,KAAA,CAtBJC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAuD,SAApD,mDAAgD,EAAA,GAEnDA,EAOM,MAPNJ,EAOM,CANJI,EAEa,aAAA,KAAA,CADXA,EAAqC,MAAA,CAAhC,UAAQC,EAAQ,SAAC,WA9D9B,EAAA,KAAA,EAAAJ,CAAA,IAgEiBI,EAAA,SAAS,QAApBC,EAAA,EAAAJ,EAEM,MAFNK,EAAyE,cAC1DC,EAAAH,EAAA,SAAS,OAAO,IAAI,EAAG,OAAKI,EAAO,OAAA,EAAA,CAAA,GAjExDC,EAAA,GAAA,EAAA,IAqEIP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAqE,WAAhE,6DAA0D,EAAA,GAEpDK,EAAA,gBAAgB,OAAM,GAAjCH,IAAAJ,EAMM,MANNS,EAMM,CALJP,EAIK,KAAA,KAAA,EAHHE,EAAA,EAAA,EAAAJ,EAEKU,OA3EbC,EAyEgCJ,EAAA,gBAzEhC,CAyEoBK,EAAIC,KAAhBT,EAAA,EAAAJ,EAEK,KAFqC,CAAA,IAAKa,CAAG,IAC7CD,CAAG,EAAA,CAAA,eA1EhBJ,EAAA,GAAA,EAAA,EA+EIM,EAAuGC,EAAA,CAA3F,cAAY,mBAAoB,0BAAUC,EAAK,MAAA,UAAA,GAAe,YAAWT,EAAc,sECxEjGU,EAAS,CACX,CACI,KAAM,aACN,MAAO,cACP,SAAU,aACV,SAAU,GACV,aAAc,CAAC,WAAAC,CAAU,EAAG,CACxB,OAAQA,EAAcxB,EAAWwB,CAAU,EAAI,IAClD,EACD,KAAM,KACN,QAAS,EACT,MAAO,MACV,EACD,CACI,KAAM,aACN,MAAO,OACP,SAAU,aACV,WAAY,GACZ,SAAU,GACV,aAAc,CAAC,WAAAA,CAAU,EAAG,CACxB,OAAQA,EAAcC,EAAWD,CAAU,EAAI,IAClD,EACD,MAAO,OACP,KAAM,IACT,EACD,CACI,KAAM,cACN,MAAO,QACP,SAAU,GACV,KAAM,MACT,EACD,CACI,KAAM,cACN,MAAO,OACP,SAAU,EACb,EACD,CACI,KAAM,KACN,MAAO,GACP,SAAU,EACd,CACJ,EAEK3B,EAAU,CACX,WAAY,cACR6B,EACA,8BAAAC,CACH,EACD,MAAO,CACH,WAAY,CACR,SAAU,GACV,KAAM,KACT,EACD,OAAQ,CACJ,SAAU,GACV,KAAM,MACV,CACH,EACD,MAAOpD,EAAO,CAEV,MAAMqD,EAAO9C,EAAI,CACb,MAAO,aACP,KAAM,EACV,CAAC,EACK+C,EAAgB/C,EAAI,EAAE,EACtBgD,EAAehD,EAAI,EAAK,EACxBiD,EAAyBjD,EAAI,EAAK,EAGlCkD,EAAgB/C,EAAS,IACpBV,EAAM,WAAW,OAAS,CACpC,EAGK0D,EAAe9C,GAAS,CAC1B2C,EAAa,MAAQ,GACrBD,EAAc,MAAQ1C,CACzB,EAEK+C,EAAiB,IAAM,CACzBJ,EAAa,MAAQ,GACrBD,EAAc,MAAQ,CAAE,CAC5B,EAEMM,EAAiBhD,GAAU,CAC7B0C,EAAc,MAAQ1C,EACtB4C,EAAuB,MAAQ,EACnC,EACMK,EAA0B,IAAM,CAClCL,EAAuB,MAAQ,GAC/BF,EAAc,MAAQ,CAAE,CAC5B,EAEA,MAAO,CACH,OAAQ/C,EAAIyC,CAAM,EAClB,KAAAK,EACA,cAAAC,EACA,aAAAC,EACA,cAAAE,EACA,aAAAC,EACA,eAAAC,EACA,uBAAAH,EACA,cAAAI,EACA,wBAAAC,CACJ,CACJ,CACJ,KAjHA,IAAA,EAqH+B,MAAM,0EArHrC,IAAA,EA0HmD,MAAM,kBA1HzDzB,GAAA,CAAA,SAAA,EAAAI,GAAA,CAAA,SAAA,EAAAsB,GAAA,CAAA,WAAA,8KAoHE/B,EAwCM,MAAA,KAAA,CAvCQO,EAAa,mBAGzByB,EAkBaC,EAAA,CA1IjB,IAAA,EAwH+B,KAAM1B,EAAI,KAxHzC,gBAAAN,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAiC,GAwHqC3B,EAAI,KAAA2B,GAAG,OAAQ3B,EAAM,OAAG,KAAMJ,EAAU,aAC5D,UAAOgC,EAChB,CAWM,CAZa,KAAAC,CAAI,IAAA,CACZpB,EAAa,cAAA,eAAA,GAAxBZ,IAAAJ,EAWM,MAXND,GAWM,CAVJG,EAES,SAAA,CAFD,MAAM,0BAA2B,QAAKgC,GAAE3B,EAAY,aAAC6B,CAAI,IAC/DtB,EAAwBuB,EAAA,CAAb,MAAM,IAAI,CAAA,CA5HjC,EAAA,EAAAhC,EAAA,EA+HkB+B,EAAK,gBAAa,UAD1BpC,EAMS,SAAA,CApInB,IAAA,EAgIY,MAAM,0BACL,QAAKkC,GAAE3B,EAAa,cAAC6B,CAAI,IAE1BtB,EAAyBwB,EAAA,CAAb,MAAM,IAAI,CAAA,CAnIlC,EAAA,EAAA7B,EAAA,GAAAD,EAAA,GAAA,EAAA,KAAAA,EAAA,GAAA,EAAA,IAuIiB,mBAAgB2B,EACzB,CAAoD,CADxB,KAAAC,CAAI,IAAA,CAChClC,EAAoD,MAAA,CAA/C,MAAM,aAAa,UAAQkC,EAAK,WAxI7C,EAAA,KAAA,EAAAL,EAAA,IAAA,EAAA,qCAqHI/B,EAEM,MAFNF,EAAsG,6BAEtG,GAoBAgB,EAOeyB,EAAA,CAlJnB,WA2I2BhC,EAAY,aA3IvC,sBAAAN,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAiC,GA2I2B3B,EAAY,aAAA2B,GAAE,MAAM,mBA3I/C,QAAAC,EA4IM,IAKE,CALFrB,EAKE0B,EAAA,CAJC,YAAWjC,EAAa,cACxB,UAASJ,EAAM,OACf,QAAOI,EAAc,eACrB,WAAUA,EAAc,yEAhJjC,EAAA,qBAoJIO,EAOeyB,EAAA,CA3JnB,WAoJ2BhC,EAAsB,uBApJjD,sBAAAN,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAiC,GAoJ2B3B,EAAsB,uBAAA2B,GAAE,MAAM,2BApJzD,QAAAC,EAqJM,IAKE,CALFrB,EAKE2B,EAAA,CAJC,YAAWlC,EAAa,cACxB,UAASJ,EAAM,OACf,WAAUI,EAAuB,wBACjC,UAASA,EAAuB,oFAzJzC,EAAA"}