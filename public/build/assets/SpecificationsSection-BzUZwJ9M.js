import{_ as xe,r as x,q as M,c as i,d as e,h as v,C as X,D as Fe,j as u,F as V,m as J,Z as te,i as P,p as ee,v as Me,b as n,f as O,n as we,w as U,a0 as Ae,ao as Ke,aL as He,aM as ze,aN as Qe,y as Xe,o as Ye,aO as Le,e as ue,a as N,aP as Ge,aQ as Ze,an as Je,a2 as We,A as et,a1 as tt}from"./app-_e7sJ9nw.js";const st={class:"space-y-3"},ot={class:"mb-3 border rounded-lg bg-white px-3 py-2"},at={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},lt={class:"flex flex-wrap items-center gap-3 w-full md:w-auto"},nt=["checked"],it={class:"flex items-center gap-2"},rt={class:"flex items-center gap-2 relative"},dt={class:"truncate"},ut={key:0,class:"absolute top-full left-0 mt-1 w-72 border rounded bg-white shadow-lg z-50 p-2"},ct={class:"flex items-center justify-between pb-2 border-b"},pt={class:"max-h-64 overflow-auto pt-2 space-y-1"},mt=["checked","onChange"],vt={class:"flex flex-wrap items-center gap-3 w-full md:w-auto md:justify-end"},_t={class:"flex items-center gap-2"},yt=["aria-label"],bt={class:"flex items-center gap-2"},ft=["value"],xt={key:0,class:"flex items-center gap-2 bg-gray-50 p-3 border rounded"},gt=["disabled"],ht={key:1,class:"p-6 text-center text-sm text-gray-500 border rounded-lg bg-white"},kt={key:2,class:"space-y-2"},wt={class:"rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm hover:shadow transition-shadow"},Ct={class:"flex items-start justify-between gap-3 p-3"},St={class:"flex items-start gap-3 flex-1 min-w-0"},Dt={key:0,class:"mt-1"},Tt=["checked","onChange","aria-label"],Gt={class:"min-w-0"},At={class:"flex flex-wrap items-center gap-2"},Vt={class:"text-base font-semibold text-gray-900"},Et={class:"mt-0.5 text-sm text-gray-700 truncate max-w-full"},Pt={class:"flex items-center gap-2"},It=["onClick","aria-expanded","aria-controls"],Lt=["onUpdate:modelValue","onChange","disabled"],Ft={key:0,class:"text-xs text-gray-500"},Mt=["disabled","onClick"],Ot={key:2,class:"text-xs text-gray-700"},Ut=["id"],Nt={class:"space-y-2"},Rt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"},$t={class:"text-gray-900"},jt={class:"text-gray-900"},Bt={class:"text-gray-900"},qt={class:"text-gray-900"},Kt={class:"text-gray-900"},Ht={class:"text-gray-900"},zt={class:"text-gray-900"},Qt={class:"col-span-2"},Xt={class:"text-gray-900"},Yt={class:"mt-4 flex justify-between items-center"},Zt=["disabled"],Jt={class:"text-sm"},Wt=["disabled"],es={key:3,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},ts={class:"bg-white rounded-lg shadow-lg w-96 p-6"},ss={class:"mb-6"},os={__name:"GeneCurationStatus",props:{genes:{type:Array,required:!0,default:()=>[]},groupID:{type:String,required:!0},editing:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["removed"],setup(b,{emit:s}){const _=b,o=s,m=Me(),g=x(""),k=x([]),I=x(!1),G=x("gene_symbol"),R=x("asc"),j=x(1),C=x(20),h=x([]),a=x([]),E=x(""),Q=x(null),B=x(!1),q=x(!1),f=x(null),W=p=>{f.value=p,q.value=!0},ie=()=>{f.value=null,q.value=!1},se=async()=>{var p;if(f.value)try{await ee.delete(`/api/groups/${_.groupID}/expert-panel/genes/${f.value.id}`),q.value=!1,m.commit("pushSuccess",`Successfully removed gene ${f.value.gene_symbol}`);const l=f.value;f.value=null,o("removed",{id:l.id,gene_symbol:l.gene_symbol})}catch(l){m.commit("pushError",(p=l.response)==null?void 0:p.data)}},L=p=>{k.value.includes(p)?k.value=k.value.filter(l=>l!==p):k.value=[...k.value,p]},ce=()=>{k.value=[]},oe=M(()=>k.value.length===0?"All":k.value.length===1?k.value[0]:`${k.value.length} selected`),K={"Not Curated":0,Uploaded:1,Precuration:2,"Disease entity assigned":3,"Precuration Complete":4,"Curation Provisional":5,"Curation Approved":6,"Recuration assigned":7,"Retired Assignment":8,Published:9},pe=M(()=>{const p=new Set;return _.genes.forEach(l=>l.statuses.forEach(S=>p.add(S))),Array.from(p).sort((l,S)=>(K[l]??0)-(K[S]??0))}),me=M(()=>{const p=g.value.trim().toLowerCase();return _.genes.filter(l=>{var be;const S=(be=l.gene_symbol)==null?void 0:be.toLowerCase().includes(p),c=(l.expert_panels||[]).some(A=>A==null?void 0:A.toLowerCase().includes(p)),$=(l.details||[]).some(A=>{var ne,ke;return((ne=A==null?void 0:A.disease_name)==null?void 0:ne.toLowerCase().includes(p))||((ke=A==null?void 0:A.mondo_id)==null?void 0:ke.toLowerCase().includes(p))}),y=(l.statuses||[]).some(A=>A==null?void 0:A.toLowerCase().includes(p)),_e=!p||S||c||$||y,ye=k.value.length===0||(l.statuses||[]).some(A=>k.value.includes(A));return _e&&ye})}),re=M(()=>[...me.value].sort((p,l)=>{if(G.value==="statuses"){const $=ye=>{const A=(Array.isArray(ye.statuses)?ye.statuses:[]).map(ne=>K[ne]??0);return A.length?Math.min(...A):0},y=$(p),_e=$(l);return R.value==="asc"?_e-y:y-_e}if(G.value==="tier"){const $=Number(p.tier||0),y=Number(l.tier||0);return R.value==="asc"?$-y:y-$}let S,c;return G.value==="expert_panel"?(S=(p.expert_panels||[]).join(", ").toLowerCase(),c=(l.expert_panels||[]).join(", ").toLowerCase()):(S=(p.gene_symbol??"").toString().toLowerCase(),c=(l.gene_symbol??"").toString().toLowerCase()),R.value==="asc"?S.localeCompare(c):c.localeCompare(S)})),de=M(()=>Math.ceil(re.value.length/C.value)),H=M(()=>{const p=(j.value-1)*C.value;return re.value.slice(p,p+C.value)}),ve=p=>{h.value.includes(p)?h.value=h.value.filter(l=>l!==p):h.value.push(p)},T=p=>{a.value.includes(p)?a.value=a.value.filter(l=>l!==p):a.value.push(p)},ge=()=>{const p=H.value.map(S=>S.id);p.every(S=>a.value.includes(S))?a.value=a.value.filter(S=>!p.includes(S)):a.value=[...new Set([...a.value,...p])]},Ce=M(()=>H.value.every(p=>a.value.includes(p.id))),he=async p=>{var S;if(_.readonly||!_.editing)return;Q.value=p.id;const l=p.tier;try{await ee.put(`/api/groups/${_.groupID}/expert-panel/genes/update-tier`,{ids:[p.id],tier:p.tier||null}),m.commit("pushSuccess",`Tier updated for ${p.gene_symbol}`)}catch(c){p.tier=l,m.commit("pushError",`Failed to update tier for ${p.gene_symbol}`),console.error(((S=c==null?void 0:c.response)==null?void 0:S.data)||c)}finally{Q.value=null}},Se=async()=>{if(!(!E.value||a.value.length===0)){B.value=!0;try{await ee.put(`/api/groups/${_.groupID}/expert-panel/genes/update-tier`,{ids:a.value,tier:E.value}),m.commit("pushSuccess",`Tier updated for ${a.value.length} genes`),_.genes.forEach(p=>{a.value.includes(p.id)&&(p.tier=E.value)}),a.value=[],E.value=""}catch{m.commit("pushError","Failed to update tiers in bulk")}finally{B.value=!1}}},De=()=>{a.value.length!==0&&(a.value=[])};return(p,l)=>{var S;return n(),i("div",st,[e("div",ot,[e("div",at,[e("div",lt,[b.editing?(n(),i("input",{key:0,type:"checkbox",checked:Ce.value,onChange:ge},null,40,nt)):v("",!0),X(e("input",{"onUpdate:modelValue":l[0]||(l[0]=c=>g.value=c),type:"text",placeholder:"Search genes, statuses, diseases…",class:"border rounded px-2 py-1 text-sm w-full sm:w-64"},null,512),[[Fe,g.value]]),e("div",it,[l[10]||(l[10]=e("label",{class:"text-xs text-gray-500"},"Status",-1)),e("div",rt,[e("button",{type:"button",class:"border rounded px-2 py-1 text-sm bg-white min-w-40 flex items-center justify-between",onClick:l[1]||(l[1]=c=>I.value=!I.value)},[e("span",dt,u(oe.value),1),l[9]||(l[9]=e("span",{class:"ml-2 text-gray-400"},"▾",-1))]),I.value?(n(),i("div",ut,[e("div",ct,[e("button",{type:"button",class:"text-xs text-blue-600",onClick:ce},"Clear"),e("button",{type:"button",class:"text-xs text-gray-600",onClick:l[2]||(l[2]=c=>I.value=!1)},"Done")]),e("div",pt,[(n(!0),i(V,null,J(pe.value,c=>(n(),i("label",{key:c,class:"flex items-center gap-2 text-sm"},[e("input",{type:"checkbox",checked:k.value.includes(c),onChange:$=>L(c)},null,40,mt),e("span",null,u(c),1)]))),128))])])):v("",!0)])])]),e("div",vt,[e("div",_t,[l[12]||(l[12]=e("label",{class:"text-xs text-gray-500"},"Sort by",-1)),X(e("select",{"onUpdate:modelValue":l[3]||(l[3]=c=>G.value=c),class:"border rounded px-2 py-1 text-sm"},l[11]||(l[11]=[e("option",{value:"gene_symbol"},"HGNC Symbol",-1),e("option",{value:"expert_panel"},"Expert Panel",-1),e("option",{value:"statuses"},"Status Priority",-1),e("option",{value:"tier"},"Tier",-1)]),512),[[te,G.value]]),e("button",{class:"border rounded px-2 py-1 text-xs",onClick:l[4]||(l[4]=c=>R.value=R.value==="asc"?"desc":"asc"),"aria-label":`Toggle sort order (currently ${R.value})`,title:"Toggle sort order"},u(R.value==="asc"?"ASC ▲":"DESC ▼"),9,yt)]),e("div",bt,[l[13]||(l[13]=e("label",{class:"text-xs text-gray-500"},"Page size",-1)),X(e("select",{"onUpdate:modelValue":l[5]||(l[5]=c=>C.value=c),class:"border rounded px-2 py-1 text-sm"},[(n(),i(V,null,J([20,50,100],c=>e("option",{key:c,value:c},u(c),9,ft)),64))],512),[[te,C.value]])])])])]),a.value.length>0&&b.editing&&!b.readonly?(n(),i("div",xt,[P(u(a.value.length)+" gene(s) selected. ",1),l[15]||(l[15]=e("span",{class:"font-semibold"},"Bulk Tier Update:",-1)),X(e("select",{"onUpdate:modelValue":l[6]||(l[6]=c=>E.value=c),class:"border rounded px-2 py-1 text-sm"},l[14]||(l[14]=[e("option",{value:""},"Select Tier",-1),e("option",{value:"1"},"Primary",-1),e("option",{value:"2"},"Secondary",-1)]),512),[[te,E.value]]),e("button",{class:"bg-blue-600 text-white px-3 py-1 rounded disabled:opacity-50",onClick:Se,disabled:!E.value||a.value.length===0||B.value},u(B.value?"Applying…":"Apply"),9,gt),e("button",{type:"button",class:"border rounded px-3 py-1 text-sm bg-white hover:bg-gray-50",onClick:De,title:"Clear selection"}," Clear ")])):v("",!0),H.value.length===0?(n(),i("div",ht," No genes found. ")):(n(),i("ul",kt,[(n(!0),i(V,null,J(H.value,(c,$)=>(n(),i("li",{key:c.id},[e("div",wt,[e("div",Ct,[e("div",St,[b.editing&&!b.readonly?(n(),i("div",Dt,[e("input",{type:"checkbox",checked:a.value.includes(c.id),onChange:y=>T(c.id),"aria-label":`Select ${c.gene_symbol}`},null,40,Tt)])):v("",!0),e("div",Gt,[e("div",At,[e("span",Vt,u(c.gene_symbol),1),(c.statuses||[]).length?(n(),i("span",{key:0,class:we(["text-xs rounded-full px-2 py-0.5 text-gray-700",(c.details||[]).length?"border border-amber-400 bg-amber-50":"border border-gray-400 bg-gray-50"])},u((c.statuses||[]).join(", ")),3)):v("",!0)]),e("div",Et,[(c.expert_panels||[]).length?(n(),i(V,{key:0},[P(u(c.expert_panels.join(", ")),1)],64)):(n(),i(V,{key:1},[P("—")],64))])])]),e("div",Pt,[(c.details||[]).length?(n(),i("button",{key:0,onClick:y=>ve($),class:"rounded border px-2 py-1 text-xs bg-white","aria-expanded":h.value.includes($),"aria-controls":`gene-details-${c.id}`,title:"Toggle details"},u(h.value.includes($)?"Hide Details":"Show Details"),9,It)):v("",!0),b.editing&&!b.readonly?(n(),i(V,{key:1},[X(e("select",{"onUpdate:modelValue":y=>c.tier=y,class:"border rounded px-2 py-1 text-xs",onChange:y=>he(c),disabled:Q.value===c.id||b.readonly,title:"Tier"},l[16]||(l[16]=[e("option",{value:""},"—",-1),e("option",{value:"1"},"Primary",-1),e("option",{value:"2"},"Secondary",-1)]),40,Lt),[[te,c.tier]]),Q.value===c.id?(n(),i("span",Ft,"Saving…")):v("",!0),e("button",{class:"rounded border px-2 py-1 text-xs bg-white hover:bg-red-50",disabled:p.removingId===c.id,onClick:y=>W(c),title:"Remove gene"},u(p.removingId===c.id?"Removing…":" X "),9,Mt)],64)):(n(),i("span",Ot,"Tier: "+u(c.tier||"—"),1))])]),O(Ae,{name:"fade"},{default:U(()=>[h.value.includes($)?(n(),i("div",{key:0,id:`gene-details-${c.id}`,class:"px-3 pb-3 pt-2 text-sm"},[e("div",Nt,[(n(!0),i(V,null,J(c.details,y=>(n(),i("div",{key:y.disease_name+y.curation_status+(y.mondo_id||""),class:"rounded-lg border border-gray-200 bg-gray-50 p-2"},[e("div",Rt,[e("div",null,[l[17]||(l[17]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Expert Panel",-1)),e("div",$t,u(y.expert_panel||"—"),1)]),e("div",null,[l[18]||(l[18]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Status",-1)),e("div",jt,u(y.curation_status||"—")+". Date: "+u(y!=null&&y.date_approved?new Date(y.date_approved).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—"),1)]),e("div",null,[l[19]||(l[19]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Disease",-1)),e("div",Bt,u(y.mondo_id?`${y.mondo_id} ${y.disease_name||""}`:y.disease_name||"—"),1)]),y.classification||y.moi_name||y.curation_type?(n(),i(V,{key:0},[e("div",null,[l[20]||(l[20]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Classification",-1)),e("div",qt,u(y.classification||"—"),1)]),e("div",null,[l[21]||(l[21]=e("span",{class:"text-[11px] uppercase text-gray-500"},"MOI",-1)),e("div",Kt,u(y.moi_name||"—"),1)]),e("div",null,[l[22]||(l[22]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Curation Type",-1)),e("div",Ht,u(y.curation_type||"—"),1)])],64)):v("",!0),y.rationales||y.phenotypes?(n(),i(V,{key:1},[e("div",null,[l[23]||(l[23]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Rationales",-1)),e("div",zt,u(y.rationales||"—"),1)]),e("div",Qt,[l[26]||(l[26]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Phenotype",-1)),e("div",Xt,[e("span",null,u(y.phenotypes||"—"),1),y.phenotypes?(n(),i(V,{key:0},[l[24]||(l[24]=e("span",{class:"mx-2 font-bold"},"·",-1)),l[25]||(l[25]=e("span",{class:"font-bold"},"Excluded:",-1)),P(" "+u(y.excluded_phenotypes),1)],64)):v("",!0)])])],64)):v("",!0)])]))),128))])],8,Ut)):v("",!0)]),_:2},1024)])]))),128))])),e("div",Yt,[e("button",{class:"border rounded px-3 py-1 text-sm",disabled:j.value===1,onClick:l[7]||(l[7]=c=>j.value--)},"Prev",8,Zt),e("span",Jt,"Page "+u(j.value)+" of "+u(de.value),1),e("button",{class:"border rounded px-3 py-1 text-sm",disabled:j.value===de.value,onClick:l[8]||(l[8]=c=>j.value++)},"Next",8,Wt)]),q.value?(n(),i("div",es,[e("div",ts,[l[29]||(l[29]=e("h3",{class:"text-lg font-semibold mb-4"},"Confirm Removal",-1)),e("p",ss,[l[27]||(l[27]=P("Are you sure you want to remove ")),e("strong",null,u((S=f.value)==null?void 0:S.gene_symbol),1),l[28]||(l[28]=P("?"))]),e("div",{class:"flex justify-end gap-2"},[e("button",{class:"btn btn-gray",onClick:ie},"Cancel"),e("button",{class:"btn btn-red",onClick:se},"Remove")])])])):v("",!0)])}}},da=xe(os,[["__scopeId","data-v-b8457f0d"]]),as={name:"VcepGeneList",components:{GeneSearchSelect:Qe,DiseaseSearchSelect:ze,CuratedGeneSearchSelect:He,RichTextEditor:Ke},props:{readonly:{type:Boolean,required:!1,default:!1},editing:{type:Boolean,required:!1,default:!0}},emits:["saved"],setup(b,{emit:s}){const _=Me(),o=x([]),m=x(null),g=x(!1),k=x(!1),I=x(0),G=x({}),R=x([]),j=x(null),C=x(!1),h=x([]),a=x(""),E=x(null),Q=x(""),B=x(""),q=x(""),f=x("gene_symbol"),W=x("asc"),ie=x(1),se=x(20),L=M(()=>_.getters["groups/currentItemOrNew"]),ce=M(()=>Xe(["ep-applications-manage",["application-edit",L.value]])&&!b.readonly),oe=x(!1),K=x(null),pe=t=>{K.value=t,oe.value=!0},me=()=>{K.value=null,oe.value=!1},re=async()=>{if(K.value)try{await ee.delete(`/api/groups/${L.value.uuid}/expert-panel/genes/${K.value.id}`),oe.value=!1,_.commit("pushSuccess",`Successfully removed gene ${K.value.gene_symbol}`),K.value=null,await H()}catch(t){_.commit("pushError",t.response.data)}},de=async()=>{try{const t=await ee.get("/api/mois");R.value=t.data}catch(t){_.commit("pushError",t.response.data)}},H=async()=>{var t;if(L.value.uuid)try{await _.dispatch("groups/getGenes",L.value),o.value=L.value.expert_panel.genes}catch(d){_.commit("pushError",((t=d.response)==null?void 0:t.data)||d)}},ve=t=>{f.value===t?W.value=W.value==="asc"?"desc":"asc":(f.value=t,W.value="asc")},T=()=>{k.value=!0,g.value=!1,m.value=null,I.value++},ge=(t="")=>t.replace(/\\([\\`*_{}\[\]()#+\-.!>~|])/g,"$1"),Ce=t=>{var r,w,D,F;const d=k.value;if(k.value=!0,g.value=t.id,(r=t.plan)!=null&&r.is_other)m.value={id:t.id,is_other:!0,custom_gene:{hgnc_id:t.hgnc_id,gene_symbol:t.gene_symbol},custom_disease:{mondo_id:t.mondo_id,name:t.disease_name},custom_moi:R.value.find(Y=>Y.abbreviation===t.moi)||null,custom_plan:ge(((w=t.plan)==null?void 0:w.the_plan)||"")};else{const Y={...t.plan,is_other:!1,curated_plan_text:((D=t.plan)==null?void 0:D.curated_plan_text)??""};m.value={id:t.id,hgnc_id:t.hgnc_id,gene_symbol:t.gene_symbol,disease_name:t.disease_name,mondo_id:t.mondo_id,moi:t.moi,date_approved:t.date_approved,requires_plan:["Moderate","Limited"].includes((F=t.plan)==null?void 0:F.classification),plan:Y,curated_plan_text:ge((Y==null?void 0:Y.curated_plan_text)||""),is_other:!1}}console.log("Editing gene:",m.value),I.value++,d?Be():C.value=!0},he=()=>{k.value=!1,g.value=!1,m.value=null,G.value={}},Se=M(()=>{var t,d,r;return(t=m.value)!=null&&t.is_other?!!((d=m.value.custom_gene)!=null&&d.hgnc_id)&&((r=m.value.custom_plan)==null?void 0:r.trim().length)>=20:!1}),De=()=>{var d;const t=((d=m.value)==null?void 0:d.id)||null;m.value={id:t,is_other:!0,custom_gene:null,custom_disease:null,custom_moi:null,custom_plan:""}},p=t=>{t&&!t.is_other&&(m.value={...t,is_other:!1,requires_plan:["Moderate","Limited"].includes(t.classification),curated_plan_text:Le("")})},l=M(()=>{var d;return(d=m.value)!=null&&d.requires_plan?(m.value.curated_plan_text||"").replace(/<[^>]+>/g,"").trim().length>=20:!0}),S=t=>{const d=t!=null&&t.plan&&Object.keys(t.plan).length?t.plan:{},r={curation_id:d.curation_id??t.curation_id,gene_symbol:d.gene_symbol??t.gene_symbol,hgnc_id:d.hgnc_id??t.hgnc_id,hgnc_name:d.hgnc_name??t.hgnc_name??null,disease_name:d.disease_name??t.disease_name,mondo_id:d.mondo_id??t.mondo_id,expert_panel:d.expert_panel??t.expert_panel??null,moi:d.moi??t.moi,moi_name:d.moi_name??t.moi_name??null,hp_id:d.hp_id??t.hp_id??null,classification_id:d.classification_id??t.classification_id??null,classification:d.classification??t.classification??null,curation_status_id:d.curation_status_id??t.curation_status_id??null,curation_type:d.curation_type??t.curation_type??null,curation_status:d.curation_status??t.curation_status??null,date_approved:d.date_approved??t.date_approved??null,phenotypes:d.phenotypes??t.phenotypes??null,phenotypeIDs:d.phenotypeIDs??t.phenotypeIDs??null,checkKey:d.checkKey??t.checkKey??null,is_other:!1,requires_plan:!!(t!=null&&t.requires_plan),curated_plan_text:t!=null&&t.requires_plan?Ge((t==null?void 0:t.curated_plan_text)||d.curated_plan_text||""):Ge(d.curated_plan_text||"")};return Object.keys(r).forEach(w=>r[w]===void 0&&delete r[w]),r},c=async()=>{var t,d,r,w,D,F,Y,Pe,Ie;try{let z;if(m.value.is_other){const Z={is_other:!0,the_plan:Ge(m.value.custom_plan),moi_name:((t=m.value.custom_moi)==null?void 0:t.name)||"",hp_id:((d=m.value.custom_moi)==null?void 0:d.hp_id)||""};z={is_other:!0,hgnc_id:((r=m.value.custom_gene)==null?void 0:r.hgnc_id)||null,gene_symbol:((w=m.value.custom_gene)==null?void 0:w.gene_symbol)||"",disease_name:((D=m.value.custom_disease)==null?void 0:D.name)||"",mondo_id:((F=m.value.custom_disease)==null?void 0:F.mondo_id)||"",moi:((Y=m.value.custom_moi)==null?void 0:Y.abbreviation)||"",plan:Z,date_approved:null}}else{const Z=S(m.value);z={hgnc_id:m.value.hgnc_id,gene_symbol:m.value.gene_symbol,disease_name:m.value.disease_name,mondo_id:m.value.mondo_id,moi:m.value.moi,date_approved:m.value.date_approved,plan:Z,is_other:!1}}g.value?(await ee.put(`/api/groups/${L.value.uuid}/expert-panel/genes/${g.value}`,z),_.commit("pushSuccess",`Successfully updated for ${z.gene_symbol}-${z.mondo_id}-${z.moi}`)):(await ee.post(`/api/groups/${L.value.uuid}/expert-panel/genes`,{genes:[z]}),_.commit("pushSuccess",`Successfully added: ${z.gene_symbol}-${z.mondo_id}-${z.moi}`)),await H(),he(),s("saved")}catch(z){const Z=z==null?void 0:z.response;if((Z==null?void 0:Z.status)===422&&((Pe=Z.data)!=null&&Pe.errors)){const qe=Object.values(Z.data.errors).flat();_.commit("pushError",qe.join(`
`))}else _.commit("pushError",((Ie=Z==null?void 0:Z.data)==null?void 0:Ie.message)||`Failed to add ${payload.gene_symbol}`)}},$=async t=>{try{await ee.delete(`/api/groups/${L.value.uuid}/expert-panel/genes/${t.id}`),await H()}catch(d){_.commit("pushError",d.response.data)}},y=async t=>{E.value=t.id;const d=t.tier;try{await ee.put(`/api/groups/${L.value.uuid}/expert-panel/genes/update-tier`,{ids:[t.id],tier:t.tier||null}),_.commit("pushSuccess",`Tier updated for ${t.gene_symbol}`)}catch{t.tier=d,_.commit("pushError","Failed to update tier")}finally{E.value=null}},_e=async()=>{if(!(!a.value||h.value.length===0))try{await ee.put(`/api/groups/${L.value.uuid}/expert-panel/genes/update-tier`,{ids:h.value,tier:a.value}),_.commit("pushSuccess",`Tier updated for ${h.value.length} genes`),h.value=[],await H(),a.value=""}catch{_.commit("pushError","Failed to update tiers in bulk")}},ye=()=>{h.value.length!==0&&(h.value=[])},be=t=>{h.value.includes(t)?h.value=h.value.filter(d=>d!==t):h.value.push(t)},A=()=>{const t=Te.value.map(r=>r.id);t.every(r=>h.value.includes(r))?h.value=h.value.filter(r=>!t.includes(r)):h.value=[...new Set([...h.value,...t])]},ne=M(()=>{let t=[...o.value];const d=Q.value.toLowerCase();return d&&(t=t.filter(r=>{var w,D,F,Y;return r.gene_symbol&&r.gene_symbol.toLowerCase().includes(d)||r.mondo_id&&r.mondo_id.toLowerCase().includes(d)||r.disease_name&&r.disease_name.toLowerCase().includes(d)||r.moi&&r.moi.toLowerCase().includes(d)||((w=r.plan)==null?void 0:w.the_plan)&&r.plan.the_plan.toLowerCase().includes(d)||((D=r.plan)==null?void 0:D.expert_panel)&&r.plan.expert_panel.toLowerCase().includes(d)||((F=r.plan)==null?void 0:F.classification)&&r.plan.classification.toLowerCase().includes(d)||((Y=r.plan)==null?void 0:Y.phenotypes)&&r.plan.phenotypes.toLowerCase().includes(d)})),B.value&&(t=t.filter(r=>r.moi===B.value)),q.value&&(t=t.filter(r=>{var w;return((w=r.plan)==null?void 0:w.classification)===q.value})),t.sort((r,w)=>{let D,F;switch(f.value){case"disease":D=`${r.mondo_id||""} ${r.disease_name||""}`.toLowerCase(),F=`${w.mondo_id||""} ${w.disease_name||""}`.toLowerCase();break;case"moi":D=r.moi||"",F=w.moi||"";break;case"tier":return D=r.tier?Number(r.tier):0,F=w.tier?Number(w.tier):0,W.value==="asc"?D-F:F-D;default:D=r.gene_symbol||"",F=w.gene_symbol||""}return W.value==="asc"?D.localeCompare(F):F.localeCompare(D)}),t}),ke=async t=>{var d;try{const r=t.gt_data;if(!r)return;const w={is_other:!1,hgnc_id:r.hgnc_id,gene_symbol:r.gene_symbol,disease_name:r.disease_name,mondo_id:r.mondo_id,moi:r.moi,date_approved:r.date_approved,plan:{...r,checkKey:r.checkKey,requires_plan:["Moderate","Limited"].includes((d=r.plan)==null?void 0:d.classification)}};await ee.put(`/api/groups/${L.value.uuid}/expert-panel/genes/${t.id}`,w),_.commit("pushSuccess",`Updated ${t.gene_symbol} from GeneTracker`),await H()}catch{_.commit("pushError","Failed to apply update from GeneTracker")}},Oe=M(()=>[...new Set(o.value.map(t=>t.moi).filter(Boolean))]),Ue=M(()=>[...new Set(o.value.map(t=>{var d;return(d=t.plan)==null?void 0:d.classification}).filter(Boolean))]),Ne=M(()=>Math.ceil(ne.value.length/se.value)),Te=M(()=>{const t=(ie.value-1)*se.value;return ne.value.slice(t,t+se.value)}),Re=M(()=>Te.value.every(t=>h.value.includes(t.id))),Ve=(t,d)=>(t??"")!==(d??""),ae=(t,d)=>{const r=(t==null?void 0:t.plan)??{};return{gene_symbol:t.gene_symbol??r.gene_symbol,moi:t.moi??r.moi,mondo_id:t.mondo_id??r.mondo_id,disease_name:t.disease_name??r.disease_name,expert_panel:r.expert_panel,classification:r.classification,curation_status:r.curation_status,date_approved:r.date_approved,phenotypes:r.phenotypes}[d]},le=(t,d)=>{const r=(t==null?void 0:t.gt_data)??{};return{gene_symbol:r.gene_symbol,moi:r.moi,mondo_id:r.mondo_id,disease_name:r.disease_name,expert_panel:r.expert_panel,classification:r.classification,curation_status:r.curation_status,date_approved:r.date_approved,phenotypes:r.phenotypes}[d]},$e=(t,{onlyChanged:d=!1}={})=>{const r=D=>D?new Date(D).toLocaleDateString():"",w=[{key:"gene_symbol",label:"HGNC Symbol",a:ae(t,"gene_symbol"),b:le(t,"gene_symbol")},{key:"moi",label:"MOI",a:ae(t,"moi"),b:le(t,"moi")},{key:"mondo_id",label:"MONDO ID",a:ae(t,"mondo_id"),b:le(t,"mondo_id")},{key:"disease_name",label:"Disease",a:ae(t,"disease_name"),b:le(t,"disease_name")},{key:"expert_panel",label:"Expert Panel",a:ae(t,"expert_panel"),b:le(t,"expert_panel")},{key:"classification",label:"Classification",a:ae(t,"classification"),b:le(t,"classification")},{key:"curation_status",label:"Status",a:ae(t,"curation_status"),b:le(t,"curation_status")},{key:"date_approved",label:"Date Approved",a:r(ae(t,"date_approved")),b:r(le(t,"date_approved"))},{key:"phenotypes",label:"Phenotypes",a:ae(t,"phenotypes"),b:le(t,"phenotypes")}];return d?w.filter(D=>Ve(D.a,D.b)):w},Ee=()=>{const t=j.value;t&&t.scrollIntoView({behavior:"smooth",block:"start"})},je=()=>{C.value&&(C.value=!1,Ee())},Be=async()=>{await Ze(),requestAnimationFrame(()=>Ee())};Ye(()=>{H(),de()});const fe=x([]);return{group:L,genes:o,formGene:m,curatedGeneKey:I,isEditing:g,isFormVisible:k,mois:R,errors:G,search:Q,filterMoi:B,filterClassification:q,sortKey:f,sortOrder:W,pageSize:se,currentPage:ie,totalPages:Ne,paginatedGenes:Te,filteredAndSortedGenes:ne,moiOptions:Oe,classificationOptions:Ue,selectedGenes:h,bulkTier:a,savingTierFor:E,isAllSelected:Re,canEdit:ce,isOtherFormValid:Se,isCuratedPlanValid:l,toggleExpanded:t=>{fe.value.includes(t)?fe.value=fe.value.filter(d=>d!==t):fe.value.push(t)},expanded:fe,showConfirmRemove:oe,selectedGene:K,confirmRemove:pe,cancelRemove:me,removeGene:re,setSort:ve,startAdd:T,startEdit:Ce,cancelForm:he,selectOther:De,handleCuratedSelection:p,saveForm:c,remove:$,updateTier:y,applyBulkTier:_e,toggleSelect:be,toggleSelectAll:A,applyGtUpdate:ke,compactDiffRows:$e,isDiff:Ve,htmlFromMarkdown:Le,formEl:j,onFormEntered:je,clearSelection:ye}}},ls={class:"flex justify-between items-center mb-4"},ns={key:0,class:"flex items-center gap-2"},is=["disabled"],rs={class:"flex items-center gap-4"},ds=["value"],us=["value"],cs={key:0,ref:"formEl",class:"border rounded bg-gray-50 p-4 mb-4"},ps={class:"text-lg font-semibold mb-3"},ms={key:0,class:"space-y-2"},vs={key:0,class:"mt-3 border rounded bg-amber-50 p-3"},_s={class:"flex items-start gap-2 mb-2"},ys={class:"text-sm text-gray-800"},bs={key:0,class:"text-xs text-red-500 mt-1"},fs={key:1,class:"border rounded bg-white p-3 mt-3"},xs={class:"grid grid-cols-2 gap-2"},gs={key:0,class:"text-red-500 text-xs mt-1"},hs=["value"],ks={key:0,class:"text-red-500 text-xs mt-1"},ws={class:"col-span-2"},Cs={class:"col-span-2 mb-6"},Ss={key:0,class:"text-red-500 text-xs mt-1"},Ds={class:"mt-4 flex justify-end gap-2"},Ts=["disabled"],Gs={key:0,class:"flex items-center gap-2 bg-gray-50 p-3 border rounded mb-3"},As=["disabled"],Vs={class:"mb-3 flex items-center justify-between border rounded-lg bg-white px-3 py-2"},Es={class:"flex items-center gap-3"},Ps=["checked"],Is={class:"text-sm text-gray-600"},Ls={class:"flex items-center gap-2"},Fs=["aria-label"],Ms={class:"ml-2 flex items-center gap-2"},Os=["value"],Us={key:1,class:"p-6 text-center text-sm text-gray-500 border rounded-lg bg-white"},Ns={key:2,class:"space-y-2"},Rs={class:"rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm hover:shadow transition-shadow"},$s={class:"flex items-start justify-between gap-3 p-3"},js={class:"flex items-start gap-3"},Bs={key:0,class:"mt-1"},qs=["checked","onChange","aria-label"],Ks={class:"flex flex-wrap items-center gap-2"},Hs={class:"text-base font-semibold text-gray-900"},zs={key:0,class:"text-xs rounded-full bg-gray-100 px-2 py-0.5 text-gray-700"},Qs={key:1,class:"text-xs rounded-full bg-gray-100 px-2 py-0.5 text-gray-700"},Xs={key:2,class:"'inline-flex h-2 w-2 rounded-full animate-pulse bg-rose-500","aria-hidden":"true"},Ys={key:3,class:"text-[11px] rounded-full bg-amber-100 text-amber-900 px-2 py-0.5 border border-amber-300"},Zs={class:"mt-0.5 text-sm text-gray-700 truncate"},Js={class:"flex items-center gap-2"},Ws=["onUpdate:modelValue","onChange","disabled"],eo=["onClick"],to={key:1,class:"text-xs text-gray-700"},so={key:0,class:"px-3 pb-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 text-sm"},oo={key:0,class:"sm:col-span-2 lg:col-span-4 rounded-xl border p-2 text-sm border-rose-300 bg-rose-50 p-2"},ao=["innerHTML"],lo={class:"rounded-xl border border-gray-200 bg-gray-50 p-2"},no={class:"text-sm text-gray-900"},io={class:"mt-0.5 text-gray-900 flex items-center gap-2 text-sm"},ro={class:"rounded-xl border border-gray-200 bg-gray-50 p-2"},uo={class:"text-sm text-gray-900"},co={class:"rounded-xl border border-gray-200 bg-gray-50 p-2"},po={class:"text-sm text-gray-900"},mo={key:0,class:"sm:col-span-2 lg:col-span-4 rounded-xl border border-gray-200 bg-gray-50 p-2"},vo={class:"text-sm text-gray-900 line-clamp-2"},_o={key:1,class:"sm:col-span-2 lg:col-span-4 rounded-xl border border-amber-200 bg-amber-50 p-2"},yo=["innerHTML"],bo={key:1,class:"flex items-center justify-between gap-2 border-t border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900"},fo=["onClick"],xo={key:0,class:"px-3 pb-3 pt-2 text-xs"},go={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},ho={class:"flex items-center justify-between border-b bg-gray-50 px-2 py-1 text-[11px] text-gray-600"},ko={class:"uppercase tracking-wide"},wo={class:"grid grid-cols-2"},Co={class:"min-w-0 p-2"},So=["title"],Do=["title"],To={class:"mt-2 flex flex-wrap items-center gap-2 sm:hidden"},Go=["onClick"],Ao=["onClick"],Vo={class:"mt-4 flex justify-between items-center"},Eo=["disabled"],Po=["disabled"],Io={key:3,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},Lo={class:"bg-white rounded-lg shadow-lg w-96 p-6"},Fo={class:"mb-6"},Mo={class:"flex justify-end gap-2"};function Oo(b,s,_,o,m,g){var h;const k=N("CuratedGeneSearchSelect"),I=N("RichTextEditor"),G=N("GeneSearchSelect"),R=N("DiseaseSearchSelect"),j=N("dropdown-item"),C=N("dropdown-menu");return n(),i("div",null,[e("div",ls,[_.editing?(n(),i("div",ns,[e("button",{class:"btn blue",onClick:s[0]||(s[0]=(...a)=>o.startAdd&&o.startAdd(...a)),disabled:o.isFormVisible}," + Add Gene ",8,is)])):v("",!0),e("div",rs,[X(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.search=a),type:"text",placeholder:"Search genes, diseases, MOI, notes...",class:"border rounded px-2 py-1 text-sm"},null,512),[[Fe,o.search]]),X(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>o.filterMoi=a),class:"border p-1 rounded text-sm"},[s[24]||(s[24]=e("option",{value:""},"All MOIs",-1)),(n(!0),i(V,null,J(o.moiOptions,a=>(n(),i("option",{key:a,value:a},u(a),9,ds))),128))],512),[[te,o.filterMoi]]),X(e("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>o.filterClassification=a),class:"border p-1 rounded text-sm"},[s[25]||(s[25]=e("option",{value:""},"All Classifications",-1)),(n(!0),i(V,null,J(o.classificationOptions,a=>(n(),i("option",{key:a,value:a},u(a),9,us))),128))],512),[[te,o.filterClassification]])])]),O(Ae,{name:"fade",onAfterEnter:o.onFormEntered},{default:U(()=>{var a,E,Q,B,q;return[o.isFormVisible?(n(),i("div",cs,[e("h3",ps,u(o.isEditing?"Edit Gene":"Add Gene"),1),(a=o.formGene)!=null&&a.is_other?v("",!0):(n(),i("div",ms,[s[31]||(s[31]=e("label",{class:"block font-semibold"},"Select Gene-Disease-MOI:",-1)),(n(),ue(k,{modelValue:o.formGene,"onUpdate:modelValue":[s[4]||(s[4]=f=>o.formGene=f),o.handleCuratedSelection],placeholder:"Search curated Gene-Disease-MOI",class:"w-full",key:o.curatedGeneKey},null,8,["modelValue","onUpdate:modelValue"])),e("button",{type:"button",class:"text-blue-600 underline text-sm hover:text-blue-800",onClick:s[5]||(s[5]=(...f)=>o.selectOther&&o.selectOther(...f))},s[26]||(s[26]=[P(" Click here for "),e("strong",null,"Other (Not Curated)",-1)])),(E=o.formGene)!=null&&E.requires_plan?(n(),i("div",vs,[e("div",_s,[s[29]||(s[29]=e("span",{class:"text-orange-500 font-bold"},"⚠",-1)),e("div",ys,[s[27]||(s[27]=P(" This gene is currently classified as ")),e("strong",null,u(o.formGene.classification??((Q=o.formGene.plan)==null?void 0:Q.classification)),1),s[28]||(s[28]=P(". Please explain the rationale for proposing its inclusion. "))])]),s[30]||(s[30]=e("label",{class:"block text-sm font-medium mb-1"},"Plan for Curation *",-1)),O(I,{modelValue:o.formGene.curated_plan_text,"onUpdate:modelValue":s[6]||(s[6]=f=>o.formGene.curated_plan_text=f),placeholder:"Describe your plan (min 20 characters)",class:"w-full"},null,8,["modelValue"]),o.isCuratedPlanValid?v("",!0):(n(),i("p",bs," Plan must be at least 20 characters. "))])):v("",!0)])),o.formGene&&o.formGene.is_other?(n(),i("div",fs,[s[37]||(s[37]=e("h5",{class:"text-lg font-semibold mb-2"},"Provide details for non-curated gene",-1)),e("div",xs,[e("div",null,[s[32]||(s[32]=e("label",{class:"block text-sm font-medium mb-1"},"Gene *",-1)),O(G,{modelValue:o.formGene.custom_gene,"onUpdate:modelValue":s[7]||(s[7]=f=>o.formGene.custom_gene=f),placeholder:"Search gene..."},null,8,["modelValue"]),o.errors.custom_gene?(n(),i("p",gs,u(o.errors.custom_gene[0]),1)):v("",!0)]),e("div",null,[s[34]||(s[34]=e("label",{class:"block text-sm font-medium mb-1"},"MOI",-1)),X(e("select",{"onUpdate:modelValue":s[8]||(s[8]=f=>o.formGene.custom_moi=f),class:"form-select w-full"},[s[33]||(s[33]=e("option",{value:""},"----Select MOI-----",-1)),(n(!0),i(V,null,J(o.mois,f=>(n(),i("option",{key:f.id,value:f},u(f.name)+" ("+u(f.abbreviation)+")",9,hs))),128))],512),[[te,o.formGene.custom_moi]]),o.errors.custom_moi?(n(),i("p",ks,u(o.errors.custom_moi[0]),1)):v("",!0)]),e("div",ws,[s[35]||(s[35]=e("label",{class:"block text-sm font-medium mb-1"},"Disease",-1)),O(R,{modelValue:o.formGene.custom_disease,"onUpdate:modelValue":s[9]||(s[9]=f=>o.formGene.custom_disease=f),placeholder:"Search disease..."},null,8,["modelValue"])]),e("div",Cs,[s[36]||(s[36]=e("label",{class:"block text-sm font-medium mb-1"},"Plan for Curation *",-1)),O(I,{modelValue:o.formGene.custom_plan,"onUpdate:modelValue":s[10]||(s[10]=f=>o.formGene.custom_plan=f),placeholder:"Describe your plan (min 20 characters)",class:"w-full"},null,8,["modelValue"]),o.errors.custom_plan?(n(),i("p",Ss,u(o.errors.custom_plan[0]),1)):v("",!0)])])])):v("",!0),e("div",Ds,[e("button",{class:"btn btn-gray",onClick:s[11]||(s[11]=(...f)=>o.cancelForm&&o.cancelForm(...f))},"Cancel"),e("button",{class:"btn blue",disabled:o.isEditing?!1:((B=o.formGene)==null?void 0:B.is_other)&&!o.isOtherFormValid||!((q=o.formGene)!=null&&q.is_other)&&!o.isCuratedPlanValid,onClick:s[12]||(s[12]=(...f)=>o.saveForm&&o.saveForm(...f))}," Save ",8,Ts)])],512)):v("",!0)]}),_:1},8,["onAfterEnter"]),o.selectedGenes.length>0&&!_.readonly?(n(),i("div",Gs,[P(u(o.selectedGenes.length)+" gene(s) selected. ",1),s[39]||(s[39]=e("span",{class:"font-semibold"},"Bulk Tier Update:",-1)),X(e("select",{"onUpdate:modelValue":s[13]||(s[13]=a=>o.bulkTier=a),class:"border rounded px-2 py-1 text-sm"},s[38]||(s[38]=[e("option",{value:""},"Select Tier",-1),e("option",{value:"1"},"Current",-1),e("option",{value:"2"},"Future",-1)]),512),[[te,o.bulkTier]]),e("button",{class:"bg-blue-600 text-white px-3 py-1 rounded disabled:opacity-50",onClick:s[14]||(s[14]=(...a)=>o.applyBulkTier&&o.applyBulkTier(...a)),disabled:!o.bulkTier||o.selectedGenes.length===0}," Apply ",8,As),e("button",{type:"button",class:"border rounded px-3 py-1 text-sm bg-white hover:bg-gray-50",onClick:s[15]||(s[15]=(...a)=>o.clearSelection&&o.clearSelection(...a)),title:"Clear selection"}," Clear ")])):v("",!0),e("div",Vs,[e("div",Es,[o.canEdit&&_.editing?(n(),i("input",{key:0,type:"checkbox",checked:o.isAllSelected,onChange:s[16]||(s[16]=(...a)=>o.toggleSelectAll&&o.toggleSelectAll(...a)),"aria-label":"Select all on page"},null,40,Ps)):v("",!0),e("span",Is,u(o.paginatedGenes.length)+" shown / "+u(o.filteredAndSortedGenes.length)+" total ",1)]),e("div",Ls,[s[42]||(s[42]=e("label",{class:"text-xs text-gray-500"},"Sort by",-1)),X(e("select",{"onUpdate:modelValue":s[17]||(s[17]=a=>o.sortKey=a),class:"border rounded px-2 py-1 text-sm"},s[40]||(s[40]=[e("option",{value:"gene_symbol"},"HGNC Symbol",-1),e("option",{value:"disease"},"Disease",-1),e("option",{value:"moi"},"MOI",-1),e("option",{value:"tier"},"Tier",-1)]),512),[[te,o.sortKey]]),e("button",{class:"border rounded px-2 py-1 text-xs",onClick:s[18]||(s[18]=a=>o.sortOrder=o.sortOrder==="asc"?"desc":"asc"),"aria-label":`Toggle sort order (currently ${o.sortOrder})`,title:"Toggle sort order"},u(o.sortOrder==="asc"?"ASC ▲":"DESC ▼"),9,Fs),e("div",Ms,[s[41]||(s[41]=e("label",{class:"text-xs text-gray-500"},"Page size",-1)),X(e("select",{"onUpdate:modelValue":s[19]||(s[19]=a=>o.pageSize=a),class:"border rounded px-2 py-1 text-sm"},[(n(),i(V,null,J([2,20,50,100],a=>e("option",{key:a,value:a},u(a),9,Os)),64))],512),[[te,o.pageSize]])])])]),o.paginatedGenes.length===0?(n(),i("div",Us," No genes found. ")):(n(),i("ul",Ns,[(n(!0),i(V,null,J(o.paginatedGenes,(a,E)=>{var Q,B,q,f,W,ie,se,L,ce,oe,K,pe,me,re,de,H,ve;return n(),i("li",{key:a.id},[e("div",Rs,[e("div",$s,[e("div",js,[o.canEdit&&_.editing?(n(),i("div",Bs,[e("input",{type:"checkbox",checked:o.selectedGenes.includes(a.id),onChange:T=>o.toggleSelect(a.id),"aria-label":`Select ${a.gene_symbol}`},null,40,qs)])):v("",!0),e("div",null,[e("div",Ks,[e("span",Hs,u(a.gene_symbol),1),a.mondo_id?(n(),i("span",zs,u(a.mondo_id),1)):v("",!0),a.moi?(n(),i("span",Qs,u(a.moi),1)):v("",!0),(Q=a.plan)!=null&&Q.is_other?(n(),i("span",Xs)):v("",!0),a.is_outdated&&a.gt_data?(n(),i("span",Ys,"Snapshot out of date")):v("",!0)]),e("div",Zs,u(a.disease_name),1)])]),e("div",Js,[_.editing?(n(),i(V,{key:0},[X(e("select",{"onUpdate:modelValue":T=>a.tier=T,class:"border rounded px-2 py-1 text-xs",onChange:T=>o.updateTier(a),disabled:o.savingTierFor===a.id||_.readonly,title:"Tier"},s[43]||(s[43]=[e("option",{value:"null"},"—",-1),e("option",{value:"1"},"Current",-1),e("option",{value:"2"},"Future",-1)]),40,Ws),[[te,a.tier]]),a.is_outdated&&a.gt_data?(n(),i("button",{key:0,onClick:T=>o.applyGtUpdate(a),title:"Refresh from latest GT",class:"hidden sm:inline-flex rounded border border-amber-400 bg-amber-50 px-2 py-1 text-xs font-semibold text-amber-900 hover:bg-amber-100"}," Apply latest GT changes ⚠ ",8,eo)):v("",!0),a.toDelete?v("",!0):(n(),ue(C,{key:1,"hide-cheveron":!0,class:"relative"},{label:U(()=>s[44]||(s[44]=[e("button",{class:"rounded border px-2 py-1 text-xs bg-white"},"⋯",-1)])),default:U(()=>[O(j,{onClick:T=>o.startEdit(a)},{default:U(()=>s[45]||(s[45]=[P("Edit")])),_:2},1032,["onClick"]),O(j,{onClick:T=>o.confirmRemove(a)},{default:U(()=>s[46]||(s[46]=[P("Remove")])),_:2},1032,["onClick"])]),_:2},1024))],64)):(n(),i("span",to,"Tier: "+u(a.tier||"—"),1))])]),a.plan?(n(),i("div",so,[(B=a.plan)!=null&&B.is_other?(n(),i("div",oo,[s[47]||(s[47]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Plan",-1)),e("div",{class:"prose max-w-none",innerHTML:o.htmlFromMarkdown((((q=a.plan)==null?void 0:q.the_plan)||"").replace(/\\/g,""))},null,8,ao)])):(n(),i(V,{key:1},[e("div",lo,[s[48]||(s[48]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Expert Panel",-1)),e("div",no,u(((f=a.plan)==null?void 0:f.expert_panel)??"N/A"),1)]),e("div",{class:we(["rounded-xl border p-2",["Moderate","Limited"].includes((W=a.plan)==null?void 0:W.classification)?((ie=a.plan)==null?void 0:ie.classification)==="Limited"?"border-amber-200 bg-amber-100 ring-1 ring-amber-500":"border-amber-100 bg-amber-50 ring-1 ring-amber-300":"border-gray-200 bg-gray-50"])},[s[49]||(s[49]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Classification",-1)),e("div",io,[P(u(((se=a.plan)==null?void 0:se.classification)??"N/A")+" ",1),["Moderate","Limited"].includes((L=a.plan)==null?void 0:L.classification)?(n(),i("span",{key:0,class:we(["inline-flex h-2 w-2 rounded-full animate-pulse",((ce=a.plan)==null?void 0:ce.classification)==="Limited"?"bg-amber-500":"bg-amber-300"]),"aria-hidden":"true"},null,2)):v("",!0)])],2),e("div",ro,[s[50]||(s[50]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Status",-1)),e("div",uo,u(((oe=a.plan)==null?void 0:oe.curation_status)??"N/A"),1)]),e("div",co,[s[51]||(s[51]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Date Approved",-1)),e("div",po,u((K=a.plan)!=null&&K.date_approved?new Date((pe=a.plan)==null?void 0:pe.date_approved).toLocaleDateString():"N/A"),1)]),(me=a.plan)!=null&&me.phenotypes?(n(),i("div",mo,[s[52]||(s[52]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Phenotypes",-1)),e("div",vo,u(((re=a.plan)==null?void 0:re.phenotypes)??"N/A"),1)])):v("",!0),["Moderate","Limited"].includes((de=a.plan)==null?void 0:de.classification)&&((H=a.plan)!=null&&H.curated_plan_text)?(n(),i("div",_o,[s[53]||(s[53]=e("div",{class:"text-[11px] uppercase tracking-wide text-amber-800"},"Plan",-1)),e("div",{class:"prose max-w-none text-sm text-amber-900",innerHTML:o.htmlFromMarkdown((((ve=a.plan)==null?void 0:ve.curated_plan_text)||"").replace(/\\/g,""))},null,8,yo)])):v("",!0)],64))])):v("",!0),a.is_outdated&&a.gt_data?(n(),i("div",bo,[s[54]||(s[54]=e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-flex h-4 w-4"},"⚠"),e("span",{class:"truncate"},"Snapshot differs from latest GeneTracker data.")],-1)),e("button",{onClick:T=>o.toggleExpanded(E),class:"rounded border border-amber-400 px-2 py-1 text-xs font-medium hover:bg-amber-100"},u(o.expanded.includes(E)?"Hide GT diff":"Show GT diff"),9,fo)])):v("",!0),O(Ae,{name:"fade"},{default:U(()=>[a.is_outdated&&a.gt_data&&o.expanded.includes(E)?(n(),i("div",xo,[e("div",go,[(n(!0),i(V,null,J(o.compactDiffRows(a),T=>(n(),i("div",{key:T.key,class:"rounded-lg border border-gray-200"},[e("div",ho,[e("span",ko,u(T.label),1)]),e("div",wo,[e("div",Co,[e("div",{class:"truncate",title:T.a},u(T.a||"—"),9,So)]),e("div",{class:we(["min-w-0 p-2",o.isDiff(T.a,T.b)?"bg-sky-50 ring-1 ring-sky-300":""])},[e("div",{class:"truncate",title:T.b},u(T.b||"—"),9,Do)],2)])]))),128))]),e("div",To,[a.is_outdated&&a.gt_data?(n(),i("button",{key:0,type:"button",class:"rounded bg-amber-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-700",onClick:T=>o.applyGtUpdate(a)}," Refresh from GT ",8,Go)):v("",!0),e("button",{type:"button",class:"rounded border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-800 hover:bg-gray-50",onClick:T=>o.toggleExpanded(E)}," Keep Snapshot ",8,Ao)])])):v("",!0)]),_:2},1024)])])}),128))])),e("div",Vo,[e("button",{class:"btn btn-gray",disabled:o.currentPage===1,onClick:s[20]||(s[20]=a=>o.currentPage--)},"Prev",8,Eo),e("span",null,"Page "+u(o.currentPage)+" of "+u(o.totalPages),1),e("button",{class:"btn btn-gray",disabled:o.currentPage===o.totalPages,onClick:s[21]||(s[21]=a=>o.currentPage++)},"Next",8,Po)]),o.showConfirmRemove?(n(),i("div",Io,[e("div",Lo,[s[57]||(s[57]=e("h3",{class:"text-lg font-semibold mb-4"},"Confirm Removal",-1)),e("p",Fo,[s[55]||(s[55]=P("Are you sure you want to remove ")),e("strong",null,u((h=o.selectedGene)==null?void 0:h.gene_symbol),1),s[56]||(s[56]=P("?"))]),e("div",Mo,[e("button",{class:"btn btn-gray",onClick:s[22]||(s[22]=(...a)=>o.cancelRemove&&o.cancelRemove(...a))},"Cancel"),e("button",{class:"btn btn-red",onClick:s[23]||(s[23]=(...a)=>o.removeGene&&o.removeGene(...a))},"Remove")])])])):v("",!0)])}const ua=xe(as,[["render",Oo],["__scopeId","data-v-c9650b3d"]]),Uo={name:"CspecSummary",props:{readonly:{type:Boolean,default:!1}},data(){return{sort:{field:"id",desc:!1},specFields:[{name:"name",type:String,sortable:!0},{name:"status",label:"Status",type:String,sortable:!0},{name:"updated_at",label:"Last Updated",type:Date,sortable:!0}]}},computed:{group(){return this.$store.getters["groups/currentItemOrNew"]},hasSpecifications(){return this.group.expert_panel.specifications&&this.group.expert_panel.specifications.length>0},specifications(){return this.group.expert_panel.specifications}},watch:{group(b){this.$store.dispatch("groups/getSpecifications",b)}},mounted(){this.$store.dispatch("groups/getSpecifications",this.group)},methods:{goToCspec(){window.location="https://cspec.genome.network/"}}},No={key:0,class:"well mb-2"},Ro={key:1},$o={class:"mb-2"},jo=["href"],Bo=["disabled"];function qo(b,s,_,o,m,g){const k=N("icon-arrow-right"),I=N("note");return n(),i("div",null,[g.hasSpecifications?(n(),i("div",Ro,[e("table",$o,[s[0]||(s[0]=e("thead",null,[e("tr",null,[e("th",null,"Specification Name"),e("th",null,"Status"),e("th",null,"Last Updated"),e("th",null," ")])],-1)),e("tbody",null,[(n(!0),i(V,null,J(g.specifications,G=>(n(),i("tr",{key:G.id},[e("td",null,u(G.name),1),e("td",null,u(G.status),1),e("td",null,u(b.formatDate(G.updated_at)),1),e("td",null,[e("ul",null,[e("li",null,[e("a",{target:"cspec_edit",href:`https://cspec.genome.network/cspec/ed/svi/doc/${G.cspec_id}`},"Edit",8,jo)])])])]))),128))])])])):(n(),i("div",No," No specifications on record in the CSPEC Registry. ")),e("a",{class:"btn btn-lg blue",target:"cspec-editor",disabled:_.readonly,href:"https://cspec.genome.network/"},[s[1]||(s[1]=P(" Go to the CSpec Registry ")),O(k,{class:"inline"})],8,Bo),O(I,{class:"mt-2"},{default:U(()=>s[2]||(s[2]=[P(" It may take up to an hour for the latest updates in the CSPEC Registry to display here. ")])),_:1})])}const Ko=xe(Uo,[["render",qo]]),Ho=et.documentsTypes,zo={props:{documentTypeId:{type:[Number,Array],required:!0},step:{type:Number,required:!1,default:null},showNotes:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["saved","canceled"],data(){return{newDocument:{file:null,date_received:new Date().toISOString(),step:this.step},errors:{},activeDocument:{},showDeleteConfirmation:!1}},computed:{group(){return this.$store.getters["groups/currentItemOrNew"]},documents(){return this.group.documents.filter(b=>this.docTypeIsArray?this.documentTypeId.includes(b.document_type_id):b.document_type_id===this.documentTypeId)},docTypeIsArray(){return Array.isArray(this.documentTypeId)},filteredTypes(){return this.docTypeIsArray?Object.values(Ho).filter(b=>this.documentTypeId.includes(b.id)).map(b=>({label:b.long_name,value:b.id})):[]},document_type_id(){return this.docTypeIsArray?null:this.documentTypeId}},mounted(){this.$store.dispatch("groups/getDocuments",this.group)},methods:{async save(){try{const b=new FormData;Object.entries(this.newDocument).forEach(([s,_])=>{_!=null&&b.append(s,_)}),b.set("file",this.$refs.fileInput.files[0]),b.set("document_type_id",this.documentTypeId),await this.$store.dispatch("groups/addApplicationDocument",{group:this.group,data:b}),this.clearForm(),this.$emit("saved")}catch(b){We(b)&&(this.errors=b.response.data.errors)}},cancel(){this.clearForm(),this.$emit("canceled")},clearForm(){this.initNewDocument(),this.clearErrors()},initNewDocument(){this.$refs.fileInput.value=null,this.newDocument={file:null,date_received:Je(new Date),date_reviewed:null,step:this.step,document_type_id:this.documentTypeId,notes:null}},clearErrors(){this.errors={}},initDownload(b){window.location=b.download_url},initDelete(b){this.activeDocument=b,this.showDeleteConfirmation=!0},cancelDelete(){this.showDeleteConfirmation=!1,this.resetActiveDocument()},async commitDelete(){await this.$store.dispatch("groups/deleteDocument",{group:this.group,document:this.activeDocument}),this.showDeleteConfirmation=!1,this.resetActiveDocument()},resetActiveDocument(){this.activeDocument={type:{}}}}},Qo={key:0,class:"table"},Xo={key:0},Yo=["href"],Zo={class:"note"},Jo={key:0},Wo={key:1},ea={ref:"fileInput",type:"file"},ta={key:0},sa={key:0,class:"mb-3"};function oa(b,s,_,o,m,g){const k=N("dropdown-item"),I=N("dropdown-menu"),G=N("input-row"),R=N("button-row"),j=N("modal-dialog");return n(),i("div",null,[g.documents.length>0?(n(),i("table",Qo,[e("thead",null,[e("tr",null,[s[3]||(s[3]=e("th",null,"File",-1)),g.docTypeIsArray?(n(),i("th",Xo," Type ")):v("",!0),s[4]||(s[4]=e("th",null,"uploaded",-1)),s[5]||(s[5]=e("th",null,null,-1))])]),e("tbody",null,[(n(!0),i(V,null,J(g.documents,C=>(n(),i("tr",{key:C.id,class:"p-1 border"},[e("td",null,[e("a",{href:C.download_url},u(C.filename),9,Yo),e("span",Zo," (v. "+u(C.version)+")",1)]),g.docTypeIsArray?(n(),i("td",Jo,u(C.type.long_name),1)):v("",!0),e("td",null,u(b.formatDate(C.created_at)),1),e("td",null,[O(I,{"hide-cheveron":""},{label:U(()=>s[6]||(s[6]=[e("button",{class:"btn btn-xs"}," … ",-1)])),default:U(()=>[O(k,{onClick:h=>g.initDownload(C)},{default:U(()=>s[7]||(s[7]=[P(" Download ")])),_:2},1032,["onClick"]),b.hasAnyPermission(["ep-applications-manage",["application-edit",g.group]])?(n(),ue(k,{key:0,onClick:h=>g.initDelete(C)},{default:U(()=>s[8]||(s[8]=[P(" Delete ")])),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)])]))),128))])])):v("",!0),_.readonly?v("",!0):(n(),i("div",Wo,[g.docTypeIsArray?(n(),ue(G,{key:0,modelValue:m.newDocument.document_type_id,"onUpdate:modelValue":s[0]||(s[0]=C=>m.newDocument.document_type_id=C),label:"Document type",type:"select",options:g.filteredTypes},null,8,["modelValue","options"])):v("",!0),O(G,{label:"Document",errors:m.errors.file},{default:U(()=>[e("input",ea,null,512)]),_:1},8,["errors"]),e("button",{class:"btn blue",onClick:s[1]||(s[1]=(...C)=>g.save&&g.save(...C))}," Upload ")])),(n(),ue(tt,{to:"body"},[O(j,{modelValue:m.showDeleteConfirmation,"onUpdate:modelValue":s[2]||(s[2]=C=>m.showDeleteConfirmation=C),title:`You are about to delete ${m.activeDocument.filename}`},{default:U(()=>[m.activeDocument?(n(),i("div",ta,[m.activeDocument.is_final?(n(),i("p",sa," This version has been tagged as the final version of the document. ")):v("",!0),s[9]||(s[9]=e("p",null,"Are you sure you want to continue?",-1)),O(R,{"submit-text":"Delete Document",onCanceled:g.cancelDelete,onSubmitted:g.commitDelete},null,8,["onCanceled","onSubmitted"])])):v("",!0)]),_:1},8,["modelValue","title"])]))])}const aa=xe(zo,[["render",oa]]),la={name:"SpecificationsSection",components:{CspecSummary:Ko,ApplicationUploadForm:aa},props:{docTypeId:{required:!0,type:[Number,Array]},readonly:{type:Boolean,default:!1}},data(){return{}},computed:{cspecSummaryEnabled(){return this.$store.state.systemInfo.app.features.cspec_summary},specificationUpload(){return this.$store.state.systemInfo.app.features.specification_upload}},methods:{}};function na(b,s,_,o,m,g){const k=N("CspecSummary"),I=N("ApplicationUploadForm"),G=N("collapsible");return n(),i("div",null,[g.cspecSummaryEnabled?(n(),ue(k,{key:0,readonly:_.readonly},null,8,["readonly"])):v("",!0),O(G,{class:"mt-4"},{title:U(()=>s[0]||(s[0]=[e("h3",null,"Legacy document-based specifications",-1)])),default:U(()=>[g.specificationUpload?(n(),ue(I,{key:0,"document-type-id":_.docTypeId,"show-notes":!1,readonly:_.readonly},null,8,["document-type-id","readonly"])):v("",!0)]),_:1})])}const ca=xe(la,[["render",na]]);export{da as G,ca as S,ua as V};
//# sourceMappingURL=SpecificationsSection-BzUZwJ9M.js.map
