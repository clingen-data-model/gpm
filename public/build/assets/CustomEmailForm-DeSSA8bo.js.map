{"version":3,"file":"CustomEmailForm-DeSSA8bo.js","sources":["../../../resources/js/components/mail/RecipientInput.vue","../../../resources/js/components/mail/CustomEmailForm.vue"],"sourcesContent":["<script>\nimport {debounce} from 'lodash-es'\n\nexport default {\n    name: 'RecipientInput',\n    props: {\n        modelValue: {\n            type: Array,\n            default: () => []\n        }\n    },\n    emits: [\n        'update:modelValue',\n    ],\n    data() {\n        return {\n            newRecipients: []\n        }\n    },\n    computed: {\n        recipientsString: {\n            get () {\n                if (!this.modelValue) {\n                    return '';\n                }\n                return this.modelValue.map(i => i.address).join(\"\\n\")\n            },\n            set (value) {\n                this.debounceInput(value);\n            }\n        }\n\n    },\n    created () {\n        this.debounceInput = debounce((value) => {\n            const pattern = /[\\n,;]/;\n            const newRecipients = value.split(pattern)\n                                    .map(i => ({name: null, address: i.trim()}))\n                                    .filter(i => {\n                                        return i.address !== null\n                                    });\n            this.$emit('update:modelValue', newRecipients)\n        }, 1000)\n    },\n    methods: {\n    }\n}\n</script>\n<template>\n  <div>\n    <textarea v-model=\"recipientsString\" rows=\"5\" class=\"w-full\" />\n  </div>\n</template>\n","<script>\nimport { api, isValidationError } from '@/http';\nimport RecipientInput from './RecipientInput.vue';\nimport RichTextEditor from '@/components/prosekit/RichTextEditor.vue';\n\nexport default {\n    name: 'CustomEmailForm',\n    components: {\n      RecipientInput,\n      RichTextEditor,\n    },\n    props: {\n        mailData: {\n            type: Object,\n            required: false\n        }\n    },\n    emits: [\n      'sent',\n      'canceled',\n    ],\n    data() {\n        return {\n            workingCopy: {},\n            showBcc: false,\n            showCc: false,\n            errors: {}\n        }\n    },\n    computed: {\n        toErrors () {\n            return this.assembleErrorsForAddressField('to')\n        },\n        ccErrors () {\n            return this.assembleErrorsForAddressField('cc')\n        },\n        bccErrors () {\n            return this.assembleErrorsForAddressField('bcc')\n        }\n    },\n    watch: {\n        mailData: {\n            immediate: true,\n            handler (to) {\n                this.workingCopy = to || {};\n                this.showCc = false;\n                // eslint-disable-next-line eqeqeq\n                if (this.workingCopy.cc !== null && this.workingCopy.cc != []) {\n                    this.showCc = true;\n                }\n                this.showBcc = false;\n                // eslint-disable-next-line eqeqeq\n                if (this.workingCopy.bcc !== null && this.workingCopy.bcc != []) {\n                    this.showBcc = true;\n                }\n            }\n        }\n    },\n    methods: {\n        async sendMail () {\n            try {\n                this.cleanData()\n                await api.post(`/api/mail`, this.workingCopy)\n                this.$emit('sent');\n                this.errors = {};\n            } catch(error) {\n                if (isValidationError(error)) {\n                    this.errors = error.response.data.errors\n                    return;\n                }\n                throw error;\n            }\n        },\n        cleanData () {\n            this.workingCopy.to = this.workingCopy.to ? this.workingCopy.to.filter(i => i.address !== '') : null;\n            this.workingCopy.cc = this.workingCopy.cc ? this.workingCopy.cc.filter(i => i.address !== '') : null;\n            this.workingCopy.bcc = this.workingCopy.bcc ? this.workingCopy.bcc.filter(i => i.address !== '') : null;\n        },\n        assembleErrorsForAddressField (field) {\n            let addressErrors = [];\n            const pattern = new RegExp(`${field}.\\\\d+.address`);\n\n            Object.keys(this.errors).filter(key => {\n                    return key.match(pattern)\n                })\n                .forEach(key => {\n                    addressErrors = [...addressErrors, ...this.errors[key]];\n                });\n\n            const set = new Set([\n                ...(this.errors.to || []),\n                ...addressErrors\n            ]);\n            return [...set];\n        }\n\n    }\n}\n</script>\n<template>\n  <div>\n    <input-row label=\"To\" :errors=\"toErrors\">\n      <RecipientInput v-model=\"workingCopy.to\" />\n    </input-row>\n    <input-row label=\"Cc\" :errors=\"errors.ccErrors\">\n      <RecipientInput v-show=\"showCc\" v-model=\"workingCopy.cc\" />\n\n      <div v-if=\"workingCopy.cc && workingCopy.cc.length > 0 && !showCc\">\n        <truncate-expander :value=\"workingCopy.cc.map(i => i.address).join(', ')\" :truncate-length=\"100\" />\n      </div>\n\n      <button class=\"btn btn-xs\" @click=\"showCc = !showCc\">\n        {{ showCc ? 'Hide Cc' : 'Show Cc' }}\n      </button>\n    </input-row>\n    <input-row label=\"Bcc\" :errors=\"bccErrors\">\n      <RecipientInput v-show=\"showBcc\" v-model=\"workingCopy.bcc\" />\n      <button class=\"btn btn-xs\" @click=\"showBcc = !showBcc\">\n        {{ showBcc ? 'Hide Bcc' : 'Show Bcc' }}\n      </button>\n    </input-row>\n    <input-row label=\"Subject\" :errors=\"errors.subject\">\n      <input v-model=\"workingCopy.subject\" type=\"text\" class=\"w-full\">\n    </input-row>\n\n    <input-row label=\"Body\" :errors=\"errors.body\">\n      <RichTextEditor v-model=\"workingCopy.body\" :markdown-format=\"false\" />\n    </input-row>\n\n    <input-row label=\"Attachments\" :errors=\"errors.attachments\">\n      <input type=\"file\" multiple>\n      <note class=\"mt-2\">\n        Please note that if you are \"Resending\" an email, any attachments on the original email must be re-added.\n      </note>\n    </input-row>\n\n    <button-row submit-text=\"Send\" @submitted=\"sendMail\" @cancel=\"$emit('canceled')\" />\n  </div>\n</template>\n"],"names":["_sfc_main","i","value","debounce","pattern","newRecipients","_createElementBlock","_createElementVNode","_cache","$event","$options","RecipientInput","RichTextEditor","to","api","error","isValidationError","field","addressErrors","key","_createVNode","_component_input_row","_withCtx","_component_RecipientInput","$data","_openBlock","_hoisted_1","_component_truncate_expander","_createCommentVNode","_vModelText","_component_RichTextEditor","_component_note","_createTextVNode","_component_button_row","_ctx"],"mappings":"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"}