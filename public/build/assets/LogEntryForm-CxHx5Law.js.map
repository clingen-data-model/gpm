{"version":3,"file":"LogEntryForm-CxHx5Law.js","sources":["../../../resources/js/components/log_entries/LogEntryForm.vue"],"sourcesContent":["<script>\nimport {mapGetters} from 'vuex'\nimport { formatDate } from '@/date_utils'\nimport StepInput from '@/components/forms/StepInput.vue'\nimport RichTextEditor from '@/components/prosekit/RichTextEditor.vue'\nimport {logEntries, saveEntry, updateEntry} from '@/adapters/log_entry_repository'\n\nexport default {\n    name: 'LogEntryForm',\n    components: {\n        StepInput,\n        RichTextEditor\n    },\n    props: {\n        id: {\n            required: false,\n            default: null\n        }\n    },\n    emits: [\n        'canceled',\n        'saved',\n    ],\n    setup () {\n        return {\n            logEntries\n        }\n    },\n    data() {\n        return {\n            newEntry: {\n                log_date: new Date(),\n                step: null,\n                entry: ''\n            },\n            errors: {},\n        }\n    },\n    computed: {\n        ...mapGetters({\n            group: 'groups/currentItemOrNew'\n        }),\n        application () {\n            return this.group.expert_panel;\n        }\n    },\n    watch: {\n        id: {\n            immediate: true,\n            handler() {\n                const entry = this.findEntry();\n                if (entry) {\n                    this.syncEntry(entry)\n                }\n            }\n        },\n        application: {\n            immediate: true,\n            handler () {\n                const entry = this.findEntry();\n                if (entry) {\n                    this.syncEntry(entry);\n                }\n            }\n        }\n    },\n    mounted() {\n        this.$el.querySelectorAll('input')[0].focus();\n    },\n    methods: {\n        findEntry () {\n            if (this.id === null) {\n                return null;\n            }\n            if (this.logEntries) {\n                return this.logEntries.find(i => i.id === this.id);\n            }\n        },\n        initNewEntry () {\n            this.newEntry = {\n                log_date: formatDate(new Date),\n                step: null,\n                entry: ''\n            }\n        },\n        syncEntry (entry) {\n            if (!entry) {\n                return;\n            }\n            this.newEntry = {\n                id: entry.id,\n                log_date: formatDate(new Date(Date.parse((entry.created_at)))),\n                step: Number.parseInt(entry.step),\n                entry: entry.description\n            }\n        },\n        cancel() {\n            this.initNewEntry();\n            this.$emit('canceled');\n        },\n        async save() {\n            try {\n                if (this.newEntry.id) {\n                    updateEntry(`/api/groups/${this.group.uuid}/activity-logs/${this.newEntry.id}`, this.newEntry);\n                } else {\n                    saveEntry(`/api/groups/${this.group.uuid}/activity-logs`, this.newEntry)\n                }\n                this.initNewEntry();\n                this.$emit('saved');\n            } catch (error) {\n                if (error.response && error.response.status === 422 && error.response.data.errors) {\n                    this.errors = error.response.data.errors\n                }\n            }\n        },\n    },\n}\n</script>\n<template>\n  <form-container class=\"log-entry-form\">\n    <input-row v-model=\"newEntry.log_date\" label=\"Log Date\" :errors=\"errors.log_date\" type=\"date\" />\n    <StepInput v-if=\"application.expert_panel_type_id == 2\" v-model=\"newEntry.step\" :errors=\"errors.step\" />\n    <input-row label=\"Entry\" :errors=\"errors.entry\">\n      <RichTextEditor v-model=\"newEntry.entry\" />\n    </input-row>\n    <button-row>\n      <button class=\"btn\" @click=\"cancel\">\n        Cancel\n      </button>\n      <button class=\"btn blue\" @click=\"save\">\n        Save\n      </button>\n    </button-row>\n  </form-container>\n</template>\n"],"names":["_sfc_main","StepInput","RichTextEditor","logEntries","mapGetters","entry","i","formatDate","updateEntry","saveEntry","error","_createBlock","_component_form_container","_withCtx","_createVNode","_component_input_row","$data","_cache","$event","$options","_component_StepInput","_createCommentVNode","_component_RichTextEditor","_component_button_row","_createElementVNode","args"],"mappings":"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"}