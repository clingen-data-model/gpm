import{_ as w,c as d,d as i,f as a,h as _,e as h,j as P,a as m,w as U,F as p,m as b,a1 as x,p as c,b7 as f,A as y,b as l}from"./app-uoJXbb9N.js";const E={name:"UserDetail",props:{id:{require:!0}},data(){return{user:new f,membershipFields:[{name:"id"},{name:"group"},{name:"roles"},{name:"extra_permissions"}],showEditForm:!1,systemRoles:[],systemPermissions:Object.values(y.system.permissions),configs:y,checkedRoles:[],checkedPermissions:[]}},computed:{userInfo(){return{name:this.user.person.name,email:this.user.person.email,roles:this.user.roles.map(e=>e.name).join(", "),additional_permissions:this.user.permissions.map(e=>e.name).join(", "),registered:this.formatDate(this.user.created_at)}},membershipInfo(){return this.user.person.memberships.map(e=>({id:e.id,group:e.group.display_name,roles:e.roles.map(s=>s.name).join(", "),extra_permissions:e.permissions.map(s=>s.name).join(", ")||"",is_contact:e.is_contact?"Yes":"No"}))},checkedRolePermissionIds(){if(!this.systemRoles)return[];const e=this.systemRoles.filter(s=>this.checkedRoles.includes(s.id)).map(s=>s.permissions).flat().map(s=>s.id);return[...new Set(e)]},availableSystemRoles(){return this.systemRoles.filter(e=>this.hasRole("super-user")?!0:this.hasRole("super-admin")?e.name!=="super-user":!1)},availableSystemPermissions(){return this.systemPermissions.filter(e=>this.hasRole("super-user")?!0:this.hasRole("super-admin")?e.name!=="logs-view":!1)},canEditUser(){const e=this.$store.getters.currentUser;return this.hasPermission("users-manage")?!!(this.currentUserIsUser||e.hasRole("super-user")||e.hasRole("super-admin")&&(this.user.hasRole("admin")||this.user.hasNoRole())):!1},currentUserIsUser(){return Number.parseInt(this.$store.getters.currentUser.id)===Number.parseInt(this.user.id)}},watch:{id:{immediate:!0,handler(){this.getUser()}}},mounted(){this.getSystemRoles()},methods:{async getUser(){this.user=await c.get(`/api/users/${this.id}`).then(e=>new f(e.data)),this.resetCheckedRolesAndPermissions()},resetCheckedRolesAndPermissions(){this.checkedRoles=this.user.roles.map(e=>e.id),this.checkedPermissions=this.user.permissions.map(e=>e.id)},async getSystemRoles(){this.systemRoles=await c.get("/api/roles").then(e=>e.data)},initEdit(){this.showEditForm=!0},async saveRolesAndPermissions(){const e={role_ids:this.checkedRoles,permission_ids:this.checkedPermissions};await c.put(`/api/users/${this.user.id}/roles-and-permissions`,e),this.showEditForm=!1,this.getUser()},closeEditForm(){this.resetCheckedRolesAndPermissions(),this.showEditForm=!1}}},F={class:"flex flex-wrap"},S={class:"flex flex-wrap"},V={class:"px-2 py-1 mb-2 mt-4 bg-gray-100 border relative text-xs"},C={class:"flex space-x-2"};function j(e,s,I,N,o,r){const R=m("object-dictionary"),k=m("data-table"),n=m("checkbox"),g=m("button-row"),v=m("modal-dialog");return l(),d("div",null,[i("h1",null,P(o.user.person.name||"loading..."),1),a(R,{obj:r.userInfo},null,8,["obj"]),r.canEditUser?(l(),d("button",{key:0,class:"btn btn-xs",onClick:s[0]||(s[0]=(...t)=>r.initEdit&&r.initEdit(...t))}," Edit system roles & permissions ")):_("",!0),s[8]||(s[8]=i("h2",{class:"mt-8 mb-2"}," Memberships ",-1)),a(k,{fields:o.membershipFields,data:r.membershipInfo},null,8,["fields","data"]),(l(),h(x,{to:"body"},[a(v,{modelValue:o.showEditForm,"onUpdate:modelValue":s[3]||(s[3]=t=>o.showEditForm=t),title:"Edit System Roles & Permissions"},{default:U(()=>[s[6]||(s[6]=i("h3",{class:"border-b mb-1"}," Roles ",-1)),i("ul",F,[(l(!0),d(p,null,b(r.availableSystemRoles,t=>(l(),d("li",{key:t.id,class:"w-1/3 h-12"},[a(n,{modelValue:o.checkedRoles,"onUpdate:modelValue":s[1]||(s[1]=u=>o.checkedRoles=u),label:e.titleCase(t.display_name),value:t.id},null,8,["modelValue","label","value"])]))),128))]),s[7]||(s[7]=i("h3",{class:"border-b mb-1"}," Permissions ",-1)),i("ul",S,[(l(!0),d(p,null,b(r.availableSystemPermissions,t=>(l(),d("li",{key:t.id,class:"w-1/3 h-12"},[r.checkedRolePermissionIds.includes(t.id)?(l(),h(n,{key:0,"model-value":!0,disabled:!0,label:t.display_name},null,8,["label"])):(l(),h(n,{key:1,modelValue:o.checkedPermissions,"onUpdate:modelValue":s[2]||(s[2]=u=>o.checkedPermissions=u),label:e.titleCase(t.display_name),value:t.id},null,8,["modelValue","label","value"]))]))),128))]),i("div",V,[i("div",C,[s[4]||(s[4]=i("strong",null,"Legend: ",-1)),a(n,{label:"Not granted"}),a(n,{value:1,"model-value":!0,label:"Granted"}),a(n,{value:2,"model-value":!0,disabled:"",label:"Granted w/ role"})]),s[5]||(s[5]=i("div",{class:"absolute top-0 left-0 w-full h-full bg-pink-500 opacity-0"}," Â  ",-1))]),a(g,{"submit-text":"Save",onSubmitted:r.saveRolesAndPermissions,onCanceled:r.closeEditForm},null,8,["onSubmitted","onCanceled"])]),_:1},8,["modelValue"])]))])}const B=w(E,[["render",j]]);export{B as default};
//# sourceMappingURL=UserDetail-CoNaDvIt.js.map
