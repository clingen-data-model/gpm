import{s as me,p as T,r as R,q as C,a2 as W,af as J,o as K,a as h,c as w,b as d,f as a,v as V,k as de,d as u,e as M,C as B,h as x,j as v,w as c,i as b,aG as G,a8 as L,F as O,m as z,n as Y,g as E,$ as pe,am as F,x as ve}from"./app-xUpSbDwL.js";import{_ as _e,a as ye}from"./ExpertisesView-f_XRcQNL.js";import{E as fe}from"./EvidenceSummaryList-CdHc_U-7.js";class Q{constructor(t,e={}){this.baseUrl=t,this.options=e}query(t){const e=me(t);return T.get(this.baseUrl+e).then(o=>this.transformToEntity(o.data))}find(t){return T.get(`${this.baseUrl}/${t}`).then(e=>this.transformToEntity(e.data))}save(t){return T.post(this.baseUrl,t).then(e=>this.transformToEntity(e.data))}update(t){return T.put(`${this.baseUrl}/${t.id}`,t).then(e=>this.transformToEntity(e.data))}destroy(t){return T.delete(`${this.baseUrl}/${t.id}`)}transformToEntity(t){return this.options.entityClass&&Array.isArray(t)?t.map(e=>new this.options.entityClass(e)):t}}const D=new Q("/api/comments");D.resolve=l=>T.post(`/api/comments/${l}/resolved`).then(t=>t.data);D.unresolve=l=>T.post(`/api/comments/${l}/unresolved`).then(t=>t.data);const U={internal:1,suggestion:2,requirement:3},be=(l,t)=>{const e=R([]),o=C(()=>e.value.filter(n=>!n.is_resolved)),_=C(()=>o.value.filter(n=>n.comment_type_id===U.requirement)),p=C(()=>o.value.filter(n=>n.comment_type_id===U.suggestion)),g=C(()=>[..._.value,...p.value]),i=C(()=>o.value.filter(n=>n.comment_type_id===U.internal)),s=n=>e.value.findIndex($=>$.id===n.id);return{subject:{type:l,id:t},comments:e,openComments:o,openRequirements:_,openSuggestions:p,openInternal:i,getComments:async()=>{e.value=await D.query({where:{subject_type:l,subject_id:t}})},addComment:n=>e.value.push(n),removeComment:n=>e.value.splice(s(n),1),updateComment:n=>e.value[s(n)]=n,commentsForEp:g}};class ge{constructor(t,e){this.fields=t,this.repo=e,this.currentItem=R({}),this.originalItem=R({}),this.errors=R({})}async find(t){return await this.repo.find(t).then(e=>(this.currentItem.value=e,this.originalItem.value=e,e))}async save(t){this.clearErrors();try{const e=await this.repo.save(t);return this.clearCurrentItem(),e}catch(e){throw W(e)&&(this.errors.value=e.response.data.errors),e}}async update(t){this.clearErrors();try{return this.currentItem.value=this.repo.update(t),this.currentItem.value}catch(e){throw W(e)&&(this.errors.value=e.response.data.errors),e}}async destroy(t){this.repo.destroy(t)}cancel(){this.clearErrors(),this.currentItem.value.id||this.clearCurrentItem()}clearCurrentItem(){this.currentItem.value={}}clearErrors(){this.errors.value={}}}class we extends Q{constructor(t,e={}){super(t,e),this.cachedList=null}query(t){if(!this.cachedList){const e=super.query(t);this.cachedList=e}return this.cachedList}find(t){throw new Error("CommentTypeRepository.find not implemented")}save(t){throw new Error("CommentTypeRepository.save not implemented")}update(t){throw new Error("CommentTypeRepository.update not implemented")}destroy(t){throw new Error("CommentTypeRepository.destroy not implemented")}}const he=new we("/api/comment-types"),H=R([]),Ce=async()=>await he.query().then(l=>(H.value=l.map(t=>({label:t.name,value:t.id})),H.value)),ke=R([{name:"comment_type_id",label:"Type",type:"select",options:H,required:!0},{name:"content",label:"Comment",type:"large-text",required:!0}]),X=()=>(Ce(),new ge(ke,D)),P={__name:"ReviewCommentForm",props:{commentManager:{type:Object,required:!0},section:{type:[String,null],default:null},subjectType:{type:String,default:"App\\Modules\\Group\\Models\\Group"},subjectId:{type:Number,required:!1},comment:{type:Object},onlyInternal:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(l,{emit:t}){const e=l,o=t,_=J("group"),p=X();K(()=>{e.comment&&(p.currentItem.value=e.comment)});const g=C(()=>{const n=[...p.fields.value];if(e.onlyInternal){const $=n.findIndex(A=>A.name==="comment_type_id");n.splice($,1)}return n}),i=C(()=>p.errors.value),s=C({get(){return p.currentItem.value},set(n){p.currentItem.value=n}}),k=()=>{p.clearCurrentItem(),p.clearErrors(),o("canceled")},r=()=>{s.value.subject_type=e.subjectType,s.value.subject_id=e.subjectId||_.value.id,s.value.metadata={section:e.section,root_subject_type:"App\\Modules\\Group\\Models\\Group",root_subject_id:_.value.id},e.onlyInternal&&(s.value.comment_type_id=1),p.save(s.value).then(n=>{e.commentManager.addComment(n),o("saved",n)})},m=()=>{e.onlyInternal&&(s.value.comment_type_id=1),p.update(s.value).then(n=>{e.commentManager.updateComment(n),o("saved",n)})},y=()=>{if(s.value.id){m();return}r()};return(n,$)=>{const A=h("data-form"),q=h("button-row");return d(),w("div",null,[a(A,{modelValue:s.value,"onUpdate:modelValue":$[0]||($[0]=N=>s.value=N),fields:g.value,errors:i.value},null,8,["modelValue","fields","errors"]),a(q,{size:"xs","submit-text":"Save",onSubmitted:y,onCanceled:k})])}}},xe={class:"my-2"},$e={class:"comment-container"},Re={key:0,class:"relative"},Ie={class:"flex justify-between items-start mb-1 rounded"},Me={class:"flex space-x-2 items-end"},Se={class:"block"},Ee={class:"flex space-x-2"},je={class:"replies ml-1"},Te={key:0},qe={class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},De={__name:"ReviewComment",props:{comment:{type:Object,required:!0},commentManager:{type:Object,required:!0}},emits:["created","updated","resolved","unresolved","deleted"],setup(l,{emit:t}){const e=l,o=t,_=V(),p=X(),g=R(be("App\\Models\\Comment",e.comment.id)),i=R(!1),s=R(!1),k=I=>{if(!I.type)return"gray";switch(I.type.name){case"required revision":return"yellow";case"suggestion":return"blue";case"internal comment":return"gray"}},r=()=>{s.value=!0},m=()=>{p.destroy(e.comment).then(()=>{s.value=!1,e.commentManager.removeComment(e.comment),o("deleted",e.comment)})},y=async()=>{if(e.comment.is_resolved){const f=await D.unresolve(e.comment.id);e.commentManager.updateComment(f),o("updated"),o("resolved");return}const I=await D.resolve(e.comment.id);e.commentManager.updateComment(I),o("updated"),o("unresolved")},n=R(!1),$=()=>{g.value.getComments().then(I=>(n.value=!0,I))},A=async()=>{n.value||$(),n.value=!n.value},q=R(!1),N=()=>q.value=!0,Z=()=>{const I={...e.comment};I.comments_count+=1,e.commentManager.updateComment(I),n.value=!0,q.value=!1},ee=()=>{const I={...e.comment};I.comments_count-=1,e.commentManager.updateComment(I)};K(()=>{g.value.getComments()});const te=C(()=>de("comments-manage")||_.getters.currentUser.person.id===e.comment.creator_id);return(I,f)=>{const ne=h("badge"),oe=h("icon-checkmark"),se=h("popper"),ae=h("dropdown-menu"),re=h("markdown-block"),le=h("icon-reply"),ie=h("button-row"),ce=h("static-alert"),ue=h("ReviewComment",!0);return d(),w("div",xe,[u("div",$e,[i.value?(d(),M(P,{key:1,comment:l.comment,"comment-manager":l.commentManager,onCanceled:f[2]||(f[2]=j=>i.value=!1),onSaved:f[3]||(f[3]=j=>i.value=!1)},null,8,["comment","comment-manager"])):(d(),w("div",Re,[u("div",Ie,[u("div",Me,[u("strong",Se,v(l.comment.creator&&l.comment.creator.name),1),a(ne,{class:"block",color:k(l.comment),size:"xxs"},{default:c(()=>[b(v(l.comment.type&&I.titleCase(l.comment.type.name)),1)]),_:1},8,["color"]),l.comment.is_resolved?(d(),M(se,{key:0,hover:"",arrow:"",content:"Resolved"},{default:c(()=>[a(oe,{class:"text-green-500",title:"Resolved"})]),_:1})):x("",!0)]),u("div",Ee,[te.value?(d(),M(ae,{key:0,"hide-cheveron":""},{default:c(()=>[a(G,{onClick:f[0]||(f[0]=j=>i.value=!0)},{default:c(()=>f[5]||(f[5]=[b(" Edit ")])),_:1}),a(G,{onClick:y},{default:c(()=>[b(v(l.comment.is_resolved?"Mark unresolved":"Resolve"),1)]),_:1}),a(G,{onClick:r},{default:c(()=>f[6]||(f[6]=[b(" Delete ")])),_:1})]),_:1})):x("",!0)])]),a(re,{markdown:l.comment.content,class:"text-sm"},null,8,["markdown"]),u("button",{class:"link",onClick:N},[a(le,{class:"inline-block"}),f[7]||(f[7]=b("Reply "))]),B(a(ce,{variant:"danger",class:""},{default:c(()=>[f[8]||(f[8]=b(" Continue with delete? ")),a(ie,{size:"xs","submit-text":"Yes, delete","submit-variant":"red",onSubmitted:m,onCanceled:f[1]||(f[1]=j=>s.value=!1)})]),_:1},512),[[L,s.value]])]))]),u("div",je,[n.value?(d(),w("ul",Te,[(d(!0),w(O,null,z(g.value.comments,j=>(d(),w("li",{key:j.id,class:"border-l-2 mt-2 px-2 py-1 bg-gray-100/50"},[a(ue,{comment:j,"comment-manager":g.value,onDeleted:ee},null,8,["comment","comment-manager"])]))),128))])):x("",!0),l.comment.comments_count>0?(d(),w("button",{key:1,class:"link text-sm",onClick:A},v(n.value?"Hide":"Show")+" "+v(l.comment.comments_count)+" "+v(l.comment.comments_count>1?"replies":"reply"),1)):x("",!0),B(u("div",qe,[f[9]||(f[9]=u("strong",null,"Your Reply",-1)),a(P,{"subject-type":"App\\Models\\Comment","subject-id":l.comment.id,"only-internal":!0,"comment-manager":g.value,onSaved:Z,onCanceled:f[4]||(f[4]=j=>q.value=!1)},null,8,["subject-id","comment-manager"])],512),[[L,q.value]])])])}}},Ae={class:"lg:flex lg:space-x-4 screen-block"},Fe={class:"flex justify-between items-start space-x-4"},Be={key:0,class:"flex justify-between items-center lg:w-2/5 px-2 py-1 pb-0 bg-gray-100 rounded-lg"},Le={class:"lg:w-2/5 p-2 bg-gray-100 rounded-lg mb-2"},Ne={class:"flex justify-between items-center"},Ge={class:"bg-white mt-2 p-2"},S={__name:"ReviewSection",props:{title:{type:String||null,default:null},name:{type:String||null,default:null}},setup(l){const t=l,e=J("commentManager"),o=R(!1),_=R(!0),p=C(()=>e?e.value.comments.filter(i=>i.metadata?i.metadata.section===t.name:!1):[]),g=C(()=>e?p.value.find(i=>i.type.name==="required revision")?"yellow":p.value.find(i=>i.type.name==="suggestion")?"blue":"gray":null);return(i,s)=>{const k=h("icon-cheveron-right"),r=h("badge"),m=h("icon-cheveron-down");return d(),w("section",Ae,[u("div",{class:Y(["overflow-x-auto flex-grow",{"lg:w-3/5":_.value}])},[u("header",Fe,[u("h2",{class:Y(["flex-grow",{"lg:w-3/5":!_.value}])},v(l.title),3),E(e)?B((d(),w("div",Be,[u("h3",null,[a(k,{class:"inline cursor-pointer",onClick:s[0]||(s[0]=y=>_.value=!0)}),s[5]||(s[5]=b(" Comments ")),a(r,{color:g.value},{default:c(()=>[b(v(p.value.length),1)]),_:1},8,["color"])])],512)),[[L,!_.value]]):x("",!0)]),u("div",null,[u("div",null,[pe(i.$slots,"default")])])],2),B(u("div",Le,[u("div",Ne,[u("h3",null,[a(m,{class:"inline cursor-pointer",onClick:s[1]||(s[1]=y=>_.value=!1)}),s[6]||(s[6]=b(" Comments "))])]),u("ul",null,[(d(!0),w(O,null,z(p.value,y=>(d(),w("li",{key:y.id,class:"bg-white p-2"},[a(De,{comment:y,"comment-manager":E(e)},null,8,["comment","comment-manager"])]))),128))]),u("div",Ge,[o.value?(d(),M(P,{key:0,section:l.name,"comment-manager":E(e),onSaved:s[2]||(s[2]=y=>o.value=!1),onCanceled:s[3]||(s[3]=y=>o.value=!1)},null,8,["section","comment-manager"])):(d(),w("button",{key:1,class:"btn btn-xs block",onClick:s[4]||(s[4]=y=>o.value=!0)}," Add comment "))])],512),[[L,_.value&&E(e)]])])}}},Ue={__name:"ReviewMembership",props:{members:{required:!0,type:Array}},setup(l){const t=l,e={Chair:1,Coordinator:2,"Grant Liaison":3,Biocurator:4,Expert:5},o=r=>e[r.display_name]??1/0,_=R({field:"roles",desc:!1}),g=R([{name:"name",sortable:!0,label:"Name",sortFunction:(r,m)=>{let y=r.last_name.localeCompare(m.last_name);return y===0&&(y=r.first_name.localeCompare(m.first_name)),y}},{name:"legacy_credentials",sortable:!1,label:"Credentials"},{name:"roles",sortable:!0,label:"Roles",sortFunction:(r,m)=>r.role_priority-m.role_priority},{name:"legacy_expertise",sortable:!1,label:"Expertise"},{name:"institution",sortable:!1,label:"Institution"}]),i=C(()=>t.members.map(r=>{var y;const m=r.roles.toSorted((n,$)=>n.id-$.id);return{id:r.id,first_name:r.person.first_name,last_name:r.person.last_name,name:r.person.name,institution:(y=r.person.institution)==null?void 0:y.name,legacy_credentials:r.person.legacy_credentials,legacy_expertise:r.legacy_expertise,roles:m,role_priority:Math.min(...m.map(o)),active:r.isActive,person:r.person}}).filter(r=>r.active)),s=(r,m)=>{r[m]||(r[m]=0),r[m]++},k=C(()=>{const r={};return r.Total=i.value.length,console.log(i.value),Object.keys(e).forEach(m=>r[m]=0),i.value.forEach(m=>{m.roles.forEach(y=>s(r,y.display_name)),m.roles.length===0&&s(r,"None")}),r});return(r,m)=>{const y=h("data-table");return d(),w("div",null,[(d(!0),w(O,null,z(k.value,(n,$)=>(d(),w("div",{key:$},[u("span",null,v($)+": "+v(n),1)]))),128)),a(y,{sort:_.value,"onUpdate:sort":m[0]||(m[0]=n=>_.value=n),fields:g.value,data:i.value,class:"text-xs"},{"cell-roles":c(({item:n})=>[u("span",null,v(n.roles.map($=>$.display_name).join(", ")),1)]),"cell-legacy_credentials":c(({item:n})=>[a(ye,{person:n.person},null,8,["person"])]),"cell-legacy_expertise":c(({item:n})=>[a(_e,{person:n.person,"legacy-expertise":n.legacy_expertise},null,8,["person","legacy-expertise"])]),_:1},8,["sort","fields","data"])])}}},He={class:"space-y-4"},Pe={key:0,class:"mt-6"},Ve=["innerHTML"],Oe=["innerHTML"],ze={class:"mb-6"},We={key:0},Ye=["innerHTML"],Je={class:"flex-none"},Ke={key:0,class:"mt-1"},ot={__name:"DefinitionReview",setup(l){const t=V(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel),_=C(()=>e.value?e.value.members:[]),p=C(()=>({type:e.value.type.name?e.value.type.name.toUpperCase():"",long_base_name:o.value.long_base_name,short_base_name:o.value.short_base_name}));return(g,i)=>{const s=h("object-dictionary"),k=h("dictionary-row"),r=h("simple-table");return d(),w("div",He,[a(S,{title:"Basic Information",name:"basic-info"},{default:c(()=>[a(s,{obj:p.value,"label-class":"w-40 font-bold"},null,8,["obj"]),a(k,{label:"CDWG","label-class":"w-40 font-bold"},{default:c(()=>[b(v(e.value.parent?e.value.parent.name:"--"),1)]),_:1})]),_:1}),a(S,{title:"Membership",name:"membership"},{default:c(()=>[a(Ue,{members:_.value},null,8,["members"]),e.value.is_vcep_or_scvcep?(d(),w("div",Pe,[i[0]||(i[0]=u("h4",null,"Expertise of VCEP members",-1)),u("blockquote",{innerHTML:o.value.membership_description},null,8,Ve)])):x("",!0)]),_:1}),a(S,{title:"Website Description",name:"website-description"},{default:c(()=>[u("blockquote",{innerHTML:e.value.description},null,8,Oe)]),_:1}),a(S,{title:"Scope",name:"scope"},{default:c(()=>[i[1]||(i[1]=u("h3",null,"Genes",-1)),u("div",ze,[e.value.is_gcep?(d(),w("p",We,v(o.value.genes.map(m=>m.gene_symbol).join(", ")),1)):x("",!0),e.value.is_vcep_or_scvcep?(d(),M(r,{key:1,data:o.value.genes.map(m=>({id:m.id,gene:m.gene_symbol,disease:m.disease_name})),"key-by":"id","hide-columns":["id"]},null,8,["data"])):x("",!0)]),i[2]||(i[2]=u("h3",null,"Description of scope",-1)),u("blockquote",{innerHTML:o.value.scope_description},null,8,Ye)]),_:1}),e.value.is_gcep?(d(),M(S,{key:0,title:"Plans",name:"plans"},{default:c(()=>[a(k,{label:"Selected protocol","label-class":"w-48 font-bold"},{default:c(()=>[u("div",Je,[b(v(o.value.curation_review_protocol?g.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(d(),w("p",Ke,[i[3]||(i[3]=u("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):x("",!0)])]),_:1})]),_:1})):x("",!0),e.value.is_gcep?(d(),M(S,{key:1,title:"Attestations",name:"attestations"},{default:c(()=>[a(k,{label:"GCEP Attestation Signed","label-class":"w-52 font-bold"},{default:c(()=>[b(v(E(F)(o.value.gcep_attestation_date)),1)]),_:1}),a(k,{label:"GCI Training Date","label-class":"w-52 font-bold"},{default:c(()=>[b(v(E(F)(o.value.gci_training_date)),1)]),_:1}),a(k,{label:"NHGRI Attestation Signed","label-class":"w-52 font-bold"},{default:c(()=>[b(v(E(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):x("",!0),e.value.is_vcep_or_scvcep?(d(),M(S,{key:2,title:"Attestations",name:"attestations"},{default:c(()=>[a(k,{label:"Reanalysis and Discrepancy Resolution Attestation Signed","label-class":"w-52 font-bold"},{default:c(()=>[b(v(E(F)(o.value.reanalysis_attestation_date)),1)]),_:1}),a(k,{label:"NHGRI Attestation Signed","label-class":"w-60 font-bold"},{default:c(()=>[b(v(E(F)(o.value.nhgri_attestation_date)),1)]),_:1})]),_:1})):x("",!0)])}}},Qe={class:"application-review p-2 bg-gray-100"},Xe={class:"w-full"},Ze={key:0,class:"mt-1"},st={__name:"SustainedCurationReview",setup(l){const t=V(),e=C(()=>t.getters["groups/currentItemOrNew"]),o=C(()=>e.value.expert_panel);return ve(()=>e.value,(_,p)=>{_.id&&(!p||_.id!==p.id)&&t.dispatch("groups/getEvidenceSummaries",e.value)}),(_,p)=>{const g=h("dictionary-row"),i=h("markdown-block");return d(),w("div",Qe,[o.value.has_approved_pilot?(d(),M(S,{key:0,title:"Plans for Ongoing Review and Discrepancy Resolution",name:"discrepency-review"},{default:c(()=>[a(g,{label:"Selected protocol","label-width-class":"w-48 font-bold"},{default:c(()=>[u("div",Xe,[b(v(o.value.curation_review_protocol?_.titleCase(o.value.curation_review_protocol.full_name):null)+" ",1),o.value.curation_review_protocol_id==100?(d(),w("p",Ze,[p[0]||(p[0]=u("em",null,"Details:",-1)),b(" "+v(o.value.curation_review_protocol_other),1)])):x("",!0)])]),_:1}),a(g,{label:"Notes","label-width-class":"w-48 font-bold"},{default:c(()=>[a(i,{markdown:o.value.curation_review_process_notes},null,8,["markdown"])]),_:1})]),_:1})):x("",!0),o.value.has_approved_pilot?(d(),M(S,{key:1,title:"Evidence Summaries",name:"evidence-summaries"},{default:c(()=>[a(fe,{readonly:!0})]),_:1})):x("",!0),o.value.has_approved_pilot?(d(),M(S,{key:2,title:"Core Approval Member, Trained Biocurator, and Biocurator Trainer Designation",name:"member-designation"},{default:c(()=>[a(g,{label:"Core Approval Members","label-width-class":"w-48 font-bold"},{default:c(()=>[b(v(e.value.coreApprovalMembers.map(s=>s.person.name).join(", ")),1)]),_:1}),a(g,{label:"Biocurator Trainers","label-width-class":"w-48 font-bold"},{default:c(()=>[b(v(e.value.biocuratorTrainers.map(s=>s.person.name).join(", ")),1)]),_:1}),a(g,{label:"Trained Biocurators","label-width-class":"w-48 font-bold"},{default:c(()=>[b(v(e.value.trainedBiocurators.map(s=>s.person.name).join(", ")),1)]),_:1})]),_:1})):x("",!0)])}}};export{st as _,ot as a,be as c};
//# sourceMappingURL=SustainedCurationReview-DDs00FWB.js.map
