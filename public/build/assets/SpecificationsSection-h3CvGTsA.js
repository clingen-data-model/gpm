import{_ as be,r as f,q as U,c as r,d as e,h as y,C as K,D as Ie,Z,F,m as J,j as u,i as P,a5 as he,p as te,v as Le,b as n,f as M,n as xe,w as N,a0 as De,an as He,aL as ze,aM as Qe,aN as Xe,y as Ye,o as Ze,aO as Pe,e as ie,a as R,aP as Te,aQ as Je,am as We,a2 as et,A as tt,a1 as st}from"./app-kcWpDedC.js";const ot={class:"space-y-3"},at={class:"mb-3 flex items-center justify-between border rounded-lg bg-white px-3 py-2"},lt={class:"flex items-center gap-3"},nt=["checked"],it={class:"flex items-center gap-2"},rt=["value"],dt={class:"flex items-center gap-3"},ut={class:"flex items-center gap-2"},ct=["aria-label"],pt={class:"flex items-center gap-2"},mt=["value"],vt={key:0,class:"flex items-center gap-2 bg-gray-50 p-3 border rounded"},_t=["disabled"],yt={key:1,class:"p-6 text-center text-sm text-gray-500 border rounded-lg bg-white"},bt={key:2,class:"space-y-2"},ft={class:"rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm hover:shadow transition-shadow"},gt={class:"flex items-start justify-between gap-3 p-3"},xt={class:"flex items-start gap-3"},ht={key:0,class:"mt-1"},kt=["checked","onChange","aria-label"],wt={class:"flex flex-wrap items-center gap-2"},St={class:"text-base font-semibold text-gray-900"},Ct={class:"mt-0.5 text-sm text-gray-700 truncate"},Tt={class:"flex items-center gap-2"},Dt=["onClick","aria-expanded","aria-controls"],Gt=["onUpdate:modelValue","onChange","disabled"],At={key:0,class:"text-xs text-gray-500"},Vt=["disabled","onClick"],Et={key:2,class:"text-xs text-gray-700"},Pt=["id"],It={class:"space-y-2"},Lt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"},Ft={class:"text-gray-900"},Mt={class:"text-gray-900"},Ot={class:"sm:col-span-2 lg:col-span-1"},Ut={class:"text-gray-900"},Nt={class:"text-gray-900"},Rt={class:"text-gray-900"},jt={class:"text-gray-900"},Bt={class:"text-gray-900"},$t={class:"text-gray-900"},qt={class:"text-gray-900"},Kt={class:"mt-4 flex justify-between items-center"},Ht=["disabled"],zt={class:"text-sm"},Qt=["disabled"],Xt={key:3,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},Yt={class:"bg-white rounded-lg shadow-lg w-96 p-6"},Zt={class:"mb-6"},Jt={__name:"GeneCurationStatus",props:{genes:{type:Array,required:!0,default:()=>[]},groupID:{type:String,required:!0},editing:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["removed"],setup(b,{emit:s}){const v=b,o=s,m=Le(),h=f(""),G=f(""),V=f("gene_symbol"),T=f("asc"),j=f(1),H=f(20),k=f([]),_=f([]),a=f(""),O=f(null),z=f(!1),B=f(!1),E=f(null),x=p=>{E.value=p,B.value=!0},W=()=>{E.value=null,B.value=!1},ne=async()=>{var p;if(E.value)try{await te.delete(`/api/groups/${v.groupID}/expert-panel/genes/${E.value.id}`),B.value=!1,m.commit("pushSuccess",`Successfully removed gene ${E.value.gene_symbol}`);const l=E.value;E.value=null,o("removed",{id:l.id,gene_symbol:l.gene_symbol})}catch(l){m.commit("pushError",(p=l.response)==null?void 0:p.data)}},ee={"Not Curated":0,Uploaded:1,Precuration:2,"Disease entity assigned":3,"Precuration Complete":4,"Curation Provisional":5,"Curation Approved":6,"Recuration assigned":7,"Retired Assignment":8,Published:9},I=U(()=>{const p=new Set;return v.genes.forEach(l=>l.statuses.forEach(C=>p.add(C))),Array.from(p).sort((l,C)=>(ee[l]??0)-(ee[C]??0))}),re=U(()=>{const p=h.value.trim().toLowerCase();return v.genes.filter(l=>{var _e;const C=(_e=l.gene_symbol)==null?void 0:_e.toLowerCase().includes(p),c=(l.expert_panels||[]).some(A=>A==null?void 0:A.toLowerCase().includes(p)),$=(l.details||[]).some(A=>{var ve,ge;return((ve=A==null?void 0:A.disease_name)==null?void 0:ve.toLowerCase().includes(p))||((ge=A==null?void 0:A.mondo_id)==null?void 0:ge.toLowerCase().includes(p))}),g=(l.statuses||[]).some(A=>A==null?void 0:A.toLowerCase().includes(p)),pe=!p||C||c||$||g,me=!G.value||(l.statuses||[]).includes(G.value);return pe&&me})}),se=U(()=>[...re.value].sort((p,l)=>{if(V.value==="statuses"){const $=me=>{const A=(Array.isArray(me.statuses)?me.statuses:[]).map(ve=>ee[ve]??0);return A.length?Math.min(...A):0},g=$(p),pe=$(l);return T.value==="asc"?pe-g:g-pe}if(V.value==="tier"){const $=Number(p.tier||0),g=Number(l.tier||0);return T.value==="asc"?$-g:g-$}let C,c;return V.value==="expert_panel"?(C=(p.expert_panels||[]).join(", ").toLowerCase(),c=(l.expert_panels||[]).join(", ").toLowerCase()):(C=(p.gene_symbol??"").toString().toLowerCase(),c=(l.gene_symbol??"").toString().toLowerCase()),T.value==="asc"?C.localeCompare(c):c.localeCompare(C)})),Q=U(()=>Math.ceil(se.value.length/H.value)),oe=U(()=>{const p=(j.value-1)*H.value;return se.value.slice(p,p+H.value)}),de=p=>{k.value.includes(p)?k.value=k.value.filter(l=>l!==p):k.value.push(p)},ue=p=>{_.value.includes(p)?_.value=_.value.filter(l=>l!==p):_.value.push(p)},ce=()=>{const p=oe.value.map(C=>C.id);p.every(C=>_.value.includes(C))?_.value=_.value.filter(C=>!p.includes(C)):_.value=[...new Set([..._.value,...p])]},S=U(()=>oe.value.every(p=>_.value.includes(p.id))),ke=async p=>{var C;if(v.readonly||!v.editing)return;O.value=p.id;const l=p.tier;try{await te.put(`/api/groups/${v.groupID}/expert-panel/genes/update-tier`,{ids:[p.id],tier:p.tier||null}),m.commit("pushSuccess",`Tier updated for ${p.gene_symbol}`)}catch(c){p.tier=l,m.commit("pushError",`Failed to update tier for ${p.gene_symbol}`),console.error(((C=c==null?void 0:c.response)==null?void 0:C.data)||c)}finally{O.value=null}},we=async()=>{if(!(!a.value||_.value.length===0)){z.value=!0;try{await te.put(`/api/groups/${v.groupID}/expert-panel/genes/update-tier`,{ids:_.value,tier:a.value}),m.commit("pushSuccess",`Tier updated for ${_.value.length} genes`),v.genes.forEach(p=>{_.value.includes(p.id)&&(p.tier=a.value)}),_.value=[],a.value=""}catch{m.commit("pushError","Failed to update tiers in bulk")}finally{z.value=!1}}},fe=()=>{_.value.length!==0&&(_.value=[])};return(p,l)=>{var C;return n(),r("div",ot,[e("div",at,[e("div",lt,[b.editing?(n(),r("input",{key:0,type:"checkbox",checked:S.value,onChange:ce},null,40,nt)):y("",!0),K(e("input",{"onUpdate:modelValue":l[0]||(l[0]=c=>h.value=c),type:"text",placeholder:"Search genes, statuses, diseases…",class:"border rounded px-2 py-1 text-sm w-64"},null,512),[[Ie,h.value]]),e("div",it,[l[9]||(l[9]=e("label",{class:"text-xs text-gray-500"},"Status",-1)),K(e("select",{"onUpdate:modelValue":l[1]||(l[1]=c=>G.value=c),class:"border rounded px-2 py-1 text-sm"},[l[8]||(l[8]=e("option",{value:""},"All",-1)),(n(!0),r(F,null,J(I.value,c=>(n(),r("option",{key:c,value:c},u(c),9,rt))),128))],512),[[Z,G.value]])])]),e("div",dt,[e("div",ut,[l[11]||(l[11]=e("label",{class:"text-xs text-gray-500"},"Sort by",-1)),K(e("select",{"onUpdate:modelValue":l[2]||(l[2]=c=>V.value=c),class:"border rounded px-2 py-1 text-sm"},l[10]||(l[10]=[e("option",{value:"gene_symbol"},"HGNC Symbol",-1),e("option",{value:"expert_panel"},"Expert Panel",-1),e("option",{value:"statuses"},"Status Priority",-1),e("option",{value:"tier"},"Tier",-1)]),512),[[Z,V.value]]),e("button",{class:"border rounded px-2 py-1 text-xs",onClick:l[3]||(l[3]=c=>T.value=T.value==="asc"?"desc":"asc"),"aria-label":`Toggle sort order (currently ${T.value})`,title:"Toggle sort order"},u(T.value==="asc"?"ASC ▲":"DESC ▼"),9,ct)]),e("div",pt,[l[12]||(l[12]=e("label",{class:"text-xs text-gray-500"},"Page size",-1)),K(e("select",{"onUpdate:modelValue":l[4]||(l[4]=c=>H.value=c),class:"border rounded px-2 py-1 text-sm"},[(n(),r(F,null,J([20,50,100],c=>e("option",{key:c,value:c},u(c),9,mt)),64))],512),[[Z,H.value]])])])]),_.value.length>0&&b.editing&&!b.readonly?(n(),r("div",vt,[P(u(_.value.length)+" gene(s) selected. ",1),l[14]||(l[14]=e("span",{class:"font-semibold"},"Bulk Tier Update:",-1)),K(e("select",{"onUpdate:modelValue":l[5]||(l[5]=c=>a.value=c),class:"border rounded px-2 py-1 text-sm"},l[13]||(l[13]=[he('<option value="" data-v-a5c372ba>Select Tier</option><option value="1" data-v-a5c372ba>Tier 1</option><option value="2" data-v-a5c372ba>Tier 2</option><option value="3" data-v-a5c372ba>Tier 3</option><option value="4" data-v-a5c372ba>Tier 4</option>',5)]),512),[[Z,a.value]]),e("button",{class:"bg-blue-600 text-white px-3 py-1 rounded disabled:opacity-50",onClick:we,disabled:!a.value||_.value.length===0||z.value},u(z.value?"Applying…":"Apply"),9,_t),e("button",{type:"button",class:"border rounded px-3 py-1 text-sm bg-white hover:bg-gray-50",onClick:fe,title:"Clear selection"}," Clear ")])):y("",!0),oe.value.length===0?(n(),r("div",yt," No genes found. ")):(n(),r("ul",bt,[(n(!0),r(F,null,J(oe.value,(c,$)=>(n(),r("li",{key:c.id},[e("div",ft,[e("div",gt,[e("div",xt,[b.editing&&!b.readonly?(n(),r("div",ht,[e("input",{type:"checkbox",checked:_.value.includes(c.id),onChange:g=>ue(c.id),"aria-label":`Select ${c.gene_symbol}`},null,40,kt)])):y("",!0),e("div",null,[e("div",wt,[e("span",St,u(c.gene_symbol),1),(c.statuses||[]).length?(n(),r("span",{key:0,class:xe(["text-xs rounded-full px-2 py-0.5 text-gray-700",(c.details||[]).length?"border border-amber-400 bg-amber-50":"border border-gray-400 bg-gray-50"])},u((c.statuses||[]).join(", ")),3)):y("",!0)]),e("div",Ct,[(c.expert_panels||[]).length?(n(),r(F,{key:0},[P(u(c.expert_panels.join(", ")),1)],64)):(n(),r(F,{key:1},[P("—")],64))])])]),e("div",Tt,[(c.details||[]).length?(n(),r("button",{key:0,onClick:g=>de($),class:"rounded border px-2 py-1 text-xs bg-white","aria-expanded":k.value.includes($),"aria-controls":`gene-details-${c.id}`,title:"Toggle details"},u(k.value.includes($)?"Hide Details":"Show Details"),9,Dt)):y("",!0),b.editing&&!b.readonly?(n(),r(F,{key:1},[K(e("select",{"onUpdate:modelValue":g=>c.tier=g,class:"border rounded px-2 py-1 text-xs",onChange:g=>ke(c),disabled:O.value===c.id||b.readonly,title:"Tier"},l[15]||(l[15]=[he('<option value="" data-v-a5c372ba>—</option><option value="1" data-v-a5c372ba>Tier 1</option><option value="2" data-v-a5c372ba>Tier 2</option><option value="3" data-v-a5c372ba>Tier 3</option><option value="4" data-v-a5c372ba>Tier 4</option>',5)]),40,Gt),[[Z,c.tier]]),O.value===c.id?(n(),r("span",At,"Saving…")):y("",!0),e("button",{class:"rounded border px-2 py-1 text-xs bg-white hover:bg-red-50",disabled:p.removingId===c.id,onClick:g=>x(c),title:"Remove gene"},u(p.removingId===c.id?"Removing…":" X "),9,Vt)],64)):(n(),r("span",Et,"Tier: "+u(c.tier||"—"),1))])]),M(De,{name:"fade"},{default:N(()=>[k.value.includes($)?(n(),r("div",{key:0,id:`gene-details-${c.id}`,class:"px-3 pb-3 pt-2 text-sm"},[e("div",It,[(n(!0),r(F,null,J(c.details,g=>(n(),r("div",{key:g.disease_name+g.curation_status+(g.mondo_id||""),class:"rounded-lg border border-gray-200 bg-gray-50 p-2"},[e("div",Lt,[e("div",null,[l[16]||(l[16]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Status",-1)),e("div",Ft,u(g.curation_status||"—"),1)]),e("div",null,[l[17]||(l[17]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Status Date",-1)),e("div",Mt,u(g!=null&&g.date_approved?new Date(g.date_approved).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—"),1)]),e("div",Ot,[l[18]||(l[18]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Expert Panel",-1)),e("div",Ut,u(g.expert_panel||"—"),1)]),e("div",null,[l[19]||(l[19]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Disease",-1)),e("div",Nt,u(g.mondo_id?`${g.mondo_id} ${g.disease_name||""}`:g.disease_name||"—"),1)]),e("div",null,[l[20]||(l[20]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Classification",-1)),e("div",Rt,u(g.classification||"—"),1)]),e("div",null,[l[21]||(l[21]=e("span",{class:"text-[11px] uppercase text-gray-500"},"MOI",-1)),e("div",jt,u(g.moi||"—"),1)]),e("div",null,[l[22]||(l[22]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Type",-1)),e("div",Bt,u(g.curation_type||"—"),1)]),e("div",null,[l[23]||(l[23]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Rationales",-1)),e("div",$t,u(g.rationales||"—"),1)]),e("div",null,[l[24]||(l[24]=e("span",{class:"text-[11px] uppercase text-gray-500"},"Phenotype",-1)),e("div",qt,u(g.phenotypes||"—"),1)])])]))),128))])],8,Pt)):y("",!0)]),_:2},1024)])]))),128))])),e("div",Kt,[e("button",{class:"border rounded px-3 py-1 text-sm",disabled:j.value===1,onClick:l[6]||(l[6]=c=>j.value--)},"Prev",8,Ht),e("span",zt,"Page "+u(j.value)+" of "+u(Q.value),1),e("button",{class:"border rounded px-3 py-1 text-sm",disabled:j.value===Q.value,onClick:l[7]||(l[7]=c=>j.value++)},"Next",8,Qt)]),B.value?(n(),r("div",Xt,[e("div",Yt,[l[27]||(l[27]=e("h3",{class:"text-lg font-semibold mb-4"},"Confirm Removal",-1)),e("p",Zt,[l[25]||(l[25]=P("Are you sure you want to remove ")),e("strong",null,u((C=E.value)==null?void 0:C.gene_symbol),1),l[26]||(l[26]=P("?"))]),e("div",{class:"flex justify-end gap-2"},[e("button",{class:"btn btn-gray",onClick:W},"Cancel"),e("button",{class:"btn btn-red",onClick:ne},"Remove")])])])):y("",!0)])}}},aa=be(Jt,[["__scopeId","data-v-a5c372ba"]]),Wt={name:"VcepGeneList",components:{GeneSearchSelect:Xe,DiseaseSearchSelect:Qe,CuratedGeneSearchSelect:ze,RichTextEditor:He},props:{readonly:{type:Boolean,required:!1,default:!1},editing:{type:Boolean,required:!1,default:!0}},emits:["saved"],setup(b,{emit:s}){const v=Le(),o=f([]),m=f(null),h=f(!1),G=f(!1),V=f(0),T=f({}),j=f([]),H=f(null),k=f(!1),_=f([]),a=f(""),O=f(null),z=f(""),B=f(""),E=f(""),x=f("gene_symbol"),W=f("asc"),ne=f(1),ee=f(20),I=U(()=>v.getters["groups/currentItemOrNew"]),re=U(()=>Ye(["ep-applications-manage",["application-edit",I.value]])&&!b.readonly),se=f(!1),Q=f(null),oe=t=>{Q.value=t,se.value=!0},de=()=>{Q.value=null,se.value=!1},ue=async()=>{if(Q.value)try{await te.delete(`/api/groups/${I.value.uuid}/expert-panel/genes/${Q.value.id}`),se.value=!1,v.commit("pushSuccess",`Successfully removed gene ${Q.value.gene_symbol}`),Q.value=null,await S()}catch(t){v.commit("pushError",t.response.data)}},ce=async()=>{try{const t=await te.get("/api/mois");j.value=t.data}catch(t){v.commit("pushError",t.response.data)}},S=async()=>{var t;if(I.value.uuid)try{await v.dispatch("groups/getGenes",I.value),o.value=I.value.expert_panel.genes}catch(d){v.commit("pushError",((t=d.response)==null?void 0:t.data)||d)}},ke=t=>{x.value===t?W.value=W.value==="asc"?"desc":"asc":(x.value=t,W.value="asc")},we=()=>{G.value=!0,h.value=!1,m.value=null,V.value++},fe=(t="")=>t.replace(/\\([\\`*_{}\[\]()#+\-.!>~|])/g,"$1"),p=t=>{var i,w,D,L;const d=G.value;if(G.value=!0,h.value=t.id,(i=t.plan)!=null&&i.is_other)m.value={id:t.id,is_other:!0,custom_gene:{hgnc_id:t.hgnc_id,gene_symbol:t.gene_symbol},custom_disease:{mondo_id:t.mondo_id,name:t.disease_name},custom_moi:j.value.find(X=>X.abbreviation===t.moi)||null,custom_plan:fe(((w=t.plan)==null?void 0:w.the_plan)||"")};else{const X={...t.plan,is_other:!1,curated_plan_text:((D=t.plan)==null?void 0:D.curated_plan_text)??""};m.value={id:t.id,hgnc_id:t.hgnc_id,gene_symbol:t.gene_symbol,disease_name:t.disease_name,mondo_id:t.mondo_id,moi:t.moi,date_approved:t.date_approved,requires_plan:["Moderate","Limited"].includes((L=t.plan)==null?void 0:L.classification),plan:X,curated_plan_text:fe((X==null?void 0:X.curated_plan_text)||""),is_other:!1}}console.log("Editing gene:",m.value),V.value++,d?qe():k.value=!0},l=()=>{G.value=!1,h.value=!1,m.value=null,T.value={}},C=U(()=>{var t,d,i;return(t=m.value)!=null&&t.is_other?!!((d=m.value.custom_gene)!=null&&d.hgnc_id)&&((i=m.value.custom_plan)==null?void 0:i.trim().length)>=20:!1}),c=()=>{var d;const t=((d=m.value)==null?void 0:d.id)||null;m.value={id:t,is_other:!0,custom_gene:null,custom_disease:null,custom_moi:null,custom_plan:""}},$=t=>{t&&!t.is_other&&(m.value={...t,is_other:!1,requires_plan:["Moderate","Limited"].includes(t.classification),curated_plan_text:Pe("")})},g=U(()=>{var d;return(d=m.value)!=null&&d.requires_plan?(m.value.curated_plan_text||"").replace(/<[^>]+>/g,"").trim().length>=20:!0}),pe=t=>{const d=t!=null&&t.plan&&Object.keys(t.plan).length?t.plan:{},i={curation_id:d.curation_id??t.curation_id,gene_symbol:d.gene_symbol??t.gene_symbol,hgnc_id:d.hgnc_id??t.hgnc_id,hgnc_name:d.hgnc_name??t.hgnc_name??null,disease_name:d.disease_name??t.disease_name,mondo_id:d.mondo_id??t.mondo_id,expert_panel:d.expert_panel??t.expert_panel??null,moi:d.moi??t.moi,moi_name:d.moi_name??t.moi_name??null,hp_id:d.hp_id??t.hp_id??null,classification_id:d.classification_id??t.classification_id??null,classification:d.classification??t.classification??null,curation_status_id:d.curation_status_id??t.curation_status_id??null,curation_type:d.curation_type??t.curation_type??null,curation_status:d.curation_status??t.curation_status??null,date_approved:d.date_approved??t.date_approved??null,phenotypes:d.phenotypes??t.phenotypes??null,phenotypeIDs:d.phenotypeIDs??t.phenotypeIDs??null,checkKey:d.checkKey??t.checkKey??null,is_other:!1,requires_plan:!!(t!=null&&t.requires_plan),curated_plan_text:t!=null&&t.requires_plan?Te((t==null?void 0:t.curated_plan_text)||d.curated_plan_text||""):Te(d.curated_plan_text||"")};return Object.keys(i).forEach(w=>i[w]===void 0&&delete i[w]),i},me=async()=>{var t,d,i,w,D,L,X,Ve,Ee;try{let q;if(m.value.is_other){const Y={is_other:!0,the_plan:Te(m.value.custom_plan),moi_name:((t=m.value.custom_moi)==null?void 0:t.name)||"",hp_id:((d=m.value.custom_moi)==null?void 0:d.hp_id)||""};q={is_other:!0,hgnc_id:((i=m.value.custom_gene)==null?void 0:i.hgnc_id)||null,gene_symbol:((w=m.value.custom_gene)==null?void 0:w.gene_symbol)||"",disease_name:((D=m.value.custom_disease)==null?void 0:D.name)||"",mondo_id:((L=m.value.custom_disease)==null?void 0:L.mondo_id)||"",moi:((X=m.value.custom_moi)==null?void 0:X.abbreviation)||"",plan:Y,date_approved:null}}else{const Y=pe(m.value);q={hgnc_id:m.value.hgnc_id,gene_symbol:m.value.gene_symbol,disease_name:m.value.disease_name,mondo_id:m.value.mondo_id,moi:m.value.moi,date_approved:m.value.date_approved,plan:Y,is_other:!1}}h.value?(await te.put(`/api/groups/${I.value.uuid}/expert-panel/genes/${h.value}`,q),v.commit("pushSuccess",`Successfully updated for ${q.gene_symbol}-${q.mondo_id}-${q.moi}`)):(await te.post(`/api/groups/${I.value.uuid}/expert-panel/genes`,{genes:[q]}),v.commit("pushSuccess",`Successfully added: ${q.gene_symbol}-${q.mondo_id}-${q.moi}`)),await S(),l(),s("saved")}catch(q){const Y=q==null?void 0:q.response;if((Y==null?void 0:Y.status)===422&&((Ve=Y.data)!=null&&Ve.errors)){const Ke=Object.values(Y.data.errors).flat();v.commit("pushError",Ke.join(`
`))}else v.commit("pushError",((Ee=Y==null?void 0:Y.data)==null?void 0:Ee.message)||`Failed to add ${payload.gene_symbol}`)}},_e=async t=>{try{await te.delete(`/api/groups/${I.value.uuid}/expert-panel/genes/${t.id}`),await S()}catch(d){v.commit("pushError",d.response.data)}},A=async t=>{O.value=t.id;const d=t.tier;try{await te.put(`/api/groups/${I.value.uuid}/expert-panel/genes/update-tier`,{ids:[t.id],tier:t.tier||null}),v.commit("pushSuccess",`Tier updated for ${t.gene_symbol}`)}catch{t.tier=d,v.commit("pushError","Failed to update tier")}finally{O.value=null}},ve=async()=>{if(!(!a.value||_.value.length===0))try{await te.put(`/api/groups/${I.value.uuid}/expert-panel/genes/update-tier`,{ids:_.value,tier:a.value}),v.commit("pushSuccess",`Tier updated for ${_.value.length} genes`),_.value=[],await S(),a.value=""}catch{v.commit("pushError","Failed to update tiers in bulk")}},ge=()=>{_.value.length!==0&&(_.value=[])},Fe=t=>{_.value.includes(t)?_.value=_.value.filter(d=>d!==t):_.value.push(t)},Me=()=>{const t=Ce.value.map(i=>i.id);t.every(i=>_.value.includes(i))?_.value=_.value.filter(i=>!t.includes(i)):_.value=[...new Set([..._.value,...t])]},Se=U(()=>{let t=[...o.value];const d=z.value.toLowerCase();return d&&(t=t.filter(i=>{var w,D,L,X;return i.gene_symbol&&i.gene_symbol.toLowerCase().includes(d)||i.mondo_id&&i.mondo_id.toLowerCase().includes(d)||i.disease_name&&i.disease_name.toLowerCase().includes(d)||i.moi&&i.moi.toLowerCase().includes(d)||((w=i.plan)==null?void 0:w.the_plan)&&i.plan.the_plan.toLowerCase().includes(d)||((D=i.plan)==null?void 0:D.expert_panel)&&i.plan.expert_panel.toLowerCase().includes(d)||((L=i.plan)==null?void 0:L.classification)&&i.plan.classification.toLowerCase().includes(d)||((X=i.plan)==null?void 0:X.phenotypes)&&i.plan.phenotypes.toLowerCase().includes(d)})),B.value&&(t=t.filter(i=>i.moi===B.value)),E.value&&(t=t.filter(i=>{var w;return((w=i.plan)==null?void 0:w.classification)===E.value})),t.sort((i,w)=>{let D,L;switch(x.value){case"disease":D=`${i.mondo_id||""} ${i.disease_name||""}`.toLowerCase(),L=`${w.mondo_id||""} ${w.disease_name||""}`.toLowerCase();break;case"moi":D=i.moi||"",L=w.moi||"";break;case"tier":return D=i.tier?Number(i.tier):0,L=w.tier?Number(w.tier):0,W.value==="asc"?D-L:L-D;default:D=i.gene_symbol||"",L=w.gene_symbol||""}return W.value==="asc"?D.localeCompare(L):L.localeCompare(D)}),t}),Oe=async t=>{var d;try{const i=t.gt_data;if(!i)return;const w={is_other:!1,hgnc_id:i.hgnc_id,gene_symbol:i.gene_symbol,disease_name:i.disease_name,mondo_id:i.mondo_id,moi:i.moi,date_approved:i.date_approved,plan:{...i,checkKey:i.checkKey,requires_plan:["Moderate","Limited"].includes((d=i.plan)==null?void 0:d.classification)}};await te.put(`/api/groups/${I.value.uuid}/expert-panel/genes/${t.id}`,w),v.commit("pushSuccess",`Updated ${t.gene_symbol} from GeneTracker`),await S()}catch{v.commit("pushError","Failed to apply update from GeneTracker")}},Ue=U(()=>[...new Set(o.value.map(t=>t.moi).filter(Boolean))]),Ne=U(()=>[...new Set(o.value.map(t=>{var d;return(d=t.plan)==null?void 0:d.classification}).filter(Boolean))]),Re=U(()=>Math.ceil(Se.value.length/ee.value)),Ce=U(()=>{const t=(ne.value-1)*ee.value;return Se.value.slice(t,t+ee.value)}),je=U(()=>Ce.value.every(t=>_.value.includes(t.id))),Ge=(t,d)=>(t??"")!==(d??""),ae=(t,d)=>{const i=(t==null?void 0:t.plan)??{};return{gene_symbol:t.gene_symbol??i.gene_symbol,moi:t.moi??i.moi,mondo_id:t.mondo_id??i.mondo_id,disease_name:t.disease_name??i.disease_name,expert_panel:i.expert_panel,classification:i.classification,curation_status:i.curation_status,date_approved:i.date_approved,phenotypes:i.phenotypes}[d]},le=(t,d)=>{const i=(t==null?void 0:t.gt_data)??{};return{gene_symbol:i.gene_symbol,moi:i.moi,mondo_id:i.mondo_id,disease_name:i.disease_name,expert_panel:i.expert_panel,classification:i.classification,curation_status:i.curation_status,date_approved:i.date_approved,phenotypes:i.phenotypes}[d]},Be=(t,{onlyChanged:d=!1}={})=>{const i=D=>D?new Date(D).toLocaleDateString():"",w=[{key:"gene_symbol",label:"HGNC Symbol",a:ae(t,"gene_symbol"),b:le(t,"gene_symbol")},{key:"moi",label:"MOI",a:ae(t,"moi"),b:le(t,"moi")},{key:"mondo_id",label:"MONDO ID",a:ae(t,"mondo_id"),b:le(t,"mondo_id")},{key:"disease_name",label:"Disease",a:ae(t,"disease_name"),b:le(t,"disease_name")},{key:"expert_panel",label:"Expert Panel",a:ae(t,"expert_panel"),b:le(t,"expert_panel")},{key:"classification",label:"Classification",a:ae(t,"classification"),b:le(t,"classification")},{key:"curation_status",label:"Status",a:ae(t,"curation_status"),b:le(t,"curation_status")},{key:"date_approved",label:"Date Approved",a:i(ae(t,"date_approved")),b:i(le(t,"date_approved"))},{key:"phenotypes",label:"Phenotypes",a:ae(t,"phenotypes"),b:le(t,"phenotypes")}];return d?w.filter(D=>Ge(D.a,D.b)):w},Ae=()=>{const t=H.value;t&&t.scrollIntoView({behavior:"smooth",block:"start"})},$e=()=>{k.value&&(k.value=!1,Ae())},qe=async()=>{await Je(),requestAnimationFrame(()=>Ae())};Ze(()=>{S(),ce()});const ye=f([]);return{group:I,genes:o,formGene:m,curatedGeneKey:V,isEditing:h,isFormVisible:G,mois:j,errors:T,search:z,filterMoi:B,filterClassification:E,sortKey:x,sortOrder:W,pageSize:ee,currentPage:ne,totalPages:Re,paginatedGenes:Ce,filteredAndSortedGenes:Se,moiOptions:Ue,classificationOptions:Ne,selectedGenes:_,bulkTier:a,savingTierFor:O,isAllSelected:je,canEdit:re,isOtherFormValid:C,isCuratedPlanValid:g,toggleExpanded:t=>{ye.value.includes(t)?ye.value=ye.value.filter(d=>d!==t):ye.value.push(t)},expanded:ye,showConfirmRemove:se,selectedGene:Q,confirmRemove:oe,cancelRemove:de,removeGene:ue,setSort:ke,startAdd:we,startEdit:p,cancelForm:l,selectOther:c,handleCuratedSelection:$,saveForm:me,remove:_e,updateTier:A,applyBulkTier:ve,toggleSelect:Fe,toggleSelectAll:Me,applyGtUpdate:Oe,compactDiffRows:Be,isDiff:Ge,htmlFromMarkdown:Pe,formEl:H,onFormEntered:$e,clearSelection:ge}}},es={class:"flex justify-between items-center mb-4"},ts={key:0,class:"flex items-center gap-2"},ss=["disabled"],os={class:"flex items-center gap-4"},as=["value"],ls=["value"],ns={key:0,ref:"formEl",class:"border rounded bg-gray-50 p-4 mb-4"},is={class:"text-lg font-semibold mb-3"},rs={key:0,class:"space-y-2"},ds={key:0,class:"mt-3 border rounded bg-amber-50 p-3"},us={class:"flex items-start gap-2 mb-2"},cs={class:"text-sm text-gray-800"},ps={key:0,class:"text-xs text-red-500 mt-1"},ms={key:1,class:"border rounded bg-white p-3 mt-3"},vs={class:"grid grid-cols-2 gap-2"},_s={key:0,class:"text-red-500 text-xs mt-1"},ys=["value"],bs={key:0,class:"text-red-500 text-xs mt-1"},fs={class:"col-span-2"},gs={class:"col-span-2 mb-6"},xs={key:0,class:"text-red-500 text-xs mt-1"},hs={class:"mt-4 flex justify-end gap-2"},ks=["disabled"],ws={key:0,class:"flex items-center gap-2 bg-gray-50 p-3 border rounded mb-3"},Ss=["disabled"],Cs={class:"mb-3 flex items-center justify-between border rounded-lg bg-white px-3 py-2"},Ts={class:"flex items-center gap-3"},Ds=["checked"],Gs={class:"text-sm text-gray-600"},As={class:"flex items-center gap-2"},Vs=["aria-label"],Es={class:"ml-2 flex items-center gap-2"},Ps=["value"],Is={key:1,class:"p-6 text-center text-sm text-gray-500 border rounded-lg bg-white"},Ls={key:2,class:"space-y-2"},Fs={class:"rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm hover:shadow transition-shadow"},Ms={class:"flex items-start justify-between gap-3 p-3"},Os={class:"flex items-start gap-3"},Us={key:0,class:"mt-1"},Ns=["checked","onChange","aria-label"],Rs={class:"flex flex-wrap items-center gap-2"},js={class:"text-base font-semibold text-gray-900"},Bs={key:0,class:"text-xs rounded-full bg-gray-100 px-2 py-0.5 text-gray-700"},$s={key:1,class:"text-xs rounded-full bg-gray-100 px-2 py-0.5 text-gray-700"},qs={key:2,class:"'inline-flex h-2 w-2 rounded-full animate-pulse bg-rose-500","aria-hidden":"true"},Ks={key:3,class:"text-[11px] rounded-full bg-amber-100 text-amber-900 px-2 py-0.5 border border-amber-300"},Hs={class:"mt-0.5 text-sm text-gray-700 truncate"},zs={class:"flex items-center gap-2"},Qs=["onUpdate:modelValue","onChange","disabled"],Xs=["onClick"],Ys={key:1,class:"text-xs text-gray-700"},Zs={class:"px-3 pb-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 text-sm"},Js={key:0,class:"sm:col-span-2 lg:col-span-4 rounded-xl border p-2 text-sm border-rose-300 bg-rose-50 p-2"},Ws=["innerHTML"],eo={class:"rounded-xl border border-gray-200 bg-gray-50 p-2"},to={class:"text-sm text-gray-900"},so={class:"mt-0.5 text-gray-900 flex items-center gap-2 text-sm"},oo={class:"rounded-xl border border-gray-200 bg-gray-50 p-2"},ao={class:"text-sm text-gray-900"},lo={class:"rounded-xl border border-gray-200 bg-gray-50 p-2"},no={class:"text-sm text-gray-900"},io={class:"sm:col-span-2 lg:col-span-4 rounded-xl border border-gray-200 bg-gray-50 p-2"},ro={class:"text-sm text-gray-900 line-clamp-2"},uo={key:0,class:"sm:col-span-2 lg:col-span-4 rounded-xl border border-amber-200 bg-amber-50 p-2"},co=["innerHTML"],po={key:0,class:"flex items-center justify-between gap-2 border-t border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900"},mo=["onClick"],vo={key:0,class:"px-3 pb-3 pt-2 text-xs"},_o={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},yo={class:"flex items-center justify-between border-b bg-gray-50 px-2 py-1 text-[11px] text-gray-600"},bo={class:"uppercase tracking-wide"},fo={class:"grid grid-cols-2"},go={class:"min-w-0 p-2"},xo=["title"],ho=["title"],ko={class:"mt-2 flex flex-wrap items-center gap-2 sm:hidden"},wo=["onClick"],So=["onClick"],Co={class:"mt-4 flex justify-between items-center"},To=["disabled"],Do=["disabled"],Go={key:3,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},Ao={class:"bg-white rounded-lg shadow-lg w-96 p-6"},Vo={class:"mb-6"},Eo={class:"flex justify-end gap-2"};function Po(b,s,v,o,m,h){var _;const G=R("CuratedGeneSearchSelect"),V=R("RichTextEditor"),T=R("GeneSearchSelect"),j=R("DiseaseSearchSelect"),H=R("dropdown-item"),k=R("dropdown-menu");return n(),r("div",null,[e("div",es,[v.editing?(n(),r("div",ts,[e("button",{class:"btn blue",onClick:s[0]||(s[0]=(...a)=>o.startAdd&&o.startAdd(...a)),disabled:o.isFormVisible}," + Add Gene ",8,ss)])):y("",!0),e("div",os,[K(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.search=a),type:"text",placeholder:"Search genes, diseases, MOI, notes...",class:"border rounded px-2 py-1 text-sm"},null,512),[[Ie,o.search]]),K(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>o.filterMoi=a),class:"border p-1 rounded text-sm"},[s[24]||(s[24]=e("option",{value:""},"All MOIs",-1)),(n(!0),r(F,null,J(o.moiOptions,a=>(n(),r("option",{key:a,value:a},u(a),9,as))),128))],512),[[Z,o.filterMoi]]),K(e("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>o.filterClassification=a),class:"border p-1 rounded text-sm"},[s[25]||(s[25]=e("option",{value:""},"All Classifications",-1)),(n(!0),r(F,null,J(o.classificationOptions,a=>(n(),r("option",{key:a,value:a},u(a),9,ls))),128))],512),[[Z,o.filterClassification]])])]),M(De,{name:"fade",onAfterEnter:o.onFormEntered},{default:N(()=>{var a,O,z,B,E;return[o.isFormVisible?(n(),r("div",ns,[e("h3",is,u(o.isEditing?"Edit Gene":"Add Gene"),1),(a=o.formGene)!=null&&a.is_other?y("",!0):(n(),r("div",rs,[s[31]||(s[31]=e("label",{class:"block font-semibold"},"Select Gene-Disease-MOI:",-1)),(n(),ie(G,{modelValue:o.formGene,"onUpdate:modelValue":[s[4]||(s[4]=x=>o.formGene=x),o.handleCuratedSelection],placeholder:"Search curated Gene-Disease-MOI",class:"w-full",key:o.curatedGeneKey},null,8,["modelValue","onUpdate:modelValue"])),e("button",{type:"button",class:"text-blue-600 underline text-sm hover:text-blue-800",onClick:s[5]||(s[5]=(...x)=>o.selectOther&&o.selectOther(...x))},s[26]||(s[26]=[P(" Click here for "),e("strong",null,"Other (Not Curated)",-1)])),(O=o.formGene)!=null&&O.requires_plan?(n(),r("div",ds,[e("div",us,[s[29]||(s[29]=e("span",{class:"text-orange-500 font-bold"},"⚠",-1)),e("div",cs,[s[27]||(s[27]=P(" This gene is currently classified as ")),e("strong",null,u(o.formGene.classification??((z=o.formGene.plan)==null?void 0:z.classification)),1),s[28]||(s[28]=P(". Please explain the rationale for proposing its inclusion. "))])]),s[30]||(s[30]=e("label",{class:"block text-sm font-medium mb-1"},"Plan for Curation *",-1)),M(V,{modelValue:o.formGene.curated_plan_text,"onUpdate:modelValue":s[6]||(s[6]=x=>o.formGene.curated_plan_text=x),placeholder:"Describe your plan (min 20 characters)",class:"w-full"},null,8,["modelValue"]),o.isCuratedPlanValid?y("",!0):(n(),r("p",ps," Plan must be at least 20 characters. "))])):y("",!0)])),o.formGene&&o.formGene.is_other?(n(),r("div",ms,[s[37]||(s[37]=e("h5",{class:"text-lg font-semibold mb-2"},"Provide details for non-curated gene",-1)),e("div",vs,[e("div",null,[s[32]||(s[32]=e("label",{class:"block text-sm font-medium mb-1"},"Gene *",-1)),M(T,{modelValue:o.formGene.custom_gene,"onUpdate:modelValue":s[7]||(s[7]=x=>o.formGene.custom_gene=x),placeholder:"Search gene..."},null,8,["modelValue"]),o.errors.custom_gene?(n(),r("p",_s,u(o.errors.custom_gene[0]),1)):y("",!0)]),e("div",null,[s[34]||(s[34]=e("label",{class:"block text-sm font-medium mb-1"},"MOI",-1)),K(e("select",{"onUpdate:modelValue":s[8]||(s[8]=x=>o.formGene.custom_moi=x),class:"form-select w-full"},[s[33]||(s[33]=e("option",{value:""},"----Select MOI-----",-1)),(n(!0),r(F,null,J(o.mois,x=>(n(),r("option",{key:x.id,value:x},u(x.name)+" ("+u(x.abbreviation)+")",9,ys))),128))],512),[[Z,o.formGene.custom_moi]]),o.errors.custom_moi?(n(),r("p",bs,u(o.errors.custom_moi[0]),1)):y("",!0)]),e("div",fs,[s[35]||(s[35]=e("label",{class:"block text-sm font-medium mb-1"},"Disease",-1)),M(j,{modelValue:o.formGene.custom_disease,"onUpdate:modelValue":s[9]||(s[9]=x=>o.formGene.custom_disease=x),placeholder:"Search disease..."},null,8,["modelValue"])]),e("div",gs,[s[36]||(s[36]=e("label",{class:"block text-sm font-medium mb-1"},"Plan for Curation *",-1)),M(V,{modelValue:o.formGene.custom_plan,"onUpdate:modelValue":s[10]||(s[10]=x=>o.formGene.custom_plan=x),placeholder:"Describe your plan (min 20 characters)",class:"w-full"},null,8,["modelValue"]),o.errors.custom_plan?(n(),r("p",xs,u(o.errors.custom_plan[0]),1)):y("",!0)])])])):y("",!0),e("div",hs,[e("button",{class:"btn btn-gray",onClick:s[11]||(s[11]=(...x)=>o.cancelForm&&o.cancelForm(...x))},"Cancel"),e("button",{class:"btn blue",disabled:o.isEditing?!1:((B=o.formGene)==null?void 0:B.is_other)&&!o.isOtherFormValid||!((E=o.formGene)!=null&&E.is_other)&&!o.isCuratedPlanValid,onClick:s[12]||(s[12]=(...x)=>o.saveForm&&o.saveForm(...x))}," Save ",8,ks)])],512)):y("",!0)]}),_:1},8,["onAfterEnter"]),o.selectedGenes.length>0&&!v.readonly?(n(),r("div",ws,[P(u(o.selectedGenes.length)+" gene(s) selected. ",1),s[39]||(s[39]=e("span",{class:"font-semibold"},"Bulk Tier Update:",-1)),K(e("select",{"onUpdate:modelValue":s[13]||(s[13]=a=>o.bulkTier=a),class:"border rounded px-2 py-1 text-sm"},s[38]||(s[38]=[he('<option value="" data-v-4c8a4ed4>Select Tier</option><option value="1" data-v-4c8a4ed4>Tier 1</option><option value="2" data-v-4c8a4ed4>Tier 2</option><option value="3" data-v-4c8a4ed4>Tier 3</option><option value="4" data-v-4c8a4ed4>Tier 4</option>',5)]),512),[[Z,o.bulkTier]]),e("button",{class:"bg-blue-600 text-white px-3 py-1 rounded disabled:opacity-50",onClick:s[14]||(s[14]=(...a)=>o.applyBulkTier&&o.applyBulkTier(...a)),disabled:!o.bulkTier||o.selectedGenes.length===0}," Apply ",8,Ss),e("button",{type:"button",class:"border rounded px-3 py-1 text-sm bg-white hover:bg-gray-50",onClick:s[15]||(s[15]=(...a)=>o.clearSelection&&o.clearSelection(...a)),title:"Clear selection"}," Clear ")])):y("",!0),e("div",Cs,[e("div",Ts,[o.canEdit&&v.editing?(n(),r("input",{key:0,type:"checkbox",checked:o.isAllSelected,onChange:s[16]||(s[16]=(...a)=>o.toggleSelectAll&&o.toggleSelectAll(...a)),"aria-label":"Select all on page"},null,40,Ds)):y("",!0),e("span",Gs,u(o.paginatedGenes.length)+" shown / "+u(o.filteredAndSortedGenes.length)+" total ",1)]),e("div",As,[s[42]||(s[42]=e("label",{class:"text-xs text-gray-500"},"Sort by",-1)),K(e("select",{"onUpdate:modelValue":s[17]||(s[17]=a=>o.sortKey=a),class:"border rounded px-2 py-1 text-sm"},s[40]||(s[40]=[e("option",{value:"gene_symbol"},"HGNC Symbol",-1),e("option",{value:"disease"},"Disease",-1),e("option",{value:"moi"},"MOI",-1),e("option",{value:"tier"},"Tier",-1)]),512),[[Z,o.sortKey]]),e("button",{class:"border rounded px-2 py-1 text-xs",onClick:s[18]||(s[18]=a=>o.sortOrder=o.sortOrder==="asc"?"desc":"asc"),"aria-label":`Toggle sort order (currently ${o.sortOrder})`,title:"Toggle sort order"},u(o.sortOrder==="asc"?"ASC ▲":"DESC ▼"),9,Vs),e("div",Es,[s[41]||(s[41]=e("label",{class:"text-xs text-gray-500"},"Page size",-1)),K(e("select",{"onUpdate:modelValue":s[19]||(s[19]=a=>o.pageSize=a),class:"border rounded px-2 py-1 text-sm"},[(n(),r(F,null,J([2,20,50,100],a=>e("option",{key:a,value:a},u(a),9,Ps)),64))],512),[[Z,o.pageSize]])])])]),o.paginatedGenes.length===0?(n(),r("div",Is," No genes found. ")):(n(),r("ul",Ls,[(n(!0),r(F,null,J(o.paginatedGenes,(a,O)=>{var z,B,E,x,W,ne,ee,I,re,se,Q,oe,de,ue,ce;return n(),r("li",{key:a.id},[e("div",Fs,[e("div",Ms,[e("div",Os,[o.canEdit&&v.editing?(n(),r("div",Us,[e("input",{type:"checkbox",checked:o.selectedGenes.includes(a.id),onChange:S=>o.toggleSelect(a.id),"aria-label":`Select ${a.gene_symbol}`},null,40,Ns)])):y("",!0),e("div",null,[e("div",Rs,[e("span",js,u(a.gene_symbol),1),a.mondo_id?(n(),r("span",Bs,u(a.mondo_id),1)):y("",!0),a.moi?(n(),r("span",$s,u(a.moi),1)):y("",!0),(z=a.plan)!=null&&z.is_other?(n(),r("span",qs)):y("",!0),a.is_outdated&&a.gt_data?(n(),r("span",Ks,"Snapshot out of date")):y("",!0)]),e("div",Hs,u(a.disease_name),1)])]),e("div",zs,[v.editing?(n(),r(F,{key:0},[K(e("select",{"onUpdate:modelValue":S=>a.tier=S,class:"border rounded px-2 py-1 text-xs",onChange:S=>o.updateTier(a),disabled:o.savingTierFor===a.id||v.readonly,title:"Tier"},s[43]||(s[43]=[he('<option value="null" data-v-4c8a4ed4>—</option><option value="1" data-v-4c8a4ed4>Tier 1</option><option value="2" data-v-4c8a4ed4>Tier 2</option><option value="3" data-v-4c8a4ed4>Tier 3</option><option value="4" data-v-4c8a4ed4>Tier 4</option>',5)]),40,Qs),[[Z,a.tier]]),a.is_outdated&&a.gt_data?(n(),r("button",{key:0,onClick:S=>o.applyGtUpdate(a),title:"Refresh from latest GT",class:"hidden sm:inline-flex rounded border border-amber-400 bg-amber-50 px-2 py-1 text-xs font-semibold text-amber-900 hover:bg-amber-100"}," Refresh GT ⚠ ",8,Xs)):y("",!0),a.toDelete?y("",!0):(n(),ie(k,{key:1,"hide-cheveron":!0,class:"relative"},{label:N(()=>s[44]||(s[44]=[e("button",{class:"rounded border px-2 py-1 text-xs bg-white"},"⋯",-1)])),default:N(()=>[M(H,{onClick:S=>o.startEdit(a)},{default:N(()=>s[45]||(s[45]=[P("Edit")])),_:2},1032,["onClick"]),M(H,{onClick:S=>o.confirmRemove(a)},{default:N(()=>s[46]||(s[46]=[P("Remove")])),_:2},1032,["onClick"])]),_:2},1024))],64)):(n(),r("span",Ys,"Tier: "+u(a.tier||"—"),1))])]),e("div",Zs,[(B=a.plan)!=null&&B.is_other?(n(),r("div",Js,[s[47]||(s[47]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Plan",-1)),e("div",{class:"prose max-w-none",innerHTML:o.htmlFromMarkdown((((E=a.plan)==null?void 0:E.the_plan)||"").replace(/\\/g,""))},null,8,Ws)])):(n(),r(F,{key:1},[e("div",eo,[s[48]||(s[48]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Expert Panel",-1)),e("div",to,u(((x=a.plan)==null?void 0:x.expert_panel)??"N/A"),1)]),e("div",{class:xe(["rounded-xl border p-2",["Moderate","Limited"].includes((W=a.plan)==null?void 0:W.classification)?((ne=a.plan)==null?void 0:ne.classification)==="Limited"?"border-amber-200 bg-amber-100 ring-1 ring-amber-500":"border-amber-100 bg-amber-50 ring-1 ring-amber-300":"border-gray-200 bg-gray-50"])},[s[49]||(s[49]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Classification",-1)),e("div",so,[P(u(((ee=a.plan)==null?void 0:ee.classification)??"N/A")+" ",1),["Moderate","Limited"].includes((I=a.plan)==null?void 0:I.classification)?(n(),r("span",{key:0,class:xe(["inline-flex h-2 w-2 rounded-full animate-pulse",((re=a.plan)==null?void 0:re.classification)==="Limited"?"bg-amber-500":"bg-amber-300"]),"aria-hidden":"true"},null,2)):y("",!0)])],2),e("div",oo,[s[50]||(s[50]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Status",-1)),e("div",ao,u(((se=a.plan)==null?void 0:se.curation_status)??"N/A"),1)]),e("div",lo,[s[51]||(s[51]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Date Approved",-1)),e("div",no,u((Q=a.plan)!=null&&Q.date_approved?new Date((oe=a.plan)==null?void 0:oe.date_approved).toLocaleDateString():"N/A"),1)]),e("div",io,[s[52]||(s[52]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Phenotypes",-1)),e("div",ro,u(((de=a.plan)==null?void 0:de.phenotypes)??"N/A"),1)]),["Moderate","Limited"].includes((ue=a.plan)==null?void 0:ue.classification)?(n(),r("div",uo,[s[53]||(s[53]=e("div",{class:"text-[11px] uppercase tracking-wide text-amber-800"},"Plan",-1)),e("div",{class:"prose max-w-none text-sm text-amber-900",innerHTML:o.htmlFromMarkdown((((ce=a.plan)==null?void 0:ce.curated_plan_text)||"").replace(/\\/g,""))},null,8,co)])):y("",!0)],64))]),a.is_outdated&&a.gt_data?(n(),r("div",po,[s[54]||(s[54]=e("div",{class:"flex items-center gap-2"},[e("span",{class:"inline-flex h-4 w-4"},"⚠"),e("span",{class:"truncate"},"Snapshot differs from latest GeneTracker data.")],-1)),e("button",{onClick:S=>o.toggleExpanded(O),class:"rounded border border-amber-400 px-2 py-1 text-xs font-medium hover:bg-amber-100"},u(o.expanded.includes(O)?"Hide GT diff":"Show GT diff"),9,mo)])):y("",!0),M(De,{name:"fade"},{default:N(()=>[a.is_outdated&&a.gt_data&&o.expanded.includes(O)?(n(),r("div",vo,[e("div",_o,[(n(!0),r(F,null,J(o.compactDiffRows(a),S=>(n(),r("div",{key:S.key,class:"rounded-lg border border-gray-200"},[e("div",yo,[e("span",bo,u(S.label),1)]),e("div",fo,[e("div",go,[e("div",{class:"truncate",title:S.a},u(S.a||"—"),9,xo)]),e("div",{class:xe(["min-w-0 p-2",o.isDiff(S.a,S.b)?"bg-sky-50 ring-1 ring-sky-300":""])},[e("div",{class:"truncate",title:S.b},u(S.b||"—"),9,ho)],2)])]))),128))]),e("div",ko,[a.is_outdated&&a.gt_data?(n(),r("button",{key:0,type:"button",class:"rounded bg-amber-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-700",onClick:S=>o.applyGtUpdate(a)}," Refresh from GT ",8,wo)):y("",!0),e("button",{type:"button",class:"rounded border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-800 hover:bg-gray-50",onClick:S=>o.toggleExpanded(O)}," Keep Snapshot ",8,So)])])):y("",!0)]),_:2},1024)])])}),128))])),e("div",Co,[e("button",{class:"btn btn-gray",disabled:o.currentPage===1,onClick:s[20]||(s[20]=a=>o.currentPage--)},"Prev",8,To),e("span",null,"Page "+u(o.currentPage)+" of "+u(o.totalPages),1),e("button",{class:"btn btn-gray",disabled:o.currentPage===o.totalPages,onClick:s[21]||(s[21]=a=>o.currentPage++)},"Next",8,Do)]),o.showConfirmRemove?(n(),r("div",Go,[e("div",Ao,[s[57]||(s[57]=e("h3",{class:"text-lg font-semibold mb-4"},"Confirm Removal",-1)),e("p",Vo,[s[55]||(s[55]=P("Are you sure you want to remove ")),e("strong",null,u((_=o.selectedGene)==null?void 0:_.gene_symbol),1),s[56]||(s[56]=P("?"))]),e("div",Eo,[e("button",{class:"btn btn-gray",onClick:s[22]||(s[22]=(...a)=>o.cancelRemove&&o.cancelRemove(...a))},"Cancel"),e("button",{class:"btn btn-red",onClick:s[23]||(s[23]=(...a)=>o.removeGene&&o.removeGene(...a))},"Remove")])])])):y("",!0)])}const la=be(Wt,[["render",Po],["__scopeId","data-v-4c8a4ed4"]]),Io={name:"CspecSummary",props:{readonly:{type:Boolean,default:!1}},data(){return{sort:{field:"id",desc:!1},specFields:[{name:"name",type:String,sortable:!0},{name:"status",label:"Status",type:String,sortable:!0},{name:"updated_at",label:"Last Updated",type:Date,sortable:!0}]}},computed:{group(){return this.$store.getters["groups/currentItemOrNew"]},hasSpecifications(){return this.group.expert_panel.specifications&&this.group.expert_panel.specifications.length>0},specifications(){return this.group.expert_panel.specifications}},watch:{group(b){this.$store.dispatch("groups/getSpecifications",b)}},mounted(){this.$store.dispatch("groups/getSpecifications",this.group)},methods:{goToCspec(){window.location="https://cspec.genome.network/"}}},Lo={key:0,class:"well mb-2"},Fo={key:1},Mo={class:"mb-2"},Oo=["href"],Uo=["disabled"];function No(b,s,v,o,m,h){const G=R("icon-arrow-right"),V=R("note");return n(),r("div",null,[h.hasSpecifications?(n(),r("div",Fo,[e("table",Mo,[s[0]||(s[0]=e("thead",null,[e("tr",null,[e("th",null,"Specification Name"),e("th",null,"Status"),e("th",null,"Last Updated"),e("th",null," ")])],-1)),e("tbody",null,[(n(!0),r(F,null,J(h.specifications,T=>(n(),r("tr",{key:T.id},[e("td",null,u(T.name),1),e("td",null,u(T.status),1),e("td",null,u(b.formatDate(T.updated_at)),1),e("td",null,[e("ul",null,[e("li",null,[e("a",{target:"cspec_edit",href:`https://cspec.genome.network/cspec/ed/svi/doc/${T.cspec_id}`},"Edit",8,Oo)])])])]))),128))])])])):(n(),r("div",Lo," No specifications on record in the CSPEC Registry. ")),e("a",{class:"btn btn-lg blue",target:"cspec-editor",disabled:v.readonly,href:"https://cspec.genome.network/"},[s[1]||(s[1]=P(" Go to the CSpec Registry ")),M(G,{class:"inline"})],8,Uo),M(V,{class:"mt-2"},{default:N(()=>s[2]||(s[2]=[P(" It may take up to an hour for the latest updates in the CSPEC Registry to display here. ")])),_:1})])}const Ro=be(Io,[["render",No]]),jo=tt.documentsTypes,Bo={props:{documentTypeId:{type:[Number,Array],required:!0},step:{type:Number,required:!1,default:null},showNotes:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["saved","canceled"],data(){return{newDocument:{file:null,date_received:new Date().toISOString(),step:this.step},errors:{},activeDocument:{},showDeleteConfirmation:!1}},computed:{group(){return this.$store.getters["groups/currentItemOrNew"]},documents(){return this.group.documents.filter(b=>this.docTypeIsArray?this.documentTypeId.includes(b.document_type_id):b.document_type_id===this.documentTypeId)},docTypeIsArray(){return Array.isArray(this.documentTypeId)},filteredTypes(){return this.docTypeIsArray?Object.values(jo).filter(b=>this.documentTypeId.includes(b.id)).map(b=>({label:b.long_name,value:b.id})):[]},document_type_id(){return this.docTypeIsArray?null:this.documentTypeId}},mounted(){this.$store.dispatch("groups/getDocuments",this.group)},methods:{async save(){try{const b=new FormData;Object.entries(this.newDocument).forEach(([s,v])=>{v!=null&&b.append(s,v)}),b.set("file",this.$refs.fileInput.files[0]),b.set("document_type_id",this.documentTypeId),await this.$store.dispatch("groups/addApplicationDocument",{group:this.group,data:b}),this.clearForm(),this.$emit("saved")}catch(b){et(b)&&(this.errors=b.response.data.errors)}},cancel(){this.clearForm(),this.$emit("canceled")},clearForm(){this.initNewDocument(),this.clearErrors()},initNewDocument(){this.$refs.fileInput.value=null,this.newDocument={file:null,date_received:We(new Date),date_reviewed:null,step:this.step,document_type_id:this.documentTypeId,notes:null}},clearErrors(){this.errors={}},initDownload(b){window.location=b.download_url},initDelete(b){this.activeDocument=b,this.showDeleteConfirmation=!0},cancelDelete(){this.showDeleteConfirmation=!1,this.resetActiveDocument()},async commitDelete(){await this.$store.dispatch("groups/deleteDocument",{group:this.group,document:this.activeDocument}),this.showDeleteConfirmation=!1,this.resetActiveDocument()},resetActiveDocument(){this.activeDocument={type:{}}}}},$o={key:0,class:"table"},qo={key:0},Ko=["href"],Ho={class:"note"},zo={key:0},Qo={key:1},Xo={ref:"fileInput",type:"file"},Yo={key:0},Zo={key:0,class:"mb-3"};function Jo(b,s,v,o,m,h){const G=R("dropdown-item"),V=R("dropdown-menu"),T=R("input-row"),j=R("button-row"),H=R("modal-dialog");return n(),r("div",null,[h.documents.length>0?(n(),r("table",$o,[e("thead",null,[e("tr",null,[s[3]||(s[3]=e("th",null,"File",-1)),h.docTypeIsArray?(n(),r("th",qo," Type ")):y("",!0),s[4]||(s[4]=e("th",null,"uploaded",-1)),s[5]||(s[5]=e("th",null,null,-1))])]),e("tbody",null,[(n(!0),r(F,null,J(h.documents,k=>(n(),r("tr",{key:k.id,class:"p-1 border"},[e("td",null,[e("a",{href:k.download_url},u(k.filename),9,Ko),e("span",Ho," (v. "+u(k.version)+")",1)]),h.docTypeIsArray?(n(),r("td",zo,u(k.type.long_name),1)):y("",!0),e("td",null,u(b.formatDate(k.created_at)),1),e("td",null,[M(V,{"hide-cheveron":""},{label:N(()=>s[6]||(s[6]=[e("button",{class:"btn btn-xs"}," … ",-1)])),default:N(()=>[M(G,{onClick:_=>h.initDownload(k)},{default:N(()=>s[7]||(s[7]=[P(" Download ")])),_:2},1032,["onClick"]),b.hasAnyPermission(["ep-applications-manage",["application-edit",h.group]])?(n(),ie(G,{key:0,onClick:_=>h.initDelete(k)},{default:N(()=>s[8]||(s[8]=[P(" Delete ")])),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)])]))),128))])])):y("",!0),v.readonly?y("",!0):(n(),r("div",Qo,[h.docTypeIsArray?(n(),ie(T,{key:0,modelValue:m.newDocument.document_type_id,"onUpdate:modelValue":s[0]||(s[0]=k=>m.newDocument.document_type_id=k),label:"Document type",type:"select",options:h.filteredTypes},null,8,["modelValue","options"])):y("",!0),M(T,{label:"Document",errors:m.errors.file},{default:N(()=>[e("input",Xo,null,512)]),_:1},8,["errors"]),e("button",{class:"btn blue",onClick:s[1]||(s[1]=(...k)=>h.save&&h.save(...k))}," Upload ")])),(n(),ie(st,{to:"body"},[M(H,{modelValue:m.showDeleteConfirmation,"onUpdate:modelValue":s[2]||(s[2]=k=>m.showDeleteConfirmation=k),title:`You are about to delete ${m.activeDocument.filename}`},{default:N(()=>[m.activeDocument?(n(),r("div",Yo,[m.activeDocument.is_final?(n(),r("p",Zo," This version has been tagged as the final version of the document. ")):y("",!0),s[9]||(s[9]=e("p",null,"Are you sure you want to continue?",-1)),M(j,{"submit-text":"Delete Document",onCanceled:h.cancelDelete,onSubmitted:h.commitDelete},null,8,["onCanceled","onSubmitted"])])):y("",!0)]),_:1},8,["modelValue","title"])]))])}const Wo=be(Bo,[["render",Jo]]),ea={name:"SpecificationsSection",components:{CspecSummary:Ro,ApplicationUploadForm:Wo},props:{docTypeId:{required:!0,type:[Number,Array]},readonly:{type:Boolean,default:!1}},data(){return{}},computed:{cspecSummaryEnabled(){return this.$store.state.systemInfo.app.features.cspec_summary},specificationUpload(){return this.$store.state.systemInfo.app.features.specification_upload}},methods:{}};function ta(b,s,v,o,m,h){const G=R("CspecSummary"),V=R("ApplicationUploadForm"),T=R("collapsible");return n(),r("div",null,[h.cspecSummaryEnabled?(n(),ie(G,{key:0,readonly:v.readonly},null,8,["readonly"])):y("",!0),M(T,{class:"mt-4"},{title:N(()=>s[0]||(s[0]=[e("h3",null,"Legacy document-based specifications",-1)])),default:N(()=>[h.specificationUpload?(n(),ie(V,{key:0,"document-type-id":v.docTypeId,"show-notes":!1,readonly:v.readonly},null,8,["document-type-id","readonly"])):y("",!0)]),_:1})])}const na=be(ea,[["render",ta]]);export{aa as G,na as S,la as V};
//# sourceMappingURL=SpecificationsSection-h3CvGTsA.js.map
