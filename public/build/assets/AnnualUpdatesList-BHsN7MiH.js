import{H as y,_ as v,p as w,a as p,c as o,b as i,d as r,f as m,C as b,D,I as g,w as c,i as W,h as U,j as h,F as k,m as A,e as x}from"./app-Dodz6L5-.js";import{s as C}from"./router_aware_sort_and_filter-BuajIqLi.js";import{b as E}from"./_baseOrderBy-Cp_BrSnl.js";function I(t,e,s,l){return t==null?[]:(y(e)||(e=e==null?[]:[e]),s=s,y(s)||(s=s==null?[]:[s]),E(t,e,s))}const S={name:"AnnualUpdateTeable",props:{items:{type:Array,required:!0}},setup(){const{sort:t,filter:e}=C({field:"expert_panel.display_name",desc:!1});return{sort:t,filter:e}},data(){return{fields:[{name:"id",sortable:!0,label:"ID"},{name:"expert_panel.display_name",label:"Expert Panel",sortable:!0},{name:"submitter.person.name",label:"Submitter",sortable:!0},{name:"completed_at",label:"Completed",sortable:!0,resolveValue:t=>t.completed_at?this.formatDate(t.completed_at):null},{name:"action",label:"",sortable:!1}]}},computed:{completedFilter:{get(){return this.$route.query.completed||null},set(t){const e=this.$route.query,s=this.$route.path;let l={...e};t?l={...e,completed:t}:delete l.completed,this.$router.replace({path:s,query:l})}},filteredItems(){let t=JSON.parse(JSON.stringify(this.items));if(this.filter!=null){const e=new RegExp(`.*${this.filter}.*`,"i");t=this.items.filter(s=>s.expert_panel.display_name.match(e)||s.submitter&&s.submitter.person&&s.submitter.person.name.match(e))}return this.completedFilter!=null&&(t=t.filter(e=>this.completedFilter===1?e.completed_at!==null:e.completed_at==null)),t}},methods:{exportData(){const t=this.filteredItems.map(e=>e.id);w.post("/api/annual-updates/export",{annual_update_ids:t}).then(e=>{const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=window.URL.createObjectURL(new Blob([e.data,{type:"text/csv"}])),s.setAttribute("download","annual_updates.csv"),s.click(),document.body.removeChild(s)})}}},V={class:"flex mb-2 items-end justify-between"},F={class:"flex space-x-4 items-end"};function B(t,e,s,l,d,n){const f=p("router-link"),_=p("data-table");return i(),o("div",null,[r("div",V,[r("div",F,[b(r("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.filter=a),placeholder:"EP name, submitter name",class:"w-60"},null,512),[[D,l.filter]]),b(r("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>n.completedFilter=a),class:"flex radio-group"},e[4]||(e[4]=[r("option",{value:null}," Any ",-1),r("option",{value:2}," Only Pending ",-1),r("option",{value:1}," Only Completed ",-1)]),512),[[g,n.completedFilter]])]),r("button",{class:"btn btn-xs",onClick:e[2]||(e[2]=(...a)=>n.exportData&&n.exportData(...a))}," Export Data ")]),m(_,{sort:l.sort,"onUpdate:sort":e[3]||(e[3]=a=>l.sort=a),data:n.filteredItems,fields:d.fields},{"cell-action":c(({item:a})=>[m(f,{to:{name:"AnnualUpdateDetail",params:{id:a.id}}},{default:c(()=>e[5]||(e[5]=[W(" view ")])),_:2},1032,["to"])]),_:1},8,["sort","data","fields"])])}const L=v(S,[["render",B]]),R={name:"AnnualUpdatesList",components:{AnnualUpdateTable:L},data(){return{selectedWindow:null,windows:[],items:[],loading:!1}},computed:{sortedWindows(){return I(this.windows,"for_year","desc")},latestWindow(){return this.sortedWindows[0]||{}},gcepReviews(){return this.items.filter(t=>t.expert_panel.expert_panel_type_id===1)},vcepReviews(){return this.items.filter(t=>t.expert_panel.expert_panel_type_id===2)},selectedYear(){return this.selectedWindow?this.selectedWindow.for_year:this.latestWindow.for_year},selectedStartDate(){return this.selectedWindow?this.selectedWindow.start:this.latestWindow.start},selectedEndDate(){return this.selectedWindow?this.selectedWindow.end:this.latestWindow.end}},watch:{selectedWindow(t){t&&this.getItems()}},mounted(){this.getWindows(),this.getItems()},methods:{async getWindows(){this.windows=await w.get("/api/annual-updates/windows").then(t=>t.data),this.selectedWindow=this.latestWindow},async getItems(){let t="/api/annual-updates";this.selectedWindow&&(t+=`?window_id=${this.selectedWindow.id}`),this.loading=!0,this.items=await w.get(t).then(e=>e.data),this.loading=!1}}},N={class:"flex justify-between items-center border-b mb-4"},O={class:"border-0 mb-0"},P=["value"],T={key:0},j={key:0};function q(t,e,s,l,d,n){const f=p("AnnualUpdateTable"),_=p("tab-item"),a=p("tabs-container");return i(),o("div",null,[r("header",N,[r("h1",O," Annual Updates for "+h(n.selectedYear),1),W(" "+h(t.formatDate(n.selectedStartDate))+" - "+h(t.formatDate(n.selectedEndDate))+" ",1),d.windows.length>1?b((i(),o("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=u=>d.selectedWindow=u),class:"font-normal text-md"},[(i(!0),o(k,null,A(n.sortedWindows,u=>(i(),o("option",{key:u.id,value:u},h(u.for_year),9,P))),128))],512)),[[g,d.selectedWindow]]):U("",!0)]),m(a,null,{default:c(()=>[m(_,{label:"VCEPS"},{default:c(()=>[d.loading?(i(),o("div",T," Loading… ")):(i(),x(f,{key:1,items:n.vcepReviews},null,8,["items"]))]),_:1}),m(_,{label:"GCEPS"},{default:c(()=>[d.loading?(i(),o("div",j," Loading… ")):(i(),x(f,{key:1,items:n.gcepReviews},null,8,["items"]))]),_:1})]),_:1})])}const Y=v(R,[["render",q],["__scopeId","data-v-4c99267f"]]);export{Y as default};
//# sourceMappingURL=AnnualUpdatesList-BHsN7MiH.js.map
