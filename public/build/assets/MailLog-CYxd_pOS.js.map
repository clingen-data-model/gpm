{"version":3,"file":"MailLog-CYxd_pOS.js","sources":["../../../resources/js/components/mail/MailDetail.vue","../../../resources/js/views/MailLog.vue"],"sourcesContent":["<script>\nexport default {\n    name: 'MailDetail',\n    props: {\n        mail: {\n            type: Object,\n            required: true\n        }\n    },\n    emits: [\n      'resend',\n    ],\n    data() {\n        return {\n            \n        }\n    },\n    computed: {\n\n    },\n    methods: {\n\n    }\n}\n</script>\n<template>\n  <div>\n    <dictionary-row label=\"To\" label-class=\"font-bold w-36\" class=\"mb-1 border-b\">\n      <div class=\"flex-none\">\n        <div v-for=\"recipient in mail.to\" :key=\"recipient.address\">\n          {{ recipient.address }}\n        </div>\n      </div>\n    </dictionary-row>\n    <dictionary-row label=\"From\" label-class=\"font-bold w-36\" class=\"mb-1 border-b\">\n      <div v-for=\"recipient in mail.from\" :key=\"recipient.address\">\n        {{ recipient.address }}\n      </div>\n    </dictionary-row>\n    <dictionary-row label=\"Cc\" label-class=\"font-bold w-36\" class=\"mb-1 border-b\">\n      <note v-if=\"!mail.cc\">\n        --\n      </note>\n      <ul v-else>\n        <li v-for=\"recipient in mail.cc\" :key=\"recipient.address\">\n          {{ recipient.address }}\n        </li>\n      </ul>\n    </dictionary-row>\n    <dictionary-row label=\"Bcc\" label-class=\"font-bold w-36\" class=\"mb-1 border-b\">\n      <note v-if=\"!mail.bcc\">\n        --\n      </note>\n      <ul v-else>\n        <li v-for=\"recipient in mail.bcc\" :key=\"recipient.address\">\n          {{ recipient.address }}\n        </li>\n      </ul>\n    </dictionary-row>\n    <dictionary-row label=\"Subject\" label-class=\"font-bold w-36\" class=\"mb-1 border-b\">\n      {{ mail.subject }}\n    </dictionary-row>\n    <dictionary-row label=\"Body\" label-class=\"font-bold w-36\" class=\"mb-1\">\n      <div class=\"email-body w-3/4\" v-html=\"mail.body\" />\n    </dictionary-row>\n    <div class=\"mt-2 border-t pt-2 text-right\">\n      <button class=\"btn \" @click=\"$emit('resend')\">\n        Resend\n      </button>\n    </div>\n  </div>\n</template>","<script>\nimport api from '../http/api'\nimport {debounce} from 'lodash-es'\nimport {formatDateTime} from '@/date_utils'\nimport sortAndFilter from '../composables/router_aware_sort_and_filter'\n\nimport CustomEmailForm from '@/components/mail/CustomEmailForm.vue'\nimport MailDetail from '@/components/mail/MailDetail.vue'\n\nexport default {\n    components: {\n        CustomEmailForm,\n        MailDetail,\n    },\n    props: {\n\n    },\n    setup() {\n        const {sort, filter} = sortAndFilter({field: 'created_at', desc: true});\n\n        return {\n            sort,\n            filter,\n        }\n    },\n    data() {\n        return {\n            showDetail: false,\n            fields: [\n                {\n                    name: 'to',\n                    sortable: true,\n                    type: Array,\n                    resolveValue(item) {\n                        const emails = Object.keys(item.to);\n                        if (emails.length === 0) {\n                            return '';\n                        }\n                        if (emails.length === 1) {\n                            return emails[0];\n                        }\n                        return emails.join('; ');\n                    }\n                },\n                {\n                    name: 'subject',\n                    sortable: true,\n                    type: String\n                },\n                {\n                    name: 'created_at',\n                    label: 'Sent at',\n                    sortable: true,\n                    resolveValue(item) {\n                        return formatDateTime(item.created_at)\n                    },\n                    resolveSort(item) {\n                        return item.created_at;\n                    },\n                    type: String\n                },\n                {\n                    name: 'actions',\n                    label: '',\n                    sortable: false\n                }\n            ],\n            data: [],\n            currentEmail: {},\n            showResendDialog: false,\n        }\n    },\n    watch: {\n        filter: {\n            immediate: true,\n            handler () {\n                if (this.triggerSearch) {\n                    this.triggerSearch();\n                }\n            }\n        },\n        sort: {\n            deep: true,\n            immediate: true,\n            handler () {\n                if (this.triggerSearch) {\n                    this.triggerSearch();\n                }\n            }\n        }\n    },\n    created() {\n        this.triggerSearch = debounce(() => this.$refs.dataTable.getItems(), 500)\n    },\n    methods: {\n        async getPage (currentPage, pageSize, sort, setTotalItems) {\n            try {\n                const params = {\n                    page: currentPage,\n                    page_size: pageSize,\n                    'sort[field]': sort.field.name,\n                    'sort[dir]': sort.desc ? 'DESC' : 'ASC',\n                    'where[filterString]': this.filter\n                }\n                const pageResponse = await api.get(`/api/mail-log`, {params})\n                    .then(rsp => rsp.data);\n\n                setTotalItems(pageResponse.total);\n                return pageResponse.data;\n            } catch (error) {\n                // eslint-disable-next-line no-alert\n                alert(error);\n            }\n        },\n        showMailDetail (item) {\n            this.currentEmail = item;\n            this.showDetail = true;\n        },\n        initResend (item) {\n            this.currentEmail = item;\n            this.showResendDialog = true;\n        },\n        cleanupResend () {\n            this.currentEmail = {}\n            this.showResendDialog = false;\n            this.$refs.dataTable.getItems()\n        }\n    },\n}\n</script>\n<template>\n  <div>\n    <h1>Mail Log</h1>\n    <data-table\n      ref=\"dataTable\"\n      v-model:sort=\"sort\"\n      :fields=\"fields\"\n      :data=\"getPage\"\n      row-class=\"cursor-pointer\"\n      :row-click-handler=\"showMailDetail\"\n      :page-size=\"20\"\n      paginated\n    >\n      <template #header>\n        <div class=\"mb-2\">\n          Filter: <input v-model=\"filter\" type=\"text\">\n        </div>\n      </template>\n      <template #cell-to=\"{item}\">\n        <ul>\n          <li v-for=\"recipient in item.to\" :key=\"recipient.address\">\n            <span v-if=\"recipient.name\">\n              {{ recipient.name }} -\n            </span>\n            {{ recipient.address }}\n          </li>\n        </ul>\n      </template>\n      <template #cell-actions=\"{item}\">\n        <div>\n          <button v-if=\"hasPermission('people-manage')\" class=\"btn btn-xs\" @click.stop=\"initResend(item)\">\n            Resend\n          </button>\n        </div>\n      </template>\n    </data-table>\n\n    <teleport to=\"body\">\n      <modal-dialog v-model=\"showDetail\">\n        <MailDetail v-if=\"hasPermission('people-manage')\" :mail=\"currentEmail\" @resend=\"initResend(currentEmail)\" />\n      </modal-dialog>\n      <modal-dialog v-model=\"showResendDialog\" title=\"Resend Email\">\n        <CustomEmailForm :mail-data=\"currentEmail\" @sent=\"cleanupResend\" @canceled=\"cleanupResend\" />\n      </modal-dialog>\n    </teleport>\n  </div>\n</template>\n<style lang=\"postcss\">\n.email-body p{\n    @apply mb-4;\n}\n.email-body a {\n    @apply text-blue-700 underline;\n}\n</style>\n"],"names":["_sfc_main","_hoisted_1","_hoisted_4","_hoisted_5","_createElementBlock","_createVNode","_component_dictionary_row","_withCtx","_createElementVNode","_openBlock","_Fragment","_renderList","$props","recipient","_toDisplayString","_hoisted_2","_createBlock","_component_note","_cache","_createTextVNode","_hoisted_3","_ctx","CustomEmailForm","MailDetail","sort","filter","sortAndFilter","item","emails","formatDateTime","debounce","currentPage","pageSize","setTotalItems","params","pageResponse","api","rsp","error","_component_data_table","$setup","$event","$data","$options","_createCommentVNode","_withModifiers","_Teleport","_component_modal_dialog","_component_MailDetail","_component_CustomEmailForm"],"mappings":"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"}