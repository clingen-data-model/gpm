import{_ as A,aO as le,aP as ae,c,h as p,d as i,i as _,j as y,F as U,m as E,e as h,w as l,a as u,b as n,n as N,f as s,G as ue,aQ as W,a2 as T,C as G,Z as V,D as L,p as Y,$ as de,a9 as pe,a1 as z,ah as j,k as ce,r as me,q as M,v as ge,x as fe,o as _e}from"./app-xUpSbDwL.js";import{l as he,f as be}from"./log_entry_repository-C8P2633p.js";import{A as ve}from"./ActivityLog-d7h36PSc.js";import{V as B,S as ye,M as we,G as O,a as De,A as ke,b as Se,c as Ce}from"./VcepGeneList-_aY7d6wj.js";import{S as xe}from"./SpecificationsSection-BT1PtQFM.js";import{E as Ae}from"./EvidenceSummaryList-CdHc_U-7.js";import{M as Fe,G as q}from"./MemberList-llxINnJO.js";import{G as Ue}from"./GroupForm-BMz5HlKv.js";import{V as H}from"./VcepOngoingPlansForm-COjPgDer.js";import{S as Ee,A as Ge}from"./SustainedCurationReviewAlert-Czp86UGg.js";import{P as Me,S as Pe}from"./StepTabs-pjaq-uwl.js";import"./router_aware_sort_and_filter-DC3rfj3s.js";import"./CoiDetail-Cpd8RasW.js";import"./ExpertisesView-f_XRcQNL.js";import"./LogEntryForm-DBT-mzpJ.js";import"./judgement_utils-CQeBr_sj.js";import"./SustainedCurationReview-DDs00FWB.js";const Ie={name:"ApplicationSummary",components:{RequirementsBadge:le},props:{group:{required:!0,type:Object}},data(){return{}},computed:{applicationStarted(){return!0},application(){return ae(this.group)},currentStep(){return this.group.expert_panel.current_step},applicationRoute(){return{name:"GroupApplication",params:{uuid:this.group.uuid},hash:`#${this.currentMenuItem.id}`}},currentMenuItem(){return this.application.getStep(this.group.expert_panel.current_step)},menu(){return this.application.steps.length>1?this.application.steps:this.application.steps[0].sections}},methods:{isStep(t){return!!t.sections},isCurrentStep(t){return!!(this.isStep(t)&&this.application.getStep(this.group.expert_panel.current_step)===t)}}},Te={key:0,class:"p-4 my-4 mb-8 border rounded-xl bg-white"},Ve={class:"mb-2"},Le={key:0},Re={class:"px-8"},Ne={key:2},je={key:0,class:"flex-1"},Be={key:0,class:"mt-4"};function Oe(t,e,d,o,a,r){const w=u("RequirementsBadge"),D=u("icon-lock"),k=u("badge"),b=u("router-link");return d.group.is_ep?(n(),c("div",Te,[i("h2",Ve,[e[0]||(e[0]=_(" Application Summary ")),r.applicationStarted&&d.group.is_vcep_or_scvcep?(n(),c("span",Le," - "+y(r.currentMenuItem.title),1)):p("",!0)]),i("ul",Re,[(n(!0),c(U,null,E(r.menu,(f,C)=>(n(),c("li",{key:C,class:"py-1 flex justify-between border-b border-gray-300 my-2"},[i("div",{class:N(["flex justify-between",{"w-full":!r.isStep(f)}])},[i("div",{class:N(["w-56 text-lg",{"text-gray-400":r.isStep(f)&&f.isDisabled(d.group)}])},y(f.title),3),i("div",null,[r.isStep(f)?p("",!0):(n(),h(w,{key:0,section:f},null,8,["section"])),r.isStep(f)&&f.isDisabled(d.group)?(n(),h(D,{key:1,class:"inline text-gray-400",height:14,width:14})):p("",!0),r.isStep(f)&&f.isComplete(d.group)?(n(),c("div",Ne,[s(k,{color:"green"},{default:l(()=>e[1]||(e[1]=[_(" Approved ")])),_:1})])):p("",!0)])],2),r.isCurrentStep(f)?(n(),c("div",je,[i("ul",null,[(n(!0),c(U,null,E(f.sections,(S,v)=>(n(),c("li",{key:v,class:"pb-2 flex justify-between my-2"},[i("div",null,y(S.title),1),s(w,{section:S},null,8,["section"])]))),128))])])):p("",!0)]))),128))]),t.hasAnyPermission(["ep-applications-manage",["application-edit",d.group]])?(n(),c("div",Be,[d.group.uuid?(n(),h(b,{key:0,to:r.applicationRoute},{default:l(()=>e[2]||(e[2]=[i("button",{class:"btn blue btn-lg"}," Go to application ",-1)])),_:1},8,["to"])):p("",!0)])):p("",!0)])):p("",!0)}const qe=A(Ie,[["render",Oe]]),He={name:"GroupDetailHeader",props:{group:{type:ue,required:!0}},emits:["showEdit"],computed:{showShortName(){return this.group.expert_panel.short_base_name!==this.group.expert_panel.long_base_name}}},We={class:"flex justify-between items-start"},Ye={class:"text-sm text-gray-800 mt-1 font-normal"},ze={key:0},Je={key:1},Qe={key:2},Ze={key:0},Ke={key:0},Xe={key:1,class:"text-gray-500"},$e={key:0},et={key:1,class:"text-gray-500"};function tt(t,e,d,o,a,r){const w=u("group-breadcrumbs"),D=u("badge"),k=u("router-link"),b=u("note"),f=u("dictionary-row");return n(),c("header",null,[s(w),i("h1",We,[i("div",null,[_(y(d.group.displayName)+" ",1),s(D,{color:d.group.statusColor,class:"text-xs"},{default:l(()=>[_(y(d.group.status?d.group.status.name:"loading..."),1)]),_:1},8,["color"]),i("div",Ye,[d.group.isEp()&&r.showShortName?(n(),c("span",ze,[e[1]||(e[1]=_("Short Name: ")),i("strong",null,y(d.group.expert_panel.full_short_base_name||"--"),1),e[2]||(e[2]=_(" | "))])):p("",!0),d.group.isEp()?(n(),c("span",Je,[e[3]||(e[3]=_(" Affiliation ID: ")),i("strong",null,y(d.group.expert_panel.affiliation_id||"--"),1)])):p("",!0),d.group.parent_id?(n(),c("span",Qe,[e[4]||(e[4]=_(" | Part of the ")),s(k,{to:{name:"GroupDetail",params:{uuid:d.group.parent.uuid}}},{default:l(()=>[_(y(d.group.parent.name),1)]),_:1},8,["to"])])):p("",!0)]),t.hasRole("super-user")?(n(),h(b,{key:0,class:"font-normal mt-2"},{default:l(()=>[_(" group.id: "+y(d.group.id)+" ",1),d.group.is_ep?(n(),c("span",Ze," | expertPanel.id: "+y(d.group.expert_panel.id),1)):p("",!0)]),_:1})):p("",!0)]),t.hasAnyPermission(["groups-manage",["info-edit",d.group]])?(n(),c("button",{key:0,class:"btn btn-xs",onClick:e[0]||(e[0]=C=>t.$emit("showEdit"))}," Edit Group Info ")):p("",!0)]),s(f,{label:"Chairs:"},{label:l(()=>e[5]||(e[5]=[i("strong",null,"Chairs:",-1)])),default:l(()=>[d.group.chairs.length>0?(n(),c("div",Ke,y(d.group.chairs.map(C=>C.person.name).join(", ")),1)):(n(),c("div",Xe," None assigned "))]),_:1}),s(f,{label:"Coordinators:"},{label:l(()=>e[6]||(e[6]=[i("strong",null,"Coordinators:",-1)])),default:l(()=>[d.group.coordinators.length>0?(n(),c("div",$e,y(d.group.coordinators.map(C=>C.person.name).join(", ")),1)):(n(),c("div",et," None assigned "))]),_:1})])}const ot=A(He,[["render",tt]]),nt={props:{saveFunction:{type:Function,required:!0}},emits:["saved","canceled"],data(){return{newDocument:{file:null,document_type_id:this.documentTypeId,notes:null},errors:{}}},computed:{...W({documentTypes:t=>t.doctypes.items}),group(){return this.$store.getters["groups/currentItemOrNew"]},application(){return this.group.expert_panel},isReviewed(){return!!this.newDocument.date_reviewed},documentType(){return this.documentTypes.length===0?{}:this.$store.getters["doctypes/getItemById"](this.documentTypeId)}},mounted(){this.$store.dispatch("doctypes/getItems")},methods:{async save(){try{const t=new FormData;Object.entries(this.newDocument).forEach(([e,d])=>{d!=null&&t.append(e,d)}),t.set("file",this.$refs.fileInput.files[0]),await this.saveFunction(t),this.clearForm(),this.$emit("saved")}catch(t){T(t)&&(this.errors=t.response.data.errors)}},cancel(){this.clearForm(),this.$emit("canceled")},clearForm(){this.initNewDocument(),this.clearErrors()},initNewDocument(){this.$refs.fileInput.value=null,this.newDocument={file:null,document_type_id:this.documentTypeId,notes:null}},clearErrors(){this.errors={}}}},rt={ref:"fileInput",type:"file"},st=["value"];function it(t,e,d,o,a,r){const w=u("input-row"),D=u("button-row"),k=u("form-container");return n(),h(k,null,{default:l(()=>[s(w,{label:"Document",errors:a.errors.file},{default:l(()=>[i("input",rt,null,512)]),_:1},8,["errors"]),s(w,{label:"Type",errors:a.errors.document_type_id},{default:l(()=>[G(i("select",{"onUpdate:modelValue":e[0]||(e[0]=b=>a.newDocument.document_type_id=b)},[e[4]||(e[4]=i("option",{value:null}," Select... ",-1)),(n(!0),c(U,null,E(t.documentTypes,b=>(n(),c("option",{key:b.id,value:b.id},y(b.long_name),9,st))),128))],512),[[V,a.newDocument.document_type_id]])]),_:1},8,["errors"]),s(w,{errors:a.errors.notes,label:"Notes"},{default:l(()=>[G(i("textarea",{"onUpdate:modelValue":e[1]||(e[1]=b=>a.newDocument.notes=b),name:"notes",cols:"30",rows:"10"},null,512),[[L,a.newDocument.notes]])]),_:1},8,["errors"]),s(D,null,{default:l(()=>[i("button",{class:"btn white",onClick:e[2]||(e[2]=(...b)=>r.cancel&&r.cancel(...b))}," Cancel "),i("button",{class:"btn blue",onClick:e[3]||(e[3]=(...b)=>r.save&&r.save(...b))}," Save ")]),_:1})]),_:1})}const lt=A(nt,[["render",it]]),at={name:"DocumentEditForm",props:{document:{required:!0,type:Object},saveFunction:{required:!0,type:Function}},emits:["saved","canceled"],data(){return{docProxy:{},errors:{}}},computed:{...W({documentTypes:t=>t.doctypes.items})},watch:{document:{immediate:!0,handler(){this.docProxy=JSON.parse(JSON.stringify(this.document))}}},mounted(){this.$store.dispatch("doctypes/getItems")},methods:{cancel(){this.docProxy={},this.$emit("canceled")},async save(){try{this.saveFunction(this.docProxy),this.$emit("saved")}catch(t){throw T(t)&&(this.errors=t.response.data.errors),t}}}},ut=["value"];function dt(t,e,d,o,a,r){const w=u("dictionary-row"),D=u("input-row"),k=u("button-row"),b=u("form-container");return n(),h(b,null,{default:l(()=>[s(w,{label:"File"},{default:l(()=>[_(y(d.document.filename),1)]),_:1}),s(D,{label:"Type",errors:a.errors.document_type_id},{default:l(()=>[G(i("select",{"onUpdate:modelValue":e[0]||(e[0]=f=>a.docProxy.document_type_id=f)},[(n(!0),c(U,null,E(t.documentTypes,f=>(n(),c("option",{key:f.id,value:f.id},y(f.long_name),9,ut))),128))],512),[[V,a.docProxy.document_type_id]])]),_:1},8,["errors"]),s(D,{errors:a.errors.notes,label:"Notes"},{default:l(()=>[G(i("textarea",{"onUpdate:modelValue":e[1]||(e[1]=f=>a.docProxy.notes=f),name:"notes",cols:"30",rows:"10"},null,512),[[L,a.docProxy.notes]])]),_:1},8,["errors"]),s(k,null,{default:l(()=>[i("button",{class:"btn",onClick:e[2]||(e[2]=(...f)=>r.cancel&&r.cancel(...f))}," Cancel "),i("button",{class:"btn blue",onClick:e[3]||(e[3]=(...f)=>r.save&&r.save(...f))}," Save ")]),_:1})]),_:1})}const pt=A(at,[["render",dt]]),ct={name:"DocumentList",components:{DocumentUploadForm:lt,DocumentEditForm:pt},props:{documents:{type:Array,required:!0},documentCreator:{type:Function,required:!1},documentUpdater:{type:Function,required:!1},documentDeleter:{type:Function,required:!1},canManage:{type:Boolean,default:!1}},emits:["updated"],data(){return{fields:[{name:"cheveron",label:"",sortable:!1},{name:"filename",label:"File",type:String,sortable:!0},{name:"type.long_name",label:"Type",type:String,sortable:!0},{name:"notes",type:String,sortable:!0},{name:"actions",label:"",type:String,sortable:!1}],sort:{field:"filename",desc:!1},keyword:null,filterType:null,documentTypes:[],activeDocument:{type:{}},showDeleteConfirmation:!1,showEditForm:!1,showUploadForm:!1}},computed:{filteredDocuments(){let t=[...this.documents];if(this.keyword){const e=new RegExp(`.*${this.keyword}.*`,"i");t=t.filter(d=>d.filename.match(e)||d.notes&&d.notes.match(e)||d.type.name.match(e))}return this.filterType&&(t=t.filter(e=>e.document_type_id===this.filterType)),t}},mounted(){Y.get("/api/document-types").then(t=>this.documentTypes=t.data)},methods:{toggleItemDetails(t){t.showDetails=!t.showDetails},initDownload(t){window.location=t.download_url},initUpdate(t){this.showEditForm=!0,this.activeDocument=t},commitUpdate(t){this.documentUpdater?this.documentUpdater(t):alert("we need a default document upload function"),this.$emit("updated"),this.showUploadForm=!1},initDelete(t){this.activeDocument=t,this.showDeleteConfirmation=!0},cancelDelete(){this.showDeleteConfirmation=!1,this.resetActiveDocument()},async commitDelete(){this.documentDeleter?this.documentDeleter(this.activeDocument):alert("we need to add a default document deleter."),this.showDeleteConfirmation=!1,this.resetActiveDocument(),this.$emit("updated")},initUpload(){this.showUploadForm=!0},commitCreate(t){this.documentCreator?this.documentCreator(t):alert("we need a default document upload function"),this.$emit("updated"),this.showUploadForm=!1},resetActiveDocument(){this.activeDocument={type:{}}}}},mt={class:"flex justify-between py-2"},gt={class:"flex space-x-2"},ft=["value"],_t=["onClick"],ht={class:"note"},bt={key:0},vt={key:1},yt={class:"px-4 pb-4 border"},wt={key:0,class:"flex space-x-2 pt-2 border-t"},Dt=["onClick"],kt=["onClick"],St=["onClick"],Ct={key:0},xt={key:0,class:"mb-3"};function At(t,e,d,o,a,r){const w=u("icon-cheveron-right"),D=u("icon-cheveron-down"),k=u("dropdown-item"),b=u("dropdown-menu"),f=u("object-dictionary"),C=u("data-table"),S=u("DocumentEditForm"),v=u("modal-dialog"),F=u("DocumentUploadForm"),P=u("button-row");return n(),c("div",null,[de(t.$slots,"heading",{},()=>[i("div",mt,[i("div",gt,[i("label",null,[e[9]||(e[9]=_(" Search: ")),G(i("input",{"onUpdate:modelValue":e[0]||(e[0]=m=>a.keyword=m),type:"text",placeholder:"Filter",class:"sm"},null,512),[[L,a.keyword]])]),i("label",null,[e[11]||(e[11]=_(" Type:   ")),G(i("select",{"onUpdate:modelValue":e[1]||(e[1]=m=>a.filterType=m)},[e[10]||(e[10]=i("option",{value:null},"Any",-1)),(n(!0),c(U,null,E(a.documentTypes,m=>(n(),c("option",{key:m.id,value:m.id},y(m.long_name),9,ft))),128))],512),[[V,a.filterType]])])]),d.canManage?(n(),c("button",{key:0,class:"btn btn-xs",onClick:e[2]||(e[2]=(...m)=>r.initUpload&&r.initUpload(...m))}," Upload ")):p("",!0)])]),s(C,{sort:a.sort,"onUpdate:sort":e[3]||(e[3]=m=>a.sort=m),fields:a.fields,data:r.filteredDocuments,"detail-rows":!0},{"cell-cheveron":l(({item:m})=>[m.metadata?(n(),c("button",{key:0,class:"w-9 align-center block -mx-3",onClick:pe(x=>r.toggleItemDetails(m),["stop"])},[m.showDetails?p("",!0):(n(),h(w,{key:0,class:"m-auto cursor-pointer"})),m.showDetails?(n(),h(D,{key:1,class:"m-auto cursor-pointer"})):p("",!0)],8,_t)):p("",!0)]),"cell-filename":l(({item:m})=>[_(y(m.filename)+" ",1),i("span",ht,[m.type.is_versioned&&m.version?(n(),c("em",bt,"(version "+y(m.version)+")",1)):p("",!0),m.is_final?(n(),c("em",vt," FINAL")):p("",!0)])]),"cell-actions":l(({item:m})=>[s(b,{"hide-cheveron":""},{label:l(()=>e[12]||(e[12]=[i("button",{class:"btn btn-xs"}," … ",-1)])),default:l(()=>[s(k,{onClick:x=>r.initDownload(m)},{default:l(()=>e[13]||(e[13]=[_(" Download ")])),_:2},1032,["onClick"]),d.canManage?(n(),h(k,{key:0,onClick:x=>r.initUpdate(m)},{default:l(()=>e[14]||(e[14]=[_(" Update ")])),_:2},1032,["onClick"])):p("",!0),d.canManage?(n(),h(k,{key:1,onClick:x=>r.initDelete(m)},{default:l(()=>e[15]||(e[15]=[_(" Delete ")])),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),detail:l(({item:m})=>[i("div",yt,[s(f,{obj:m.metadata},null,8,["obj"]),d.canManage?(n(),c("div",wt,[i("button",{class:"btn btn-xs",onClick:x=>r.initDownload(m)}," Download ",8,Dt),i("button",{class:"btn btn-xs",onClick:x=>r.initUpdate(m)}," Update ",8,kt),i("button",{class:"btn btn-xs red",onClick:x=>r.initDelete(m)}," Delete ",8,St)])):p("",!0)])]),_:1},8,["sort","fields","data"]),(n(),h(z,{to:"body"},[s(v,{modelValue:a.showEditForm,"onUpdate:modelValue":e[5]||(e[5]=m=>a.showEditForm=m),title:`Update ${a.activeDocument.filename}`},{default:l(()=>[s(S,{document:a.activeDocument,"save-function":r.commitUpdate,onSaved:e[4]||(e[4]=m=>t.$emit("updated"))},null,8,["document","save-function"])]),_:1},8,["modelValue","title"]),s(v,{modelValue:a.showUploadForm,"onUpdate:modelValue":e[7]||(e[7]=m=>a.showUploadForm=m),title:"Upload a new document"},{default:l(()=>[s(F,{"save-function":r.commitCreate,onSaved:e[6]||(e[6]=m=>t.$emit("updated"))},null,8,["save-function"])]),_:1},8,["modelValue"]),s(v,{modelValue:a.showDeleteConfirmation,"onUpdate:modelValue":e[8]||(e[8]=m=>a.showDeleteConfirmation=m),title:`You are about to delete ${a.activeDocument.filename}`},{default:l(()=>[a.activeDocument?(n(),c("div",Ct,[a.activeDocument.is_final?(n(),c("p",xt," This version has been tagged as the final version of the document. ")):p("",!0),e[16]||(e[16]=i("p",null,"Are you sure you want to continue?",-1)),s(P,{"submit-text":"Delete Document",onCanceled:r.cancelDelete,onSubmitted:r.commitDelete},null,8,["onCanceled","onSubmitted"])])):p("",!0)]),_:1},8,["modelValue","title"])]))])}const Ft=A(ct,[["render",At]]),Ut={name:"GroupDocuments",components:{DocumentList:Ft},props:{},data(){return{}},computed:{group:{get(){return this.$store.getters["groups/currentItemOrNew"]}},displayDocuments(){return this.group.documents},canManageDocuments(){return this.hasAnyPermission(["groups-manage","ep-applications-manage",["info-edit",this.group]])}},methods:{async updateDocument(t){if(!this.canManageDocuments){this.$store.pushError("Permission denied");return}await this.$store.dispatch("groups/updateDocument",{group:this.group,document:t})},async createDocument(t){if(!this.canManageDocuments){this.$store.pushError("Permission denied");return}await this.$store.dispatch("groups/addDocument",{group:this.group,data:t})},async deleteDocument(t){if(!this.canManageDocuments){this.$store.pushError("Permission denied");return}await this.$store.dispatch("groups/deleteDocument",{group:this.group,document:t})}}};function Et(t,e,d,o,a,r){const w=u("DocumentList");return n(),c("div",null,[s(w,{documents:r.displayDocuments,"document-updater":r.updateDocument,"document-creator":r.createDocument,"document-deleter":r.deleteDocument,"can-manage":r.canManageDocuments},null,8,["documents","document-updater","document-creator","document-deleter","can-manage"])])}const Gt=A(Ut,[["render",Et]]),Mt={name:"SubgroupList",props:{},data(){return{}},computed:{group(){return this.$store.getters["groups/currentItemOrNew"]},showMemberReportButton(){return this.hasAnyPermission([["members-invite",this.group],"groups-manage","ep-applications-manage","annual-updates-manage"])},exportUrl(){return`/api/report/groups/${this.group.uuid}/subgroup-member-export`}}},Pt={class:"flex justify-between"},It={class:"btn btn-icon"},Tt=["href"],Vt={class:"text-xs"};function Lt(t,e,d,o,a,r){const w=u("icon-download"),D=u("dropdown-item"),k=u("note"),b=u("dropdown-menu"),f=u("dictionary-row"),C=u("router-link"),S=u("popover");return n(),c("div",null,[i("div",Pt,[e[2]||(e[2]=i("h2",{class:"mb-4"}," Subgroups ",-1)),s(b,{"hide-cheveron":"",orientation:"right"},{label:l(()=>[i("button",It,[s(w,{width:"16",height:"16"})])]),default:l(()=>[s(D,{class:"text-right font-bold"},{default:l(()=>e[0]||(e[0]=[_(" Downloads: ")])),_:1}),r.showMemberReportButton?(n(),h(D,{key:0,class:"text-right"},{default:l(()=>[i("a",{href:r.exportUrl},"Member Export",8,Tt),s(k,{class:"inline"},{default:l(()=>e[1]||(e[1]=[_(" (CSV) ")])),_:1})]),_:1})):p("",!0)]),_:1})]),i("ul",null,[(n(!0),c(U,null,E(r.group.children,v=>(n(),c("li",{key:v.id,class:"child-group"},[s(S,{hover:"",arrow:"",placement:"left",class:"block w-full"},{content:l(()=>[i("div",Vt,[s(f,{label:"Status","label-class":"font-bold","label-width":"8em"},{default:l(()=>[_(y(v.status.name),1)]),_:2},1024),v.chairs.length>0?(n(),h(f,{key:0,label:"Chairs","label-class":"font-bold","label-width":"8em",class:"my-1"},{default:l(()=>[_(y(v.chairs.map(F=>F.person.name).join(", ")),1)]),_:2},1024)):p("",!0),v.coordinators.length>0?(n(),h(f,{key:1,label:"Coordinators","label-class":"font-bold","label-width":"8em"},{default:l(()=>[_(y(v.coordinators.map(F=>F.person.name).join(", ")),1)]),_:2},1024)):p("",!0),s(f,{label:"# Members","label-width":"8em","label-class":"font-bold"},{default:l(()=>[_(y(v.members_count),1)]),_:2},1024)])]),default:l(()=>[s(C,{to:{name:"GroupDetail",params:{uuid:v.uuid}},class:"block w-full"},{default:l(()=>[_(y(v.name),1)]),_:2},1032,["to"])]),_:2},1024)]))),128))])])}const Rt=A(Mt,[["render",Lt],["__scopeId","data-v-04effe7e"]]),Nt={name:"GroupDetail",components:{ActivityLog:ve,ApplicationSummary:qe,AttestationGcep:Ce,AttestationNhgri:Se,AttestationReanalysis:ke,GroupDescriptionForm:De,SpecificationsSection:xe,GroupDocuments:Gt,GroupForm:Ue,GroupDetailHeader:ot,EvidenceSummaries:Ae,GcepGeneList:O,GcepOngoingPlansForm:q,MemberList:Fe,MembershipDescriptionForm:we,ScopeDescriptionForm:ye,VcepGeneList:B,VcepOngoingPlansForm:H,AnnualUpdateAlert:Ge,StepTabs:Pe,ProgressChart:Me,SustainedCurationReviewAlert:Ee,SubgroupList:Rt},props:{uuid:{type:String,required:!0}},setup(t){const e=ge(),d=me(!1),o=M({get(){return e.getters["groups/currentItemOrNew"]},set(b){e.commit("groups/addItem",b)}}),a=M(()=>o.value.is_ep?o.value.is_vcep_or_scvcep?B:O:null),r=M(()=>o.value.is_vcep_or_scvcep?H:q),w=async()=>{await be(`/api/groups/${t.uuid}/activity-logs`)},D=()=>{e.dispatch("groups/find",t.uuid).then(()=>{e.commit("groups/setCurrentItemIndexByUuid",t.uuid),e.dispatch("groups/getChildren",o.value),o.value.is_ep&&(e.dispatch("groups/getGenes",o.value),e.dispatch("groups/getDocuments",o.value),o.value.is_vcep_or_scvcep&&e.dispatch("groups/getEvidenceSummaries",o.value),e.dispatch("groups/getPendingTasks",o.value),e.dispatch("groups/getAnnualUpdate",o.value))})},k=M(()=>o.value.pendingTasks&&o.value.pendingTasks.filter(b=>Number.parseInt(b.task_type_id)===1).length>0);return fe(()=>t.uuid,()=>D(),{immediate:!0}),_e(async()=>{}),{group:o,groupGeneList:a,showModal:d,ongoingPlansFormComponent:r,logEntries:he,needsToReviewSustainedCuration:k,getLogEntries:w,getGroup:D}},data(){return{showInfoEdit:!1,editingExpertise:!1,editingDescription:!1,editingScopeDescription:!1,editingGenes:!1,showConfirmDelete:!1,ongoingPlansErrors:{},errors:{}}},computed:{showCreateAnnualUpdateButton(){return this.hasPermission("annual-updates-manage")&&this.group.expert_panel&&!this.group.expert_panel.annualUpdate}},watch:{$route(){this.showModal=this.$route.meta.showModal?!!this.$route.meta.showModal:!1}},mounted(){this.showModal=!!this.$route.meta.showModal,this.showConfirmDelete=!1},beforeUnmount(){this.$store.commit("groups/clearCurrentItem")},methods:{hideModal(){this.$router.replace({name:"GroupDetail",params:{uuid:this.uuid}})},handleModalClosed(t){this.clearModalForm(t),this.$router.push({name:"GroupDetail",params:{uuid:this.uuid}})},clearModalForm(){typeof this.$refs.modalView.clearForm=="function"&&this.$refs.modalView.clearForm()},showEdit(){this.showInfoEdit=!0},cancelForm(t){this[t]=!1,this.errors={},this.revertGroupChanges()},async submitForm(t,e){try{await this[t].apply(this.group),this[e]=!1}catch(d){if(T(d)){this.errors=d.response.data.errors;return}throw d}},saveDescription(){return this.$store.dispatch("groups/descriptionUpdate",{uuid:this.group.uuid,description:this.group.description}).then(()=>{this.$store.commit("pushSuccess","Description updated.")})},saveMembershipDescription(){return this.$store.dispatch("groups/membershipDescriptionUpdate",{uuid:this.group.uuid,membershipDescription:this.group.expert_panel.membership_description}).then(()=>{this.$store.commit("pushSuccess","Description of expertise updated.")})},saveScopeDescription(){return this.$store.dispatch("groups/scopeDescriptionUpdate",{uuid:this.group.uuid,scopeDescription:this.group.expert_panel.scope_description}).then(t=>(this.$store.commit("pushSuccess","Description of scope updated."),t))},saveOngoingPlansForm(){const{uuid:t,expert_panel:e}=this.group;return this.$store.dispatch("groups/curationReviewProtocolUpdate",{uuid:t,expertPanel:e}).then(()=>{this.$store.commit("pushSuccess","Curation review protocol updated.")})},revertGroupChanges(){return this.errors={},this.$store.dispatch("groups/find",this.group.uuid).then(()=>{this.$store.commit("pushInfo","Update canceled.")})},handleTabChange(t){t==="Log"&&ce("groups-manage")&&this.getLogEntries()},initDelete(){this.showConfirmDelete=!0},deleteGroup(){this.$store.dispatch("groups/delete",this.group.uuid),this.$store.commit("pushSuccess","Group deleted."),this.$router.push({name:"GroupList"})},async fakeCspecPilotApproved(){try{await Y.post(`/api/groups/${this.uuid}/dev/fake-pilot-approved`),this.$store.dispatch("groups/getPendingTasks",this.group)}catch(t){t.response.status===418&&this.$store.commit("pushError",t.response.data)}},createAnnualUpdateForLatestWindow(){this.$store.dispatch("groups/createAnnualUpdateForLatestWindow",this.group)}}},jt={class:"flex space-x-4"},Bt={class:"flex-grow mt-4"},Ot={key:0,class:"bg-white/50 absolute top-0 left-0 right-0 bottom-0"},qt={key:2},Ht={class:"relative"},Wt={key:0,class:"bg-white/50 absolute top-0 left-0 right-0 bottom-0"},Yt={key:0},zt={key:1,class:"border my-4 p-4 rounded"},Jt=["href"],Qt={class:"border my-4 p-4 bg-red-100 border-red-200 rounded"},Zt={key:2,class:"border my-4 p-4 rounded"},Kt={key:0,class:"md:w-1/5 lg:w-1/4"},Xt={class:"text-lg"};function $t(t,e,d,o,a,r){const w=u("AnnualUpdateAlert"),D=u("SustainedCurationReviewAlert"),k=u("GroupDetailHeader"),b=u("ApplicationSummary"),f=u("MemberList"),C=u("MembershipDescriptionForm"),S=u("submission-wrapper"),v=u("tab-item"),F=u("GroupDescriptionForm"),P=u("ScopeDescriptionForm"),m=u("static-alert"),x=u("EvidenceSummaries"),J=u("SpecificationsSection"),Q=u("GroupDocuments"),R=u("note"),Z=u("AttestationGcep"),K=u("AttestationReanalysis"),X=u("AttestationNhgri"),$=u("ActivityLog"),ee=u("ProgressChart"),te=u("StepTabs"),oe=u("tabs-container"),ne=u("SubgroupList"),re=u("router-view"),I=u("modal-dialog"),se=u("GroupForm"),ie=u("button-row");return n(),c("div",null,[t.hasAnyPermission(["annual-updates-mange",["annual-update-manage",o.group]])?(n(),h(w,{key:0,group:o.group,class:"mb-2"},null,8,["group"])):p("",!0),o.needsToReviewSustainedCuration&&t.hasAnyPermission(["ep-applications-manage",["application-edit",o.group]])?(n(),h(D,{key:1,group:o.group,class:"mb-2"},null,8,["group"])):p("",!0),s(k,{group:o.group,onShowEdit:r.showEdit},null,8,["group","onShowEdit"]),i("div",jt,[i("div",Bt,[o.group.isApplying?(n(),h(b,{key:0,group:o.group},null,8,["group"])):p("",!0),s(oe,{onTabChanged:r.handleTabChange},{default:l(()=>[s(v,{label:"Members"},{default:l(()=>[s(f,{group:o.group},null,8,["group"]),o.group.is_vcep_or_scvcep?(n(),h(S,{key:0,"show-controls":a.editingExpertise,onSubmitted:e[1]||(e[1]=g=>r.submitForm("saveMembershipDescription","editingExpertise")),onCanceled:e[2]||(e[2]=g=>r.cancelForm("editingExpertise"))},{default:l(()=>[s(C,{editing:a.editingExpertise,"onUpdate:editing":e[0]||(e[0]=g=>a.editingExpertise=g),class:"mt-8",errors:a.errors},null,8,["editing","errors"])]),_:1},8,["show-controls"])):p("",!0)]),_:1}),s(v,{label:"Website Description"},{default:l(()=>[s(S,{visible:o.group.is_ep,"show-controls":a.editingDescription,onSubmitted:e[4]||(e[4]=g=>r.submitForm("saveDescription","editingDescription")),onCanceled:e[5]||(e[5]=g=>r.cancelForm("editingDescription"))},{default:l(()=>[s(F,{editing:a.editingDescription,"onUpdate:editing":e[3]||(e[3]=g=>a.editingDescription=g),errors:a.errors},null,8,["editing","errors"])]),_:1},8,["visible","show-controls"])]),_:1}),s(v,{label:"Scope",visible:o.group.is_ep},{default:l(()=>[e[27]||(e[27]=i("h3",null," Plans for Ongoing Gene Review and Reanalysis and Discrepancy Resolution ",-1)),o.group.is_ep?(n(),h(S,{key:0,"show-controls":a.editingGenes,onSubmitted:e[7]||(e[7]=g=>t.$refs.groupGeneListRef.save()),onCanceled:e[8]||(e[8]=g=>t.$refs.groupGeneListRef.cancel())},{default:l(()=>[(n(),h(j(o.groupGeneList),{ref:"groupGeneListRef",editing:a.editingGenes,"onUpdate:editing":e[6]||(e[6]=g=>a.editingGenes=g)},null,40,["editing"]))]),_:1},8,["show-controls"])):p("",!0),e[28]||(e[28]=i("br",null,null,-1)),s(S,{visible:o.group.is_ep,"show-controls":a.editingScopeDescription,onSubmitted:e[10]||(e[10]=g=>r.submitForm("saveScopeDescription","editingScopeDescription")),onCanceled:e[11]||(e[11]=g=>r.cancelForm("editingScopeDescription"))},{default:l(()=>[s(P,{editing:a.editingScopeDescription,"onUpdate:editing":e[9]||(e[9]=g=>a.editingScopeDescription=g),errors:a.errors},null,8,["editing","errors"])]),_:1},8,["visible","show-controls"])]),_:1},8,["visible"]),s(v,{label:"Sustained Curation",visible:o.group.is_ep,class:"relative"},{default:l(()=>[!o.group.expert_panel.pilotSpecificationsIsApproved&&o.group.is_vcep_or_scvcep?(n(),c("div",Ot)):p("",!0),!o.group.expert_panel.pilotSpecificationsIsApproved&&o.group.is_vcep_or_scvcep?(n(),h(m,{key:1,variant:"info"},{default:l(()=>e[29]||(e[29]=[_(" You can complete these sections after your first Specifications Pilot has been approved. ")])),_:1})):p("",!0),s(S,{class:"pb-4","show-controls":t.hasAnyPermission(["ep-applications-manage",["application-edit",o.group]])&&o.group.expert_panel.pilotSpecificationsIsApproved,onSubmitted:e[12]||(e[12]=g=>r.submitForm("saveOngoingPlansForm")),onCanceled:e[13]||(e[13]=g=>r.cancelForm())},{default:l(()=>[(n(),h(j(o.ongoingPlansFormComponent),{errors:a.errors,readonly:!o.group.expert_panel.pilotSpecificationsIsApproved},null,8,["errors","readonly"]))]),_:1},8,["show-controls"]),o.group.is_vcep_or_scvcep?(n(),c("section",qt,[e[30]||(e[30]=i("header",null,[i("h3",null,"Example Evidence Summaries")],-1)),s(x,{group:o.group,readonly:!o.group.expert_panel.pilotSpecificationsIsApproved,class:"pb-2 mb-4 border-b"},null,8,["group","readonly"])])):p("",!0)]),_:1},8,["visible"]),s(v,{label:"Specifications",visible:o.group.is_vcep_or_scvcep},{default:l(()=>[i("div",Ht,[!o.group.expert_panel.defIsApproved&&o.group.is_vcep_or_scvcep?(n(),c("div",Wt)):p("",!0),!o.group.expert_panel.defIsApproved&&o.group.is_vcep_or_scvcep?(n(),h(m,{key:1,variant:"info"},{default:l(()=>e[31]||(e[31]=[_(" You can complete these sections after your Group Definition has been approved. ")])),_:1})):p("",!0),i("div",null,[s(J,{"doc-type-id":o.group.expert_panel.draftSpecApproved?[2,3,4,7]:2,step:o.group.expert_panel.draftSpecApproved?3:2},null,8,["doc-type-id","step"])])])]),_:1},8,["visible"]),t.userInGroup(o.group)||t.hasPermission("groups-manage")?(n(),h(v,{key:0,label:"Documents"},{default:l(()=>[s(Q),s(R,null,{default:l(()=>e[32]||(e[32]=[_("Documents are only available to members of this group.")])),_:1})]),_:1})):p("",!0),s(v,{label:"Attestations",visible:o.group.is_ep},{default:l(()=>[s(R,null,{default:l(()=>e[33]||(e[33]=[_(" The attestations below are read only. Attestations can only be completed during the application process. ")])),_:1}),o.group.is_gcep?(n(),h(Z,{key:0,class:"pb-2 mb-4 border-b",disabled:!0})):p("",!0),e[34]||(e[34]=i("h3",null,"Reanalysis & Discrepancy Resolution",-1)),o.group.is_vcep_or_scvcep?(n(),h(K,{key:1,class:"pb-2 mb-4 border-b",disabled:!0})):p("",!0),e[35]||(e[35]=i("h3",null,"NHGRI Data Availability",-1)),s(X,{class:"pb-2 mb-4 border-b",disabled:!0})]),_:1},8,["visible"]),s(v,{label:"Log",visible:t.hasPermission("groups-manage")||t.userInGroup(o.group)},{default:l(()=>[s($,{"log-entries":o.logEntries,"api-url":`/api/groups/${o.group.uuid}/activity-logs`,"log-updated":o.getLogEntries},null,8,["log-entries","api-url","log-updated"]),i("button",{class:"btn btn-xs mt-1",onClick:e[14]||(e[14]=(...g)=>o.getLogEntries&&o.getLogEntries(...g))}," Refresh ")]),_:1},8,["visible"]),s(v,{label:"Admin",visible:t.hasPermission("groups-manage")},{default:l(()=>[o.group.isApplying&&o.group.is_ep?(n(),c("div",Yt,[e[36]||(e[36]=i("h2",{class:"pb-2 border-b mb-4"}," Application ",-1)),s(ee,{application:o.group.expert_panel,class:"pb-4 border-b border-gray-300 mb-6"},null,8,["application"]),o.group.is_ep?(n(),h(te,{key:0,application:o.group.expert_panel,onStepApproved:o.getGroup},null,8,["application","onStepApproved"])):p("",!0),e[37]||(e[37]=i("hr",null,null,-1))])):p("",!0),o.group.is_ep?(n(),c("section",zt,[e[38]||(e[38]=i("h2",{class:"mb-4"}," Annual Update ",-1)),r.showCreateAnnualUpdateButton?(n(),c("button",{key:0,class:"btn",onClick:e[15]||(e[15]=(...g)=>r.createAnnualUpdateForLatestWindow&&r.createAnnualUpdateForLatestWindow(...g))}," Create Annual Update for latest window. ")):o.group.expert_panel.annualUpdate?(n(),c("a",{key:1,href:`/annual-updates/${o.group.expert_panel.annualUpdate.id}`,target:"annual update"}," View Annual Update for "+y(o.group.expert_panel.annualUpdate.window.for_year),9,Jt)):p("",!0)])):p("",!0),i("section",Qt,[e[39]||(e[39]=i("h2",{class:"mb-4 text-red-800"}," Here be dragons. Proceed with caution. ",-1)),i("button",{class:"btn btn red",onClick:e[16]||(e[16]=(...g)=>r.initDelete&&r.initDelete(...g))}," Delete Group ")]),t.$store.state.systemInfo.env!=="production"?(n(),c("section",Zt,[e[40]||(e[40]=i("h2",{class:"mb-4"},[_(" Dev tools "),i("span",{class:"text-gray-500"}," - don't use if you don't know.")],-1)),o.group.is_vcep_or_scvcep&&o.group.expert_panel.has_approved_pilot?(n(),c("button",{key:0,class:"btn",onClick:e[17]||(e[17]=(...g)=>r.fakeCspecPilotApproved&&r.fakeCspecPilotApproved(...g))}," Fake a Pilot Approved Message ")):p("",!0)])):p("",!0)]),_:1},8,["visible"])]),_:1},8,["onTabChanged"])]),o.group.hasChildren?(n(),c("div",Kt,[s(ne)])):p("",!0)]),(n(),h(z,{to:"body"},[s(I,{modelValue:o.showModal,"onUpdate:modelValue":e[18]||(e[18]=g=>o.showModal=g),title:t.$route.meta.title,onClosed:r.handleModalClosed},{default:l(()=>[s(re,{ref:"modalView",onSaved:r.hideModal,onCanceled:r.hideModal},null,8,["onSaved","onCanceled"])]),_:1},8,["modelValue","title","onClosed"]),s(I,{modelValue:a.showInfoEdit,"onUpdate:modelValue":e[23]||(e[23]=g=>a.showInfoEdit=g),title:"Edit Group Info",size:"sm",onClosed:e[24]||(e[24]=g=>a.showInfoEdit=!1)},{default:l(()=>[s(S,{onSubmitted:e[21]||(e[21]=g=>t.$refs.infoForm.save()),onCanceled:e[22]||(e[22]=g=>t.$refs.infoForm.cancel())},{default:l(()=>[s(se,{ref:"infoForm",onCanceled:e[19]||(e[19]=g=>a.showInfoEdit=!1),onSaved:e[20]||(e[20]=g=>a.showInfoEdit=!1)},null,512)]),_:1})]),_:1},8,["modelValue"]),s(I,{modelValue:a.showConfirmDelete,"onUpdate:modelValue":e[26]||(e[26]=g=>a.showConfirmDelete=g),title:"Delete This Group?"},{default:l(()=>[i("div",Xt,[i("p",null," You are about to delete "+y(o.group.displayName)+" and all associated data. ",1),e[41]||(e[41]=i("p",null,"This cannot be undone.",-1))]),s(ie,{"submit-text":"Delete this group.",onSubmitted:r.deleteGroup,onCanceled:e[25]||(e[25]=g=>a.showConfirmDelete=!1)},null,8,["onSubmitted"])]),_:1},8,["modelValue"])]))])}const bo=A(Nt,[["render",$t]]);export{bo as default};
//# sourceMappingURL=GroupDetail-DYgvn2BH.js.map
