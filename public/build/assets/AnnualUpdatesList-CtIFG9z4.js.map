{"version":3,"file":"AnnualUpdatesList-CtIFG9z4.js","sources":["../../../node_modules/lodash-es/orderBy.js","../../../resources/js/components/annual_updates/AnnualUpdateTable.vue","../../../resources/js/views/AnnualUpdatesList.vue"],"sourcesContent":["import baseOrderBy from './_baseOrderBy.js';\nimport isArray from './isArray.js';\n\n/**\n * This method is like `_.sortBy` except that it allows specifying the sort\n * orders of the iteratees to sort by. If `orders` is unspecified, all values\n * are sorted in ascending order. Otherwise, specify an order of \"desc\" for\n * descending or \"asc\" for ascending sort order of corresponding values.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Array[]|Function[]|Object[]|string[]} [iteratees=[_.identity]]\n *  The iteratees to sort by.\n * @param {string[]} [orders] The sort orders of `iteratees`.\n * @param- {Object} [guard] Enables use as an iteratee for methods like `_.reduce`.\n * @returns {Array} Returns the new sorted array.\n * @example\n *\n * var users = [\n *   { 'user': 'fred',   'age': 48 },\n *   { 'user': 'barney', 'age': 34 },\n *   { 'user': 'fred',   'age': 40 },\n *   { 'user': 'barney', 'age': 36 }\n * ];\n *\n * // Sort by `user` in ascending order and by `age` in descending order.\n * _.orderBy(users, ['user', 'age'], ['asc', 'desc']);\n * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 40]]\n */\nfunction orderBy(collection, iteratees, orders, guard) {\n  if (collection == null) {\n    return [];\n  }\n  if (!isArray(iteratees)) {\n    iteratees = iteratees == null ? [] : [iteratees];\n  }\n  orders = guard ? undefined : orders;\n  if (!isArray(orders)) {\n    orders = orders == null ? [] : [orders];\n  }\n  return baseOrderBy(collection, iteratees, orders);\n}\n\nexport default orderBy;\n","<script>\nimport {api} from '@/http'\nimport setupRouterSortAndFilter from '@/composables/router_aware_sort_and_filter'\n\nexport default {\n    name: 'AnnualUpdateTeable',\n    props: {\n        items: {\n            type: Array,\n            required: true\n        }\n    },\n    setup() {\n        const {sort, filter} = setupRouterSortAndFilter({field: 'expert_panel.display_name', desc: false});\n\n        return {\n            sort,\n            filter\n        }\n    },\n    data() {\n        return {\n            fields: [\n                {\n                    name: 'id',\n                    sortable: true,\n                    label: 'ID'\n                },\n                {\n                    name: 'expert_panel.display_name',\n                    label: 'Expert Panel',\n                    sortable: true\n                },\n                {\n                    name: 'submitter.person.name',\n                    label: 'Submitter',\n                    sortable: true\n                },\n                {\n                    name: 'completed_at',\n                    label: 'Completed',\n                    sortable: true,\n                    resolveValue: (item) => {\n                        return item.completed_at ? this.formatDate(item.completed_at) : null;\n                    }\n                },\n                {\n                    name: 'action',\n                    label: '',\n                    sortable: false\n\n                }\n            ],\n            // completedFilter: null\n            \n        }\n    },\n    computed: {\n        completedFilter: {\n            get () {\n                return this.$route.query.completed || null;\n            },\n            set (value) {\n                const currentQuery = this.$route.query;\n                const currentPath = this.$route.path;\n        \n                let updatedQuery = {...currentQuery};\n        \n                if (!value) {\n                    delete updatedQuery.completed;\n                } else {\n                    updatedQuery = {...currentQuery, ...{'completed': value} };\n                }\n        \n                this.$router.replace({path: currentPath, query: updatedQuery})\n            }\n        },\n        filteredItems () {\n            let result = JSON.parse(JSON.stringify(this.items));\n            if (this.filter != null) {\n                const pattern = new RegExp(`.*${this.filter}.*`, 'i');\n                result = this.items.filter(i => {\n                    return i.expert_panel.display_name.match(pattern)\n                        || (i.submitter && i.submitter.person && i.submitter.person.name.match(pattern));\n                });\n            }\n\n            if (this.completedFilter != null) {\n                result = result.filter(i => {\n                    if (this.completedFilter === 1) {\n                        return i.completed_at !== null;\n                    }\n                    return i.completed_at == null;\n                });\n            }\n            return result\n        },\n    },\n    methods: {\n        exportData () {\n            const annual_update_ids = this.filteredItems.map(i => i.id);\n            api.post(`/api/annual-updates/export`, {annual_update_ids})\n                .then(response => {\n                    const a = document.createElement('a');\n                    a.style.display = \"none\";\n                    document.body.appendChild(a);\n\n                    a.href = window.URL.createObjectURL( new Blob([response.data, { type: 'text/csv' }]));\n\n                    a.setAttribute('download', 'annual_updates.csv');\n                    a.click();\n\n                    document.body.removeChild(a);\n                });\n        }\n    }\n}\n</script>\n<template>\n  <div>\n    <div class=\"flex mb-2 items-end justify-between\">\n      <div class=\"flex space-x-4 items-end\">\n        <input \n          v-model=\"filter\" \n          placeholder=\"EP name, submitter name\"\n          class=\"w-60\"\n        >\n        <select v-model=\"completedFilter\" class=\"flex radio-group\">\n          <option :value=\"null\">\n            Any\n          </option>\n          <option :value=\"2\">\n            Only Pending\n          </option>\n          <option :value=\"1\">\n            Only Completed\n          </option>\n        </select>\n      </div>\n      <button class=\"btn btn-xs\" @click=\"exportData\">\n        Export Data\n      </button>\n    </div>\n\n    <data-table v-model:sort=\"sort\" :data=\"filteredItems\" :fields=\"fields\">\n      <template #cell-action=\"{item}\">\n        <router-link :to=\"{name: 'AnnualUpdateDetail', params: {id: item.id}}\">\n          view\n        </router-link>\n      </template>\n    </data-table>\n  </div>\n</template>","<script>\nimport { api } from '@/http';\nimport { orderBy } from 'lodash-es';\n\nimport AnnualUpdateTable from \"@/components/annual_updates/AnnualUpdateTable.vue\";\n\nexport default {\n  name: \"AnnualUpdatesList\",\n  components: {\n    AnnualUpdateTable,\n  },\n  data() {\n    return {\n      selectedWindow: null,\n      windows: [],\n      items: [],\n      loading: false,\n    };\n  },\n  computed: {\n    sortedWindows() {\n      return orderBy(this.windows, \"for_year\", \"desc\");\n    },\n    latestWindow() {\n      return this.sortedWindows[0] || {};\n    },\n    gcepReviews() {\n      return this.items.filter((i) => i.expert_panel.expert_panel_type_id === 1);\n    },\n    vcepReviews() {\n      return this.items.filter((i) => i.expert_panel.expert_panel_type_id === 2);\n    },\n    selectedYear() {\n        return this.selectedWindow ? this.selectedWindow.for_year : this.latestWindow.for_year\n    },\n    selectedStartDate() {\n        return this.selectedWindow ? this.selectedWindow.start : this.latestWindow.start\n    },\n    selectedEndDate() {\n        return this.selectedWindow ? this.selectedWindow.end : this.latestWindow.end\n    }\n  },\n  watch: {\n    selectedWindow (to) {\n        if (to) {\n            this.getItems()\n        }\n    }\n  },\n  mounted() {\n    this.getWindows();\n    this.getItems();\n  },\n  methods: {\n    async getWindows() {\n        this.windows = await api\n            .get(\"/api/annual-updates/windows\")\n            .then((response) => response.data);\n        this.selectedWindow = this.latestWindow;\n    },\n\n    async getItems() {\n        let url = `/api/annual-updates`;\n        if (this.selectedWindow) {\n            url += `?window_id=${this.selectedWindow.id}`\n        }\n        this.loading = true;\n        this.items = await api\n            .get(url)\n            .then((response) => response.data);\n        this.loading = false;\n    },\n  },\n};\n</script>\n<template>\n  <div>\n    <header class=\"flex justify-between items-center border-b mb-4\">\n      <h1 class=\"border-0 mb-0\">\n        Annual Updates for {{ selectedYear }}\n      </h1>\n      {{ formatDate(selectedStartDate) }} - {{ formatDate(selectedEndDate) }}\n      <select\n        v-if=\"windows.length > 1\"\n        v-model=\"selectedWindow\"\n        class=\"font-normal text-md\"\n      >\n        <option\n          v-for=\"window in sortedWindows\"\n          :key=\"window.id\"\n          :value=\"window\"\n        >\n          {{ window.for_year }}\n        </option>\n      </select>\n    </header>\n    <tabs-container>\n      <tab-item label=\"VCEPS\">\n        <div v-if=\"loading\">\n          Loading&hellip;\n        </div>\n        <AnnualUpdateTable v-else :items=\"vcepReviews\" />\n      </tab-item>\n      <tab-item label=\"GCEPS\">\n        <div v-if=\"loading\">\n          Loading&hellip;\n        </div>\n        <AnnualUpdateTable v-else :items=\"gcepReviews\" />\n      </tab-item>\n    </tabs-container>\n  </div>\n</template>\n<style scoped>\n    .radio-group > label {\n    @apply border border-gray-400 px-2 py-1 mb-0;\n    }\n    .radio-group > label:first-child {\n    @apply rounded-l-lg border-r-0;\n    }\n    .radio-group > label:last-child {\n    @apply rounded-r-lg border-l-0;\n    }\n</style>\n"],"names":["orderBy","collection","iteratees","orders","guard","isArray","baseOrderBy","_sfc_main","sort","filter","setupRouterSortAndFilter","item","value","currentQuery","currentPath","updatedQuery","result","pattern","i","annual_update_ids","api","response","a","_hoisted_1","_hoisted_2","_createElementBlock","_createElementVNode","_cache","$event","$setup","$options","args","_createVNode","_component_data_table","$data","_withCtx","_component_router_link","_createTextVNode","AnnualUpdateTable","to","url","_hoisted_3","_toDisplayString","_ctx","_openBlock","_Fragment","_renderList","window","_createCommentVNode","_component_tabs_container","_component_tab_item","_hoisted_4","_createBlock","_component_AnnualUpdateTable","_hoisted_5"],"mappings":"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","x_google_ignoreList":[0]}