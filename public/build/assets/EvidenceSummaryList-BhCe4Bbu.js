import{_ as E,p as C,a2 as N,c as i,d as l,f as u,w as d,C as g,Z as G,F as b,m as x,a as c,D as A,b as m,j as y,e as S,h as D,i as _,a0 as F,a1 as q,aL as j,n as B,a8 as w}from"./app-YZgFRkFe.js";const I={name:"EvidenceSummaryForm",props:{group:{required:!0,type:Object},summary:{required:!0,type:Object}},emits:["saved","canceled"],data(){return{groupGenes:[],summaryClone:{gene:{}},errors:{}}},computed:{},watch:{group:{immediate:!0,handler(){this.group&&this.group.id&&this.getGroupGenes()}},summary:{immediate:!0,handler(){this.summaryClone={...this.summary}}}},methods:{async save(){try{let r=`/api/groups/${this.group.uuid}/expert-panel/evidence-summaries`,e="post";this.summaryClone.id&&(r+=`/${this.summaryClone.id}`,e="put");const n=await C({method:e,url:r,data:this.summaryClone}).then(v=>v.data.data);this.$emit("saved",n),this.$store.commit("pushSuccess","Saved example evidence summary"),this.editing=!1}catch(r){N(r)&&(this.errors=r.response.data.errors)}},cancel(){this.initSummaryClone(),this.$emit("canceled")},edit(r){r.editing=!0},async getGroupGenes(){this.groupGenes=await C.get(`/api/groups/${this.group.uuid}/expert-panel/genes`).then(r=>r.data)},initSummaryClone(){this.summaryClone={gene:{}}}}},U={class:"flex space-x-2"},L=["value"];function O(r,e,n,v,s,t){const o=c("input-row"),p=c("button-row");return m(),i("div",null,[l("div",U,[u(o,{class:"mt-0 mb-0",vertical:!0,label:"Gene",errors:s.errors.gene_id},{default:d(()=>[g(l("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.summaryClone.gene_id=a)},[e[4]||(e[4]=l("option",{value:null}," Select... ",-1)),(m(!0),i(b,null,x(s.groupGenes,a=>(m(),i("option",{key:a.id,value:a.id},y(a.gene_symbol),9,L))),128))],512),[[G,s.summaryClone.gene_id]])]),_:1},8,["errors"]),u(o,{modelValue:s.summaryClone.variant,"onUpdate:modelValue":e[1]||(e[1]=a=>s.summaryClone.variant=a),class:"mt-0 mb-0",vertical:!0,label:"Variant",errors:s.errors.variant},null,8,["modelValue","errors"])]),u(o,{class:"mt-0 mb-0",label:"Summary",vertical:!0,errors:s.errors.summary},{default:d(()=>[g(l("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.summaryClone.summary=a),rows:"5",class:"w-full"},null,512),[[A,s.summaryClone.summary]])]),_:1},8,["errors"]),u(o,{modelValue:s.summaryClone.vci_url,"onUpdate:modelValue":e[3]||(e[3]=a=>s.summaryClone.vci_url=a),class:"mt-0",label:"VCI URL",vertical:!0,"input-class":"w-full",errors:s.errors.vci_url},null,8,["modelValue","errors"]),u(p,{"submit-text":"save",onSubmit:t.save,onCancel:t.cancel},null,8,["onSubmit","onCancel"])])}const k=E(I,[["render",O]]),T={name:"EvidenceSummary",components:{EvidenceSummaryForm:k},props:{summary:{required:!0,type:Object},group:{required:!0,type:Object},readonly:{type:Boolean,required:!1,default:!1}},emits:["edit","saved","deleted"],data(){return{editing:!1,showDeleteConfirm:!1}},computed:{canEdit(){return this.hasAnyPermission(["ep-applications-manage",["application-edit",this.group]])&&!this.readonly}},methods:{handleSaved(r){this.$emit("saved",r),this.editing=!1},edit(){this.editing=!0},cancelEdit(){this.editing=!1},confirmDelete(){this.showDeleteConfirm=!0},async deleteSummary(){try{await C.delete(`/api/groups/${this.group.uuid}/expert-panel/evidence-summaries/${this.summary.id}`),this.$emit("deleted",this.summary)}catch(r){console.error(r)}this.showDeleteConfirm=!1},cancelDelete(){this.showDeleteConfirm=!1}}},M={key:0,class:"p-2 border rounded"},P={class:"flex justify-between"},R=["href"];function Y(r,e,n,v,s,t){const o=c("dropdown-item"),p=c("dropdown-menu"),a=c("EvidenceSummaryForm"),h=c("button-row"),V=c("modal-dialog");return m(),i("div",null,[u(F,{mode:"out-in",name:"fade"},{default:d(()=>[s.editing?(m(),S(a,{key:1,summary:n.summary,group:n.group,onSaved:t.handleSaved,onCanceled:t.cancelEdit},null,8,["summary","group","onSaved","onCanceled"])):(m(),i("div",M,[l("header",P,[l("h4",null,y(n.summary.gene.gene_symbol)+" - "+y(n.summary.variant),1),t.canEdit?(m(),S(p,{key:0,"hide-cheveron":!0,class:"relative"},{label:d(()=>e[3]||(e[3]=[l("button",{class:"btn btn-xs"}," â€¦ ",-1)])),default:d(()=>[u(o,{onClick:e[0]||(e[0]=f=>t.edit())},{default:d(()=>e[4]||(e[4]=[_(" Edit ")])),_:1}),u(o,{onClick:e[1]||(e[1]=f=>t.confirmDelete())},{default:d(()=>e[5]||(e[5]=[_(" Delete ")])),_:1})]),_:1})):D("",!0)]),l("p",null,y(n.summary.summary),1),n.summary.vci_url?(m(),i("a",{key:0,class:"link",href:n.summary.vci_url,target:"_blank"}," View in the VCI ",8,R)):D("",!0)]))]),_:1}),(m(),S(q,{to:"body"},[u(V,{modelValue:s.showDeleteConfirm,"onUpdate:modelValue":e[2]||(e[2]=f=>s.showDeleteConfirm=f),title:"You are about to delete an example evidence summary."},{default:d(()=>[_(" You are about to delete an evidence summary for "+y(n.summary.gene.gene_symbol)+" - "+y(n.summary.variant)+". Are you sure you want to continue? ",1),u(h,{"submit-text":"Delete Summary",onSubmit:t.deleteSummary,onCancel:t.cancelDelete},null,8,["onSubmit","onCancel"])]),_:1},8,["modelValue"])]))])}const z=E(T,[["render",Y]]),Z={name:"EvidenceSummaryList",components:{EvidenceSummary:z,EvidenceSummaryForm:k},props:{readonly:{type:Boolean,required:!1,default:!1}},emits:["summariesAdded"],data(){return{newSummaries:[],errors:{},summaries:[],showDeleteConfirm:!1,selectedSummary:{gene:{}},loading:!1}},computed:{group:{get(){return this.$store.getters["groups/currentItemOrNew"]},set(r){this.$store.commit("groups/addItem",r)}},meetsRequirements(){return this.summaries.length>4},adding(){return this.newSummaries.length>0},canEdit(){return this.hasAnyPermission(["ep-applications-manage",["application-edit",this.group]])&&!this.readonly}},watch:{group:{immediate:!0,handler(){this.group&&this.group.id&&this.getEvidenceSummaries()}}},methods:{async getEvidenceSummaries(){this.loading=!0;try{this.summaries=await this.$store.dispatch("groups/getEvidenceSummaries",this.group)}catch(r){console.log(r)}this.loading=!1},startNewSummary(){this.readonly||this.newSummaries.push({gene:null,variant:null,summary:null})},clearNewSummaries(){this.newSummaries=[]},handleSavedSummary(){this.getEvidenceSummaries(),this.clearNewSummaries(),this.$emit("summariesAdded")},handleDeleted(r){const e=this.summaries.findIndex(n=>n.id===r.id);e>-1&&this.summaries.splice(e,1),this.getEvidenceSummaries()},cancelAdd(){this.clearNewSummaries()},mergeSummary(r){const e=this.summaries.findIndex(n=>n.id===r.id);if(e>-1){this.summaries.splice(e,1,r);return}this.summaries.push(r)}}},H={key:0},J={class:"text-lg pr-4"},K={key:1,class:"well text-center"},Q={class:"text-lg pr-4"};function W(r,e,n,v,s,t){const o=c("EvidenceSummary"),p=c("EvidenceSummaryForm");return m(),i("div",null,[s.summaries.length>0?(m(),i("ul",H,[u(j,{name:"slide-fade-down"},{default:d(()=>[(m(!0),i(b,null,x(t.group.expert_panel.evidence_summaries,(a,h)=>(m(),i("li",{key:h,class:"my-4 flex"},[l("div",J,y(h+1),1),u(o,{summary:a,group:t.group,class:"flex-1",readonly:n.readonly,onSaved:t.handleSavedSummary,onDeleted:t.handleDeleted},null,8,["summary","group","readonly","onSaved","onDeleted"])]))),128))]),_:1})])):s.loading?(m(),i("div",K," Loading... ")):(m(),i("div",{key:2,class:B(["well text-center",{"cursor-pointer":!n.readonly}]),onClick:e[0]||(e[0]=(...a)=>t.startNewSummary&&t.startNewSummary(...a))}," No example evidence summaries have been added. ",2)),g(l("ul",null,[(m(!0),i(b,null,x(s.newSummaries,(a,h)=>(m(),i("li",{key:h,class:"my-4 flex"},[l("div",Q,y(h+1+s.summaries.length),1),u(p,{class:"flex-1",group:t.group,summary:a,onSaved:t.handleSavedSummary,onCanceled:t.cancelAdd},null,8,["group","summary","onSaved","onCanceled"])]))),128))],512),[[w,t.adding]]),g(l("div",null,[g(l("button",{class:"btn btn-xs",onClick:e[1]||(e[1]=(...a)=>t.startNewSummary&&t.startNewSummary(...a))}," Add Summary ",512),[[w,!t.adding]])],512),[[w,!t.adding&&t.canEdit]])])}const $=E(Z,[["render",W]]);export{$ as E};
//# sourceMappingURL=EvidenceSummaryList-BhCe4Bbu.js.map
